var loadScript;function loadJS(a){""!=a&&(unloadJS(),loadScript=document.createElement("script"),loadScript.setAttribute("type","text/javascript"),loadScript.setAttribute("src",a),loadScript.setAttribute("Id","loadedJS"),loadScript.setAttribute("onerror","alert('Error loading file!');"),"undefined"!=typeof loadScript?document.getElementsByTagName("head")[0].appendChild(loadScript):alert("Error loading script!"))}
function unloadJS(){var a=document.getElementById("loadedJS");a&&a.parentNode.removeChild(a)}function AEObject(){this.getParamList=function(){};this.run=function(){}}var axesPicked,axesN,axesNmax,xyAxes,axesAlignmentData=[],plotType;
function initiatePlotAlignment(){axesPicked=0;xyEl=document.getElementById("r_xy");polarEl=document.getElementById("r_polar");ternaryEl=document.getElementById("r_ternary");mapEl=document.getElementById("r_map");imageEl=document.getElementById("r_image");closePopup("axesList");!0==xyEl.checked?setAxes("XY"):!0==polarEl.checked?setAxes("polar"):!0==ternaryEl.checked?setAxes("ternary"):!0==mapEl.checked?setAxes("map"):!0==imageEl.checked&&setAxes("image")}
function setAxes(a){plotType=a;clearSidebar();removeAllMouseEvents();addMouseEvent("click",pickCorners,!0);axesN=0;xyAxes=[];"XY"===plotType||"bar"===plotType?(axesNmax=4,showPopup("xyAxesInfo")):"polar"===plotType?(axesNmax=3,showPopup("polarAxesInfo")):"ternary"===plotType?(axesNmax=3,showPopup("ternaryAxesInfo")):"map"===plotType?(axesNmax=2,showPopup("mapAxesInfo")):"image"===plotType&&(axesNmax=0,alignAxes())}
function pickCorners(a){if(axesN<axesNmax){var c=getPosition(a),b=c.x,c=c.y;xyAxes[axesN]=[];xyAxes[axesN][0]=parseFloat(b);xyAxes[axesN][1]=parseFloat(c);axesN+=1;dataCtx.beginPath();dataCtx.fillStyle="rgb(0,0,200)";dataCtx.arc(b,c,3,0,2*Math.PI,!0);dataCtx.fill();updateZoom(a);axesN===axesNmax&&(axesPicked=1,removeMouseEvent("click",pickCorners,!0),"XY"===plotType?showPopup("xyAlignment"):"polar"===plotType?showPopup("polarAlignment"):"ternary"===plotType?showPopup("ternaryAlignment"):"map"===plotType&&
showPopup("mapAlignment"),dataCanvas.width=dataCanvas.width)}}
function alignAxes(){if("XY"===plotType){var a=document.getElementById("xmin"),c=document.getElementById("xmax"),b=document.getElementById("ymin"),f=document.getElementById("ymax"),e=document.getElementById("xlog"),d=document.getElementById("ylog");axesAlignmentData[0]=parseFloat(a.value);axesAlignmentData[1]=parseFloat(c.value);axesAlignmentData[2]=parseFloat(b.value);axesAlignmentData[3]=parseFloat(f.value);axesAlignmentData[4]=!0===e.checked?!0:!1;axesAlignmentData[5]=!0===d.checked?!0:!1;closePopup("xyAlignment")}else"polar"==
plotType?(a=document.getElementById("rpoint1"),c=document.getElementById("thetapoint1"),b=document.getElementById("rpoint2"),f=document.getElementById("thetapoint2"),e=document.getElementById("degrees"),document.getElementById("radians"),d=document.getElementById("clockwise"),axesAlignmentData[0]=parseFloat(a.value),axesAlignmentData[1]=parseFloat(c.value),axesAlignmentData[2]=parseFloat(b.value),axesAlignmentData[3]=parseFloat(f.value),axesAlignmentData[4]=!0===e.checked?!0:!1,axesAlignmentData[5]=
!0===d.checked?!0:!1,closePopup("polarAlignment")):"ternary"===plotType?(document.getElementById("range0to1"),a=document.getElementById("range0to100"),c=document.getElementById("ternarynormal"),axesAlignmentData[0]=!0===a.checked?!0:!1,axesAlignmentData[1]=!0===c.checked?!0:!1,closePopup("ternaryAlignment")):"map"===plotType?(a=document.getElementById("scaleLength"),axesAlignmentData[0]=parseFloat(a.value),closePopup("mapAlignment")):"image"===plotType&&(axesPicked=1,axesAlignmentData[0]=imageDimensions[0],
axesAlignmentData[1]=imageDimensions[2],axesAlignmentData[2]=imageDimensions[1],axesAlignmentData[3]=imageDimensions[3]);1===axesPicked&&acquireData()}var fg_color=[0,0,0],bg_color=[255,255,255],colorPickerMode="fg",testImgCanvas,testImgContext,boxCoordinates=[0,0,1,1],drawingBox=!1,drawingPen=!1,drawingEraser=!1,binaryData;function colorPickerWindow(a){colorPickerMode=a;"fg"===a?showPopup("colorPickerFG"):"bg"===a&&showPopup("colorPickerBG")}
function pickColor(){removeAllMouseEvents();addMouseEvent("click",colorPicker,!0)}
function colorPicker(a){var c=getPosition(a);a=c.x;var b=c.y,c=ctx.getImageData(cx0,cy0,currentImageWidth,currentImageHeight);if(a<currentImageWidth+cx0&&b<currentImageHeight+cy0&&a>cx0&&b>cy0){a=4*(b-cy0)*currentImageWidth+4*(a-cx0);a=[c.data[a],c.data[a+1],c.data[a+2]];var c=document.getElementById("color_red"),b=document.getElementById("color_green"),f=document.getElementById("color_blue");removeMouseEvent("click",colorPicker,!0);"fg"===colorPickerMode?(assignColor("fg",a),c=document.getElementById("color_red_fg"),
b=document.getElementById("color_green_fg"),f=document.getElementById("color_blue_fg"),showPopup("colorPickerFG")):"bg"===colorPickerMode&&(assignColor("bg",a),c=document.getElementById("color_red_bg"),b=document.getElementById("color_green_bg"),f=document.getElementById("color_blue_bg"),showPopup("colorPickerBG"));c.value=a[0];b.value=a[1];f.value=a[2]}}
function assignColor(a,c){"fg"===a?(c||(redEl=document.getElementById("color_red_fg"),greenEl=document.getElementById("color_green_fg"),blueEl=document.getElementById("color_blue_fg"),c=[],c[0]=redEl.value,c[1]=greenEl.value,c[2]=blueEl.value),fg_color=c,document.getElementById("autoFGBtn").style.borderColor="rgb("+fg_color[0]+","+fg_color[1]+","+fg_color[2]+")"):"bg"===a&&(c||(redEl=document.getElementById("color_red_bg"),greenEl=document.getElementById("color_green_bg"),blueEl=document.getElementById("color_blue_bg"),
c=[],c[0]=redEl.value,c[1]=greenEl.value,c[2]=blueEl.value),bg_color=c,document.getElementById("autoBGBtn").style.borderColor="rgb("+bg_color[0]+","+bg_color[1]+","+bg_color[2]+")")}function boxPaint(){removeAllMouseEvents();addMouseEvent("mousedown",boxPaintMousedown,!0);addMouseEvent("mouseup",boxPaintMouseup,!0);addMouseEvent("mousemove",boxPaintMousedrag,!0)}function boxPaintMousedown(a){a=getPosition(a);boxCoordinates[0]=a.x;boxCoordinates[1]=a.y;drawingBox=!0}
function boxPaintMouseup(a){a=getPosition(a);boxCoordinates[2]=a.x;boxCoordinates[3]=a.y;hoverCanvas.width=hoverCanvas.width;dataCtx.fillStyle="rgba(255,255,0,1)";dataCtx.fillRect(boxCoordinates[0],boxCoordinates[1],boxCoordinates[2]-boxCoordinates[0],boxCoordinates[3]-boxCoordinates[1]);drawingBox=!1}
function boxPaintMousedrag(a){if(!0===drawingBox){var c=getPosition(a);a=c.x;c=c.y;hoverCanvas.width=hoverCanvas.width;hoverCtx.strokeStyle="rgb(0,0,0)";hoverCtx.strokeRect(boxCoordinates[0],boxCoordinates[1],a-boxCoordinates[0],c-boxCoordinates[1])}}function penPaint(){removeAllMouseEvents();showToolbar("paintToolbar");addMouseEvent("mousedown",penPaintMousedown,!0);addMouseEvent("mouseup",penPaintMouseup,!0);addMouseEvent("mousemove",penPaintMousedrag,!0)}
function penPaintMousedown(a){if(!1===drawingPen){var c=getPosition(a);a=c.x;c=c.y;drawingPen=!0;ctx.strokeStyle="rgba(255,255,0,1)";thkRange=document.getElementById("paintThickness");dataCtx.lineWidth=parseInt(thkRange.value);dataCtx.beginPath();dataCtx.moveTo(a,c)}}function penPaintMouseup(a){dataCtx.closePath();dataCtx.lineWidth=1;drawingPen=!1}
function penPaintMousedrag(a){if(!0===drawingPen){var c=getPosition(a);a=c.x;c=c.y;dataCtx.strokeStyle="rgba(255,255,0,1)";dataCtx.lineTo(a,c);dataCtx.stroke()}}function eraser(){removeAllMouseEvents();showToolbar("paintToolbar");addMouseEvent("mousedown",eraserMousedown,!0);addMouseEvent("mouseup",eraserMouseup,!0);addMouseEvent("mousemove",eraserMousedrag,!0);dataCtx.globalCompositeOperation="destination-out"}
function eraserMousedown(a){if(!1===drawingEraser){var c=getPosition(a);a=c.x;c=c.y;drawingEraser=!0;dataCtx.globalCompositeOperation="destination-out";dataCtx.strokeStyle="rgba(0,0,0,1)";thkRange=document.getElementById("paintThickness");dataCtx.lineWidth=parseInt(thkRange.value);dataCtx.beginPath();dataCtx.moveTo(a,c)}}function eraserMouseup(a){dataCtx.closePath();dataCtx.lineWidth=1;dataCtx.globalCompositeOperation="source-over";drawingEraser=!1}
function eraserMousedrag(a){if(!0===drawingEraser){var c=getPosition(a);a=c.x;c=c.y;dataCtx.globalCompositeOperation="destination-out";dataCtx.strokeStyle="rgba(0,0,0,1)";dataCtx.lineTo(a,c);dataCtx.stroke()}}
function updateTestWindow(){colorModeEl=document.getElementById("colorModeFG");colorDistanceEl=document.getElementById("colorDistance");!0===colorModeEl.checked?(colmode="fg",chosenColor=fg_color):(colmode="bg",chosenColor=bg_color);cdistance=parseInt(colorDistanceEl.value);tempImgCanvas=document.createElement("canvas");tempImgCanvas.width=canvasWidth;tempImgCanvas.height=canvasHeight;tempImgContext=tempImgCanvas.getContext("2d");timgData=tempImgContext.getImageData(0,0,canvasWidth,canvasHeight);
timgData=getImageDataBasedOnSelection(timgData,colmode,chosenColor,cdistance);tempImgContext.putImageData(timgData,0,0);testImage=tempImgCanvas.toDataURL();var a=document.createElement("img");a.onload=function(){testImgContext.drawImage(a,0,0,canvasWidth/2,canvasHeight/2);processingNote(!1)};a.src=testImage}function saveTest(){window.open().location=testImgCanvas.toDataURL()}function launchTestWindow(){processingNote(!0);setTimeout("updateTestWindow();showPopup('testImageWindow');",100)}
function scanPlot(){autoStepEl=document.getElementById("autostepalgo");xStepEl=document.getElementById("xstepalgo");yStepEl=document.getElementById("ystepalgo");var a=document.getElementById("colorModeFG"),c=document.getElementById("colorDistance");!0===a.checked?(a="fg",chosenColor=fg_color):(a="bg",chosenColor=bg_color);cdistance=parseInt(c.value);closePopup("testImageWindow");binaryData=selectFromMarkedRegion(a,chosenColor,cdistance);xyData=[];pointsPicked=0;resetLayers();AEObject.run();pointsStatus(pointsPicked);
for(c=0;c<pointsPicked;c++)dataCtx.beginPath(),dataCtx.fillStyle="rgb(200,0,200)",dataCtx.arc(xyData[c][0],xyData[c][1],3,0,2*Math.PI,!0),dataCtx.fill()}function displayParameters(){var a=document.getElementById("curvesAlgoSelect");document.getElementById("paramZone");var c=document.getElementById("URLinput");"customAlgorithm"!==a.value&&(c.style.display="none",AEObject=window[a.value],makeParameterTable())}
function makeParameterTable(){if(AEObject.getParamList){var a=AEObject.getParamList(),c=document.getElementById("paramZone");c.innerHTML="";for(var b=0;b<a.length;b++)c.innerHTML+="<p>"+a[b][0]+" ("+a[b][1]+") <input type='text' value='"+a[b][2]+"' size=3 id='pv"+b+"'></p>"}}
var mainCanvas,dataCanvas,drawCanvas,hoverCanvas,topCanvas,cx0,cy0,canvasWidth,canvasHeight,cwidth,cheight,caspectratio,currentImage,originalImage,currentImageHeight,currentImageWidth,currentImageData,imageDimensions=[],onScreenDimensions=[],ctx,dataCtx,drawCtx,hoverCtx,topCtx,originalScreen,mainScreen,dataScreen,drawScreen,hoverScreen,topScreen;
function loadImage(a){var c=parseInt(a.height),b=parseInt(a.width),f=c/b,e=c,d=b;f>caspectratio?(e=cheight,d=cheight/f):(d=cwidth,e=cwidth*f);currentImage=a;currentImageHeight=parseInt(e);currentImageWidth=parseInt(d);ctx.fillStyle="rgb(255,255,255)";ctx.fillRect(0,0,canvasWidth,canvasHeight);ctx.drawImage(a,cx0,cy0,d,e);currentScreen=getCanvasData();imageDimensions[0]=0;imageDimensions[1]=0;imageDimensions[2]=b;imageDimensions[3]=c;onScreenDimensions[0]=cx0;onScreenDimensions[1]=cy0;onScreenDimensions[2]=
d+cx0;onScreenDimensions[3]=e+cy0}function saveCanvasImage(){var a=ctx.getImageData(cx0,cy0,currentImageWidth,currentImageHeight),c=document.createElement("canvas");c.width=currentImageWidth;c.height=currentImageHeight;tCanvasContext=c.getContext("2d");tCanvasContext.putImageData(a,0,0);newImage=document.createElement("img");newImage.src=c.toDataURL();newImage.onload=function(){currentImage=newImage;currentScreen=getCanvasData()}}
function getCanvasData(){return ctx.getImageData(0,0,canvasWidth,canvasHeight)}function putCanvasData(a){mainCanvas.width=mainCanvas.width;ctx.putImageData(a,0,0)}function reloadPlot(){mainCanvas.width=mainCanvas.width;ctx.drawImage(currentImage,cx0,cy0,currentImageWidth,currentImageHeight)}function redrawCanvas(){mainCanvas.width=mainCanvas.width;putCanvasData(currentScreen)}
function resetLayers(){dataCanvas.width=dataCanvas.width;drawCanvas.width=drawCanvas.width;hoverCanvas.width=hoverCanvas.width;topCanvas.width=topCanvas.width}function savePNG(){window.open().location=mainCanvas.toDataURL()}function getPosition(a){var c=mainCanvas.getBoundingClientRect();return{x:parseInt(a.pageX-(c.left+window.pageXOffset+1),10),y:parseInt(a.pageY-(c.top+window.pageYOffset+1),10)}}function dropHandler(a){a=a.dataTransfer.files;1==a.length&&fileLoader(a[0])}
function pasteHandler(a){console.log("paste");console.log(a)}function fileLoader(a){if(a.type.match("image.*")){var c=new FileReader;c.onload=function(){var a=c.result,f=document.createElement("img");f.onload=function(){loadImage(f);originalScreen=getCanvasData();originalImage=f;setDefaultState()};f.src=a};c.readAsDataURL(a)}}function loadNewFile(){var a=document.getElementById("fileLoadBox");1==a.files.length&&fileLoader(a.files[0]);closePopup("loadNewImage")}var dataToPixelxy;
function pixelToData(a,c,b){if(1===axesPicked&&1<=c){var f=[];if("XY"===b){b=xyAxes[0][0];var e=xyAxes[0][1],d=xyAxes[1][0],g=xyAxes[1][1],h=xyAxes[2][0],k=xyAxes[2][1],l=xyAxes[3][0],r=xyAxes[3][1],m=axesAlignmentData[0],p=axesAlignmentData[1],n=axesAlignmentData[2],q=axesAlignmentData[3];!0===axesAlignmentData[4]&&(m=Math.log(m)/Math.log(10),p=Math.log(p)/Math.log(10));!0===axesAlignmentData[5]&&(n=Math.log(n)/Math.log(10),q=Math.log(q)/Math.log(10));var p=p-m,q=q-n,t=Math.sqrt((b-d)*(b-d)+(e-g)*
(e-g)),s=Math.sqrt((h-l)*(h-l)+(k-r)*(k-r)),p=p/t,q=q/s,s=taninverse(-(g-e),d-b),r=taninverse(-(r-k),l-h),t=r-s;for(ii=0;ii<c;ii++){var d=a[ii][0],g=a[ii][1],l=Math.sqrt((d-b)*(d-b)+(g-e)*(g-e)),u=taninverse(-(g-e),d-b)-s,l=l*Math.cos(u)-l*Math.sin(u)/Math.tan(t),l=l*p+m,u=Math.sqrt((d-h)*(d-h)+(g-k)*(g-k)),d=r-taninverse(-(g-k),d-h),d=u*Math.cos(d)-u*Math.sin(d)/Math.tan(t),d=d*q+n;!0===axesAlignmentData[4]&&(l=Math.pow(10,l));!0===axesAlignmentData[5]&&(d=Math.pow(10,d));f[ii]=[];f[ii][0]=l;f[ii][1]=
d}}else if("image"===b){b=onScreenDimensions[0];e=onScreenDimensions[1];d=onScreenDimensions[2];g=onScreenDimensions[1];h=onScreenDimensions[0];k=onScreenDimensions[1];l=onScreenDimensions[0];r=onScreenDimensions[3];m=axesAlignmentData[0];p=axesAlignmentData[1];n=axesAlignmentData[2];q=axesAlignmentData[3];p-=m;q-=n;t=Math.sqrt((b-d)*(b-d)+(e-g)*(e-g));s=Math.sqrt((h-l)*(h-l)+(k-r)*(k-r));p/=t;q/=s;s=taninverse(-(g-e),d-b);r=taninverse(-(r-k),l-h);t=r-s;for(ii=0;ii<c;ii++)d=a[ii][0],g=a[ii][1],l=
Math.sqrt((d-b)*(d-b)+(g-e)*(g-e)),u=taninverse(-(g-e),d-b)-s,l=l*Math.cos(u)-l*Math.sin(u)/Math.tan(t),l=l*p+m,u=Math.sqrt((d-h)*(d-h)+(g-k)*(g-k)),d=r-taninverse(-(g-k),d-h),d=u*Math.cos(d)-u*Math.sin(d)/Math.tan(t),d=d*q+n,f[ii]=[],f[ii][0]=parseInt(l,10),f[ii][1]=parseInt(d,10)}else if("map"===b){my0=canvasHeight;my2=my1=0;h=canvasWidth;my3=canvasHeight;b=0;e=-(my1-my0);h-=0;k=-(my3-my0);m=xyAxes[0][0];n=xyAxes[0][1];d=xyAxes[1][0];g=xyAxes[1][1];d=axesAlignmentData[0]/Math.sqrt((m-d)*(m-d)+(n-
g)*(n-g));m=0;p=canvasWidth*d;n=0;q=canvasHeight*d;p-=m;q-=n;g=b*k-e*h;for(ii=0;ii<c;ii++)d=a[ii][0]-0,s=-(a[ii][1]-my0),l=(-e*p*d+b*p*s)/g+m,d=(k*q*d-h*q*s)/g+n,f[ii]=[],f[ii][0]=l,f[ii][1]=d}else if("polar"===b){m=parseFloat(xyAxes[0][0]);n=parseFloat(xyAxes[0][1]);b=parseFloat(xyAxes[1][0]);e=parseFloat(xyAxes[1][1]);d=parseFloat(xyAxes[2][0]);g=parseFloat(xyAxes[2][1]);h=parseFloat(axesAlignmentData[0]);s=parseFloat(axesAlignmentData[1]);k=parseFloat(axesAlignmentData[2]);parseFloat(axesAlignmentData[3]);
p=axesAlignmentData[4];!0===p&&(s*=Math.PI/180);q=Math.sqrt((b-m)*(b-m)+(e-n)*(e-n));l=Math.sqrt((d-m)*(d-m)+(g-n)*(g-n))-q;b=taninverse(-(e-n),b-m);b-=s;for(ii=0;ii<c;ii++)d=a[ii][0],g=a[ii][1],e=(k-h)/l*(Math.sqrt((d-m)*(d-m)+(g-n)*(g-n))-q)+h,d=taninverse(-(g-n),d-m)-b,!0==p&&(d=180*d/Math.PI),f[ii]=[],f[ii][0]=e,f[ii][1]=d}else if("ternary"===plotType){m=xyAxes[0][0];n=xyAxes[0][1];b=xyAxes[1][0];e=xyAxes[1][1];h=Math.sqrt((m-b)*(m-b)+(n-e)*(n-e));b=taninverse(-(e-n),b-m);k=Math.sqrt(3);p=axesAlignmentData[0];
q=axesAlignmentData[1];for(ii=0;ii<c;ii++)d=a[ii][0],g=a[ii][1],e=Math.sqrt((d-m)*(d-m)+(g-n)*(g-n)),d=taninverse(-(g-n),d-m)-b,g=e*Math.cos(d)/h,l=e*Math.sin(d)/h,e=1-g-l/k,d=g-l/k,g=2*l/k,!1==q&&(l=d,d=e,e=g,g=l),!0==p&&(e*=100,d*=100,g*=100),f[ii]=[],f[ii][0]=e,f[ii][1]=d,f[ii][2]=g}return f}return 0}
function dataToPixel(a,c,b){dataToPixelxy=[];if("XY"===b){var f=xyAxes[0][0],e=xyAxes[0][1],d=xyAxes[1][0],g=xyAxes[1][1],h=xyAxes[2][0];b=xyAxes[2][1];var k=xyAxes[3][0],l=xyAxes[3][1],r=axesAlignmentData[0],m=axesAlignmentData[1],p=axesAlignmentData[2],n=axesAlignmentData[3];!0===axesAlignmentData[4]&&(r=Math.log(r)/Math.log(10),m=Math.log(m)/Math.log(10));!0===axesAlignmentData[5]&&(p=Math.log(p)/Math.log(10),n=Math.log(n)/Math.log(10));var q=(f-d)*(b-l)-(e-g)*(h-k),t=[[]];t[0][0]=((f*g-e*d)*(h-
k)-(f-d)*(h*l-b*k))/q;t[0][1]=((f*g-e*d)*(b-l)-(e-g)*(h*l-b*k))/q;var t=pixelToData(t,1,"XY"),q=t[0][0],t=t[0][1],m=m-r,s=n-p,n=Math.sqrt((f-d)*(f-d)+(e-g)*(e-g)),u=Math.sqrt((h-k)*(h-k)+(b-l)*(b-l)),n=m/n,m=s/u,e=taninverse(-(g-e),d-f),h=taninverse(-(l-b),k-h),f=(a-r)*Math.cos(e)/n+(c-t)*Math.cos(h)/m+f;a=b-(a-q)*Math.sin(e)/n-(c-p)*Math.sin(h)/m;dataToPixelxy[0]=f;dataToPixelxy[1]=a}return 0}var rawCSVData;
function generateCSV(){if(1===axesPicked&&1<=pointsPicked){showPopup("csvWindow");rawCSVData=pixelToData(xyData,pointsPicked,plotType);generateCSVTextFromData(rawCSVData);document.getElementById("dataSortOrder");var a=document.getElementById("dataSortOption"),c=document.getElementById("dataVariables");a.innerHTML='<option value="raw">Raw Output</option>';"XY"===plotType||"map"===plotType||"image"===plotType?(a.innerHTML+='<option value="0">x</option>',a.innerHTML+='<option value="1">y</option>',c.innerHTML=
"x, y"):"ternary"===plotType?(a.innerHTML+='<option value="0">a</option>',a.innerHTML+='<option value="1">b</option>',a.innerHTML+='<option value="2">c</option>',c.innerHTML="a, b, c"):"polar"===plotType&&(a.innerHTML+='<option value="0">r</option>',a.innerHTML+='<option value="1">\u0398</option>',c.innerHTML="r, \u0398");a.innerHTML+='<option value="Connectivity">Connectivity</option>';updateCSVSortingControls()}}
function selectAllCSVData(){var a=document.getElementById("tarea");a.focus();a.select()}function updateCSVSortingControls(){var a=document.getElementById("dataSortOption"),c=document.getElementById("dataSortOrder");"Connectivity"===a.value||"raw"===a.value?c.setAttribute("disabled",!0):c.removeAttribute("disabled")}
function generateCSVTextFromData(a){var c=document.getElementById("tarea");c.value="";if("XY"===plotType||"map"===plotType||"polar"===plotType||"image"===plotType)for(var b=0;b<pointsPicked;b++)c.value=c.value+a[b][0]+","+a[b][1]+"\n";else if("ternary"===plotType)for(b=0;b<pointsPicked;b++)c.value=c.value+a[b][0]+","+a[b][1]+","+a[b][2]+"\n"}
function reSortCSV(){var a=document.getElementById("dataSortOption"),c="ascending"===document.getElementById("dataSortOrder").value,b="raw"==a.value,f="Connectivity"===a.value,e,d=rawCSVData.slice(0),g="ternary"===plotType?3:2;if(b)generateCSVTextFromData(d);else if(f){if(f){for(var h,f=[1,1,1],k=0;k<pointsPicked-1;k++){for(var b=-1,l=k+1;l<pointsPicked;l++)if(a=(d[k][0]-d[l][0])*(d[k][0]-d[l][0])+(d[k][1]-d[l][1])*(d[k][1]-d[l][1]),3===g&&(a+=(d[k][2]-d[l][2])*(d[k][2]-d[l][2])),a<h||-1===b)h=a,
b=l;f[0]=d[b][0];d[b][0]=d[k+1][0];d[k+1][0]=f[0];f[1]=d[b][1];d[b][1]=d[k+1][1];d[k+1][1]=f[1];3===g&&(f[2]=d[b][2],d[b][2]=d[k+1][2],d[k+1][2]=f[2])}generateCSVTextFromData(d)}}else e=parseInt(a.value,10),0>e||3<=e||(d.sort(function(a,b){return a[e]>b[e]?c?1:-1:a[e]<b[e]?c?-1:1:0}),generateCSVTextFromData(d))}var cropStatus=0,cropCoordinates=[0,0,0,0];
function hflip(){processingNote(!0);for(var a=ctx.getImageData(cx0,cy0,currentImageWidth,currentImageHeight),c=0;c<currentImageHeight;c++)for(var b=0;b<currentImageWidth/2;b++)for(var f=4*c*currentImageWidth+4*b,e=4*(c+1)*currentImageWidth-4*(b+1),d=0;4>d;d++){var g=a.data[f+d];a.data[f+d]=a.data[e+d];a.data[e+d]=g}ctx.putImageData(a,cx0,cy0);saveCanvasImage();processingNote(!1)}
function vflip(){processingNote(!0);for(var a=ctx.getImageData(cx0,cy0,currentImageWidth,currentImageHeight),c=0;c<currentImageWidth;c++)for(var b=0;b<currentImageHeight/2;b++)for(var f=4*b*currentImageWidth+4*c,e=4*(currentImageHeight-(b+2))*currentImageWidth+4*c,d=0;4>d;d++){var g=a.data[f+d];a.data[f+d]=a.data[e+d];a.data[e+d]=g}ctx.putImageData(a,cx0,cy0);saveCanvasImage();processingNote(!1)}
function cropPlot(){redrawCanvas();removeAllMouseEvents();addMouseEvent("mousedown",cropMousedown,!0);addMouseEvent("mouseup",cropMouseup,!0);addMouseEvent("mousemove",cropMousemove,!0)}function cropMousedown(a){cropCoordinates[0]=parseInt(a.layerX);cropCoordinates[1]=parseInt(a.layerY);cropStatus=1}
function cropMouseup(a){cropCoordinates[2]=parseInt(a.layerX);cropCoordinates[3]=parseInt(a.layerY);cropStatus=0;hoverCanvas.width=hoverCanvas.width;cropWidth=cropCoordinates[2]-cropCoordinates[0];cropHeight=cropCoordinates[3]-cropCoordinates[1];if(0<cropWidth&&0<cropHeight){a=document.createElement("canvas");var c=a.getContext("2d");a.width=cropWidth;a.height=cropHeight;var b=ctx.getImageData(cropCoordinates[0],cropCoordinates[1],cropWidth,cropHeight);c.putImageData(b,0,0);cropSrc=a.toDataURL();
cropImg=new Image;cropImg.src=cropSrc;cropImg.onload=function(){loadImage(cropImg)}}}function cropMousemove(a){1==cropStatus&&(hoverCanvas.width=hoverCanvas.width,hoverCtx.strokeStyle="rgb(0,0,0)",hoverCtx.strokeRect(cropCoordinates[0],cropCoordinates[1],parseInt(a.layerX)-cropCoordinates[0],parseInt(a.layerY)-cropCoordinates[1]))}function restoreOriginalImage(){loadImage(originalImage)}function rotateCanvas(){}
function findDifference(a,c){for(var b=canvasWidth,f=canvasHeight,e=[],d=0;d<f;d++){e[d]=[];for(var g=0;g<b;g++){var h=4*d*b+4*g;e[d][g]=!1;for(var k=0;4>k;k++)a.data[h+k]!=c.data[h+k]&&(e[d][g]=!0)}}return e}function copyUsingDifference(a,c,b){for(var f=canvasWidth,e=canvasHeight,d=0;d<e;d++)for(var g=0;g<f;g++){var h=4*d*f+4*g;if(!0===b[d][g])for(var k=0;4>k;k++)a.data[h+k]=c.data[h+k]}return a}
function colorSelect(a,c,b,f){dw=canvasWidth;dh=canvasHeight;redv=b[0];greenv=b[1];bluev=b[2];b=[];for(var e=0;e<dh;e++){b[e]=[];for(var d=0;d<dw;d++)index=4*e*dw+4*d,ir=a.data[index],ig=a.data[index+1],ib=a.data[index+2],dist=Math.sqrt((ir-redv)*(ir-redv)+(ig-greenv)*(ig-greenv)+(ib+bluev)*(ib+bluev)),b[e][d]=!1,"fg"===c?dist<=f&&(b[e][d]=!0):"bg"===c&&dist>f&&(b[e][d]=!0)}return b}
function colorSelectDiff(a,c,b,f,e){dw=canvasWidth;dh=canvasHeight;redv=b[0];greenv=b[1];bluev=b[2];b=[];for(var d=0;d<dh;d++){b[d]=[];for(var g=0;g<dw;g++){index=4*d*dw+4*g;var h=a.data[index],k=a.data[index+1],l=a.data[index+2],h=Math.sqrt((h-redv)*(h-redv)+(k-greenv)*(k-greenv)+(l-bluev)*(l-bluev));b[d][g]=!1;"fg"===c&&1===e[d][g]?h<=f&&(b[d][g]=!0):"bg"===c&&1===e[d][g]&&h>f&&(b[d][g]=!0)}}return b}
function selectFromMarkedRegion(a,c,b){dw=canvasWidth;dh=canvasHeight;redv=c[0];greenv=c[1];bluev=c[2];c=dataCtx.getImageData(0,0,canvasWidth,canvasHeight);for(var f=getCanvasData(),e=[],d=0;d<dh;d++){e[d]=[];for(var g=0;g<dw;g++){index=4*d*dw+4*g;var h=c.data[index],k=c.data[index+1],l=c.data[index+2],r=f.data[index],m=f.data[index+1],p=f.data[index+2];e[d][g]=!1;255===h&&(255===k&&0===l)&&(h=Math.sqrt((r-redv)*(r-redv)+(m-greenv)*(m-greenv)+(p-bluev)*(p-bluev)),"fg"===a&&h<=b?e[d][g]=!0:"bg"===
a&&h>b&&(e[d][g]=!0))}}return e}function binaryToImageData(a,c){dw=canvasWidth;dh=canvasHeight;for(var b=0;b<dh;b++)for(var f=0;f<dw;f++)index=4*b*dw+4*f,!1===a[b][f]?(c.data[index]=255,c.data[index+1]=255,c.data[index+2]=255):(c.data[index]=0,c.data[index+1]=0,c.data[index+2]=0),c.data[index+3]=255;return c}
function getImageDataBasedOnSelection(a,c,b,f){var e=canvasWidth,d=canvasHeight,g,h,k,l=b[0],r=b[1],m=b[2],p=dataCtx.getImageData(0,0,canvasWidth,canvasHeight),n=getCanvasData(),q,t,s,u,w,v;for(b=0;b<d;b++)for(g=0;g<e;g++)h=4*b*e+4*g,k=p.data[h],q=p.data[h+1],t=p.data[h+2],s=n.data[h],u=n.data[h+1],w=n.data[h+2],v=!0,255===k&&(255===q&&0===t)&&(k=(s-l)*(s-l)+(u-r)*(u-r)+(w-m)*(w-m),"fg"===c&&k<=f*f?v=!1:"bg"===c&&k>f*f&&(v=!1)),v?(a.data[h]=255,a.data[h+1]=255,a.data[h+2]=255):(a.data[h]=0,a.data[h+
1]=0,a.data[h+2]=0),a.data[h+3]=255;return a}
function init(){checkBrowser();mainCanvas=document.getElementById("mainCanvas");dataCanvas=document.getElementById("dataCanvas");drawCanvas=document.getElementById("drawCanvas");hoverCanvas=document.getElementById("hoverCanvas");topCanvas=document.getElementById("topCanvas");var a=document.getElementById("canvasDiv");zCanvas=document.getElementById("zoomCanvas");zctx=zCanvas.getContext("2d");tempCanvas=document.createElement("canvas");tctx=tempCanvas.getContext("2d");tempCanvas.width=zoom_dx;tempCanvas.height=
zoom_dy;cx0=zoom_dx/2;cy0=zoom_dy/2;canvasWidth=parseFloat(a.offsetWidth);canvasHeight=parseFloat(a.offsetHeight);mainCanvas.height=canvasHeight;mainCanvas.width=canvasWidth;dataCanvas.height=canvasHeight;dataCanvas.width=canvasWidth;drawCanvas.height=canvasHeight;drawCanvas.width=canvasWidth;hoverCanvas.height=canvasHeight;hoverCanvas.width=canvasWidth;topCanvas.height=canvasHeight;topCanvas.width=canvasWidth;cheight=canvasHeight-zoom_dy;cwidth=canvasWidth-zoom_dx;caspectratio=cheight/cwidth;ctx=
mainCanvas.getContext("2d");dataCtx=dataCanvas.getContext("2d");drawCtx=drawCanvas.getContext("2d");hoverCtx=hoverCanvas.getContext("2d");topCtx=topCanvas.getContext("2d");mPosn=document.getElementById("mousePosition");img=document.createElement("img");img.onload=function(){loadImage(img);originalImage=img};img.src="start.png";testImgCanvas=document.getElementById("testImg");testImgCanvas.width=canvasWidth/2;testImgCanvas.height=canvasHeight/2;testImgContext=testImgCanvas.getContext("2d");topCanvas.addEventListener("mousemove",
updateZoom,!1);document.body.addEventListener("keydown",toggleCrosshair,!1);topCanvas.addEventListener("dragover",function(a){a.preventDefault()},!0);topCanvas.addEventListener("drop",function(a){a.preventDefault();dropHandler(a)},!0);topCanvas.addEventListener("paste",function(a){a.preventDefault();pasteHandler(a)},!0);setDefaultState();initZoom();activeScreen=originalScreen=getCanvasData();displayParameters()}function setDefaultState(){pointsPicked=axesPicked=0;xyData=[];axesAlignmentData=[]}
function checkBrowser(){window.FileReader||alert("\tWARNING!\nYou are using an unsupported browser. Please use Google Chrome 6+ or Firefox 3.6+.\n Sorry for the inconvenience.")}var xyData=[],pointsPicked=0;function acquireData(){0===axesPicked?showPopup("alignAxes"):(showSidebar("manualMode"),removeAllMouseEvents())}
function pickPoints(){0===axesPicked?alert("Define the axes first!"):(removeAllMouseEvents(),addMouseEvent("click",clickPoints,!0),pointsStatus(pointsPicked),showSidebar("manualMode"))}
function clickPoints(a){var c=getPosition(a),b=c.x,c=c.y;xyData[pointsPicked]=[];xyData[pointsPicked][0]=parseFloat(b);xyData[pointsPicked][1]=parseFloat(c);pointsPicked+=1;dataCtx.beginPath();dataCtx.fillStyle="rgb(200,0,0)";dataCtx.arc(b,c,3,0,2*Math.PI,!0);dataCtx.fill();pointsStatus(pointsPicked);updateZoom(a)}function clearPoints(){pointsPicked=0;pointsStatus(pointsPicked);resetLayers();removeAllMouseEvents()}
function undoPointSelection(){if(1<=pointsPicked){pointsPicked-=1;pointsStatus(pointsPicked);resetLayers();for(ii=0;ii<pointsPicked;ii++)xi=xyData[ii][0],yi=xyData[ii][1],dataCtx.beginPath(),dataCtx.fillStyle="rgb(200,0,0)",dataCtx.arc(xi,yi,3,0,2*Math.PI,!0),dataCtx.fill()}}function pointsStatus(a){var c=document.getElementById("pointsStatus"),b=document.getElementById("autoPointsStatus");c.innerHTML=a;b.innerHTML=a}
function deleteSpecificPoint(){removeAllMouseEvents();addMouseEvent("click",deleteSpecificPointHandler,!0)}
function deleteSpecificPointHandler(a){for(var c=getPosition(a),b=parseFloat(c.x),c=parseFloat(c.y),f=10,e=0,d=0,g=0;g<pointsPicked;g++){var h=parseFloat(xyData[g][0]),k=parseFloat(xyData[g][1]),h=Math.sqrt((h-b)*(h-b)+(k-c)*(k-c));h<f&&(e=1,d=g,f=h)}if(1===e){xyData.splice(d,1);pointsPicked-=1;pointsStatus(pointsPicked);resetLayers();for(g=0;g<pointsPicked;g++)xp=xyData[g][0],yp=xyData[g][1],dataCtx.beginPath(),dataCtx.fillStyle="rgb(200,0,0)",dataCtx.arc(xp,yp,3,0,2*Math.PI,!0),dataCtx.fill()}updateZoom(a)}
function taninverse(a,c){var b;0<a?b=Math.atan2(a,c):0>=a&&(b=Math.atan2(a,c)+2*Math.PI);b>=2*Math.PI&&(b=0);return b}var mouseEventType=[],mouseEventFunction=[],mouseEventCapture=[],mouseEvents=0;
function addMouseEvent(a,c,b){for(var f=!1,e=0;e<mouseEvents;e++)a===mouseEventType[e]&&(c===mouseEventFunction[e]&&b===mouseEventCapture[e])&&(f=!0);!1===f&&(topCanvas.addEventListener(a,c,b),mouseEventType[mouseEvents]=a,mouseEventFunction[mouseEvents]=c,mouseEventCapture[mouseEvents]=b,mouseEvents+=1)}
function removeAllMouseEvents(){if(0<mouseEvents){for(var a=0;a<mouseEvents;a++)topCanvas.removeEventListener(mouseEventType[a],mouseEventFunction[a],mouseEventCapture[a]);mouseEvents=0;mouseEventType=[];moueEventFunction=[];mouseEventCapture=[]}clearToolbar()}
function removeMouseEvent(a,c,b){for(var f=!1,e=0,d=0;d<mouseEvents;d++)a===mouseEventType[d]&&(c===mouseEventFunction[d]&&b===mouseEventCapture[d])&&(f=!0,e=d);!0===f&&(topCanvas.removeEventListener(a,c,b),mouseEvents-=1,mouseEventType.splice(e,1),mouseEventFunction.splice(e,1),mouseEventCapture.splice(e,1))}
function showPopup(a){document.getElementById("shadow").style.visibility="visible";a=document.getElementById(a);var c=parseInt(window.innerWidth),b=parseInt(window.innerHeight),f=parseInt(a.offsetWidth),e=parseInt(a.offsetHeight);a.style.left=(c-f)/2+"px";a.style.top=(b-e)/2+"px";a.style.visibility="visible"}function closePopup(a){document.getElementById("shadow").style.visibility="hidden";document.getElementById(a).style.visibility="hidden"}
function processingNote(a){document.getElementById("wait").style.visibility=!0===a?"visible":"hidden"}var sidebarList=["editImageToolbar","manualMode","autoMode"];function showSidebar(a){clearSidebar();document.getElementById(a).style.visibility="visible"}function clearSidebar(){for(ii=0;ii<sidebarList.length;ii++)document.getElementById(sidebarList[ii]).style.visibility="hidden"}var toolbarList=["paintToolbar","colorPickerToolbar"];
function showToolbar(a){clearToolbar();document.getElementById(a).style.visibility="visible"}function clearToolbar(){for(ii=0;ii<toolbarList.length;ii++)document.getElementById(toolbarList[ii]).style.visibility="hidden"}var zCanvas,zctx,tempCanvas,tctx,zoom_dx=20,zoom_dy=20,zWindowWidth=200,zWindowHeight=200,mPosn,extendedCrosshair=!1,pix=[[]];
function initZoom(){var a=document.getElementById("zoomCrossHair").getContext("2d");a.strokeStyle="rgb(0,0,0)";a.beginPath();a.moveTo(zWindowWidth/2,0);a.lineTo(zWindowWidth/2,zWindowHeight);a.moveTo(0,zWindowHeight/2);a.lineTo(zWindowWidth,zWindowHeight/2);a.stroke()}
function updateZoom(a){var c=getPosition(a);a=c.x;var b=c.y,f=zoom_dx,e=zoom_dy;1!=axesPicked?mPosn.innerHTML=a+", "+b:1==axesPicked&&(pix[0][0]=parseFloat(a),pix[0][1]=parseFloat(b),c=pixelToData(pix,1,plotType),"image"===plotType?mPosn.innerHTML=c[0][0]+", "+c[0][1]:(mPosn.innerHTML=parseFloat(c[0][0]).toExponential(3)+", "+parseFloat(c[0][1]).toExponential(3),"ternary"===plotType&&(mPosn.innerHTML+=", "+parseFloat(c[0][2]).toExponential(3))));!0===extendedCrosshair&&(hoverCanvas.width=hoverCanvas.width,
hoverCtx.strokeStyle="rgba(0,0,0, 0.5)",hoverCtx.beginPath(),hoverCtx.moveTo(a,0),hoverCtx.lineTo(a,canvasHeight),hoverCtx.moveTo(0,b),hoverCtx.lineTo(canvasWidth,b),hoverCtx.stroke());if(0<=a-f/2&&0<=b-e/2&&a+f/2<=canvasWidth&&b+e/2<=canvasHeight){c=ctx.getImageData(a-f/2,b-e/2,f,e);a=dataCtx.getImageData(a-f/2,b-e/2,f,e);for(b=0;b<a.data.length;b+=4)0!=a.data[b]+a.data[b+1]+a.data[b+2]+a.data[b+3]&&(c.data[b]=a.data[b],c.data[b+1]=a.data[b+1],c.data[b+2]=a.data[b+2]);tctx.putImageData(c,0,0);a=
tempCanvas.toDataURL();var d=document.createElement("img");d.onload=function(){zctx.drawImage(d,0,0,parseInt(zWindowWidth),parseInt(zWindowHeight))};d.src=a}}function toggleCrosshair(a){220===a.keyCode&&(a.preventDefault(),extendedCrosshair=!extendedCrosshair,hoverCanvas.width=hoverCanvas.width)}
var averagingWindowAlgo={getParamList:function(){return[["\u0394X","Px","5"],["\u0394Y","Px","5"]]},run:function(){var a=[],c=0;xyData=[];pointsPicked=0;for(var b=document.getElementById("pv0"),b=parseFloat(b.value),f=document.getElementById("pv1"),f=parseFloat(f.value),e=canvasWidth,d=canvasHeight,g=[],h=0;h<e;h++){blobs=-1;firstbloby=-2*f;for(var k=bi=0;k<d;k++)!0===binaryData[k][h]&&(k>firstbloby+f?(blobs+=1,bi=1,firstbloby=g[blobs]=k):(bi+=1,g[blobs]=parseFloat((g[blobs]*(bi-1)+k)/parseFloat(bi))));
if(0<=blobs){xi=h;for(k=0;k<=blobs;k++)yi=g[k],a[c]=[],a[c][0]=parseFloat(xi),a[c][1]=parseFloat(yi),a[c][2]=1,c+=1}}if(0===c)return 0;for(e=0;e<c;e++)if(1===a[e][2]){for(var d=1,g=e+1,h=a[e][0],k=a[e][1],l=h,r=k,m=1;1===d&&g<c;){var p=a[g][0],n=a[g][1];Math.abs(p-h)<=b&&(Math.abs(n-k)<=f&&1===a[g][2])&&(l=(l*m+p)/(m+1),r=(r*m+n)/(m+1),m+=1,a[g][2]=0);p>h+2*b&&(d=0);g+=1}a[e][2]=0;xyData[pointsPicked]=[];xyData[pointsPicked][0]=parseFloat(l);xyData[pointsPicked][1]=parseFloat(r);pointsPicked+=1}}},
averagingWindowWithStepSizeAlgo={getParamList:function(){if("XY"===plotType)return[["X_min","Units",axesAlignmentData[0].toString()],["\u0394X Step","Units","0.1"],["X_max","Units",axesAlignmentData[1].toString()],["Y_min","Units",axesAlignmentData[2].toString()],["Y_max","Units",axesAlignmentData[3].toString()],["Line width","Px","30"]];showPopup("xyAxesOnly");return[["X_min","Units","0"],["\u0394X Step","Units","0.1"],["X_max","Units","0"],["Y_min","Units","0"],["Y_max","Units","0"],["Line width",
"Px","30"]]},run:function(){if("XY"===plotType){xyData=[];pointsPicked=0;resetLayers();for(var a=canvasWidth,c=canvasHeight,b=document.getElementById("pv0"),f=document.getElementById("pv1"),e=document.getElementById("pv2"),d=document.getElementById("pv5"),g=document.getElementById("pv3"),h=document.getElementById("pv4"),b=parseFloat(b.value),f=parseFloat(f.value),e=parseFloat(e.value),d=parseFloat(d.value),g=parseFloat(g.value),h=parseFloat(h.value);b<=e;b+=f){var k,l,r,m;dataToPixel(b,g,"XY");k=
dataToPixelxy[0];r=dataToPixelxy[1];dataToPixel(b,h,"XY");l=dataToPixelxy[0];m=dataToPixelxy[1];k=Math.sqrt((m-r)*(m-r)+(l-k)*(l-k));l=(h-g)/k;r=!1;for(var p=m=0,n=!1,q=0;q<=k;q++)if(dataToPixel(b,1*-q*l+h,"XY"),xi_pix=dataToPixelxy[0],yi_pix=dataToPixelxy[1],0<=xi_pix&&(xi_pix<a&&0<=yi_pix&&yi_pix<c)&&(!0===binaryData[parseInt(yi_pix,10)][parseInt(xi_pix,10)]?!1===r&&(p=m=q,r=!0,n=!1):!1===n&&(p=q,n=!0),!0===r&&(q>=m+d||q<=k&&q>k)))r=!1,m>p&&(p=q),dataToPixel(b,1*-((m+p)/2)*l+h,"XY"),xyData[pointsPicked]=
[],xyData[pointsPicked][0]=parseFloat(dataToPixelxy[0]),xyData[pointsPicked][1]=parseFloat(dataToPixelxy[1]),pointsPicked+=1}}else showPopup("xyAxesOnly")}},blobDetectorAlgo={getParamList:function(){return[["Min size","Px","0"],["Max size","Px","1000"]]},run:function(){xyData=[];pointsPicked=0;for(var a=document.getElementById("pv0").value,c=document.getElementById("pv1").value,b=[],f=0;f<canvasHeight;f++){b[f]=[];for(var e=0;e<canvasWidth;e++)b[f][e]=!1}for(var f=0,e=[],d=[],g=[],h=[],k=[],l=0;l<
canvasHeight;l++)for(var r=0;r<canvasWidth;r++){if(!0===binaryData[l][r]&&!1===b[l][r]){b[l][r]=!0;f+=1;e[f-1]=1;h[f-1]=[];k[f-1]=[];h[f-1][0]=r;k[f-1][0]=l;d[f-1]=r;g[f-1]=l;for(var m=1,p=1;m<=p;){ai=k[f-1][m-1];bi=h[f-1][m-1];for(var n=-1;1>=n;n++)for(var q=-1;1>=q;q++)0<=ai+n&&(0<=bi+q&&ai+n<canvasHeight&&bi+q<canvasWidth)&&(!0==binaryData[ai+n][bi+q]&&!1==b[ai+n][bi+q])&&(e[f-1]+=1,p=e[f-1],k[f-1][p-1]=ai+n,h[f-1][p-1]=bi+q,g[f-1]=(g[f-1]*(p-1)+(ai+n))/p,d[f-1]=(d[f-1]*(p-1)+(bi+q))/p,b[ai+n][bi+
q]=!0);m+=1}}b[l][r]=!0}for(b=0;b<f;b++)h=2*Math.sqrt(e[b]/Math.PI),h>=a&&h<=c&&(xyData[pointsPicked]=[],xyData[pointsPicked][0]=parseFloat(d[b]),xyData[pointsPicked][1]=parseFloat(g[b]),xyData[pointsPicked][2]=e[b],pointsPicked+=1)}},xStepAlgo={getParamList:function(){return[["\u0394X","Px","5"],["Line Width","Px","15"]]},run:function(){xyData=[];pointsPicked=0;resetLayers();for(var a=document.getElementById("pv0"),a=parseFloat(a.value),c=document.getElementById("pv1"),c=parseFloat(c.value),b=canvasWidth,
f=canvasHeight,e=[],d=1,g=0;g<b;){blobs=-1;firstbloby=-2*c;for(var h=bi=0;h<f;h++)!0===binaryData[h][g]&&(d=a,h>firstbloby+c?(blobs+=1,bi=1,firstbloby=e[blobs]=h):(bi+=1,e[blobs]=parseFloat((e[blobs]*(bi-1)+h)/parseFloat(bi))));if(0<=blobs){xi=g;for(h=0;h<=blobs;h++)yi=e[h],xyData[pointsPicked]=[],xyData[pointsPicked][0]=parseFloat(xi),xyData[pointsPicked][1]=parseFloat(yi),pointsPicked+=1}g+=d}}},yStepAlgo={getParamList:function(){return[["\u0394Y","Px","5"],["Line Width","Px","15"]]},run:function(){xyData=
[];pointsPicked=0;resetLayers();for(var a=document.getElementById("pv0"),a=parseFloat(a.value),c=document.getElementById("pv1"),c=parseFloat(c.value),b=canvasWidth,f=[],e=-1,d=canvasHeight-1;0<=d;){blobs=-1;firstblobx=-2*c;for(var g=bi=0;g<b;g++)!0===binaryData[d][g]&&(e=-a,g>firstblobx+c?(blobs+=1,bi=1,firstblobx=f[blobs]=g):(bi+=1,f[blobs]=parseFloat((f[blobs]*(bi-1)+g)/parseFloat(bi))));if(0<=blobs){yi=d;for(g=0;g<=blobs;g++)xi=f[g],xyData[pointsPicked]=[],xyData[pointsPicked][0]=parseFloat(xi),
xyData[pointsPicked][1]=parseFloat(yi),pointsPicked+=1}d+=e}}};
