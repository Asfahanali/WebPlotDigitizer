var wpd=wpd||{};wpd.initApp=function(){wpd.browserInfo.checkBrowser();wpd.layoutManager.initialLayout();wpd.graphicsWidget.loadImageFromURL("start.png");document.getElementById("loadingCurtain").style.display="none"};document.addEventListener("DOMContentLoaded",wpd.initApp,!0);wpd=wpd||{};wpd.detectionAlgoManager=function(){return{setActiveAlgo:function(a){},getActiveAlgo:function(){return null},getAllApplicableAlgorithms:function(){}}}();wpd=wpd||{};
wpd.appData=function(){function a(){null==c&&(c=new wpd.PlotData);return c}var b=!1,c;return{isAligned:function(c){null!=c&&(b=c);return b},getPlotData:a,reset:function(){b=!1;c=null},plotLoaded:function(b){a().topColors=wpd.colorAnalyzer.getTopColors(b)}}}();wpd=wpd||{};
wpd.AutoDetector=function(){return function(){this.fgColor=[0,0,200];this.bgColor=[255,255,255];this.mask=null;this.colorDetectionMode="fg";this.colorDistance=120;this.imageData=this.binaryData=this.algorithm=null;this.imageHeight=this.imageWidth=0;this.generateBinaryDataFromMask=function(){var a,b,c,d="fg"===this.colorDetectionMode?this.fgColor:this.bgColor;for(a=0;a<this.mask.length;a++)b=this.mask[a],c=Math.sqrt((this.imageData.data[4*b]-d[0])*(this.imageData.data[4*b]-d[0])+(this.imageData.data[4*
b+1]-d[1])*(this.imageData.data[4*b+1]-d[1])+(this.imageData.data[4*b+2]-d[2])*(this.imageData.data[4*b+2]-d[2])),"fg"===this.colorDetectionMode?c<=this.colorDistance&&(this.binaryData[b]=!0):c>=this.colorDistance&&(this.binaryData[b]=!0)};this.generateBinaryDataUsingFullImage=function(){var a,b,c="fg"===this.colorDetectionMode?this.fgColor:this.bgColor;for(b=0;b<this.imageData.data.length/4;b++)a=Math.sqrt((this.imageData.data[4*b]-c[0])*(this.imageData.data[4*b]-c[0])+(this.imageData.data[4*b+1]-
c[1])*(this.imageData.data[4*b+1]-c[1])+(this.imageData.data[4*b+2]-c[2])*(this.imageData.data[4*b+2]-c[2])),"fg"===this.colorDetectionMode?a<=this.colorDistance&&(this.binaryData[b]=!0):a>=this.colorDistance&&(this.binaryData[b]=!0)};this.generateBinaryData=function(){this.binaryData=[];null==this.imageData?this.imageWidth=this.imageHeight=0:(this.imageHeight=this.imageData.height,this.imageWidth=this.imageData.width,null==this.mask||0===this.mask.length?this.generateBinaryDataUsingFullImage():this.generateBinaryDataFromMask())}}}();
wpd=wpd||{};wpd.ColorGroup=function(){return function(a){var b=0,c={r:0,g:0,b:0};a=null==a?100:a;this.getPixelCount=function(){return b};this.getAverageColor=function(){return c};this.isColorInGroup=function(d,e,f){return 0===b?!0:(c.r-d)*(c.r-d)+(c.g-e)*(c.g-e)+(c.b-f)*(c.b-f)<=a*a};this.addPixel=function(a,e,f){c.r=(c.r*b+a)/(b+1);c.g=(c.g*b+e)/(b+1);c.b=(c.b*b+f)/(b+1);b+=1}}}();
wpd.colorAnalyzer=function(){return{getTopColors:function(a){var b=[],c,d,e,f,g,k,p=[];b[0]=new wpd.ColorGroup(120);for(c=0;c<a.data.length;c+=4){d=a.data[c];e=a.data[c+1];f=a.data[c+2];k=!1;for(g=0;g<b.length;g++)if(b[g].isColorInGroup(d,e,f)){b[g].addPixel(d,e,f);k=!0;break}k||(b[b.length]=new wpd.ColorGroup(120),b[b.length-1].addPixel(d,e,f))}b.sort(function(b,c){return b.getPixelCount()>c.getPixelCount()?-1:b.getPixelCount()<c.getPixelCount()?1:0});for(g=0;g<b.length;g++)c=b[g].getAverageColor(),
p[g]={r:parseInt(c.r,10),g:parseInt(c.g,10),b:parseInt(c.b,10),pixels:b[g].getPixelCount(),percentage:100*b[g].getPixelCount()/(0.25*a.data.length)};return p}}}();wpd=wpd||{};wpd.dataEventNames={axesAligned:"axesAligned",imageLoaded:"imageLoaded"};wpd.dataEventManager=function(){return{fireEvent:function(a,b){},subscribe:function(a,b){},unsubscribe:function(a,b){},removeAllSubscriptionsForEvent:function(a){}}}();wpd=wpd||{};
wpd.Calibration=function(){return function(a){var b=[],c=[],d=null==a?2:a,e=[],f=[];this.labels=[];this.getCount=function(){return b.length};this.getDimensions=function(){return d};this.addPoint=function(a,f,p,l,h){var n=b.length,m=e.length;b[n]=a;c[n]=f;e[m]=p;e[m+1]=l;3===d&&(e[m+2]=h)};this.getPoint=function(a){return 0>a||a>=b.length?null:{px:b[a],py:c[a],dx:e[d*a],dy:e[d*a+1],dz:2===d?null:e[d*a+2]}};this.changePointPx=function(a,d,f){0>a||a>=b.length||(b[a]=d,c[a]=f)};this.setDataAt=function(a,
c,f,l){0>a||a>=b.length||(e[d*a]=c,e[d*a+1]=f,3===d&&(e[d*a+2]=l))};this.findNearestPoint=function(a,d,f){f=null==f?50:parseFloat(f);var e,h=-1,n,m;for(n=0;n<b.length;n++)if(m=Math.sqrt((a-b[n])*(a-b[n])+(d-c[n])*(d-c[n])),0>h&&m<=f||0<=h&&m<e)h=n,e=m;return h};this.selectPoint=function(b){0>f.indexOf(b)&&(f[f.length]=b)};this.selectNearestPoint=function(b,a,c){b=this.findNearestPoint(b,a,c);0<=b&&this.selectPoint(b)};this.getSelectedPoints=function(){return f};this.unselectAll=function(){f=[]};this.isPointSelected=
function(b){return 0<=f.indexOf(b)};this.dump=function(){console.log(b);console.log(c);console.log(e)}}}();
wpd.DataSeries=function(){return function(a){var b=[],c=[],d=!1,e=[];this.name="Data Series";this.variableNames=["x","y"];this.hasMetadata=function(){return d};this.setMetadataKeys=function(b){e=b};this.getMetadataKeys=function(){return e};this.addPixel=function(a,c,e){b[b.length]={x:a,y:c,metadata:e};null!=e&&(d=!0)};this.getPixel=function(a){return b[a]};this.setPixelAt=function(a,c,d){a<b.length&&(b[a].x=c,b[a].y=d)};this.setMetadataAt=function(a,c){a<b.length&&(b[a].metadata=c)};this.insertPixel=
function(a,c,d,e){b.splice(a,0,{x:c,y:d,metadata:e})};this.removePixelAtIndex=function(a){a<b.length&&b.splice(a,1)};this.removeLastPixel=function(){this.removePixelAtIndex(b.length-1)};this.findNearestPixel=function(a,c,d){d=null==d?50:parseFloat(d);var e,l=-1,h,n;for(h=0;h<b.length;h++)if(n=Math.sqrt((a-b[h].x)*(a-b[h].x)+(c-b[h].y)*(c-b[h].y)),0>l&&n<=d||0<=l&&n<e)l=h,e=n;return l};this.removeNearestPixel=function(b,a,c){b=this.findNearestPixel(b,a,c);0<=b&&this.removePixelAtIndex(b)};this.clearAll=
function(){b=[];d=!1;e=[]};this.getCount=function(){return b.length};this.selectPixel=function(b){0<=c.indexOf(b)||(c[c.length]=b)};this.unselectAll=function(){c=[]};this.selectNearestPixel=function(b,a,c){b=this.findNearestPixel(b,a,c);0<=b&&this.selectPixel(b)};this.getSelectedPixels=function(){return c}}}();
wpd.PlotData=function(){return function(){var a=0,b=new wpd.AutoDetector;this.axes=this.topColors=null;this.dataSeriesColl=[];this.distanceMeasurementData=this.angleMeasurementData=null;this.getActiveDataSeries=function(){null==this.dataSeriesColl[a]&&(this.dataSeriesColl[a]=new wpd.DataSeries);return this.dataSeriesColl[a]};this.getDataSeriesCount=function(){return this.dataSeriesColl.length};this.setActiveDataSeriesIndex=function(b){a=b};this.getAutoDetector=function(){return b};this.getDataFromActiveSeries=
function(){var b=this.getActiveDataSeries();if(null==b||null==this.axes)return null;var d,e,f,g=[],k;d=b.hasMetadata();e=b.getMetadataKeys();var p=!0===d?e.length:0;for(d=0;d<b.getCount();d++){e=this.dataSeriesColl[a].getPixel(d);f=this.axes.pixelToData(e.x,e.y);g[d]=[];for(k=0;k<f.length;k++)g[d][k]=f[k];for(k=0;k<p;k++)g[d][f.length+k]=e.metadata[k]}return g};this.reset=function(){this.distanceMeasurementData=this.angleMeasurementData=this.axes=null;this.dataSeriesColl=[];a=0;b=new wpd.AutoDetector}}}();
wpd.ConnectedPoints=function(){return function(a){var b=[],c=-1,d=-1;this.addConnection=function(a){b[b.length]=a};this.clearAll=function(){b=[]};this.getConnectionAt=function(a){if(a<b.length)return b[a]};this.replaceConnectionAt=function(a,c){a<b.length&&(b[a]=c)};this.deleteConnectionAt=function(a){a<b.length&&b.splice(a,1)};this.connectionCount=function(){return b.length};this.getDistance=function(c){if(c<b.length&&2===a)return Math.sqrt((b[c][0]-b[c][2])*(b[c][0]-b[c][2])+(b[c][1]-b[c][3])*(b[c][1]-
b[c][3]))};this.getAngle=function(c){if(c<b.length&&3===a){var d=wpd.taninverse(-(b[c][5]-b[c][3]),b[c][4]-b[c][2]);c=wpd.taninverse(-(b[c][1]-b[c][3]),b[c][0]-b[c][2]);d=180*(d-c)/Math.PI;return d=0>d?d+360:d}};this.findNearestPointAndConnection=function(c,d){var g=-1,k=-1,p,l,h,n;for(h=0;h<b.length;h++)for(n=0;n<2*a;n+=2)if(l=(b[h][n]-c)*(b[h][n]-c)+(b[h][n+1]-d)*(b[h][n+1]-d),-1===k||l<p)g=h,k=n/2,p=l;return{connectionIndex:g,pointIndex:k}};this.selectNearestPoint=function(b,a){var g=this.findNearestPointAndConnection(b,
a);0<=g.connectionIndex&&(c=g.connectionIndex,d=g.pointIndex)};this.deleteNearestConnection=function(b,a){var c=this.findNearestPointAndConnection(b,a);0<=c.connectionIndex&&this.deleteConnectionAt(c.connectionIndex)};this.isPointSelected=function(b,a){return d===a&&c===b?!0:!1};this.getSelectedConnectionAndPoint=function(){return{connectionIndex:c,pointIndex:d}};this.unselectConnectionAndPoint=function(){d=c=-1};this.setPointAt=function(a,c,d,k){b[a][2*c]=d;b[a][2*c+1]=k};this.getPointAt=function(a,
c){return{x:b[a][2*c],y:b[a][2*c+1]}}}}();wpd=wpd||{};
wpd.dateConverter=function(){function a(b,a){var d;d=a.replace("YYYY","yyyy");d=d.replace("YY","yy");d=d.replace("MMMM","mmmm");d=d.replace("MMM","mmm");d=d.replace("MM","mm");d=d.replace("DD","dd");d=d.replace("yyyy",b.getUTCFullYear());var e=b.getUTCFullYear()%100;d=d.replace("yy",10>e?"0"+e:e);d=d.replace("mmmm","January February March April May June July August September October November December".split(" ")[b.getUTCMonth()]);d=d.replace("mmm","Jan Feb Mar Apr May Jun Jul Aug Sep Oct Nov Dec".split(" ")[b.getUTCMonth()]);
d=d.replace("mm",b.getUTCMonth()+1);return d=d.replace("dd",b.getUTCDate())}return{parse:function(b){if(null==b||0>b.indexOf("/"))b=null;else{var a=b.split("/"),d;0>=a.length||3<a.length?b=null:(b=parseInt(a[0],10),d=parseInt(void 0===a[1]?0:a[1],10),date=parseInt(void 0===a[2]?1:a[2],10),isNaN(b)||isNaN(d)||isNaN(date)||12<d||1>d||31<date||1>date?b=null:(a=new Date,a.setUTCFullYear(b),a.setUTCMonth(d-1),a.setUTCDate(date),b=parseFloat(Date.parse(a)),b=isNaN(b)?null:b))}return b},getFormatString:function(b){b=
b.split("/");var a="yyyy/mm/dd";1<=b.length&&(a="yyyy");2<=b.length&&(a+="/mm");3===b.length&&(a+="/dd");return a},formatDate:a,formatDateNumber:function(b,c){var d;d=parseFloat(b);d=parseInt(864E5*Math.round(d/864E5),10);return a(new Date(d),c)}}}();wpd=wpd||{};
wpd.InputParser=function(){return function(){this.parse=function(a){this.isDate=this.isValid=!1;this.formatting=null;if(null==a)return null;a=a.trim();if(0<=a.indexOf("^"))return null;var b=wpd.dateConverter.parse(a);if(null!=b)return this.isDate=this.isValid=!0,this.formatting=wpd.dateConverter.getFormatString(a),b;a=parseFloat(a);return isNaN(a)?null:(this.isValid=!0,a)};this.isDate=this.isValid=!1;this.formatting=null}}();wpd=wpd||{};
wpd.taninverse=function(a,b){var c;0<a?c=Math.atan2(a,b):0>=a&&(c=Math.atan2(a,b)+2*Math.PI);c>=2*Math.PI&&(c=0);return c};wpd=wpd||{};
wpd.AveragingWindowAlgo=function(){return function(){var a=5,b=5;this.getParamList=function(){return[["\u0394X","Px",10],["\u0394Y","Px",10]]};this.setParam=function(c,d){0===c?a=d:1===c&&(b=d)};this.run=function(c){var d=c.getAutoDetector();c=c.getActiveDataSeries();var e=[],f=0,g=d.imageWidth,k=d.imageHeight,p=[],l,h,n,m,r,q;c.clearAll();for(l=0;l<g;l++){r=-1;n=-2*b;for(h=m=0;h<k;h++)!0===d.binaryData[h*g+l]&&(h>n+b?(r+=1,m=1,n=p[r]=h):(m+=1,p[r]=parseFloat((p[r]*(m-1)+h)/parseFloat(m))));if(0<=
r)for(n=l,h=0;h<=r;h++)m=p[h],e[f]=[],e[f][0]=parseFloat(n),e[f][1]=parseFloat(m),e[f][2]=!0,f+=1}if(0!==f)for(d=0;d<f;d++)if(!0===e[d][2]){g=!0;k=d+1;p=e[d][0];l=e[d][1];r=p;h=l;for(q=1;!0===g&&k<f;)n=e[k][0],m=e[k][1],Math.abs(n-p)<=a&&Math.abs(m-l)<=b&&!0===e[k][2]&&(r=(r*q+n)/(q+1),h=(h*q+m)/(q+1),q+=1,e[k][2]=!1),n>p+2*a&&(g=!1),k+=1;e[d][2]=!1;c.addPixel(parseFloat(r),parseFloat(h))}}}}();wpd=wpd||{};
wpd.AveragingWindowWithStepSizeAlgo=function(){return function(){var a,b,c,d,e,f;this.getParamList=function(){var b=wpd.appData.isAligned(),a=wpd.appData.getPlotData().axes;return b&&a instanceof wpd.XYAxes?(b=a.getBounds(),[["X_min","Units",b.x1],["\u0394X Step","Units",0.1],["X_max","Units",b.x2],["Y_min","Units",b.y3],["Y_max","Units",b.y4],["Line width","Px",30]]):[["X_min","Units",0],["\u0394X Step","Units",0.1],["X_max","Units",0],["Y_min","Units",0],["Y_max","Units",0],["Line width","Px",30]]};
this.setParam=function(g,k){0===g?a=k:1===g?b=k:2===g?c=k:3===g?e=k:4===g?f=k:5===g&&(d=k)};this.run=function(g){var k=g.getAutoDetector(),p=g.getActiveDataSeries();g=g.axes;var l=k.imageWidth,h=k.imageHeight,n,m,r,q,s,t,u,v,w;p.clearAll();for(n=a;n<=c;n+=b)for(w=g.dataToPixel(n,e),m=w.x,q=w.y,w=g.dataToPixel(n,f),r=w.x,s=w.y,m=Math.sqrt((s-q)*(s-q)+(r-m)*(r-m)),r=(f-e)/m,q=!1,t=s=0,u=!1,v=0;v<=m;v++)w=1*-v*r+f,w=g.dataToPixel(n,w),xi_pix=w.x,yi_pix=w.y,0<=xi_pix&&xi_pix<l&&0<=yi_pix&&yi_pix<h&&(!0===
k.binaryData[parseInt(yi_pix,10)*l+parseInt(xi_pix,10)]?(!1===q&&(t=s=v,q=!0,u=!1),!0===u&&(t=v,u=!1)):!1===u&&(t=v,u=!0),!0===q&&(v>s+d||v==m-1)&&(q=!1,s>t&&(t=v),w=(s+t)/2,w=1*-w*r+f,w=g.dataToPixel(n,w),p.addPixel(parseFloat(w.x),parseFloat(w.y))))}}}();wpd=wpd||{};
wpd.BlobDetectorAlgo=function(){return function(){this.getParamList=function(){return[]};this.setParam=function(a,b){};this.run=function(a){var b=a.getAutoDetector(),c=a.getActiveDataSeries(),d=b.imageWidth,e=b.imageHeight,f=[],g=[],k,p,l,h,n,m,r,q,s;if(!(0>=d||0>=e||null==b.binaryData||0===b.binaryData.length)){c.clearAll();c.setMetadataKeys(["area","moment"]);for(k=0;k<d;k++)for(p=0;p<e;p++)if(!0===b.binaryData[p*d+k]&&!0!==f[p*d+k])for(f[p*d+k]=!0,h=g.length,g[h]={pixels:[{x:k,y:p}],centroid:{x:k,
y:p},area:1,moment:0},l=0;l<g[h].pixels.length;){r=g[h].pixels[l].x;q=g[h].pixels[l].y;for(n=r-1;n<=r+1;n++)for(m=q-1;m<=q+1;m++)0<=n&&0<=m&&n<d&&m<e&&!0!==f[m*d+n]&&!0===b.binaryData[m*d+n]&&(f[m*d+n]=!0,s=g[h].pixels.length,g[h].pixels[s]={x:n,y:m},g[h].centroid.x=(g[h].centroid.x*s+n)/(s+1),g[h].centroid.y=(g[h].centroid.y*s+m)/(s+1),g[h].area+=1);l+=1}for(h=0;h<g.length;h++){for(l=g[h].moment=0;l<g[h].pixels.length;l++)g[h].moment=g[h].moment+(g[h].pixels[l].x-g[h].centroid.x)*(g[h].pixels[l].x-
g[h].centroid.x)+(g[h].pixels[l].y-g[h].centroid.y)*(g[h].pixels[l].y-g[h].centroid.y);a.axes instanceof wpd.MapAxes&&(g[h].area=a.axes.pixelToDataArea(g[h].area));c.addPixel(g[h].centroid.x,g[h].centroid.y,[g[h].area,g[h].moment])}}}}}();
var xStepAlgo={getParamList:function(){return[["\u0394X","Px","5"],["Line Width","Px","15"]]},run:function(){xyData=[];pointsPicked=0;resetLayers();for(var a=document.getElementById("pv0"),a=parseFloat(a.value),b=document.getElementById("pv1"),b=parseFloat(b.value),c=canvasWidth,d=canvasHeight,e=[],f=1,g=0;g<c;){blobs=-1;firstbloby=-2*b;for(var k=bi=0;k<d;k++)!0===binaryData[k][g]&&(f=a,k>firstbloby+b?(blobs+=1,bi=1,firstbloby=e[blobs]=k):(bi+=1,e[blobs]=parseFloat((e[blobs]*(bi-1)+k)/parseFloat(bi))));
if(0<=blobs)for(xi=g,k=0;k<=blobs;k++)yi=e[k],xyData[pointsPicked]=[],xyData[pointsPicked][0]=parseFloat(xi),xyData[pointsPicked][1]=parseFloat(yi),pointsPicked+=1;g+=f}}},yStepAlgo={getParamList:function(){return[["\u0394Y","Px","5"],["Line Width","Px","15"]]},run:function(){xyData=[];pointsPicked=0;resetLayers();for(var a=document.getElementById("pv0"),a=parseFloat(a.value),b=document.getElementById("pv1"),b=parseFloat(b.value),c=canvasWidth,d=[],e=-1,f=canvasHeight-1;0<=f;){blobs=-1;firstblobx=
-2*b;for(var g=bi=0;g<c;g++)!0===binaryData[f][g]&&(e=-a,g>firstblobx+b?(blobs+=1,bi=1,firstblobx=d[blobs]=g):(bi+=1,d[blobs]=parseFloat((d[blobs]*(bi-1)+g)/parseFloat(bi))));if(0<=blobs)for(yi=f,g=0;g<=blobs;g++)xi=d[g],xyData[pointsPicked]=[],xyData[pointsPicked][0]=parseFloat(xi),xyData[pointsPicked][1]=parseFloat(yi),pointsPicked+=1;f+=e}}},wpd=wpd||{};
wpd.ImageAxes=function(){var a=function(){this.isCalibrated=function(){return!0};this.calibrate=function(){return!0};this.pixelToData=function(b,a){return[b,a]};this.dataToPixel=function(b,a){return{x:b,y:a}};this.pixelToLiveString=function(b,a){var d=this.pixelToData(b,a);return d[0].toFixed(2)+", "+d[1].toFixed(2)}};a.prototype.numCalibrationPointsRequired=function(){return 0};a.prototype.getDimensions=function(){return 2};a.prototype.getAxesLabels=function(){return["X","Y"]};return a}();
wpd=wpd||{};
wpd.MapAxes=function(){var a=function(){var b=!1,a,d,e;this.isCalibrated=function(){return b};this.calibrate=function(f,g,k){var p=f.getPoint(0);f=f.getPoint(1);e=Math.sqrt((p.px-f.px)*(p.px-f.px)+(p.py-f.py)*(p.py-f.py));a=parseFloat(g);d=k;return b=!0};this.pixelToData=function(b,d){var k=[];k[0]=b*a/e;k[1]=d*a/e;return k};this.pixelToDataDistance=function(b){return b*a/e};this.pixelToDataArea=function(b){return b*a*a/(e*e)};this.dataToPixel=function(b,a,c){return{x:0,y:0}};this.pixelToLiveString=function(b,
a){var c=this.pixelToData(b,a);return c[0].toExponential(4)+", "+c[1].toExponential(4)};this.getUnits=function(){return d}};a.prototype.numCalibrationPointsRequired=function(){return 2};a.prototype.getDimensions=function(){return 2};a.prototype.getAxesLabels=function(){return["X","Y"]};return a}();wpd=wpd||{};
wpd.PolarAxes=function(){var a=function(){var b=!1,a=!1,d,e,f,g,k,p,l,h,n,m,r,q,s,t;processCalibration=function(b,v,w){w=b.getPoint(0);var A=b.getPoint(1);b=b.getPoint(2);d=w.px;e=w.py;f=A.px;g=A.py;k=b.px;p=b.py;l=A.dx;h=A.dy;n=b.dx;a=v;!0===a&&(h*=Math.PI/180);m=Math.sqrt((f-d)*(f-d)+(g-e)*(g-e));r=Math.sqrt((k-d)*(k-d)+(p-e)*(p-e));q=r-m;s=wpd.taninverse(-(g-e),f-d);t=s-h;return!0};this.isCalibrated=function(){return b};this.calibrate=function(a,c,d){return b=processCalibration(a,c,d)};this.pixelToData=
function(b,f){var g=[],k,h;xp=parseFloat(b);yp=parseFloat(f);k=(n-l)/q*(Math.sqrt((xp-d)*(xp-d)+(yp-e)*(yp-e))-m)+l;h=wpd.taninverse(-(yp-e),xp-d)-t;!0==a&&(h=180*h/Math.PI);g[0]=k;g[1]=h;return g};this.dataToPixel=function(b,a){return{x:0,y:0}};this.pixelToLiveString=function(b,a){var c=this.pixelToData(b,a);return c[0].toExponential(4)+", "+c[1].toExponential(4)}};a.prototype.numCalibrationPointsRequired=function(){return 3};a.prototype.getDimensions=function(){return 2};a.prototype.getAxesLabels=
function(){return["r","\u03b8"]};return a}();wpd=wpd||{};
wpd.TernaryAxes=function(){var a=function(){var b=!1,a,d,e,f,g,k,p,l,h;this.isCalibrated=function(){return b};this.calibrate=function(n,m,r){var q=n.getPoint(0),s=n.getPoint(1);n.getPoint(2);a=q.px;d=q.py;e=s.px;f=s.py;g=Math.sqrt((a-e)*(a-e)+(d-f)*(d-f));k=wpd.taninverse(-(f-d),e-a);p=Math.sqrt(3);l=m;h=r;return b=!0};this.pixelToData=function(b,f){var e=[],q,s,t,u;xp=parseFloat(b);yp=parseFloat(f);q=Math.sqrt((xp-a)*(xp-a)+(yp-d)*(yp-d));s=wpd.taninverse(-(yp-d),xp-a)-k;t=q*Math.cos(s)/g;s=q*Math.sin(s)/
g;q=1-t-s/p;t-=s/p;s=2*s/p;!1==h&&(u=t,t=q,q=s,s=u);!0==l&&(q*=100,t*=100,s*=100);e[0]=q;e[1]=t;e[2]=s;return e};this.dataToPixel=function(a,b,c){return{x:0,y:0}};this.pixelToLiveString=function(a,b){var c=this.pixelToData(a,b);return c[0].toExponential(4)+", "+c[1].toExponential(4)+", "+c[2].toExponential(4)}};a.prototype.numCalibrationPointsRequired=function(){return 3};a.prototype.getDimensions=function(){return 3};a.prototype.getAxesLabels=function(){return["a","b","c"]};return a}();
wpd=wpd||{};
wpd.XYAxes=function(){var a=function(){var a=!1,c=!1,d=!1,e=!1,f=!1,g,k,p,l,h,n,m,r,q,s,t,u,v,w,A,F,J,E,z,H,G,M,N,R=function(a,b,T){if(4>a.getCount())return!1;var L=a.getPoint(0),P=a.getPoint(1),I=a.getPoint(2);a=a.getPoint(3);var y=new wpd.InputParser;p=L.px;m=L.py;l=P.px;r=P.py;h=I.px;q=I.py;n=a.px;s=a.py;t=L.dx;u=P.dx;v=I.dy;w=a.dy;t=y.parse(t);if(!y.isValid)return!1;e=y.isDate;u=y.parse(u);if(!y.isValid||y.isDate!=e)return!1;g=y.formatting;v=y.parse(v);if(!y.isValid)return!1;f=y.isDate;w=y.parse(w);
if(!y.isValid||y.isDate!=f)return!1;k=y.formatting;c=b;d=T;!0===c&&(t=Math.log(t)/Math.log(10),u=Math.log(u)/Math.log(10));!0===d&&(v=Math.log(v)/Math.log(10),w=Math.log(w)/Math.log(10));A=u-t;F=w-v;J=Math.sqrt((p-l)*(p-l)+(m-r)*(m-r));E=Math.sqrt((h-n)*(h-n)+(q-s)*(q-s));z=A/J;H=F/E;G=wpd.taninverse(-(r-m),l-p);M=wpd.taninverse(-(s-q),n-h);N=M-G;return!0};this.getBounds=function(){return{x1:t,x2:u,y3:v,y4:w}};this.isCalibrated=function(){return a};this.calibrate=function(c,d,f){return a=R(c,d,f)};
this.pixelToData=function(a,b){var f=[],e,g,k,l;e=parseFloat(a);g=parseFloat(b);k=Math.sqrt((e-p)*(e-p)+(g-m)*(g-m));l=wpd.taninverse(-(g-m),e-p)-G;k=(k*Math.cos(l)-k*Math.sin(l)/Math.tan(N))*z+t;l=Math.sqrt((e-h)*(e-h)+(g-q)*(g-q));e=M-wpd.taninverse(-(g-q),e-h);e=(l*Math.cos(e)-l*Math.sin(e)/Math.tan(N))*H+v;!0===c&&(k=Math.pow(10,k));!0===d&&(e=Math.pow(10,e));f[0]=k;f[1]=e;return f};this.dataToPixel=function(a,b){var c,d;c=(p-l)*(q-s)-(m-r)*(h-n);d=this.pixelToData(((p*r-m*l)*(h-n)-(p-l)*(h*s-
q*n))/c,((p*r-m*l)*(q-s)-(m-r)*(h*s-q*n))/c);c=d[0];d=d[1];d=(a-t)*Math.cos(G)/z+(b-d)*Math.cos(M)/H+p;c=q-(a-c)*Math.sin(G)/z-(b-v)*Math.sin(M)/H;return{x:d,y:c}};this.pixelToLiveString=function(a,b){var c="",d=this.pixelToData(a,b),c=e?c+wpd.dateConverter.formatDateNumber(d[0],g):c+d[0].toExponential(4),c=c+", ";return c=f?c+wpd.dateConverter.formatDateNumber(d[1],k):c+d[1].toExponential(4)};this.isDate=function(a){return 0===a?e:f};this.getInitialDateFormat=function(a){return 0===a?g:k};this.isLogX=
function(){return c};this.isLogY=function(){return d}};a.prototype.numCalibrationPointsRequired=function(){return 4};a.prototype.getDimensions=function(){return 2};a.prototype.getAxesLabels=function(){return["X","Y"]};return a}();wpd=wpd||{};
wpd.dataTable=function(){function a(){e=wpd.appData.getPlotData().getDataFromActiveSeries()}function b(){f=e.slice(0);var a=document.getElementById("data-sort-variables").value,b="ascending"===document.getElementById("data-sort-order").value,c="raw"===a,d="NearestNeighbor"===a,g,m=wpd.appData.getPlotData().axes.getDimensions();if(!c)if(!d)g=parseInt(a,10),f.sort(function(a,c){return a[g]>c[g]?b?1:-1:a[g]<c[g]?b?-1:1:0});else if(d){var r,d=[1,1,1],q,s,t=e.length;for(q=0;q<t-1;q++){c=-1;for(s=q+1;s<
t;s++)if(a=(f[q][0]-f[s][0])*(f[q][0]-f[s][0])+(f[q][1]-f[s][1])*(f[q][1]-f[s][1]),3===m&&(a+=(f[q][2]-f[s][2])*(f[q][2]-f[s][2])),a<r||-1===c)r=a,c=s;d[0]=f[c][0];f[c][0]=f[q+1][0];f[q+1][0]=d[0];d[1]=f[c][1];f[c][1]=f[q+1][1];f[q+1][1]=d[1];3===m&&(d[2]=f[c][2],f[c][2]=f[q+1][2],f[q+1][2]=d[2])}}}function c(){var a=document.getElementById("data-sort-variables").value,b=document.getElementById("data-sort-order");"NearestNeighbor"===a||"raw"===a?b.setAttribute("disabled",!0):b.removeAttribute("disabled")}
function d(){if(null!=e){var a=wpd.appData.getPlotData().axes,b=wpd.appData.getPlotData().getActiveDataSeries(),c=a.getDimensions(),b=b.getMetadataKeys().length,d=e.length,n,m,r,q=document.getElementById("digitizedDataTable"),s=[];g="";for(n=0;n<d;n++){r=[];for(m=0;m<c+b;m++)m<c&&null!=a.isDate&&a.isDate(m)?(void 0===s[m]&&(s[m]=document.getElementById("data-format-string-"+m).value),r[m]=wpd.dateConverter.formatDateNumber(f[n][m],s[m])):r[m]=f[n][m];g+=r.join(", ");g+="\n"}q.value=g}}var e,f,g;return{getSeriesData:a,
showTable:function(){if(wpd.appData.isAligned()){wpd.popup.show("csvWindow");a();var f=document.getElementById("data-sort-variables"),e=document.getElementById("dataVariables"),g=document.getElementById("data-date-formatting-container"),h=document.getElementById("data-date-formatting"),n=wpd.appData.getPlotData().axes,m=wpd.appData.getPlotData().getActiveDataSeries(),r=n.getAxesLabels(),q="",s=r.join(", "),t="";isAnyVariableDate=!1;tableVariables=r;dimCount=n.getDimensions();m.hasMetadata()&&(tableVariables=
r.concat(m.getMetadataKeys()),s=tableVariables.join(", "));g.style.display="none";q+='<option value="raw">Raw</option>';for(m=0;m<tableVariables.length;m++)q+='<option value="'+m+'">'+tableVariables[m]+"</option>",m<dimCount&&null!=n.isDate&&null!=n.getInitialDateFormat&&n.isDate(m)&&(t+=r[m]+' <input type="text" length="15" value="'+n.getInitialDateFormat(m)+'" id="data-format-string-'+m+'"/>',isAnyVariableDate=!0);f.innerHTML=q+'<option value="NearestNeighbor">Nearest Neighbor</option>';e.innerHTML=
s;isAnyVariableDate&&(g.style.display="inline-block",h.innerHTML=t);b();d();c()}},updateSortingControls:c,reSort:function(){c();b();d()},selectAll:function(){var a=document.getElementById("digitizedDataTable");a.focus();a.select()},generateCSV:function(){var a,b,c,d=JSON.stringify(g);a=document.createElement("div");b=document.createElement("form");c=document.createElement("input");b.setAttribute("method","post");b.setAttribute("action","php/csvexport.php");c.setAttribute("type","text");c.setAttribute("name",
"data");b.appendChild(c);a.appendChild(b);document.body.appendChild(a);a.style.display="none";c.setAttribute("value",d);b.submit();document.body.removeChild(a)},exportToPlotly:function(){if(null!=e&&0!==e.length){var a=document.createElement("div"),b=document.createElement("form"),c=document.createElement("input");b.setAttribute("method","post");b.setAttribute("action","https://plot.ly/external");b.setAttribute("target","_blank");c.setAttribute("type","text");c.setAttribute("name","data");b.appendChild(c);
a.appendChild(b);document.body.appendChild(a);a.style.display="none";var d={data:[]},g=wpd.appData.getPlotData().axes,m=wpd.appData.getPlotData().getActiveDataSeries().getMetadataKeys(),r=m.length,q=g.getDimensions(),s=e.length,t,u,v=["x","y","z"];d.data[0]={};for(t=0;t<s;t++)for(rowValues=[],u=0;u<q+r;u++)0===t&&(u<q?d.data[0][v[u]]=[]:d.data[0][m[u-q]]=[]),u<q&&null!=g.isDate&&g.isDate(u)?d.data[0][v[u]][t]=wpd.dateConverter.formatDateNumber(f[t][u],"yyyy-mm-dd"):u<q?d.data[0][v[u]][t]=f[t][u]:
d.data[0][m[u-q]][t]=f[t][u];c.setAttribute("value",JSON.stringify(d));b.submit();document.body.removeChild(a)}}}}();wpd=wpd||{};
wpd.graphicsWidget=function(){function a(a){var b=A.getBoundingClientRect();return{x:parseInt(a.pageX-(b.left+window.pageXOffset),10),y:parseInt(a.pageY-(b.top+window.pageYOffset),10)}}function b(a,b){return{x:a/K,y:b/K}}function c(a,b){a=parseInt(a,10);b=parseInt(b,10);M.style.width=a+"px";M.style.height=b+"px";A.width=a;F.width=a;J.width=a;E.width=a;z.width=a;A.height=b;F.height=b;J.height=b;E.height=b;z.height=b;W=a/(1*b);I=a;y=b;if(null!=Q){N.fillStyle="rgb(255, 255, 255)";N.fillRect(0,0,I,y);
N.drawImage(H,0,0,I,y);if(null!=B&&void 0!=B.onRedraw)B.onRedraw();if(null!=x&&void 0!=x.onRedraw)x.onRedraw()}}function d(){A.width=A.width;F.width=F.width;J.width=J.width;E.width=E.width;z.width=z.width;G.width=G.width}function e(){if(null!=B&&void 0!=B.onRemove)B.onRemove();B=null}function f(){var a=wpd.layoutManager.getGraphicsViewportSize();c(a.width,a.height);W>S?(K=y/(1*C),c(y*S,y)):(K=I/(1*D),c(I,I/S))}function g(a){K=a;c(D*K,C*K)}function k(a){220===a.keyCode&&(a.preventDefault(),U=!U,E.width=
E.width)}function p(a,b){var c=wpd.zoomView.getSize(),d=wpd.zoomView.getZoomRatio(),f,e,g,k,h,p,l,n=0,m=0,q=c.width,r=c.height;g=c.width/d;k=c.height/d;f=a-g/2;e=b-k/2;p=f;c=e;h=f+g;l=e+k;0>f&&(p=0,n=-f*d);0>e&&(c=0,m=-e*d);f+g>=D&&(h=D,q-=d*(D-(f+g)));e+k>=C&&(l=C,r-=d*(C-(e+k)));g=L.getImageData(parseInt(p,10),parseInt(c,10),parseInt(h-p,10),parseInt(l-c,10));h=P.getImageData(parseInt(p,10),parseInt(c,10),parseInt(h-p,10),parseInt(l-c,10));for(l=0;l<h.data.length;l+=4)if(0!=h.data[l]||0!=h.data[l+
1]||0!=h.data[l+2])g.data[l]=h.data[l],g.data[l+1]=h.data[l+1],g.data[l+2]=h.data[l+2];p=d*(parseInt(p,10)-p);d*=parseInt(c,10)-c;wpd.zoomView.setZoomImage(g,parseInt(n+p,10),parseInt(m+d,10),parseInt(q-n,10),parseInt(r-m,10))}function l(c){clearTimeout(X);var d=setTimeout,f=a(c);c=f.x;var f=f.y,e=b(c,f);U&&(E.width=E.width,O.strokeStyle="rgba(0,0,0, 0.5)",O.beginPath(),O.moveTo(c,0),O.lineTo(c,y),O.moveTo(0,f),O.lineTo(I,f),O.stroke());p(e.x,e.y);wpd.zoomView.setCoords(e.x,e.y);X=d(void 0,10)}function h(){A=
document.getElementById("mainCanvas");F=document.getElementById("dataCanvas");J=document.getElementById("drawCanvas");E=document.getElementById("hoverCanvas");z=document.getElementById("topCanvas");H=document.createElement("canvas");G=document.createElement("canvas");N=A.getContext("2d");R=F.getContext("2d");O=E.getContext("2d");T=z.getContext("2d");V=J.getContext("2d");L=H.getContext("2d");P=G.getContext("2d");M=document.getElementById("canvasDiv");document.body.addEventListener("keydown",k,!1);
z.addEventListener("mousemove",l,!1);z.addEventListener("dragover",function(a){a.preventDefault()},!0);z.addEventListener("drop",function(a){a.preventDefault();a=a.dataTransfer.files;1===a.length&&m(a[0])},!0);z.addEventListener("mousemove",s,!1);z.addEventListener("click",t,!1);z.addEventListener("mouseup",u,!1);z.addEventListener("mousedown",v,!1);z.addEventListener("mouseout",w,!0);document.addEventListener("mousedown",function(a){Y=a.target===z?!0:!1},!1);document.addEventListener("keydown",function(a){if(Y&&
null!=x&&void 0!=x.onKeyDown)x.onKeyDown(a)},!0);wpd.zoomView.initZoom();document.getElementById("fileLoadBox").addEventListener("change",r);window.addEventListener("paste",function(a){if(void 0!==a.clipboardData&&(a=a.clipboardData.items,void 0!==a))for(var b=0;b<a.length;b++)if(-1!==a[b].type.indexOf("image")){var c=a[b].getAsFile();(window.URL||window.webkitURL).createObjectURL(c);m(c)}},!1)}function n(a){var b=document.createElement("img");b.onload=function(){null==A&&h();wpd.appData.reset();
wpd.sidebar.clear();q();e();D=b.width;C=b.height;S=D/(1*C);H.width=D;H.height=C;G.width=D;G.height=C;L.drawImage(b,0,0,D,C);Q=L.getImageData(0,0,D,C);d();f();wpd.appData.plotLoaded(Q)};b.src=a}function m(a){if(a.type.match("image.*")){var b=new FileReader;b.onload=function(){n(b.result)};b.readAsDataURL(a)}}function r(){var a=document.getElementById("fileLoadBox");1==a.files.length&&m(a.files[0])}function q(){if(null!=x&&void 0!=x.onRemove)x.onRemove();x=null}function s(c){if(null!=x&&void 0!=x.onMouseMove){var d=
a(c),f=b(d.x,d.y);x.onMouseMove(c,d,f)}}function t(c){if(null!=x&&void 0!=x.onMouseClick){var d=a(c),f=b(d.x,d.y);x.onMouseClick(c,d,f)}}function u(c){if(null!=x&&void 0!=x.onMouseUp){var d=a(c),f=b(d.x,d.y);x.onMouseUp(c,d,f)}}function v(c){if(null!=x&&void 0!=x.onMouseDown){var d=a(c),f=b(d.x,d.y);x.onMouseDown(c,d,f)}}function w(c){if(null!=x&&void 0!=x.onMouseOut){var d=a(c),f=b(d.x,d.y);x.onMouseOut(c,d,f)}}var A,F,J,E,z,H,G,M,N,R,V,O,T,L,P,I,y,D,C,S,W,Q,K,U=!1,X,x,B,Y=!1;return{zoomIn:function(){g(1.2*
K)},zoomOut:function(){g(K/1.2)},zoomFit:f,zoom100perc:function(){g(1)},setZoomRatio:g,getZoomRatio:function(){return K},loadImageFromURL:n,runImageOp:function(a){var b=a(Q,D,C);a=b.imageData;var c=b.width,b=b.height;wpd.appData.reset();q();e();D=c;C=b;S=D/(1*C);H.width=D;H.height=C;G.width=D;G.height=C;L.putImageData(a,0,0);Q=a;d();f();wpd.appData.plotLoaded(Q)},setTool:function(a){if(null!=x&&void 0!=x.onRemove)x.onRemove();x=a;if(null!=x&&void 0!=x.onAttach)x.onAttach()},removeTool:q,getAllContexts:function(){return{mainCtx:N,
dataCtx:R,drawCtx:V,hoverCtx:O,topCtx:T,oriImageCtx:L,oriDataCtx:P}},resetData:function(){G.width=G.width;F.width=F.width},resetHover:function(){E.width=E.width},imagePx:b,screenPx:function(a,b){return{x:a*K,y:b*K}},updateZoomOnEvent:function(c){c=a(c);c=b(c.x,c.y);p(c.x,c.y);wpd.zoomView.setCoords(c.x,c.y)},updateZoomToImagePosn:function(a,b){p(a,b);wpd.zoomView.setCoords(a,b)},getDisplaySize:function(){return{width:I,height:y}},getImageSize:function(){return{width:D,height:C}},copyImageDataLayerToScreen:function(){R.drawImage(G,
0,0,I,y)},setRepainter:function(a){if(null==B||void 0==B.painterName||null==a||void 0==a.painterName||B.painterName!=a.painterName){if(null!=B&&void 0!=B.onRemove)B.onRemove();B=a;if(null!=B&&void 0!=B.onAttach)B.onAttach()}},removeRepainter:e,forceHandlerRepaint:function(){if(null!=B&&void 0!=B.onForcedRedraw)B.onForcedRedraw()},getRepainter:function(){return B},saveImage:function(){var a=document.createElement("canvas"),b=a.getContext("2d"),c,d,f;a.width=D;a.height=C;b.drawImage(H,0,0,D,C);c=b.getImageData(0,
0,D,C);f=P.getImageData(0,0,D,C);for(d=0;d<c.data.length;d+=4)if(0!=f.data[d]||0!=f.data[d+1]||0!=f.data[d+2])c.data[d]=f.data[d],c.data[d+1]=f.data[d+1],c.data[d+2]=f.data[d+2];b.putImageData(c,0,0);window.open(a.toDataURL(),"_blank")}}}();wpd=wpd||{};
wpd.layoutManager=function(){function a(){var a=parseInt(document.body.offsetWidth,10),b=parseInt(document.body.offsetHeight,10);e.style.height=b+"px";f.style.width=a-e.offsetWidth-5+"px";f.style.height=b+"px";d.style.height=b-44+"px"}function b(b){clearTimeout(c);c=setTimeout(a,80)}var c,d,e,f;return{initialLayout:function(){d=document.getElementById("graphicsContainer");e=document.getElementById("sidebarContainer");f=document.getElementById("mainContainer");a();window.addEventListener("resize",
b,!1)},getGraphicsViewportSize:function(){return{width:d.offsetWidth,height:d.offsetHeight}}}}();wpd=wpd||{};
wpd.popup=function(){return{show:function(a){document.getElementById("shadow").style.visibility="visible";a=document.getElementById(a);var b=parseInt(window.innerWidth),c=parseInt(window.innerHeight),d=parseInt(a.offsetWidth),e=parseInt(a.offsetHeight),c=(c-e)/2;a.style.left=(b-d)/2+"px";a.style.top=(60<c?60:c)+"px";a.style.visibility="visible"},close:function(a){document.getElementById("shadow").style.visibility="hidden";document.getElementById(a).style.visibility="hidden"}}}();
wpd.busyNote=function(){return{show:function(){document.getElementById("wait").style.visibility="visible"},close:function(){document.getElementById("wait").style.visibility="hidden"}}}();wpd.messagePopup=function(){var a;return{show:function(b,c,d){wpd.popup.show("messagePopup");document.getElementById("message-popup-heading").innerHTML=b;document.getElementById("message-popup-text").innerHTML=c;a=d},close:function(){wpd.popup.close("messagePopup");null!=a&&a()}}}();
wpd.unsupported=function(){wpd.messagePopup.show("Unsupported Feature!","This feature has not been implemented in the current version. This may be available in a future release.")};wpd=wpd||{};wpd.sidebar=function(){function a(){var a=document.getElementsByClassName("sidebar"),c;for(c=0;c<a.length;c++)a[c].style.visibility="hidden"}return{show:function(b){a();document.getElementById(b).style.visibility="visible"},clear:a}}();wpd=wpd||{};
wpd.toolbar=function(){function a(){var a=document.getElementsByClassName("toolbar"),c;for(c=0;c<a.length;c++)a[c].style.visibility="hidden"}return{show:function(b){a();document.getElementById(b).style.visibility="visible"},clear:a}}();wpd=wpd||{};
wpd.webcamCapture=function(){function a(){void 0!=b&&b.stop();wpd.popup.close("webcamCapture")}var b;return{start:function(){if(null==(navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia))wpd.messagePopup.show("Webcam Capture","Your browser does not support webcam capture using HTML5 APIs. A recent version of Google Chrome is recommended.");else{wpd.popup.show("webcamCapture");var a=document.getElementById("webcamVideo");navigator.getUserMedia=
navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia;navigator.getUserMedia({video:!0},function(d){b=d;a.src=window.URL.createObjectURL(d)},function(){})}},cancel:function(){a()},capture:function(){var b=document.createElement("canvas"),d=document.getElementById("webcamVideo"),e=b.getContext("2d"),f;b.width=d.videoWidth;b.height=d.videoHeight;e.drawImage(d,0,0);f=e.getImageData(0,0,b.width,b.height);a();wpd.graphicsWidget.runImageOp(function(){return{imageData:f,
width:b.width,height:b.height}})}}}();wpd=wpd||{};
wpd.zoomView=function(){function a(){var a=document.getElementById("zoomCrossHair"),b=a.getContext("2d");a.width=a.width;b.strokeStyle="black"===l?"rgba(0,0,0,1)":"red"===l?"rgba(255,0,0,1)":"yellow"===l?"rgba(255,255,0,1)":"rgba(0,0,0,1)";b.beginPath();b.moveTo(f/2,0);b.lineTo(f/2,g);b.moveTo(0,g/2);b.lineTo(f,g/2);b.stroke()}var b,c,d,e,f=250,g=250,k,p,l="black";return{initZoom:function(){b=document.getElementById("zoomCanvas");c=b.getContext("2d");d=document.createElement("canvas");e=d.getContext("2d");
k=document.getElementById("mousePosition");p=5;a()},setZoomImage:function(a,f,g,k,l){d.width=k/p;d.height=l/p;e.putImageData(a,0,0);b.width=b.width;c.drawImage(d,f,g,k,l)},setCoords:function(a,b){if(wpd.appData.isAligned()){var c=wpd.appData.getPlotData();k.innerHTML=c.axes.pixelToLiveString(a,b)}else k.innerHTML=a.toFixed(2)+", "+b.toFixed(2)},setZoomRatio:function(a){p=a},getZoomRatio:function(){return p},getSize:function(){return{width:f,height:g}},showSettingsWindow:function(){document.getElementById("zoom-magnification-value").value=
p;document.getElementById("zoom-crosshair-color-value").value=l;wpd.popup.show("zoom-settings-popup")},applySettings:function(){p=document.getElementById("zoom-magnification-value").value;l=document.getElementById("zoom-crosshair-color-value").value;a();wpd.popup.close("zoom-settings-popup")}}}();wpd=wpd||{};
wpd.xyCalibration=function(){function a(){wpd.popup.show("xyAlignment")}return{start:function(){wpd.popup.show("xyAxesInfo")},pickCorners:function(){wpd.popup.close("xyAxesInfo");var a=new wpd.AxesCornersTool(4,2,["X1","X2","Y1","Y2"]);wpd.graphicsWidget.setTool(a)},getCornerValues:a,align:function(){var b=document.getElementById("xmin").value,c=document.getElementById("xmax").value,d=document.getElementById("ymin").value,e=document.getElementById("ymax").value,f=document.getElementById("xlog").checked,
g=document.getElementById("ylog").checked,k=new wpd.XYAxes,p=wpd.alignAxes.getActiveCalib();p.setDataAt(0,b,d);p.setDataAt(1,c,d);p.setDataAt(2,b,d);p.setDataAt(3,c,e);if(!k.calibrate(p,f,g))return wpd.popup.close("xyAlignment"),wpd.messagePopup.show("Invalid Inputs","Please enter valid values for calibration.",a),!1;wpd.appData.getPlotData().axes=k;wpd.popup.close("xyAlignment");return!0}}}();
wpd.polarCalibration=function(){return{start:function(){wpd.popup.show("polarAxesInfo")},pickCorners:function(){wpd.popup.close("polarAxesInfo");var a=new wpd.AxesCornersTool(3,2,["Origin","P1","P2"]);wpd.graphicsWidget.setTool(a)},getCornerValues:function(){wpd.popup.show("polarAlignment")},align:function(){var a=parseFloat(document.getElementById("rpoint1").value),b=parseFloat(document.getElementById("thetapoint1").value),c=parseFloat(document.getElementById("rpoint2").value),d=parseFloat(document.getElementById("thetapoint2").value),
e=document.getElementById("degrees").checked;document.getElementById("radians");var f=document.getElementById("clockwise").checked,g=new wpd.PolarAxes,k=wpd.alignAxes.getActiveCalib();k.setDataAt(1,a,b);k.setDataAt(2,c,d);g.calibrate(k,e,f);wpd.appData.getPlotData().axes=g;wpd.popup.close("polarAlignment");return!0}}}();
wpd.ternaryCalibration=function(){return{start:function(){wpd.popup.show("ternaryAxesInfo")},pickCorners:function(){wpd.popup.close("ternaryAxesInfo");var a=new wpd.AxesCornersTool(3,3,["A","B","C"]);wpd.graphicsWidget.setTool(a)},getCornerValues:function(){wpd.popup.show("ternaryAlignment")},align:function(){document.getElementById("range0to1");var a=document.getElementById("range0to100").checked,b=document.getElementById("ternarynormal").checked,c=new wpd.TernaryAxes,d=wpd.alignAxes.getActiveCalib();
c.calibrate(d,a,b);wpd.appData.getPlotData().axes=c;wpd.popup.close("ternaryAlignment");return!0}}}();
wpd.mapCalibration=function(){function a(){wpd.popup.show("mapAlignment")}return{start:function(){wpd.popup.show("mapAxesInfo")},pickCorners:function(){wpd.popup.close("mapAxesInfo");var b=new wpd.AxesCornersTool(2,2,["P1","P2"]);wpd.graphicsWidget.setTool(b);b.onComplete=a},getCornerValues:a,align:function(){var a=parseFloat(document.getElementById("scaleLength").value),c=document.getElementById("scaleUnits").value,d=new wpd.MapAxes,e=wpd.alignAxes.getActiveCalib();d.calibrate(e,a,c);wpd.appData.getPlotData().axes=
d;wpd.popup.close("mapAlignment");return!0}}}();
wpd.AxesCornersTool=function(){return function(a,b,c){var d=0;b=new wpd.Calibration(b);var e=!0;b.labels=c;wpd.alignAxes.setActiveCalib(b);wpd.graphicsWidget.resetData();this.onMouseClick=function(b,c,k){e?(d+=1,c=wpd.alignAxes.getActiveCalib(),c.addPoint(k.x,k.y,0,0),c.unselectAll(),c.selectPoint(d-1),wpd.graphicsWidget.forceHandlerRepaint(),d===a&&(e=!1,wpd.alignAxes.calibrationCompleted())):(c=wpd.alignAxes.getActiveCalib(),c.unselectAll(),c.selectNearestPoint(k.x,k.y),wpd.graphicsWidget.forceHandlerRepaint());
wpd.graphicsWidget.updateZoomOnEvent(b)};this.onKeyDown=function(a){var b=wpd.alignAxes.getActiveCalib();if(0!==b.getSelectedPoints().length){var c=b.getPoint(b.getSelectedPoints()[0]),d=c.px,c=c.py,e=!0===a.shiftKey?5/wpd.graphicsWidget.getZoomRatio():0.5/wpd.graphicsWidget.getZoomRatio();if(wpd.keyCodes.isUp(a.keyCode))c-=e;else if(wpd.keyCodes.isDown(a.keyCode))c+=e;else if(wpd.keyCodes.isLeft(a.keyCode))d-=e;else if(wpd.keyCodes.isRight(a.keyCode))d+=e;else return;b.changePointPx(b.getSelectedPoints()[0],
d,c);wpd.graphicsWidget.forceHandlerRepaint();wpd.graphicsWidget.updateZoomToImagePosn(d,c);a.preventDefault();a.stopPropagation()}}}}();
wpd.AlignmentCornersRepainter=function(){return function(){var a=wpd.graphicsWidget.getAllContexts();this.painterName="AlignmentCornersReptainer";this.onForcedRedraw=function(){wpd.graphicsWidget.resetData();this.onRedraw()};this.onRedraw=function(){var b=wpd.alignAxes.getActiveCalib();if(null!=b){var c,d,e;for(c=0;c<b.getCount();c++)e=b.getPoint(c),d=wpd.graphicsWidget.screenPx(e.px,e.py),a.dataCtx.fillStyle="rgba(255,255,255,0.7)",a.dataCtx.fillRect(d.x-10,d.y-10,20,40),a.dataCtx.beginPath(),b.isPointSelected(c)?
a.dataCtx.fillStyle="rgba(0,200,0,1)":a.dataCtx.fillStyle="rgba(200,0,0,1)",a.dataCtx.arc(d.x,d.y,3,0,2*Math.PI,!0),a.dataCtx.fill(),a.dataCtx.font="14px sans-serif",a.dataCtx.fillText(b.labels[c],d.x-10,d.y+18),a.oriDataCtx.beginPath(),b.isPointSelected(c)?a.oriDataCtx.fillStyle="rgb(0,200,0)":a.oriDataCtx.fillStyle="rgb(200,0,0)",a.oriDataCtx.arc(e.px,e.py,3,0,2*Math.PI,!0),a.oriDataCtx.fill(),a.oriDataCtx.font="14px sans-serif",a.oriDataCtx.fillText(b.labels[c],parseInt(e.px-10,10),parseInt(e.py+
18,10))}}}}();
wpd.alignAxes=function(){var a,b;return{start:function(){xyEl=document.getElementById("r_xy");polarEl=document.getElementById("r_polar");ternaryEl=document.getElementById("r_ternary");mapEl=document.getElementById("r_map");imageEl=document.getElementById("r_image");wpd.popup.close("axesList");if(!0===xyEl.checked)b=wpd.xyCalibration;else if(!0===polarEl.checked)b=wpd.polarCalibration;else if(!0===ternaryEl.checked)b=wpd.ternaryCalibration;else if(!0===mapEl.checked)b=wpd.mapCalibration;else if(!0===
imageEl.checked){b=null;var a=new wpd.ImageAxes;a.calibrate();wpd.appData.getPlotData().axes=a;wpd.appData.isAligned(!0);wpd.acquireData.load()}null!=b&&(b.start(),wpd.graphicsWidget.setRepainter(new wpd.AlignmentCornersRepainter))},calibrationCompleted:function(){wpd.sidebar.show("axes-calibration-sidebar")},getCornerValues:function(){b.getCornerValues()},align:function(){wpd.graphicsWidget.removeTool();wpd.graphicsWidget.removeRepainter();wpd.graphicsWidget.resetData();b.align()&&(wpd.appData.isAligned(!0),
wpd.acquireData.load())},getActiveCalib:function(){return a},setActiveCalib:function(b){a=b}}}();wpd=wpd||{};
wpd.autoExtraction=function(){function a(){var a=wpd.appData.getPlotData().getAutoDetector(),c=document.getElementById("auto-extract-algo-name").value;"averagingWindow"===c?a.algorithm=new wpd.AveragingWindowAlgo:"XStep"===c?(c=wpd.appData.getPlotData().axes,c instanceof wpd.XYAxes&&!1===c.isLogX()&&!1===c.isLogY()?a.algorithm=new wpd.AveragingWindowWithStepSizeAlgo:(wpd.messagePopup.show("Not supported!","This algorithm is only supported for non log scale XY plots."),document.getElementById("auto-extract-algo-name").value=
"averagingWindow",a.algorithm=new wpd.AveragingWindowAlgo)):"blobDetector"===c&&(a.algorithm=new wpd.BlobDetectorAlgo);var c=a.algorithm,a=document.getElementById("algo-parameter-container"),c=c.getParamList(),d,e="<table>";for(d=0;d<c.length;d++)e+="<tr><td>"+c[d][0]+'</td><td><input type="text" size=3 id="algo-param-'+d+'" class="algo-params" value="'+c[d][2]+'"/></td><td>'+c[d][1]+"</td></tr>";a.innerHTML=e+"</table>"}return{start:function(){wpd.sidebar.show("auto-extraction-sidebar");wpd.colorPicker.init();
a()},changeAlgorithm:a,runAlgo:function(){var a=wpd.appData.getPlotData().getAutoDetector(),c=a.algorithm,d=new wpd.DataPointsRepainter,e=document.getElementsByClassName("algo-params"),f,g,k=wpd.graphicsWidget.getAllContexts(),p=wpd.graphicsWidget.getImageSize();for(f=0;f<e.length;f++)g=e[f].id,g=parseInt(g.replace("algo-param-",""),10),c.setParam(g,parseFloat(e[f].value));wpd.graphicsWidget.removeTool();a.imageData=k.oriImageCtx.getImageData(0,0,p.width,p.height);a.generateBinaryData();wpd.graphicsWidget.setRepainter(d);
c.run(wpd.appData.getPlotData());wpd.graphicsWidget.forceHandlerRepaint();wpd.dataPointCounter.setCount()}}}();wpd=wpd||{};
wpd.colorPicker=function(){function a(){var a=document.getElementById("color-button"),b=document.getElementById("color-distance-value"),c=wpd.appData.getPlotData().getAutoDetector(),d=document.getElementById("color-detection-mode-select"),e;e="fg"===c.colorDetectionMode?c.fgColor:c.bgColor;color_distance=c.colorDistance;a.style.backgroundColor="rgb("+e[0]+","+e[1]+","+e[2]+")";b.value=color_distance;d.value=c.colorDetectionMode}function b(){var a=wpd.appData.getPlotData().getAutoDetector().fgColor;
document.getElementById("selectedFGColorBox").style.backgroundColor="rgb("+a[0]+","+a[1]+","+a[2]+")";document.getElementById("color_red_fg").value=a[0];document.getElementById("color_green_fg").value=a[1];document.getElementById("color_blue_fg").value=a[2];d("fg");wpd.popup.show("colorPickerFG")}function c(){var a=wpd.appData.getPlotData().getAutoDetector().bgColor;document.getElementById("selectedBGColorBox").style.backgroundColor="rgb("+a[0]+","+a[1]+","+a[2]+")";document.getElementById("color_red_bg").value=
a[0];document.getElementById("color_green_bg").value=a[1];document.getElementById("color_blue_bg").value=a[2];d("bg");wpd.popup.show("colorPickerBG")}function d(a){var b=document.getElementById("fg"===a?"fgColorOptions":"bgColorOptions"),c=wpd.appData.getPlotData().topColors,d=10<c.length?10:c.length,e,h="",n,m;for(e=0;e<d;e++)m="rgb("+c[e].r+","+c[e].g+","+c[e].b+");",n=c[e].percentage.toFixed(3)+"%",h+='<div class="colorOptionBox" style="background-color: '+m+'" title="'+n+'" onclick="wpd.colorPicker.selectTopColor('+
e+",'"+a+"');\"></div>";b.innerHTML=h}function e(){var a=wpd.graphicsWidget.getAllContexts(),b=wpd.appData.getPlotData().getAutoDetector(),c=wpd.graphicsWidget.getImageSize(),d,e,h;h=a.oriDataCtx.getImageData(0,0,c.width,c.height);b.imageData=a.oriImageCtx.getImageData(0,0,c.width,c.height);b.generateBinaryData();if(null!=b.mask&&0!==b.mask.length){for(d=0;d<b.mask.length;d++)e=b.mask[d],!0===b.binaryData[e]?(parseInt(e/c.width,10),h.data[4*e]=255,h.data[4*e+1]=255,h.data[4*e+2]=0,h.data[4*e+3]=255):
(h.data[4*e]=0,h.data[4*e+1]=0,h.data[4*e+2]=0,h.data[4*e+3]=150);a.oriDataCtx.putImageData(h,0,0);wpd.graphicsWidget.copyImageDataLayerToScreen()}}return{startPicker:function(){wpd.graphicsWidget.removeTool();wpd.graphicsWidget.removeRepainter();wpd.graphicsWidget.resetData();"fg"===wpd.appData.getPlotData().getAutoDetector().colorDetectionMode?b():c()},changeDetectionMode:function(){var b=document.getElementById("color-detection-mode-select");wpd.appData.getPlotData().getAutoDetector().colorDetectionMode=
b.value;a()},pickFGColor:function(){wpd.popup.close("colorPickerFG");var a=new wpd.ColorPickerTool;a.onComplete=function(a){wpd.appData.getPlotData().getAutoDetector().fgColor=a;wpd.graphicsWidget.removeTool();b()};wpd.graphicsWidget.setTool(a)},pickBGColor:function(){wpd.popup.close("colorPickerBG");var a=new wpd.ColorPickerTool;a.onComplete=function(a){wpd.appData.getPlotData().getAutoDetector().bgColor=a;wpd.graphicsWidget.removeTool();c()};wpd.graphicsWidget.setTool(a)},setFGColor:function(){var b=
[];b[0]=parseInt(document.getElementById("color_red_fg").value,10);b[1]=parseInt(document.getElementById("color_green_fg").value,10);b[2]=parseInt(document.getElementById("color_blue_fg").value,10);wpd.appData.getPlotData().getAutoDetector().fgColor=b;wpd.popup.close("colorPickerFG");a()},setBGColor:function(){var b=[];b[0]=parseInt(document.getElementById("color_red_bg").value,10);b[1]=parseInt(document.getElementById("color_green_bg").value,10);b[2]=parseInt(document.getElementById("color_blue_bg").value,
10);wpd.appData.getPlotData().getAutoDetector().bgColor=b;wpd.popup.close("colorPickerBG");a()},changeColorDistance:function(){var a=parseFloat(document.getElementById("color-distance-value").value);wpd.appData.getPlotData().getAutoDetector().colorDistance=a},init:a,testColorDetection:function(){wpd.graphicsWidget.removeTool();wpd.graphicsWidget.resetData();wpd.graphicsWidget.setRepainter(new wpd.ColorFilterRepainter);e()},paintFilteredColor:e,selectTopColor:function(a,d){var e=[],p=wpd.appData.getPlotData().topColors;
e[0]=p[a].r;e[1]=p[a].g;e[2]=p[a].b;"fg"===d?(wpd.appData.getPlotData().getAutoDetector().fgColor=e,b()):(wpd.appData.getPlotData().getAutoDetector().bgColor=e,c())}}}();wpd.ColorPickerTool=function(){return function(){var a=wpd.graphicsWidget.getAllContexts();this.onMouseClick=function(b,c,d){b=a.oriImageCtx.getImageData(d.x,d.y,1,1);this.onComplete([b.data[0],b.data[1],b.data[2]])};this.onComplete=function(a){}}}();
wpd.ColorFilterRepainter=function(){return function(){this.painterName="colorFilterRepainter";this.onRedraw=function(){wpd.colorPicker.paintFilteredColor()}}}();wpd=wpd||{};
wpd.imageOps=function(){function a(a,b,e){var f,g,k,p,l,h;for(f=0;f<e;f++)for(g=0;g<b/2;g++)for(k=4*(f*b+g),p=4*((f+1)*b-(g+1)),h=0;4>h;h++)l=a.data[k+h],a.data[k+h]=a.data[p+h],a.data[p+h]=l;return{imageData:a,width:b,height:e}}function b(a,b,e){var f,g,k,p,l,h;for(f=0;f<e/2;f++)for(g=0;g<b;g++)for(k=4*(f*b+g),p=4*((e-(f+2))*b+g),h=0;4>h;h++)l=a.data[k+h],a.data[k+h]=a.data[p+h],a.data[p+h]=l;return{imageData:a,width:b,height:e}}return{hflip:function(){wpd.graphicsWidget.runImageOp(a)},vflip:function(){wpd.graphicsWidget.runImageOp(b)}}}();
wpd=wpd||{};wpd.keyCodes=function(){return{isUp:function(a){return 38===a},isDown:function(a){return 40===a},isLeft:function(a){return 37===a},isRight:function(a){return 39===a},isAlphabet:function(a,b){return 90<a||65>a?!1:String.fromCharCode(a).toLowerCase()===b}}}();wpd=wpd||{};
wpd.acquireData=function(){function a(){var a=new wpd.ManualSelectionTool;wpd.graphicsWidget.setTool(a)}function b(){var a=new wpd.DeleteDataPointTool;wpd.graphicsWidget.setTool(a)}function c(){wpd.graphicsWidget.setTool(new wpd.AdjustDataPointTool)}return{load:function(){wpd.appData.isAligned()?(wpd.sidebar.show("acquireDataSidebar"),wpd.dataPointCounter.setCount(),wpd.graphicsWidget.removeTool(),wpd.graphicsWidget.setRepainter(new wpd.DataPointsRepainter),a()):wpd.messagePopup.show("Acquire Data",
"Please calibrate the axes before acquiring data.")},manualSelection:a,adjustPoints:c,deletePoint:b,clearAll:function(){wpd.appData.getPlotData().getActiveDataSeries().clearAll();wpd.graphicsWidget.removeTool();wpd.graphicsWidget.resetData();wpd.dataPointCounter.setCount()},undo:function(){wpd.appData.getPlotData().getActiveDataSeries().removeLastPixel();wpd.graphicsWidget.resetData();wpd.graphicsWidget.forceHandlerRepaint();wpd.dataPointCounter.setCount()},showSidebar:function(){wpd.sidebar.show("acquireDataSidebar")},
switchToolOnKeyPress:function(d){switch(d){case "d":b();break;case "a":a();break;case "s":c()}}}}();
wpd.ManualSelectionTool=function(){return function(){var a=wpd.graphicsWidget.getAllContexts(),b=wpd.appData.getPlotData();this.onAttach=function(){document.getElementById("manual-select-button").classList.add("pressed-button");wpd.graphicsWidget.setRepainter(new wpd.DataPointsRepainter)};this.onMouseClick=function(c,d,e){b.getActiveDataSeries().addPixel(e.x,e.y);a.dataCtx.beginPath();a.dataCtx.fillStyle="rgb(200,0,0)";a.dataCtx.arc(d.x,d.y,3,0,2*Math.PI,!0);a.dataCtx.fill();a.oriDataCtx.beginPath();
a.oriDataCtx.fillStyle="rgb(200,0,0)";a.oriDataCtx.arc(e.x,e.y,3,0,2*Math.PI,!0);a.oriDataCtx.fill();wpd.graphicsWidget.updateZoomOnEvent(c);wpd.dataPointCounter.setCount()};this.onRemove=function(){document.getElementById("manual-select-button").classList.remove("pressed-button")};this.onKeyDown=function(a){var d=b.getActiveDataSeries(),e=d.getCount()-1,f=d.getPixel(e),g=0.5/wpd.graphicsWidget.getZoomRatio();if(wpd.keyCodes.isUp(a.keyCode))f.y-=g;else if(wpd.keyCodes.isDown(a.keyCode))f.y+=g;else if(wpd.keyCodes.isLeft(a.keyCode))f.x-=
g;else if(wpd.keyCodes.isRight(a.keyCode))f.x+=g;else{(wpd.keyCodes.isAlphabet(a.keyCode,"a")||wpd.keyCodes.isAlphabet(a.keyCode,"s")||wpd.keyCodes.isAlphabet(a.keyCode,"d"))&&wpd.acquireData.switchToolOnKeyPress(String.fromCharCode(a.keyCode).toLowerCase());return}d.setPixelAt(e,f.x,f.y);wpd.graphicsWidget.resetData();wpd.graphicsWidget.forceHandlerRepaint();wpd.graphicsWidget.updateZoomToImagePosn(f.x,f.y);a.preventDefault()}}}();
wpd.DeleteDataPointTool=function(){return function(){wpd.graphicsWidget.getAllContexts();var a=wpd.appData.getPlotData();this.onAttach=function(){document.getElementById("delete-point-button").classList.add("pressed-button");wpd.graphicsWidget.setRepainter(new wpd.DataPointsRepainter)};this.onMouseClick=function(b,c,d){a.getActiveDataSeries().removeNearestPixel(d.x,d.y);wpd.graphicsWidget.resetData();wpd.graphicsWidget.forceHandlerRepaint();wpd.graphicsWidget.updateZoomOnEvent(b);wpd.dataPointCounter.setCount()};
this.onKeyDown=function(a){(wpd.keyCodes.isAlphabet(a.keyCode,"a")||wpd.keyCodes.isAlphabet(a.keyCode,"s")||wpd.keyCodes.isAlphabet(a.keyCode,"d"))&&wpd.acquireData.switchToolOnKeyPress(String.fromCharCode(a.keyCode).toLowerCase())};this.onRemove=function(){document.getElementById("delete-point-button").classList.remove("pressed-button")}}}();
wpd.DataPointsRepainter=function(){return function(){var a=function(){var a=wpd.graphicsWidget.getAllContexts(),c=wpd.appData.getPlotData().getActiveDataSeries(),d,e,f,g;for(d=0;d<c.getCount();d++)e=c.getPixel(d),g=0<=c.getSelectedPixels().indexOf(d),f=wpd.graphicsWidget.screenPx(e.x,e.y),a.dataCtx.beginPath(),a.dataCtx.fillStyle=g?"rgb(0,200,0)":"rgb(200,0,0)",a.dataCtx.arc(f.x,f.y,3,0,2*Math.PI,!0),a.dataCtx.fill(),a.oriDataCtx.beginPath(),a.oriDataCtx.fillStyle=g?"rgb(0,200,0)":"rgb(200,0,0)",
a.oriDataCtx.arc(e.x,e.y,3,0,2*Math.PI,!0),a.oriDataCtx.fill()};this.painterName="dataPointsRepainter";this.onAttach=function(){wpd.graphicsWidget.resetData();a()};this.onRedraw=function(){a()};this.onForcedRedraw=function(){wpd.graphicsWidget.resetData();a()}}}();
wpd.AdjustDataPointTool=function(){return function(){this.onAttach=function(){document.getElementById("manual-adjust-button").classList.add("pressed-button");wpd.graphicsWidget.setRepainter(new wpd.DataPointsRepainter)};this.onRemove=function(){wpd.appData.getPlotData().getActiveDataSeries().unselectAll();wpd.graphicsWidget.forceHandlerRepaint();document.getElementById("manual-adjust-button").classList.remove("pressed-button")};this.onMouseClick=function(a,b,c){b=wpd.appData.getPlotData().getActiveDataSeries();
b.unselectAll();b.selectNearestPixel(c.x,c.y);wpd.graphicsWidget.forceHandlerRepaint();wpd.graphicsWidget.updateZoomOnEvent(a)};this.onKeyDown=function(a){if(wpd.keyCodes.isAlphabet(a.keyCode,"a")||wpd.keyCodes.isAlphabet(a.keyCode,"s")||wpd.keyCodes.isAlphabet(a.keyCode,"d"))wpd.acquireData.switchToolOnKeyPress(String.fromCharCode(a.keyCode).toLowerCase());else{var b=wpd.appData.getPlotData().getActiveDataSeries(),c=b.getSelectedPixels()[0];if(null!=c){var d=b.getPixel(c),e=d.x,d=d.y,f=!0===a.shiftKey?
5/wpd.graphicsWidget.getZoomRatio():0.5/wpd.graphicsWidget.getZoomRatio();if(wpd.keyCodes.isUp(a.keyCode))d-=f;else if(wpd.keyCodes.isDown(a.keyCode))d+=f;else if(wpd.keyCodes.isLeft(a.keyCode))e-=f;else if(wpd.keyCodes.isRight(a.keyCode))e+=f;else return;b.setPixelAt(c,e,d);wpd.graphicsWidget.forceHandlerRepaint();wpd.graphicsWidget.updateZoomToImagePosn(e,d);a.preventDefault();a.stopPropagation()}}}}}();
wpd.dataPointCounter=function(){return{setCount:function(){var a=document.getElementsByClassName("data-point-counter"),b;for(b=0;b<a.length;b++)a[b].innerHTML=wpd.appData.getPlotData().getActiveDataSeries().getCount()}}}();wpd=wpd||{};
wpd.dataMask=function(){return{grabMask:function(){var a=wpd.graphicsWidget.getAllContexts(),b=wpd.graphicsWidget.getImageSize(),a=a.oriDataCtx.getImageData(0,0,b.width,b.height),b=[],c,d=0,e=wpd.appData.getPlotData().getAutoDetector();for(c=0;c<a.data.length;c+=4)255===a.data[c]&&255===a.data[c+1]&&0===a.data[c+2]&&(b[d]=c/4,d++);e.mask=b},drawMask:function(){var a=wpd.appData.getPlotData().getAutoDetector().mask;if(null!=a&&0!==a.length){var b,c,d=wpd.graphicsWidget.getAllContexts(),e=wpd.graphicsWidget.getImageSize(),
f=d.oriDataCtx.getImageData(0,0,e.width,e.height);for(b=0;b<a.length;b++)c=a[b],parseInt(c/e.height,10),f.data[4*c]=255,f.data[4*c+1]=255,f.data[4*c+2]=0,f.data[4*c+3]=200;d.oriDataCtx.putImageData(f,0,0,e.width,e.height);wpd.graphicsWidget.copyImageDataLayerToScreen()}},markBox:function(){var a=new wpd.BoxMaskTool;wpd.graphicsWidget.setTool(a)},markPen:function(){var a=new wpd.PenMaskTool;wpd.graphicsWidget.setTool(a)},eraseMarks:function(){var a=new wpd.EraseMaskTool;wpd.graphicsWidget.setTool(a)},
viewMask:function(){var a=new wpd.ViewMaskTool;wpd.graphicsWidget.setTool(a)}}}();
wpd.BoxMaskTool=function(){return function(){var a=!1,b,c,d=wpd.graphicsWidget.getAllContexts(),e,f,g=function(){wpd.graphicsWidget.resetHover();d.hoverCtx.strokeStyle="rgb(0,0,0)";d.hoverCtx.strokeRect(c.x,c.y,f.x-c.x,f.y-c.y)};this.onAttach=function(){wpd.graphicsWidget.setRepainter(new wpd.MaskPainter);document.getElementById("box-mask").classList.add("pressed-button");document.getElementById("view-mask").classList.add("pressed-button")};this.onMouseDown=function(d,e,f){!0!==a&&(a=!0,b=f,c=e)};
this.onMouseMove=function(b,c,d){!1!==a&&(f=c,clearTimeout(e),e=setTimeout(g,5))};this.onMouseOut=function(){!0===a&&(clearTimeout(e),a=!1,wpd.graphicsWidget.resetHover())};this.onMouseUp=function(f,g,l){!1!==a&&(clearTimeout(e),a=!1,wpd.graphicsWidget.resetHover(),d.dataCtx.fillStyle="rgba(255,255,0,0.8)",d.dataCtx.fillRect(c.x,c.y,g.x-c.x,g.y-c.y),d.oriDataCtx.fillStyle="rgba(255,255,0,0.8)",d.oriDataCtx.fillRect(b.x,b.y,l.x-b.x,l.y-b.y))};this.onRemove=function(){document.getElementById("box-mask").classList.remove("pressed-button");
document.getElementById("view-mask").classList.remove("pressed-button");wpd.dataMask.grabMask()}}}();
wpd.PenMaskTool=function(){return function(){var a=wpd.graphicsWidget.getAllContexts(),b=!1,c,d,e,f=function(){a.dataCtx.strokeStyle="rgba(255,255,0,0.8)";a.dataCtx.lineTo(d.x,d.y);a.dataCtx.stroke();a.oriDataCtx.strokeStyle="rgba(255,255,0,0.8)";a.oriDataCtx.lineTo(e.x,e.y);a.oriDataCtx.stroke()};this.onAttach=function(){wpd.graphicsWidget.setRepainter(new wpd.MaskPainter);document.getElementById("pen-mask").classList.add("pressed-button");document.getElementById("view-mask").classList.add("pressed-button");
wpd.toolbar.show("paintToolbar")};this.onMouseDown=function(c,d,e){!0!==b&&(c=parseInt(document.getElementById("paintThickness").value,10),b=!0,a.dataCtx.strokeStyle="rgba(255,255,0,0.8)",a.dataCtx.lineWidth=c*wpd.graphicsWidget.getZoomRatio(),a.dataCtx.beginPath(),a.dataCtx.moveTo(d.x,d.y),a.oriDataCtx.strokeStyle="rgba(255,255,0,0.8)",a.oriDataCtx.lineWidth=c,a.oriDataCtx.beginPath(),a.oriDataCtx.moveTo(e.x,e.y))};this.onMouseMove=function(a,k,p){!1!==b&&(d=k,e=p,clearTimeout(c),c=setTimeout(f,
5))};this.onMouseUp=function(d,e,f){clearTimeout(c);a.dataCtx.closePath();a.dataCtx.lineWidth=1;a.oriDataCtx.closePath();a.oriDataCtx.lineWidth=1;b=!1};this.onMouseOut=function(a,b,c){this.onMouseUp(a,b,c)};this.onRemove=function(){document.getElementById("pen-mask").classList.remove("pressed-button");document.getElementById("view-mask").classList.remove("pressed-button");wpd.dataMask.grabMask();wpd.toolbar.clear()}}}();
wpd.EraseMaskTool=function(){return function(){var a=wpd.graphicsWidget.getAllContexts(),b=!1,c,d,e,f=function(){a.dataCtx.globalCompositeOperation="destination-out";a.oriDataCtx.globalCompositeOperation="destination-out";a.dataCtx.strokeStyle="rgba(255,255,0,1)";a.dataCtx.lineTo(d.x,d.y);a.dataCtx.stroke();a.oriDataCtx.strokeStyle="rgba(255,255,0,1)";a.oriDataCtx.lineTo(e.x,e.y);a.oriDataCtx.stroke()};this.onAttach=function(){wpd.graphicsWidget.setRepainter(new wpd.MaskPainter);document.getElementById("erase-mask").classList.add("pressed-button");
document.getElementById("view-mask").classList.add("pressed-button");wpd.toolbar.show("paintToolbar")};this.onMouseDown=function(c,d,e){!0!==b&&(c=parseInt(document.getElementById("paintThickness").value,10),b=!0,a.dataCtx.globalCompositeOperation="destination-out",a.oriDataCtx.globalCompositeOperation="destination-out",a.dataCtx.strokeStyle="rgba(0,0,0,1)",a.dataCtx.lineWidth=c*wpd.graphicsWidget.getZoomRatio(),a.dataCtx.beginPath(),a.dataCtx.moveTo(d.x,d.y),a.oriDataCtx.strokeStyle="rgba(0,0,0,1)",
a.oriDataCtx.lineWidth=c,a.oriDataCtx.beginPath(),a.oriDataCtx.moveTo(e.x,e.y))};this.onMouseMove=function(a,k,p){!1!==b&&(d=k,e=p,clearTimeout(c),c=setTimeout(f,5))};this.onMouseOut=function(a,b,c){this.onMouseUp(a,b,c)};this.onMouseUp=function(d,e,f){clearTimeout(c);a.dataCtx.closePath();a.dataCtx.lineWidth=1;a.oriDataCtx.closePath();a.oriDataCtx.lineWidth=1;a.dataCtx.globalCompositeOperation="source-over";a.oriDataCtx.globalCompositeOperation="source-over";b=!1};this.onRemove=function(){document.getElementById("erase-mask").classList.remove("pressed-button");
document.getElementById("view-mask").classList.remove("pressed-button");wpd.dataMask.grabMask();wpd.toolbar.clear()}}}();wpd.ViewMaskTool=function(){return function(){this.onAttach=function(){wpd.graphicsWidget.setRepainter(new wpd.MaskPainter);document.getElementById("view-mask").classList.add("pressed-button")};this.onRemove=function(){document.getElementById("view-mask").classList.remove("pressed-button");wpd.dataMask.grabMask()}}}();
wpd.MaskPainter=function(){return function(){var a=wpd.graphicsWidget.getAllContexts(),b=wpd.appData.getPlotData().getAutoDetector(),c=function(){if(null!=b.mask&&0!==b.mask.length){var c,e;c=wpd.graphicsWidget.getImageSize();imgData=a.oriDataCtx.getImageData(0,0,c.width,c.height);for(c=0;c<b.mask.length;c++)e=b.mask[c],imgData.data[4*e]=255,imgData.data[4*e+1]=255,imgData.data[4*e+2]=0,imgData.data[4*e+3]=200;a.oriDataCtx.putImageData(imgData,0,0);wpd.graphicsWidget.copyImageDataLayerToScreen()}};
this.painterName="dataMaskPainter";this.onRedraw=function(){wpd.dataMask.grabMask();c()};this.onAttach=function(){wpd.graphicsWidget.resetData();c()}}}();wpd=wpd||{};
wpd.distanceMeasurement=function(){return{start:function(){wpd.graphicsWidget.removeTool();wpd.graphicsWidget.resetData();var a=wpd.appData.getPlotData();null==a.distanceMeasurementData&&(a.distanceMeasurementData=new wpd.ConnectedPoints(2));wpd.sidebar.show("measure-distances-sidebar");wpd.graphicsWidget.setTool(new wpd.AddMeasurementTool("distance"));wpd.graphicsWidget.forceHandlerRepaint()},addPair:function(){wpd.graphicsWidget.setTool(new wpd.AddMeasurementTool("distance"))},deletePair:function(){wpd.graphicsWidget.setTool(new wpd.DeleteMeasurementTool("distance"))},
clearAll:function(){wpd.graphicsWidget.removeTool();wpd.graphicsWidget.resetData();wpd.appData.getPlotData().distanceMeasurementData=new wpd.ConnectedPoints(2)}}}();
wpd.angleMeasurement=function(){return{start:function(){wpd.graphicsWidget.removeTool();wpd.graphicsWidget.resetData();var a=wpd.appData.getPlotData();null==a.angleMeasurementData&&(a.angleMeasurementData=new wpd.ConnectedPoints(3));wpd.sidebar.show("measure-angles-sidebar");wpd.graphicsWidget.setTool(new wpd.AddMeasurementTool("angle"));wpd.graphicsWidget.forceHandlerRepaint()},addAngle:function(){wpd.graphicsWidget.setTool(new wpd.AddMeasurementTool("angle"))},deleteAngle:function(){wpd.graphicsWidget.setTool(new wpd.DeleteMeasurementTool("angle"))},
clearAll:function(){wpd.graphicsWidget.removeTool();wpd.graphicsWidget.resetData();wpd.appData.getPlotData().angleMeasurementData=new wpd.ConnectedPoints(3)}}}();
wpd.measurementData=function(){var a;return{showAngleData:function(){wpd.popup.show("measurement-data-window");var b=wpd.appData.getPlotData().angleMeasurementData,c=b.connectionCount(),d,e=document.getElementById("measurement-data-table");a="";for(d=0;d<c;d++)a+=d.toString()+", "+b.getAngle(d)+"\n";e.value=a},showDistanceData:function(){wpd.popup.show("measurement-data-window");var b=wpd.appData.getPlotData().distanceMeasurementData,c=b.connectionCount(),d,e=document.getElementById("measurement-data-table"),
f=wpd.appData.getPlotData().axes;a="";for(d=0;d<c;d++)a=!0===wpd.appData.isAligned()&&f instanceof wpd.MapAxes?a+(d.toString()+", "+f.pixelToDataDistance(b.getDistance(d))+"\n"):a+(d.toString()+", "+b.getDistance(d)+"\n");e.value=a},selectAll:function(){var a=document.getElementById("measurement-data-table");a.focus();a.select()},generateCSV:function(){var b,c,d,e=JSON.stringify(a);b=document.createElement("div");c=document.createElement("form");d=document.createElement("input");c.setAttribute("method",
"post");c.setAttribute("action","php/csvexport.php");d.setAttribute("type","text");d.setAttribute("name","data");c.appendChild(d);b.appendChild(c);document.body.appendChild(b);b.style.display="none";d.setAttribute("value",e);c.submit();document.body.removeChild(b)},close:function(){a="";wpd.popup.close("measurement-data-window")}}}();
wpd.AddMeasurementTool=function(){return function(a){var b="distance"===a,c=wpd.graphicsWidget.getAllContexts(),d=wpd.appData.getPlotData(),e=0,f=!0,g=[],k=b?2:3;this.onAttach=function(){document.getElementById(!0===b?"add-pair-button":"add-angle-button").classList.add("pressed-button");wpd.graphicsWidget.setRepainter(new wpd.MeasurementRepainter(a))};this.onRemove=function(){document.getElementById(!0===b?"add-pair-button":"add-angle-button").classList.remove("pressed-button")};this.onMouseClick=
function(p,l,h){if(f){wpd.graphicsWidget.resetHover();g[2*e]=h.x;g[2*e+1]=h.y;e+=1;e===k&&(f=!1,b?d.distanceMeasurementData.addConnection(g):d.angleMeasurementData.addConnection(g),wpd.graphicsWidget.forceHandlerRepaint(),wpd.graphicsWidget.setTool(new wpd.AdjustMeasurementTool(a)));if(1<e){var n=wpd.graphicsWidget.screenPx(g[2*(e-2)],g[2*(e-2)+1]);c.dataCtx.beginPath();c.dataCtx.strokeStyle="rgb(0,0,10)";c.dataCtx.moveTo(n.x,n.y);c.dataCtx.lineTo(l.x,l.y);c.dataCtx.stroke();c.oriDataCtx.beginPath();
c.oriDataCtx.strokeStyle="rgb(0,0,10)";c.oriDataCtx.moveTo(g[2*(e-2)],g[2*(e-2)+1]);c.oriDataCtx.lineTo(h.x,h.y);c.oriDataCtx.stroke()}c.dataCtx.beginPath();c.dataCtx.fillStyle="rgb(200, 0, 0)";c.dataCtx.arc(l.x,l.y,3,0,2*Math.PI,!0);c.dataCtx.fill();c.oriDataCtx.beginPath();c.oriDataCtx.fillStyle="rgb(200,0,0)";c.oriDataCtx.arc(h.x,h.y,3,0,2*Math.PI,!0);c.oriDataCtx.fill()}wpd.graphicsWidget.updateZoomOnEvent(p)};this.onMouseMove=function(a,b,d){f&&1<=e&&(wpd.graphicsWidget.resetHover(),a=wpd.graphicsWidget.screenPx(g[2*
(e-1)],g[2*(e-1)+1]),c.hoverCtx.beginPath(),c.hoverCtx.strokeStyle="rgb(0,0,0)",c.hoverCtx.moveTo(a.x,a.y),c.hoverCtx.lineTo(b.x,b.y),c.hoverCtx.stroke())};this.onKeyDown=function(a){}}}();
wpd.DeleteMeasurementTool=function(){return function(a){var b="distance"===a;wpd.graphicsWidget.getAllContexts();var c=wpd.appData.getPlotData();this.onAttach=function(){document.getElementById(!0===b?"delete-pair-button":"delete-angle-button").classList.add("pressed-button");wpd.graphicsWidget.setRepainter(new wpd.MeasurementRepainter(a))};this.onRemove=function(){document.getElementById(!0===b?"delete-pair-button":"delete-angle-button").classList.remove("pressed-button")};this.onMouseClick=function(d,
e,f){b?c.distanceMeasurementData.deleteNearestConnection(f.x,f.y):c.angleMeasurementData.deleteNearestConnection(f.x,f.y);wpd.graphicsWidget.setTool(new wpd.AdjustMeasurementTool(a));wpd.graphicsWidget.resetData();wpd.graphicsWidget.forceHandlerRepaint();wpd.graphicsWidget.updateZoomOnEvent(d)}}}();
wpd.AdjustMeasurementTool=function(){return function(a){this.onAttach=function(){wpd.graphicsWidget.setRepainter(new wpd.MeasurementRepainter(a))};this.onMouseClick=function(b,c,d){c=wpd.appData.getPlotData();"distance"===a?c.distanceMeasurementData.selectNearestPoint(d.x,d.y):"angle"===a&&c.angleMeasurementData.selectNearestPoint(d.x,d.y);wpd.graphicsWidget.forceHandlerRepaint();wpd.graphicsWidget.updateZoomOnEvent(b)};this.onKeyDown=function(b){if(wpd.keyCodes.isAlphabet(b.keyCode,"a"))wpd.graphicsWidget.setTool(new wpd.AddMeasurementTool(a));
else if(wpd.keyCodes.isAlphabet(b.keyCode,"d"))wpd.graphicsWidget.setTool(new wpd.DeleteMeasurementTool(a));else{var c=wpd.appData.getPlotData(),c="distance"===a?c.distanceMeasurementData:c.angleMeasurementData,d=c.getSelectedConnectionAndPoint();if(0<=d.connectionIndex&&0<=d.pointIndex){var e=!0===b.shiftKey?5/wpd.graphicsWidget.getZoomRatio():0.5/wpd.graphicsWidget.getZoomRatio(),f=c.getPointAt(d.connectionIndex,d.pointIndex);if(wpd.keyCodes.isUp(b.keyCode))f.y-=e;else if(wpd.keyCodes.isDown(b.keyCode))f.y+=
e;else if(wpd.keyCodes.isLeft(b.keyCode))f.x-=e;else if(wpd.keyCodes.isRight(b.keyCode))f.x+=e;else return;c.setPointAt(d.connectionIndex,d.pointIndex,f.x,f.y);wpd.graphicsWidget.forceHandlerRepaint();wpd.graphicsWidget.updateZoomToImagePosn(f.x,f.y);b.preventDefault();b.stopPropagation()}}}}}();
wpd.MeasurementRepainter=function(){return function(a){var b="distance"===a,c="angle"===a,d=wpd.graphicsWidget.getAllContexts(),e=function(a,b,c,e,f,g,r,q){d.dataCtx.beginPath();d.dataCtx.strokeStyle="rgb(0,0,10)";d.dataCtx.moveTo(a,b);d.dataCtx.lineTo(c,e);d.dataCtx.stroke();d.oriDataCtx.beginPath();d.oriDataCtx.strokeStyle="rgb(0,0,10)";d.oriDataCtx.moveTo(f,g);d.oriDataCtx.lineTo(r,q);d.oriDataCtx.stroke()},f=function(a,b,c,e,f){d.dataCtx.beginPath();d.dataCtx.fillStyle=f?"rgb(0, 200, 0)":"rgb(200, 0, 0)";
d.dataCtx.arc(a,b,3,0,2*Math.PI,!0);d.dataCtx.fill();d.oriDataCtx.beginPath();d.oriDataCtx.fillStyle=f?"rgb(0,200,0)":"rgb(200,0,0)";d.oriDataCtx.arc(c,e,3,0,2*Math.PI,!0);d.oriDataCtx.fill()},g=function(a,b,c,e,f){d.dataCtx.font="14px sans-serif";d.dataCtx.fillText(f,parseInt(a,10),parseInt(b,10));d.oriDataCtx.font="14px sans-serif";d.oriDataCtx.fillText(f,parseInt(c,10),parseInt(e,10))};this.painterName="measurementRepainter-"+a;this.onAttach=function(){wpd.graphicsWidget.resetData()};this.onRedraw=
function(){if(b){var a=wpd.appData.getPlotData().distanceMeasurementData,p=a.connectionCount(),l,h,n,m,r,q,s,t,u,v,w=wpd.appData.getPlotData().axes;for(l=0;l<p;l++)h=a.getConnectionAt(l),n=h[0],m=h[1],r=h[2],h=h[3],u=a.isPointSelected(l,0),v=a.isPointSelected(l,1),t=!0===wpd.appData.isAligned()&&w instanceof wpd.MapAxes?"["+l.toString()+"]: "+w.pixelToDataDistance(a.getDistance(l)).toFixed(2)+" "+w.getUnits():"["+l.toString()+"]: "+a.getDistance(l).toFixed(2)+" px",q=wpd.graphicsWidget.screenPx(n,
m),s=wpd.graphicsWidget.screenPx(r,h),e(q.x,q.y,s.x,s.y,n,m,r,h),f(q.x,q.y,n,m,u),f(s.x,s.y,r,h,v),g(0.5*(q.x+s.x),0.5*(q.y+s.y),0.5*(n+r),0.5*(m+h),t)}if(c){var a=wpd.appData.getPlotData().angleMeasurementData,p=a.connectionCount(),A,F,J,E,z;for(l=0;l<p;l++)r=a.getConnectionAt(l),s=r[0],t=r[1],n=r[2],m=r[3],u=r[4],v=r[5],J=a.isPointSelected(l,0),E=a.isPointSelected(l,1),z=a.isPointSelected(l,2),w="["+l.toString()+"]: "+a.getAngle(l).toFixed(2)+"\u00b0",q=Math.atan2(t-m,s-n),h=Math.atan2(v-m,u-n),
A=wpd.graphicsWidget.screenPx(s,t),r=wpd.graphicsWidget.screenPx(n,m),F=wpd.graphicsWidget.screenPx(u,v),e(A.x,A.y,r.x,r.y,s,t,n,m),e(r.x,r.y,F.x,F.y,n,m,u,v),f(A.x,A.y,s,t,J),f(r.x,r.y,n,m,E),f(F.x,F.y,u,v,z),s=r.x,t=r.y,u=n,v=m,d.dataCtx.beginPath(),d.dataCtx.strokeStyle="rgb(0,0,10)",d.dataCtx.arc(s,t,15,q,h,!0),d.dataCtx.stroke(),d.oriDataCtx.beginPath(),d.oriDataCtx.strokeStyle="rgb(0,0,10)",d.oriDataCtx.arc(u,v,15,q,h,!0),d.oriDataCtx.stroke(),g(r.x+10,r.y+15,n+10,m+15,w)}};this.onForcedRedraw=
function(){wpd.graphicsWidget.resetData();this.onRedraw()}}}();wpd=wpd||{};wpd.saveResume=function(){return{save:function(){var a=wpd.appData.getPlotData().getAutoDetector().imageData,b=new XMLHttpRequest,c=new FormData;b.open("POST","php/test.php",!0);b.onload=function(a){console.log("done")};a=new Blob(BSON.serialize(a),{type:"application/bson"});c.append("file.bson",a,"file.bson");b.send(c)}}}();wpd=wpd||{};
wpd.scriptInjector=function(){return{start:function(){wpd.popup.show("runScriptPopup")},cancel:function(){wpd.popup.close("runScriptPopup")},load:function(){var a=document.getElementById("runScriptFileInput");wpd.popup.close("runScriptPopup");if(1==a.files.length){var b=new FileReader;b.onload=function(){eval(b.result);wpdscript.run();window.wpdscript=wpdscript};b.readAsText(a.files[0])}}}}();wpd=wpd||{};wpd.browserInfo=function(){return{checkBrowser:function(){window.FileReader||alert("\tWARNING!\nYour web browser is not supported. This program might not behave as intended. Please use a recent version of Google Chrome, Firefox or Safari browser.")}}}();
