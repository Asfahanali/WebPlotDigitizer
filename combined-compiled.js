var loadScript;function loadJS(a){""!=a&&(unloadJS(),loadScript=document.createElement("script"),loadScript.setAttribute("type","text/javascript"),loadScript.setAttribute("src",a),loadScript.setAttribute("Id","loadedJS"),loadScript.setAttribute("onerror","alert('Error loading file!');"),"undefined"!=typeof loadScript?document.getElementsByTagName("head")[0].appendChild(loadScript):alert("Error loading script!"))}
function unloadJS(){var a=document.getElementById("loadedJS");a&&a.parentNode.removeChild(a)}function AEObject(){this.getParamList=function(){};this.run=function(){}}var axesPicked,axesN,axesNmax,xyAxes,axesAlignmentData=[],plotType;
function initiatePlotAlignment(){axesPicked=0;xyEl=document.getElementById("r_xy");polarEl=document.getElementById("r_polar");ternaryEl=document.getElementById("r_ternary");mapEl=document.getElementById("r_map");imageEl=document.getElementById("r_image");closePopup("axesList");!0===xyEl.checked?setAxes("XY"):!0===polarEl.checked?setAxes("polar"):!0===ternaryEl.checked?setAxes("ternary"):!0===mapEl.checked?setAxes("map"):!0===imageEl.checked&&setAxes("image")}
function setAxes(a){plotType=a;clearSidebar();removeAllMouseEvents();addMouseEvent("click",pickCorners,!0);axesN=0;xyAxes=[];"XY"===plotType||"bar"===plotType?(axesNmax=4,showPopup("xyAxesInfo")):"polar"===plotType?(axesNmax=3,showPopup("polarAxesInfo")):"ternary"===plotType?(axesNmax=3,showPopup("ternaryAxesInfo")):"map"===plotType?(axesNmax=2,showPopup("mapAxesInfo")):"image"===plotType&&(axesNmax=0,alignAxes())}
function pickCorners(a){if(axesN<axesNmax){var b=getPosition(a),c=b.x,b=b.y;xyAxes[axesN]=[];xyAxes[axesN][0]=parseFloat(c);xyAxes[axesN][1]=parseFloat(b);axesN+=1;dataCtx.beginPath();dataCtx.fillStyle="rgb(0,0,200)";dataCtx.arc(c,b,3,0,2*Math.PI,!0);dataCtx.fill();updateZoom(a);axesN===axesNmax&&(axesPicked=1,removeMouseEvent("click",pickCorners,!0),"XY"===plotType?showPopup("xyAlignment"):"polar"===plotType?showPopup("polarAlignment"):"ternary"===plotType?showPopup("ternaryAlignment"):"map"===plotType&&
showPopup("mapAlignment"),dataCanvas.width=dataCanvas.width)}}
function alignAxes(){if("XY"===plotType){var a=document.getElementById("xmin"),b=document.getElementById("xmax"),c=document.getElementById("ymin"),g=document.getElementById("ymax"),f=document.getElementById("xlog"),d=document.getElementById("ylog"),e=new InputParser,h,k=!1,l=!1,r=!1,m=!1,p=function(a){return!e.isValid||null==a?(closePopup("xyAlignment"),showPopup("inputError"),null):a};h=p(e.parse(a.value));if(null===h)return;axesAlignmentData[0]=h;e.isDate&&(k=!0);h=p(e.parse(b.value));if(null===
h)return;axesAlignmentData[1]=h;e.isDate&&(r=!0);h=p(e.parse(c.value));if(null===h)return;axesAlignmentData[2]=h;e.isDate&&(l=!0);h=p(e.parse(g.value));if(null===h)return;axesAlignmentData[3]=h;e.isDate&&(m=!0);axesAlignmentData[4]=!0===f.checked?!0:!1;axesAlignmentData[5]=!0===d.checked?!0:!1;if(k!==r||l!==m){closePopup("xyAlignment");showPopup("inputError");return}k&&r?(axesAlignmentData[6]=!0,axesAlignmentData[8]=dateConverter.getFormatString(a.value)):axesAlignmentData[6]=!1;l&&m?(axesAlignmentData[7]=
!0,axesAlignmentData[9]=dateConverter.getFormatString(c.value)):axesAlignmentData[7]=!1;closePopup("xyAlignment")}else"polar"==plotType?(a=document.getElementById("rpoint1"),b=document.getElementById("thetapoint1"),c=document.getElementById("rpoint2"),g=document.getElementById("thetapoint2"),f=document.getElementById("degrees"),document.getElementById("radians"),d=document.getElementById("clockwise"),axesAlignmentData[0]=parseFloat(a.value),axesAlignmentData[1]=parseFloat(b.value),axesAlignmentData[2]=
parseFloat(c.value),axesAlignmentData[3]=parseFloat(g.value),axesAlignmentData[4]=!0===f.checked?!0:!1,axesAlignmentData[5]=!0===d.checked?!0:!1,closePopup("polarAlignment")):"ternary"===plotType?(document.getElementById("range0to1"),a=document.getElementById("range0to100"),b=document.getElementById("ternarynormal"),axesAlignmentData[0]=!0===a.checked?!0:!1,axesAlignmentData[1]=!0===b.checked?!0:!1,closePopup("ternaryAlignment")):"map"===plotType?(a=document.getElementById("scaleLength"),axesAlignmentData[0]=
parseFloat(a.value),closePopup("mapAlignment")):"image"===plotType&&(axesPicked=1,axesAlignmentData[0]=imageDimensions[0],axesAlignmentData[1]=imageDimensions[2],axesAlignmentData[2]=imageDimensions[1],axesAlignmentData[3]=imageDimensions[3]);1===axesPicked&&acquireData()}
window.addEventListener("load",function(a){window.applicationCache.addEventListener("updateready",function(a){window.applicationCache.status==window.applicationCache.UPDATEREADY&&confirm("A new version of WebPlotDigitizer is available. Update?")&&window.location.reload()},!1)},!1);var fg_color=[0,0,0],bg_color=[255,255,255],colorPickerMode="fg",testImgCanvas,testImgContext,boxCoordinates=[0,0,1,1],drawingBox=!1,drawingPen=!1,drawingEraser=!1,binaryData;
function colorPickerWindow(a){colorPickerMode=a;"fg"===a?showPopup("colorPickerFG"):"bg"===a&&showPopup("colorPickerBG")}function pickColor(){removeAllMouseEvents();addMouseEvent("click",colorPicker,!0)}
function colorPicker(a){var b=getPosition(a);a=b.x;var c=b.y,b=ctx.getImageData(cx0,cy0,currentImageWidth,currentImageHeight);if(a<currentImageWidth+cx0&&c<currentImageHeight+cy0&&a>cx0&&c>cy0){a=4*(c-cy0)*currentImageWidth+4*(a-cx0);a=[b.data[a],b.data[a+1],b.data[a+2]];var b=document.getElementById("color_red"),c=document.getElementById("color_green"),g=document.getElementById("color_blue");removeMouseEvent("click",colorPicker,!0);"fg"===colorPickerMode?(assignColor("fg",a),b=document.getElementById("color_red_fg"),
c=document.getElementById("color_green_fg"),g=document.getElementById("color_blue_fg"),showPopup("colorPickerFG")):"bg"===colorPickerMode&&(assignColor("bg",a),b=document.getElementById("color_red_bg"),c=document.getElementById("color_green_bg"),g=document.getElementById("color_blue_bg"),showPopup("colorPickerBG"));b.value=a[0];c.value=a[1];g.value=a[2]}}
function assignColor(a,b){"fg"===a?(b||(redEl=document.getElementById("color_red_fg"),greenEl=document.getElementById("color_green_fg"),blueEl=document.getElementById("color_blue_fg"),b=[],b[0]=redEl.value,b[1]=greenEl.value,b[2]=blueEl.value),fg_color=b,document.getElementById("autoFGBtn").style.borderColor="rgb("+fg_color[0]+","+fg_color[1]+","+fg_color[2]+")"):"bg"===a&&(b||(redEl=document.getElementById("color_red_bg"),greenEl=document.getElementById("color_green_bg"),blueEl=document.getElementById("color_blue_bg"),
b=[],b[0]=redEl.value,b[1]=greenEl.value,b[2]=blueEl.value),bg_color=b,document.getElementById("autoBGBtn").style.borderColor="rgb("+bg_color[0]+","+bg_color[1]+","+bg_color[2]+")")}function boxPaint(){removeAllMouseEvents();addMouseEvent("mousedown",boxPaintMousedown,!0);addMouseEvent("mouseup",boxPaintMouseup,!0);addMouseEvent("mousemove",boxPaintMousedrag,!0)}function boxPaintMousedown(a){a=getPosition(a);boxCoordinates[0]=a.x;boxCoordinates[1]=a.y;drawingBox=!0}
function boxPaintMouseup(a){a=getPosition(a);boxCoordinates[2]=a.x;boxCoordinates[3]=a.y;hoverCanvas.width=hoverCanvas.width;dataCtx.fillStyle="rgba(255,255,0,1)";dataCtx.fillRect(boxCoordinates[0],boxCoordinates[1],boxCoordinates[2]-boxCoordinates[0],boxCoordinates[3]-boxCoordinates[1]);drawingBox=!1}
function boxPaintMousedrag(a){if(!0===drawingBox){var b=getPosition(a);a=b.x;b=b.y;hoverCanvas.width=hoverCanvas.width;hoverCtx.strokeStyle="rgb(0,0,0)";hoverCtx.strokeRect(boxCoordinates[0],boxCoordinates[1],a-boxCoordinates[0],b-boxCoordinates[1])}}function penPaint(){removeAllMouseEvents();showToolbar("paintToolbar");addMouseEvent("mousedown",penPaintMousedown,!0);addMouseEvent("mouseup",penPaintMouseup,!0);addMouseEvent("mousemove",penPaintMousedrag,!0)}
function penPaintMousedown(a){if(!1===drawingPen){var b=getPosition(a);a=b.x;b=b.y;drawingPen=!0;ctx.strokeStyle="rgba(255,255,0,1)";thkRange=document.getElementById("paintThickness");dataCtx.lineWidth=parseInt(thkRange.value);dataCtx.beginPath();dataCtx.moveTo(a,b)}}function penPaintMouseup(a){dataCtx.closePath();dataCtx.lineWidth=1;drawingPen=!1}
function penPaintMousedrag(a){if(!0===drawingPen){var b=getPosition(a);a=b.x;b=b.y;dataCtx.strokeStyle="rgba(255,255,0,1)";dataCtx.lineTo(a,b);dataCtx.stroke()}}function eraser(){removeAllMouseEvents();showToolbar("paintToolbar");addMouseEvent("mousedown",eraserMousedown,!0);addMouseEvent("mouseup",eraserMouseup,!0);addMouseEvent("mousemove",eraserMousedrag,!0);dataCtx.globalCompositeOperation="destination-out"}
function eraserMousedown(a){if(!1===drawingEraser){var b=getPosition(a);a=b.x;b=b.y;drawingEraser=!0;dataCtx.globalCompositeOperation="destination-out";dataCtx.strokeStyle="rgba(0,0,0,1)";thkRange=document.getElementById("paintThickness");dataCtx.lineWidth=parseInt(thkRange.value);dataCtx.beginPath();dataCtx.moveTo(a,b)}}function eraserMouseup(a){dataCtx.closePath();dataCtx.lineWidth=1;dataCtx.globalCompositeOperation="source-over";drawingEraser=!1}
function eraserMousedrag(a){if(!0===drawingEraser){var b=getPosition(a);a=b.x;b=b.y;dataCtx.globalCompositeOperation="destination-out";dataCtx.strokeStyle="rgba(0,0,0,1)";dataCtx.lineTo(a,b);dataCtx.stroke()}}
function updateTestWindow(){colorModeEl=document.getElementById("colorModeFG");colorDistanceEl=document.getElementById("colorDistance");!0===colorModeEl.checked?(colmode="fg",chosenColor=fg_color):(colmode="bg",chosenColor=bg_color);cdistance=parseInt(colorDistanceEl.value);tempImgCanvas=document.createElement("canvas");tempImgCanvas.width=canvasWidth;tempImgCanvas.height=canvasHeight;tempImgContext=tempImgCanvas.getContext("2d");timgData=tempImgContext.getImageData(0,0,canvasWidth,canvasHeight);
timgData=getImageDataBasedOnSelection(timgData,colmode,chosenColor,cdistance);tempImgContext.putImageData(timgData,0,0);testImage=tempImgCanvas.toDataURL();var a=document.createElement("img");a.onload=function(){testImgContext.drawImage(a,0,0,canvasWidth/2,canvasHeight/2);processingNote(!1)};a.src=testImage}function saveTest(){window.open().location=testImgCanvas.toDataURL()}function launchTestWindow(){processingNote(!0);setTimeout("updateTestWindow();showPopup('testImageWindow');",100)}
function scanPlot(){autoStepEl=document.getElementById("autostepalgo");xStepEl=document.getElementById("xstepalgo");yStepEl=document.getElementById("ystepalgo");var a=document.getElementById("colorModeFG"),b=document.getElementById("colorDistance");!0===a.checked?(a="fg",chosenColor=fg_color):(a="bg",chosenColor=bg_color);cdistance=parseInt(b.value);closePopup("testImageWindow");binaryData=selectFromMarkedRegion(a,chosenColor,cdistance);xyData=[];pointsPicked=0;resetLayers();AEObject.run();pointsStatus(pointsPicked);
for(b=0;b<pointsPicked;b++)dataCtx.beginPath(),dataCtx.fillStyle="rgb(200,0,200)",dataCtx.arc(xyData[b][0],xyData[b][1],3,0,2*Math.PI,!0),dataCtx.fill()}function displayParameters(){var a=document.getElementById("curvesAlgoSelect");document.getElementById("paramZone");var b=document.getElementById("URLinput");"customAlgorithm"!==a.value&&(b.style.display="none",AEObject=window[a.value],makeParameterTable())}
function makeParameterTable(){if(AEObject.getParamList){var a=AEObject.getParamList(),b=document.getElementById("paramZone");b.innerHTML="";for(var c=0;c<a.length;c++)b.innerHTML+="<p>"+a[c][0]+" ("+a[c][1]+") <input type='text' value='"+a[c][2]+"' size=3 id='pv"+c+"'></p>"}}
var mainCanvas,dataCanvas,drawCanvas,hoverCanvas,topCanvas,cx0,cy0,canvasWidth,canvasHeight,cwidth,cheight,caspectratio,currentImage,originalImage,currentImageHeight,currentImageWidth,currentImageData,imageDimensions=[],onScreenDimensions=[],ctx,dataCtx,drawCtx,hoverCtx,topCtx,originalScreen,mainScreen,dataScreen,drawScreen,hoverScreen,topScreen;
function loadImage(a){var b=parseInt(a.height),c=parseInt(a.width),g=b/c,f=b,d=c;g>caspectratio?(f=cheight,d=cheight/g):(d=cwidth,f=cwidth*g);currentImage=a;currentImageHeight=parseInt(f);currentImageWidth=parseInt(d);ctx.fillStyle="rgb(255,255,255)";ctx.fillRect(0,0,canvasWidth,canvasHeight);ctx.drawImage(a,cx0,cy0,d,f);currentScreen=getCanvasData();imageDimensions[0]=1;imageDimensions[1]=1;imageDimensions[2]=c;imageDimensions[3]=b;onScreenDimensions[0]=cx0;onScreenDimensions[1]=cy0;onScreenDimensions[2]=
d+cx0;onScreenDimensions[3]=f+cy0}function saveCanvasImage(){var a=ctx.getImageData(cx0,cy0,currentImageWidth,currentImageHeight),b=document.createElement("canvas");b.width=currentImageWidth;b.height=currentImageHeight;tCanvasContext=b.getContext("2d");tCanvasContext.putImageData(a,0,0);newImage=document.createElement("img");newImage.src=b.toDataURL();newImage.onload=function(){currentImage=newImage;currentScreen=getCanvasData()}}
function getCanvasData(){return ctx.getImageData(0,0,canvasWidth,canvasHeight)}function putCanvasData(a){mainCanvas.width=mainCanvas.width;ctx.putImageData(a,0,0)}function reloadPlot(){mainCanvas.width=mainCanvas.width;ctx.drawImage(currentImage,cx0,cy0,currentImageWidth,currentImageHeight)}function redrawCanvas(){mainCanvas.width=mainCanvas.width;putCanvasData(currentScreen)}
function resetLayers(){dataCanvas.width=dataCanvas.width;drawCanvas.width=drawCanvas.width;hoverCanvas.width=hoverCanvas.width;topCanvas.width=topCanvas.width}function savePNG(){window.open().location=mainCanvas.toDataURL()}function getPosition(a){var b=mainCanvas.getBoundingClientRect();return{x:parseInt(a.pageX-(b.left+window.pageXOffset),10),y:parseInt(a.pageY-(b.top+window.pageYOffset),10)}}function dropHandler(a){a=a.dataTransfer.files;1==a.length&&fileLoader(a[0])}
function pasteHandler(a){if(void 0!==a.clipboardData&&(a=a.clipboardData.items,void 0!==a))for(var b=0;b<a.length;b++)if(-1!==a[b].type.indexOf("image")){var c=a[b].getAsFile();(window.URL||window.webkitURL).createObjectURL(c);fileLoader(c)}}
function fileLoader(a){if(a.type.match("image.*")){var b=new FileReader;b.onload=function(){var a=b.result,g=document.createElement("img");g.onload=function(){loadImage(g);originalScreen=getCanvasData();originalImage=g;setDefaultState()};g.src=a};b.readAsDataURL(a)}}function loadNewFile(){var a=document.getElementById("fileLoadBox");1==a.files.length&&fileLoader(a.files[0]);closePopup("loadNewImage")}var dataToPixelxy;
function pixelToData(a,b,c){if(1===axesPicked&&1<=b){var g=[];if("XY"===c){c=xyAxes[0][0];var f=xyAxes[0][1],d=xyAxes[1][0],e=xyAxes[1][1],h=xyAxes[2][0],k=xyAxes[2][1],l=xyAxes[3][0],r=xyAxes[3][1],m=axesAlignmentData[0],p=axesAlignmentData[1],n=axesAlignmentData[2],q=axesAlignmentData[3];!0===axesAlignmentData[4]&&(m=Math.log(m)/Math.log(10),p=Math.log(p)/Math.log(10));!0===axesAlignmentData[5]&&(n=Math.log(n)/Math.log(10),q=Math.log(q)/Math.log(10));var p=p-m,q=q-n,t=Math.sqrt((c-d)*(c-d)+(f-e)*
(f-e)),s=Math.sqrt((h-l)*(h-l)+(k-r)*(k-r)),p=p/t,q=q/s,s=taninverse(-(e-f),d-c),r=taninverse(-(r-k),l-h),t=r-s;for(ii=0;ii<b;ii++){var d=a[ii][0],e=a[ii][1],l=Math.sqrt((d-c)*(d-c)+(e-f)*(e-f)),u=taninverse(-(e-f),d-c)-s,l=l*Math.cos(u)-l*Math.sin(u)/Math.tan(t),l=l*p+m,u=Math.sqrt((d-h)*(d-h)+(e-k)*(e-k)),d=r-taninverse(-(e-k),d-h),d=u*Math.cos(d)-u*Math.sin(d)/Math.tan(t),d=d*q+n;!0===axesAlignmentData[4]&&(l=Math.pow(10,l));!0===axesAlignmentData[5]&&(d=Math.pow(10,d));g[ii]=[];g[ii][0]=l;g[ii][1]=
d}}else if("image"===c){c=onScreenDimensions[0];f=onScreenDimensions[1];d=onScreenDimensions[2];e=onScreenDimensions[1];h=onScreenDimensions[0];k=onScreenDimensions[1];l=onScreenDimensions[0];r=onScreenDimensions[3];m=axesAlignmentData[0];p=axesAlignmentData[1];n=axesAlignmentData[2];q=axesAlignmentData[3];p-=m;q-=n;s=0.5*(d-c)/(p+1);t=0.5*(e-f)/(q+1);c+=s;d-=s;f+=t;e-=t;t=Math.sqrt((c-d)*(c-d)+(f-e)*(f-e));s=Math.sqrt((h-l)*(h-l)+(k-r)*(k-r));p/=t;q/=s;s=taninverse(-(e-f),d-c);r=taninverse(-(r-k),
l-h);t=r-s;for(ii=0;ii<b;ii++)d=a[ii][0],e=a[ii][1],l=Math.sqrt((d-c)*(d-c)+(e-f)*(e-f)),u=taninverse(-(e-f),d-c)-s,l=l*Math.cos(u)-l*Math.sin(u)/Math.tan(t),l=l*p+m,u=Math.sqrt((d-h)*(d-h)+(e-k)*(e-k)),d=r-taninverse(-(e-k),d-h),d=u*Math.cos(d)-u*Math.sin(d)/Math.tan(t),d=d*q+n,g[ii]=[],g[ii][0]=Math.round(l),g[ii][1]=Math.round(d)}else if("map"===c){my0=canvasHeight;my2=my1=0;h=canvasWidth;my3=canvasHeight;c=0;f=-(my1-my0);h-=0;k=-(my3-my0);m=xyAxes[0][0];n=xyAxes[0][1];d=xyAxes[1][0];e=xyAxes[1][1];
d=axesAlignmentData[0]/Math.sqrt((m-d)*(m-d)+(n-e)*(n-e));m=0;p=canvasWidth*d;n=0;q=canvasHeight*d;p-=m;q-=n;e=c*k-f*h;for(ii=0;ii<b;ii++)d=a[ii][0]-0,s=-(a[ii][1]-my0),l=(-f*p*d+c*p*s)/e+m,d=(k*q*d-h*q*s)/e+n,g[ii]=[],g[ii][0]=l,g[ii][1]=d}else if("polar"===c){m=parseFloat(xyAxes[0][0]);n=parseFloat(xyAxes[0][1]);c=parseFloat(xyAxes[1][0]);f=parseFloat(xyAxes[1][1]);d=parseFloat(xyAxes[2][0]);e=parseFloat(xyAxes[2][1]);h=parseFloat(axesAlignmentData[0]);s=parseFloat(axesAlignmentData[1]);k=parseFloat(axesAlignmentData[2]);
parseFloat(axesAlignmentData[3]);p=axesAlignmentData[4];!0===p&&(s*=Math.PI/180);q=Math.sqrt((c-m)*(c-m)+(f-n)*(f-n));l=Math.sqrt((d-m)*(d-m)+(e-n)*(e-n))-q;c=taninverse(-(f-n),c-m);c-=s;for(ii=0;ii<b;ii++)d=a[ii][0],e=a[ii][1],f=(k-h)/l*(Math.sqrt((d-m)*(d-m)+(e-n)*(e-n))-q)+h,d=taninverse(-(e-n),d-m)-c,!0==p&&(d=180*d/Math.PI),g[ii]=[],g[ii][0]=f,g[ii][1]=d}else if("ternary"===plotType){m=xyAxes[0][0];n=xyAxes[0][1];c=xyAxes[1][0];f=xyAxes[1][1];h=Math.sqrt((m-c)*(m-c)+(n-f)*(n-f));c=taninverse(-(f-
n),c-m);k=Math.sqrt(3);p=axesAlignmentData[0];q=axesAlignmentData[1];for(ii=0;ii<b;ii++)d=a[ii][0],e=a[ii][1],f=Math.sqrt((d-m)*(d-m)+(e-n)*(e-n)),d=taninverse(-(e-n),d-m)-c,e=f*Math.cos(d)/h,l=f*Math.sin(d)/h,f=1-e-l/k,d=e-l/k,e=2*l/k,!1==q&&(l=d,d=f,f=e,e=l),!0==p&&(f*=100,d*=100,e*=100),g[ii]=[],g[ii][0]=f,g[ii][1]=d,g[ii][2]=e}return g}return 0}
function dataToPixel(a,b,c){dataToPixelxy=[];if("XY"===c){var g=xyAxes[0][0],f=xyAxes[0][1],d=xyAxes[1][0],e=xyAxes[1][1],h=xyAxes[2][0];c=xyAxes[2][1];var k=xyAxes[3][0],l=xyAxes[3][1],r=axesAlignmentData[0],m=axesAlignmentData[1],p=axesAlignmentData[2],n=axesAlignmentData[3];!0===axesAlignmentData[4]&&(r=Math.log(r)/Math.log(10),m=Math.log(m)/Math.log(10));!0===axesAlignmentData[5]&&(p=Math.log(p)/Math.log(10),n=Math.log(n)/Math.log(10));var q=(g-d)*(c-l)-(f-e)*(h-k),t=[[]];t[0][0]=((g*e-f*d)*(h-
k)-(g-d)*(h*l-c*k))/q;t[0][1]=((g*e-f*d)*(c-l)-(f-e)*(h*l-c*k))/q;var t=pixelToData(t,1,"XY"),q=t[0][0],t=t[0][1],m=m-r,s=n-p,n=Math.sqrt((g-d)*(g-d)+(f-e)*(f-e)),u=Math.sqrt((h-k)*(h-k)+(c-l)*(c-l)),n=m/n,m=s/u,f=taninverse(-(e-f),d-g),h=taninverse(-(l-c),k-h),g=(a-r)*Math.cos(f)/n+(b-t)*Math.cos(h)/m+g;a=c-(a-q)*Math.sin(f)/n-(b-p)*Math.sin(h)/m;dataToPixelxy[0]=g;dataToPixelxy[1]=a}return 0}var rawCSVData,displayData;
function generateCSV(){if(1===axesPicked&&1<=pointsPicked){showPopup("csvWindow");rawCSVData=pixelToData(xyData,pointsPicked,plotType);document.getElementById("dataSortOrder");var a=document.getElementById("dataSortOption"),b=document.getElementById("dataVariables");a.innerHTML='<option value="raw">Raw Output</option>';"XY"===plotType||"map"===plotType||"image"===plotType?(a.innerHTML+='<option value="0">x</option>',a.innerHTML+='<option value="1">y</option>',b.innerHTML="x, y"):"ternary"===plotType?
(a.innerHTML+='<option value="0">a</option>',a.innerHTML+='<option value="1">b</option>',a.innerHTML+='<option value="2">c</option>',b.innerHTML="a, b, c"):"polar"===plotType&&(a.innerHTML+='<option value="0">r</option>',a.innerHTML+='<option value="1">\u0398</option>',b.innerHTML="r, \u0398");a.innerHTML+='<option value="NearestNeighbor">Nearest Neighbor</option>';updateCSVSortingControls();a=document.getElementById("csvDateFormatting");if("XY"===plotType)if(!0===axesAlignmentData[6]||!0===axesAlignmentData[7]){a.style.display=
"inline-block";var a=document.getElementById("csvDateFormattingX"),b=document.getElementById("csvDateFormattingY"),c=document.getElementById("xDateFormat");document.getElementById("yDateFormat");axesAlignmentData[6]?(a.style.display="inline-block",c.value=axesAlignmentData[8]):a.style.display="none";axesAlignmentData[7]?(b.style.display="inline-block",yDateFormat.value=axesAlignmentData[9]):b.style.display="none"}else a.style.display="none";else a.style.display="none";generateCSVTextFromData(rawCSVData)}}
function selectAllCSVData(){var a=document.getElementById("tarea");a.focus();a.select()}function updateCSVSortingControls(){var a=document.getElementById("dataSortOption"),b=document.getElementById("dataSortOrder");"NearestNeighbor"===a.value||"raw"===a.value?b.setAttribute("disabled",!0):b.removeAttribute("disabled");reSortCSV()}
function generateCSVTextFromData(a){var b=document.getElementById("tarea");b.value="";if("XY"===plotType||"map"===plotType||"polar"===plotType||"image"===plotType)for(var c=0;c<pointsPicked;c++)b.value=b.value+formatVariableInCSV(a[c][0],"X")+","+formatVariableInCSV(a[c][1],"Y")+"\n";else if("ternary"===plotType)for(c=0;c<pointsPicked;c++)b.value=b.value+a[c][0]+","+a[c][1]+","+a[c][2]+"\n";displayData=a}
function formatVariableInCSV(a,b){if("XY"===plotType){if("X"===b&&axesAlignmentData[6]){var c=document.getElementById("xDateFormat");return dateConverter.formatDate(dateConverter.fromJD(a),c.value)}if("Y"===b&&axesAlignmentData[7])return c=document.getElementById("yDateFormat"),dateConverter.formatDate(dateConverter.fromJD(a),c.value)}return a}
function reSortCSV(){var a=document.getElementById("dataSortOption"),b="ascending"===document.getElementById("dataSortOrder").value,c="raw"==a.value,g="NearestNeighbor"===a.value,f,d=rawCSVData.slice(0),e="ternary"===plotType?3:2;if(c)generateCSVTextFromData(d);else if(g){if(g){for(var h,g=[1,1,1],k=0;k<pointsPicked-1;k++){for(var c=-1,l=k+1;l<pointsPicked;l++)if(a=(d[k][0]-d[l][0])*(d[k][0]-d[l][0])+(d[k][1]-d[l][1])*(d[k][1]-d[l][1]),3===e&&(a+=(d[k][2]-d[l][2])*(d[k][2]-d[l][2])),a<h||-1===c)h=
a,c=l;g[0]=d[c][0];d[c][0]=d[k+1][0];d[k+1][0]=g[0];g[1]=d[c][1];d[c][1]=d[k+1][1];d[k+1][1]=g[1];3===e&&(g[2]=d[c][2],d[c][2]=d[k+1][2],d[k+1][2]=g[2])}generateCSVTextFromData(d)}}else f=parseInt(a.value,10),0>f||3<=f||(d.sort(function(a,c){return a[f]>c[f]?b?1:-1:a[f]<c[f]?b?-1:1:0}),generateCSVTextFromData(d))}
var dateConverter={parse:function(a){return null==a||-1===a.indexOf("/")?null:this.toJD(a)},toJD:function(a){var b=a.split("/"),c;if(0>=b.length||3<b.length)return null;a=parseInt(b[0],10);c=parseInt(void 0===b[1]?0:b[1],10);date=parseInt(void 0===b[2]?1:b[2],10);if(isNaN(a)||isNaN(c)||isNaN(date)||12<c||1>c||31<date||1>date)return null;b=new Date;b.setUTCFullYear(a);b.setUTCMonth(c-1);b.setUTCDate(date);a=parseFloat(Date.parse(b));return!isNaN(a)?a:null},fromJD:function(a){a=parseFloat(a);a=parseInt(864E5*
Math.round(a/864E5),10);return new Date(a)},formatDate:function(a,b){var c;c=b.replace("YYYY","yyyy");c=c.replace("YY","yy");c=c.replace("MMMM","mmmm");c=c.replace("MMM","mmm");c=c.replace("MM","mm");c=c.replace("DD","dd");c=c.replace("yyyy",a.getUTCFullYear());var g=a.getUTCFullYear()%100;c=c.replace("yy",10>g?"0"+g:g);c=c.replace("mmmm","January February March April May June July August September October November December".split(" ")[a.getUTCMonth()]);c=c.replace("mmm","Jan Feb Mar Apr May Jun Jul Aug Sep Oct Nov Dec".split(" ")[a.getUTCMonth()]);
c=c.replace("mm",a.getUTCMonth()+1);return c=c.replace("dd",a.getUTCDate())},getFormatString:function(a){a=a.split("/");var b="yyyy/mm/dd";1<=a.length&&(b="yyyy");2<=a.length&&(b+="/mm");3===a.length&&(b+="/dd");return b}},cropStatus=0,cropCoordinates=[0,0,0,0];
function hflip(){processingNote(!0);for(var a=ctx.getImageData(cx0,cy0,currentImageWidth,currentImageHeight),b=0;b<currentImageHeight;b++)for(var c=0;c<currentImageWidth/2;c++)for(var g=4*b*currentImageWidth+4*c,f=4*(b+1)*currentImageWidth-4*(c+1),d=0;4>d;d++){var e=a.data[g+d];a.data[g+d]=a.data[f+d];a.data[f+d]=e}ctx.putImageData(a,cx0,cy0);saveCanvasImage();processingNote(!1)}
function vflip(){processingNote(!0);for(var a=ctx.getImageData(cx0,cy0,currentImageWidth,currentImageHeight),b=0;b<currentImageWidth;b++)for(var c=0;c<currentImageHeight/2;c++)for(var g=4*c*currentImageWidth+4*b,f=4*(currentImageHeight-(c+2))*currentImageWidth+4*b,d=0;4>d;d++){var e=a.data[g+d];a.data[g+d]=a.data[f+d];a.data[f+d]=e}ctx.putImageData(a,cx0,cy0);saveCanvasImage();processingNote(!1)}
function cropPlot(){redrawCanvas();removeAllMouseEvents();addMouseEvent("mousedown",cropMousedown,!0);addMouseEvent("mouseup",cropMouseup,!0);addMouseEvent("mousemove",cropMousemove,!0)}function cropMousedown(a){a=getPosition(a);var b=a.y;cropCoordinates[0]=a.x;cropCoordinates[1]=b;cropStatus=1}
function cropMouseup(a){a=getPosition(a);var b=a.y;cropCoordinates[2]=a.x;cropCoordinates[3]=b;cropStatus=0;hoverCanvas.width=hoverCanvas.width;cropWidth=cropCoordinates[2]-cropCoordinates[0];cropHeight=cropCoordinates[3]-cropCoordinates[1];if(0<cropWidth&&0<cropHeight){a=document.createElement("canvas");b=a.getContext("2d");a.width=cropWidth;a.height=cropHeight;var c=ctx.getImageData(cropCoordinates[0],cropCoordinates[1],cropWidth,cropHeight);b.putImageData(c,0,0);cropSrc=a.toDataURL();cropImg=new Image;
cropImg.src=cropSrc;cropImg.onload=function(){loadImage(cropImg)}}}function cropMousemove(a){var b=getPosition(a);a=b.x;b=b.y;1==cropStatus&&(hoverCanvas.width=hoverCanvas.width,hoverCtx.strokeStyle="rgb(0,0,0)",hoverCtx.strokeRect(cropCoordinates[0],cropCoordinates[1],a-cropCoordinates[0],b-cropCoordinates[1]))}function restoreOriginalImage(){loadImage(originalImage)}function rotateCanvas(){}
function findDifference(a,b){for(var c=canvasWidth,g=canvasHeight,f=[],d=0;d<g;d++){f[d]=[];for(var e=0;e<c;e++){var h=4*d*c+4*e;f[d][e]=!1;for(var k=0;4>k;k++)a.data[h+k]!=b.data[h+k]&&(f[d][e]=!0)}}return f}function copyUsingDifference(a,b,c){for(var g=canvasWidth,f=canvasHeight,d=0;d<f;d++)for(var e=0;e<g;e++){var h=4*d*g+4*e;if(!0===c[d][e])for(var k=0;4>k;k++)a.data[h+k]=b.data[h+k]}return a}
function colorSelect(a,b,c,g){dw=canvasWidth;dh=canvasHeight;redv=c[0];greenv=c[1];bluev=c[2];c=[];for(var f=0;f<dh;f++){c[f]=[];for(var d=0;d<dw;d++)index=4*f*dw+4*d,ir=a.data[index],ig=a.data[index+1],ib=a.data[index+2],dist=Math.sqrt((ir-redv)*(ir-redv)+(ig-greenv)*(ig-greenv)+(ib+bluev)*(ib+bluev)),c[f][d]=!1,"fg"===b?dist<=g&&(c[f][d]=!0):"bg"===b&&dist>g&&(c[f][d]=!0)}return c}
function colorSelectDiff(a,b,c,g,f){dw=canvasWidth;dh=canvasHeight;redv=c[0];greenv=c[1];bluev=c[2];c=[];for(var d=0;d<dh;d++){c[d]=[];for(var e=0;e<dw;e++){index=4*d*dw+4*e;var h=a.data[index],k=a.data[index+1],l=a.data[index+2],h=Math.sqrt((h-redv)*(h-redv)+(k-greenv)*(k-greenv)+(l-bluev)*(l-bluev));c[d][e]=!1;"fg"===b&&1===f[d][e]?h<=g&&(c[d][e]=!0):"bg"===b&&1===f[d][e]&&h>g&&(c[d][e]=!0)}}return c}
function selectFromMarkedRegion(a,b,c){dw=canvasWidth;dh=canvasHeight;redv=b[0];greenv=b[1];bluev=b[2];b=dataCtx.getImageData(0,0,canvasWidth,canvasHeight);for(var g=getCanvasData(),f=[],d=0;d<dh;d++){f[d]=[];for(var e=0;e<dw;e++){index=4*d*dw+4*e;var h=b.data[index],k=b.data[index+1],l=b.data[index+2],r=g.data[index],m=g.data[index+1],p=g.data[index+2];f[d][e]=!1;255===h&&(255===k&&0===l)&&(h=Math.sqrt((r-redv)*(r-redv)+(m-greenv)*(m-greenv)+(p-bluev)*(p-bluev)),"fg"===a&&h<=c?f[d][e]=!0:"bg"===
a&&h>c&&(f[d][e]=!0))}}return f}function binaryToImageData(a,b){dw=canvasWidth;dh=canvasHeight;for(var c=0;c<dh;c++)for(var g=0;g<dw;g++)index=4*c*dw+4*g,!1===a[c][g]?(b.data[index]=255,b.data[index+1]=255,b.data[index+2]=255):(b.data[index]=0,b.data[index+1]=0,b.data[index+2]=0),b.data[index+3]=255;return b}
function getImageDataBasedOnSelection(a,b,c,g){var f=canvasWidth,d=canvasHeight,e,h,k,l=c[0],r=c[1],m=c[2],p=dataCtx.getImageData(0,0,canvasWidth,canvasHeight),n=currentScreen,q,t,s,u,w,v;for(c=0;c<d;c++)for(e=0;e<f;e++)h=4*c*f+4*e,k=p.data[h],q=p.data[h+1],t=p.data[h+2],s=n.data[h],u=n.data[h+1],w=n.data[h+2],v=!0,255===k&&(255===q&&0===t)&&(k=(s-l)*(s-l)+(u-r)*(u-r)+(w-m)*(w-m),"fg"===b&&k<=g*g?v=!1:"bg"===b&&k>g*g&&(v=!1)),v?(a.data[h]=255,a.data[h+1]=255,a.data[h+2]=255):(a.data[h]=0,a.data[h+
1]=0,a.data[h+2]=0),a.data[h+3]=255;return a}var InputParser=function(){var a=this;a.parse=function(b){a.isValid=!1;a.isDate=!1;if(null==b)return null;b=b.trim();if(-1!==b.indexOf("^"))return null;var c=dateConverter.parse(b);if(null!==c)return a.isValid=!0,a.isDate=!0,c;b=parseFloat(b);return!isNaN(b)?(a.isValid=!0,b):null};a.isValid=!1;a.isDate=!1};
function init(){checkBrowser();mainCanvas=document.getElementById("mainCanvas");dataCanvas=document.getElementById("dataCanvas");drawCanvas=document.getElementById("drawCanvas");hoverCanvas=document.getElementById("hoverCanvas");topCanvas=document.getElementById("topCanvas");var a=document.getElementById("canvasDiv");zCanvas=document.getElementById("zoomCanvas");zctx=zCanvas.getContext("2d");tempCanvas=document.createElement("canvas");tctx=tempCanvas.getContext("2d");tempCanvas.width=zoom_dx;tempCanvas.height=
zoom_dy;cx0=zoom_dx/2;cy0=zoom_dy/2;canvasWidth=parseFloat(a.offsetWidth);canvasHeight=parseFloat(a.offsetHeight);mainCanvas.height=canvasHeight;mainCanvas.width=canvasWidth;dataCanvas.height=canvasHeight;dataCanvas.width=canvasWidth;drawCanvas.height=canvasHeight;drawCanvas.width=canvasWidth;hoverCanvas.height=canvasHeight;hoverCanvas.width=canvasWidth;topCanvas.height=canvasHeight;topCanvas.width=canvasWidth;cheight=canvasHeight-zoom_dy;cwidth=canvasWidth-zoom_dx;caspectratio=cheight/cwidth;ctx=
mainCanvas.getContext("2d");dataCtx=dataCanvas.getContext("2d");drawCtx=drawCanvas.getContext("2d");hoverCtx=hoverCanvas.getContext("2d");topCtx=topCanvas.getContext("2d");mPosn=document.getElementById("mousePosition");img=document.createElement("img");img.onload=function(){loadImage(img);originalImage=img};img.src="start.png";testImgCanvas=document.getElementById("testImg");testImgCanvas.width=canvasWidth/2;testImgCanvas.height=canvasHeight/2;testImgContext=testImgCanvas.getContext("2d");topCanvas.addEventListener("mousemove",
updateZoomEventHandler,!1);document.body.addEventListener("keydown",toggleCrosshair,!1);topCanvas.addEventListener("dragover",function(a){a.preventDefault()},!0);topCanvas.addEventListener("drop",function(a){a.preventDefault();dropHandler(a)},!0);window.addEventListener("paste",function(a){pasteHandler(a)},!1);setDefaultState();initZoom();activeScreen=originalScreen=getCanvasData();displayParameters()}
function setDefaultState(){pointsPicked=axesPicked=0;xyData=[];axesAlignmentData=[];clearPoints();clearSidebar()}function checkBrowser(){window.FileReader||alert("\tWARNING!\nYou are using an unsupported browser. Please use Google Chrome 6+ or Firefox 3.6+.\n Sorry for the inconvenience.")}var xyData=[],pointsPicked=0;function acquireData(){0===axesPicked?showPopup("alignAxes"):(showSidebar("manualMode"),removeAllMouseEvents())}
function pickPoints(){0===axesPicked?alert("Define the axes first!"):(removeAllMouseEvents(),addMouseEvent("click",clickPoints,!0),pointsStatus(pointsPicked),showSidebar("manualMode"))}
function clickPoints(a){var b=getPosition(a),c=b.x,b=b.y;xyData[pointsPicked]=[];xyData[pointsPicked][0]=parseFloat(c);xyData[pointsPicked][1]=parseFloat(b);pointsPicked+=1;dataCtx.beginPath();dataCtx.fillStyle="rgb(200,0,0)";dataCtx.arc(c,b,3,0,2*Math.PI,!0);dataCtx.fill();pointsStatus(pointsPicked);updateZoom(a)}function clearPoints(){pointsPicked=0;pointsStatus(pointsPicked);resetLayers();removeAllMouseEvents()}
function undoPointSelection(){if(1<=pointsPicked){pointsPicked-=1;pointsStatus(pointsPicked);resetLayers();for(ii=0;ii<pointsPicked;ii++)xi=xyData[ii][0],yi=xyData[ii][1],dataCtx.beginPath(),dataCtx.fillStyle="rgb(200,0,0)",dataCtx.arc(xi,yi,3,0,2*Math.PI,!0),dataCtx.fill()}}function pointsStatus(a){var b=document.getElementById("pointsStatus"),c=document.getElementById("autoPointsStatus");b.innerHTML=a;c.innerHTML=a}
function deleteSpecificPoint(){removeAllMouseEvents();addMouseEvent("click",deleteSpecificPointHandler,!0)}
function deleteSpecificPointHandler(a){for(var b=getPosition(a),c=parseFloat(b.x),b=parseFloat(b.y),g=10,f=0,d=0,e=0;e<pointsPicked;e++){var h=parseFloat(xyData[e][0]),k=parseFloat(xyData[e][1]),h=Math.sqrt((h-c)*(h-c)+(k-b)*(k-b));h<g&&(f=1,d=e,g=h)}if(1===f){xyData.splice(d,1);pointsPicked-=1;pointsStatus(pointsPicked);resetLayers();for(e=0;e<pointsPicked;e++)xp=xyData[e][0],yp=xyData[e][1],dataCtx.beginPath(),dataCtx.fillStyle="rgb(200,0,0)",dataCtx.arc(xp,yp,3,0,2*Math.PI,!0),dataCtx.fill()}updateZoom(a)}
function taninverse(a,b){var c;0<a?c=Math.atan2(a,b):0>=a&&(c=Math.atan2(a,b)+2*Math.PI);c>=2*Math.PI&&(c=0);return c}var mouseEventType=[],mouseEventFunction=[],mouseEventCapture=[],mouseEvents=0;
function addMouseEvent(a,b,c){for(var g=!1,f=0;f<mouseEvents;f++)a===mouseEventType[f]&&(b===mouseEventFunction[f]&&c===mouseEventCapture[f])&&(g=!0);!1===g&&(topCanvas.addEventListener(a,b,c),mouseEventType[mouseEvents]=a,mouseEventFunction[mouseEvents]=b,mouseEventCapture[mouseEvents]=c,mouseEvents+=1)}
function removeAllMouseEvents(){if(0<mouseEvents){for(var a=0;a<mouseEvents;a++)topCanvas.removeEventListener(mouseEventType[a],mouseEventFunction[a],mouseEventCapture[a]);mouseEvents=0;mouseEventType=[];moueEventFunction=[];mouseEventCapture=[]}clearToolbar()}
function removeMouseEvent(a,b,c){for(var g=!1,f=0,d=0;d<mouseEvents;d++)a===mouseEventType[d]&&(b===mouseEventFunction[d]&&c===mouseEventCapture[d])&&(g=!0,f=d);!0===g&&(topCanvas.removeEventListener(a,b,c),mouseEvents-=1,mouseEventType.splice(f,1),mouseEventFunction.splice(f,1),mouseEventCapture.splice(f,1))}
function exportToPlotly(){if(0!==pointsPicked){var a=document.createElement("div"),b=document.createElement("form"),c=document.createElement("input");b.setAttribute("method","post");b.setAttribute("action","https://plot.ly/external");b.setAttribute("target","_blank");c.setAttribute("type","text");c.setAttribute("name","data");b.appendChild(c);a.appendChild(b);document.body.appendChild(a);a.style.display="none";var g=[],f=[],d=[],e={data:[]};if("XY"===plotType||"map"===plotType||"polar"===plotType||
"image"===plotType){for(var h=0;h<pointsPicked;h++)g[h]=formatVariableForPlotly(displayData[h][0],"X"),f[h]=formatVariableForPlotly(displayData[h][1],"Y");e.data[0]={x:g,y:f}}else if("ternary"===plotType){for(h=0;h<pointsPicked;h++)g[h]=displayData[h][0],f[h]=displayData[h][1],d[h]=displayData[h][2];e.data[0]={x:g,y:f,z:d}}c.setAttribute("value",JSON.stringify(e));b.submit();document.body.removeChild(a)}}
function formatVariableForPlotly(a,b){return"XY"===plotType&&("X"===b&&axesAlignmentData[6]||"Y"===b&&axesAlignmentData[7])?dateConverter.formatDate(dateConverter.fromJD(a),"yyyy-mm-dd"):a}function showPopup(a){document.getElementById("shadow").style.visibility="visible";a=document.getElementById(a);var b=parseInt(window.innerWidth),c=parseInt(window.innerHeight),g=parseInt(a.offsetWidth),f=parseInt(a.offsetHeight);a.style.left=(b-g)/2+"px";a.style.top=(c-f)/2+"px";a.style.visibility="visible"}
function closePopup(a){document.getElementById("shadow").style.visibility="hidden";document.getElementById(a).style.visibility="hidden"}function processingNote(a){document.getElementById("wait").style.visibility=!0===a?"visible":"hidden"}var sidebarList=["editImageToolbar","manualMode","autoMode"];function showSidebar(a){clearSidebar();document.getElementById(a).style.visibility="visible"}
function clearSidebar(){for(ii=0;ii<sidebarList.length;ii++)document.getElementById(sidebarList[ii]).style.visibility="hidden"}var toolbarList=["paintToolbar","colorPickerToolbar"];function showToolbar(a){clearToolbar();document.getElementById(a).style.visibility="visible"}function clearToolbar(){for(ii=0;ii<toolbarList.length;ii++)document.getElementById(toolbarList[ii]).style.visibility="hidden"}
var zCanvas,zctx,tempCanvas,tctx,zoom_dx=20,zoom_dy=20,zWindowWidth=200,zWindowHeight=200,mPosn,extendedCrosshair=!1,pix=[[]],zoomTimeout;function initZoom(){var a=document.getElementById("zoomCrossHair").getContext("2d");a.strokeStyle="rgb(0,0,0)";a.beginPath();a.moveTo(zWindowWidth/2,0);a.lineTo(zWindowWidth/2,zWindowHeight);a.moveTo(0,zWindowHeight/2);a.lineTo(zWindowWidth,zWindowHeight/2);a.stroke()}
function updateZoomEventHandler(a){clearTimeout(zoomTimeout);zoomTimeout=setTimeout(updateZoom(a),5)}
function updateZoom(a){var b=getPosition(a);a=b.x;var c=b.y,g=zoom_dx,f=zoom_dy;1!=axesPicked?mPosn.innerHTML=a+", "+c:1==axesPicked&&(pix[0][0]=parseFloat(a),pix[0][1]=parseFloat(c),b=pixelToData(pix,1,plotType),"image"===plotType?mPosn.innerHTML=b[0][0]+", "+b[0][1]:("XY"===plotType?(mPosn.innerHTML=!0===axesAlignmentData[6]?dateConverter.formatDate(dateConverter.fromJD(b[0][0]),axesAlignmentData[8]):parseFloat(b[0][0]).toExponential(4),mPosn.innerHTML=!0===axesAlignmentData[7]?mPosn.innerHTML+
(", "+dateConverter.formatDate(dateConverter.fromJD(b[0][1]),axesAlignmentData[9])):mPosn.innerHTML+(", "+parseFloat(b[0][1]).toExponential(4))):mPosn.innerHTML=parseFloat(b[0][0]).toExponential(4)+", "+parseFloat(b[0][1]).toExponential(4),"ternary"===plotType&&(mPosn.innerHTML+=", "+parseFloat(b[0][2]).toExponential(4))));!0===extendedCrosshair&&(hoverCanvas.width=hoverCanvas.width,hoverCtx.strokeStyle="rgba(0,0,0, 0.5)",hoverCtx.beginPath(),hoverCtx.moveTo(a,0),hoverCtx.lineTo(a,canvasHeight),hoverCtx.moveTo(0,
c),hoverCtx.lineTo(canvasWidth,c),hoverCtx.stroke());if(0<=a-g/2&&0<=c-f/2&&a+g/2<=canvasWidth&&c+f/2<=canvasHeight){b=ctx.getImageData(a-g/2,c-f/2,g,f);a=dataCtx.getImageData(a-g/2,c-f/2,g,f);for(c=0;c<a.data.length;c+=4)0!=a.data[c]+a.data[c+1]+a.data[c+2]+a.data[c+3]&&(b.data[c]=a.data[c],b.data[c+1]=a.data[c+1],b.data[c+2]=a.data[c+2]);tctx.clearRect(0,0,zoom_dx,zoom_dy);tctx.putImageData(b,0,0);zctx.drawImage(tempCanvas,0,0,zWindowWidth,zWindowHeight)}}
function toggleCrosshair(a){220===a.keyCode&&(a.preventDefault(),extendedCrosshair=!extendedCrosshair,hoverCanvas.width=hoverCanvas.width)}
var averagingWindowAlgo={getParamList:function(){return[["\u0394X","Px","5"],["\u0394Y","Px","5"]]},run:function(){var a=[],b=0;xyData=[];pointsPicked=0;for(var c=document.getElementById("pv0"),c=parseFloat(c.value),g=document.getElementById("pv1"),g=parseFloat(g.value),f=canvasWidth,d=canvasHeight,e=[],h=0;h<f;h++){blobs=-1;firstbloby=-2*g;for(var k=bi=0;k<d;k++)!0===binaryData[k][h]&&(k>firstbloby+g?(blobs+=1,bi=1,firstbloby=e[blobs]=k):(bi+=1,e[blobs]=parseFloat((e[blobs]*(bi-1)+k)/parseFloat(bi))));
if(0<=blobs){xi=h;for(k=0;k<=blobs;k++)yi=e[k],a[b]=[],a[b][0]=parseFloat(xi),a[b][1]=parseFloat(yi),a[b][2]=1,b+=1}}if(0===b)return 0;for(f=0;f<b;f++)if(1===a[f][2]){for(var d=1,e=f+1,h=a[f][0],k=a[f][1],l=h,r=k,m=1;1===d&&e<b;){var p=a[e][0],n=a[e][1];Math.abs(p-h)<=c&&(Math.abs(n-k)<=g&&1===a[e][2])&&(l=(l*m+p)/(m+1),r=(r*m+n)/(m+1),m+=1,a[e][2]=0);p>h+2*c&&(d=0);e+=1}a[f][2]=0;xyData[pointsPicked]=[];xyData[pointsPicked][0]=parseFloat(l);xyData[pointsPicked][1]=parseFloat(r);pointsPicked+=1}}},
averagingWindowWithStepSizeAlgo={getParamList:function(){if("XY"===plotType)return[["X_min","Units",axesAlignmentData[0].toString()],["\u0394X Step","Units","0.1"],["X_max","Units",axesAlignmentData[1].toString()],["Y_min","Units",axesAlignmentData[2].toString()],["Y_max","Units",axesAlignmentData[3].toString()],["Line width","Px","30"]];closePopup("testImageWindow");showPopup("xyAxesOnly");return[["X_min","Units","0"],["\u0394X Step","Units","0.1"],["X_max","Units","0"],["Y_min","Units","0"],["Y_max",
"Units","0"],["Line width","Px","30"]]},run:function(){if("XY"===plotType){xyData=[];pointsPicked=0;resetLayers();for(var a=canvasWidth,b=canvasHeight,c=document.getElementById("pv0"),g=document.getElementById("pv1"),f=document.getElementById("pv2"),d=document.getElementById("pv5"),e=document.getElementById("pv3"),h=document.getElementById("pv4"),c=parseFloat(c.value),g=parseFloat(g.value),f=parseFloat(f.value),d=parseFloat(d.value),e=parseFloat(e.value),h=parseFloat(h.value);c<=f;c+=g){var k,l,r,
m;dataToPixel(c,e,"XY");k=dataToPixelxy[0];r=dataToPixelxy[1];dataToPixel(c,h,"XY");l=dataToPixelxy[0];m=dataToPixelxy[1];k=Math.sqrt((m-r)*(m-r)+(l-k)*(l-k));l=(h-e)/k;r=!1;for(var p=m=0,n=!1,q=0;q<=k;q++)if(dataToPixel(c,1*-q*l+h,"XY"),xi_pix=dataToPixelxy[0],yi_pix=dataToPixelxy[1],0<=xi_pix&&(xi_pix<a&&0<=yi_pix&&yi_pix<b)&&(!0===binaryData[parseInt(yi_pix,10)][parseInt(xi_pix,10)]?(!1===r&&(p=m=q,r=!0,n=!1),!0===n&&(p=q,n=!1)):!1===n&&(p=q,n=!0),!0===r&&(q>m+d||q==k-1)))r=!1,m>p&&(p=q),dataToPixel(c,
1*-((m+p)/2)*l+h,"XY"),xyData[pointsPicked]=[],xyData[pointsPicked][0]=parseFloat(dataToPixelxy[0]),xyData[pointsPicked][1]=parseFloat(dataToPixelxy[1]),pointsPicked+=1}}else showPopup("xyAxesOnly")}},blobDetectorAlgo={getParamList:function(){return[["Min size","Px","0"],["Max size","Px","1000"]]},run:function(){xyData=[];pointsPicked=0;for(var a=document.getElementById("pv0").value,b=document.getElementById("pv1").value,c=[],g=0;g<canvasHeight;g++){c[g]=[];for(var f=0;f<canvasWidth;f++)c[g][f]=!1}for(var g=
0,f=[],d=[],e=[],h=[],k=[],l=0;l<canvasHeight;l++)for(var r=0;r<canvasWidth;r++){if(!0===binaryData[l][r]&&!1===c[l][r]){c[l][r]=!0;g+=1;f[g-1]=1;h[g-1]=[];k[g-1]=[];h[g-1][0]=r;k[g-1][0]=l;d[g-1]=r;e[g-1]=l;for(var m=1,p=1;m<=p;){ai=k[g-1][m-1];bi=h[g-1][m-1];for(var n=-1;1>=n;n++)for(var q=-1;1>=q;q++)0<=ai+n&&(0<=bi+q&&ai+n<canvasHeight&&bi+q<canvasWidth)&&(!0==binaryData[ai+n][bi+q]&&!1==c[ai+n][bi+q])&&(f[g-1]+=1,p=f[g-1],k[g-1][p-1]=ai+n,h[g-1][p-1]=bi+q,e[g-1]=(e[g-1]*(p-1)+(ai+n))/p,d[g-1]=
(d[g-1]*(p-1)+(bi+q))/p,c[ai+n][bi+q]=!0);m+=1}}c[l][r]=!0}for(c=0;c<g;c++)h=2*Math.sqrt(f[c]/Math.PI),h>=a&&h<=b&&(xyData[pointsPicked]=[],xyData[pointsPicked][0]=parseFloat(d[c]),xyData[pointsPicked][1]=parseFloat(e[c]),xyData[pointsPicked][2]=f[c],pointsPicked+=1)}},xStepAlgo={getParamList:function(){return[["\u0394X","Px","5"],["Line Width","Px","15"]]},run:function(){xyData=[];pointsPicked=0;resetLayers();for(var a=document.getElementById("pv0"),a=parseFloat(a.value),b=document.getElementById("pv1"),
b=parseFloat(b.value),c=canvasWidth,g=canvasHeight,f=[],d=1,e=0;e<c;){blobs=-1;firstbloby=-2*b;for(var h=bi=0;h<g;h++)!0===binaryData[h][e]&&(d=a,h>firstbloby+b?(blobs+=1,bi=1,firstbloby=f[blobs]=h):(bi+=1,f[blobs]=parseFloat((f[blobs]*(bi-1)+h)/parseFloat(bi))));if(0<=blobs){xi=e;for(h=0;h<=blobs;h++)yi=f[h],xyData[pointsPicked]=[],xyData[pointsPicked][0]=parseFloat(xi),xyData[pointsPicked][1]=parseFloat(yi),pointsPicked+=1}e+=d}}},yStepAlgo={getParamList:function(){return[["\u0394Y","Px","5"],["Line Width",
"Px","15"]]},run:function(){xyData=[];pointsPicked=0;resetLayers();for(var a=document.getElementById("pv0"),a=parseFloat(a.value),b=document.getElementById("pv1"),b=parseFloat(b.value),c=canvasWidth,g=[],f=-1,d=canvasHeight-1;0<=d;){blobs=-1;firstblobx=-2*b;for(var e=bi=0;e<c;e++)!0===binaryData[d][e]&&(f=-a,e>firstblobx+b?(blobs+=1,bi=1,firstblobx=g[blobs]=e):(bi+=1,g[blobs]=parseFloat((g[blobs]*(bi-1)+e)/parseFloat(bi))));if(0<=blobs){yi=d;for(e=0;e<=blobs;e++)xi=g[e],xyData[pointsPicked]=[],xyData[pointsPicked][0]=
parseFloat(xi),xyData[pointsPicked][1]=parseFloat(yi),pointsPicked+=1}d+=f}}};
