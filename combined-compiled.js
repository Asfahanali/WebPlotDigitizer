var wpd=wpd||{};wpd.initApp=function(){wpd.browserInfo.checkBrowser();wpd.layoutManager.initialLayout();wpd.graphicsWidget.loadImageFromURL("start.png");document.getElementById("loadingCurtain").style.display="none"};document.addEventListener("DOMContentLoaded",wpd.initApp,!0);wpd=wpd||{};wpd.detectionAlgoManager=function(){return{setActiveAlgo:function(a){},getActiveAlgo:function(){return null},getAllApplicableAlgorithms:function(){}}}();wpd=wpd||{};
wpd.appData=function(){var a=!1,b;return{isAligned:function(b){null!=b&&(a=b);return a},getPlotData:function(){null==b&&(b=new wpd.PlotData);return b},reset:function(){a=!1;b=null}}}();wpd=wpd||{};
wpd.AutoDetector=function(){return function(){this.fgColor=[0,0,200];this.bgColor=[255,255,255];this.mask=null;this.colorDetectionMode="fg";this.colorDistance=120;this.imageData=this.binaryData=this.algorithm=null;this.generateBinaryData=function(){if(null!=this.mask&&0!==this.mask.length){this.binaryData=[];var a,b,c,d="fg"===this.colorDetectionMode?this.fgColor:this.bgColor;for(a=0;a<this.mask.length;a++)b=this.mask[a],c=Math.sqrt((this.imageData.data[4*b]-d[0])*(this.imageData.data[4*b]-d[0])+
(this.imageData.data[4*b+1]-d[1])*(this.imageData.data[4*b+1]-d[1])+(this.imageData.data[4*b+2]-d[2])*(this.imageData.data[4*b+2]-d[2])),"fg"===this.colorDetectionMode?c<=this.colorDistance&&(this.binaryData[b]=!0):c>=this.colorDistance&&(this.binaryData[b]=!0)}}}}();wpd=wpd||{};wpd.dataEventNames={axesAligned:"axesAligned",imageLoaded:"imageLoaded"};wpd.dataEventManager=function(){return{fireEvent:function(a,b){},subscribe:function(a,b){},unsubscribe:function(a,b){},removeAllSubscriptionsForEvent:function(a){}}}();
wpd=wpd||{};
wpd.Calibration=function(){return function(a){var b=[],c=[],d=null==a?2:a,e=[];this.getCount=function(){return b.length};this.getDimensions=function(){return d};this.addPoint=function(a,h,g,k,m){var n=b.length,l=e.length;b[n]=a;c[n]=h;e[l]=g;e[l+1]=k;3===d&&(e[l+2]=m)};this.getPoint=function(a){return 0>a||a>=b.length?null:{px:b[a],py:c[a],dx:e[d*a],dy:e[d*a+1],dz:2===d?null:e[d*a+2]}};this.setDataAt=function(a,c,g,k){0>a||a>=b.length||(e[d*a]=c,e[d*a+1]=g,3===d&&(e[d*a+2]=k))};this.dump=function(){console.log(b);
console.log(c);console.log(e)}}}();
wpd.DataSeries=function(){return function(a){var b=[];this.name="Data Series";this.variableNames=["x","y"];this.addPixel=function(a,d){var e=b.length;b[e]=a;b[e+1]=d};this.getPixel=function(a){return{x:b[2*a],y:b[2*a+1]}};this.insertPixel=function(a,d,e){b.splice(2*e,0,a);b.splice(2*e+1,0,d)};this.removePixelAtIndex=function(a){2*a<b.length&&b.splice(2*a,2)};this.removeLastPixel=function(){this.removePixelAtIndex(b.length/2-1)};this.removeNearestPixel=function(a,d,e){e=null==e?50:parseFloat(e);var f,
h=-1,g,k;for(g=0;g<b.length;g+=2)if(k=Math.sqrt((a-b[g])*(a-b[g])+(d-b[g+1])*(d-b[g+1])),0>h&&k<=e||0<=h&&k<f)h=g/2,f=k;0<=h&&this.removePixelAtIndex(h)};this.clearAll=function(){b=[]};this.getCount=function(){return b.length/2}}}();
wpd.PlotData=function(){return function(){var a=0,b=new wpd.AutoDetector;this.axes=null;this.dataSeriesColl=[];this.getActiveDataSeries=function(){null==this.dataSeriesColl[a]&&(this.dataSeriesColl[a]=new wpd.DataSeries);return this.dataSeriesColl[a]};this.getDataSeriesCount=function(){return this.dataSeriesColl.length};this.setActiveDataSeriesIndex=function(b){a=b};this.getAutoDetector=function(){return b};this.getDataFromActiveSeries=function(){if(null==this.dataSeriesColl[a]||null==this.axes)return null;
var b,d,e=[],f;for(b=0;b<this.dataSeriesColl[a].getCount();b++)for(d=this.dataSeriesColl[a].getPixel(b),d=this.axes.pixelToData(d.x,d.y),e[b]=[],f=0;f<d.length;f++)e[b][f]=d[f];return e};this.reset=function(){this.axes=null;this.dataSeriesColl=[];a=0;b=new wpd.AutoDetector}}}();
var dateConverter={parse:function(a){return null==a||-1===a.indexOf("/")?null:this.toJD(a)},toJD:function(a){var b=a.split("/"),c;if(0>=b.length||3<b.length)return null;a=parseInt(b[0],10);c=parseInt(void 0===b[1]?0:b[1],10);date=parseInt(void 0===b[2]?1:b[2],10);if(isNaN(a)||isNaN(c)||isNaN(date)||12<c||1>c||31<date||1>date)return null;b=new Date;b.setUTCFullYear(a);b.setUTCMonth(c-1);b.setUTCDate(date);a=parseFloat(Date.parse(b));return isNaN(a)?null:a},fromJD:function(a){a=parseFloat(a);a=parseInt(864E5*
Math.round(a/864E5),10);return new Date(a)},formatDate:function(a,b){var c;c=b.replace("YYYY","yyyy");c=c.replace("YY","yy");c=c.replace("MMMM","mmmm");c=c.replace("MMM","mmm");c=c.replace("MM","mm");c=c.replace("DD","dd");c=c.replace("yyyy",a.getUTCFullYear());var d=a.getUTCFullYear()%100;c=c.replace("yy",10>d?"0"+d:d);c=c.replace("mmmm","January February March April May June July August September October November December".split(" ")[a.getUTCMonth()]);c=c.replace("mmm","Jan Feb Mar Apr May Jun Jul Aug Sep Oct Nov Dec".split(" ")[a.getUTCMonth()]);
c=c.replace("mm",a.getUTCMonth()+1);return c=c.replace("dd",a.getUTCDate())},getFormatString:function(a){a=a.split("/");var b="yyyy/mm/dd";1<=a.length&&(b="yyyy");2<=a.length&&(b+="/mm");3===a.length&&(b+="/dd");return b}};function findDifference(a,b){for(var c=canvasWidth,d=canvasHeight,e=[],f=0;f<d;f++){e[f]=[];for(var h=0;h<c;h++){var g=4*f*c+4*h;e[f][h]=!1;for(var k=0;4>k;k++)a.data[g+k]!=b.data[g+k]&&(e[f][h]=!0)}}return e}
function copyUsingDifference(a,b,c){for(var d=canvasWidth,e=canvasHeight,f=0;f<e;f++)for(var h=0;h<d;h++){var g=4*f*d+4*h;if(!0===c[f][h])for(var k=0;4>k;k++)a.data[g+k]=b.data[g+k]}return a}
function colorSelect(a,b,c,d){dw=canvasWidth;dh=canvasHeight;redv=c[0];greenv=c[1];bluev=c[2];c=[];for(var e=0;e<dh;e++){c[e]=[];for(var f=0;f<dw;f++)index=4*e*dw+4*f,ir=a.data[index],ig=a.data[index+1],ib=a.data[index+2],dist=Math.sqrt((ir-redv)*(ir-redv)+(ig-greenv)*(ig-greenv)+(ib+bluev)*(ib+bluev)),c[e][f]=!1,"fg"===b?dist<=d&&(c[e][f]=!0):"bg"===b&&dist>d&&(c[e][f]=!0)}return c}
function colorSelectDiff(a,b,c,d,e){dw=canvasWidth;dh=canvasHeight;redv=c[0];greenv=c[1];bluev=c[2];c=[];for(var f=0;f<dh;f++){c[f]=[];for(var h=0;h<dw;h++){index=4*f*dw+4*h;var g=a.data[index],k=a.data[index+1],m=a.data[index+2],g=Math.sqrt((g-redv)*(g-redv)+(k-greenv)*(k-greenv)+(m-bluev)*(m-bluev));c[f][h]=!1;"fg"===b&&1===e[f][h]?g<=d&&(c[f][h]=!0):"bg"===b&&1===e[f][h]&&g>d&&(c[f][h]=!0)}}return c}
function selectFromMarkedRegion(a,b,c){dw=canvasWidth;dh=canvasHeight;redv=b[0];greenv=b[1];bluev=b[2];b=dataCtx.getImageData(0,0,canvasWidth,canvasHeight);for(var d=getCanvasData(),e=[],f=0;f<dh;f++){e[f]=[];for(var h=0;h<dw;h++){index=4*f*dw+4*h;var g=b.data[index],k=b.data[index+1],m=b.data[index+2],n=d.data[index],l=d.data[index+1],r=d.data[index+2];e[f][h]=!1;255===g&&255===k&&0===m&&(g=Math.sqrt((n-redv)*(n-redv)+(l-greenv)*(l-greenv)+(r-bluev)*(r-bluev)),"fg"===a&&g<=c?e[f][h]=!0:"bg"===a&&
g>c&&(e[f][h]=!0))}}return e}function binaryToImageData(a,b){dw=canvasWidth;dh=canvasHeight;for(var c=0;c<dh;c++)for(var d=0;d<dw;d++)index=4*c*dw+4*d,!1===a[c][d]?(b.data[index]=255,b.data[index+1]=255,b.data[index+2]=255):(b.data[index]=0,b.data[index+1]=0,b.data[index+2]=0),b.data[index+3]=255;return b}
function getImageDataBasedOnSelection(a,b,c,d){var e=canvasWidth,f=canvasHeight,h,g,k,m=c[0],n=c[1],l=c[2],r=dataCtx.getImageData(0,0,canvasWidth,canvasHeight),q=currentScreen,p,s,u,E,K,v;for(c=0;c<f;c++)for(h=0;h<e;h++)g=4*c*e+4*h,k=r.data[g],p=r.data[g+1],s=r.data[g+2],u=q.data[g],E=q.data[g+1],K=q.data[g+2],v=!0,255===k&&255===p&&0===s&&(k=(u-m)*(u-m)+(E-n)*(E-n)+(K-l)*(K-l),"fg"===b&&k<=d*d?v=!1:"bg"===b&&k>d*d&&(v=!1)),v?(a.data[g]=255,a.data[g+1]=255,a.data[g+2]=255):(a.data[g]=0,a.data[g+1]=
0,a.data[g+2]=0),a.data[g+3]=255;return a}var InputParser=function(){var a=this;a.parse=function(b){a.isValid=!1;a.isDate=!1;if(null==b)return null;b=b.trim();if(-1!==b.indexOf("^"))return null;var c=dateConverter.parse(b);if(null!==c)return a.isValid=!0,a.isDate=!0,c;b=parseFloat(b);return isNaN(b)?null:(a.isValid=!0,b)};a.isValid=!1;a.isDate=!1},wpd=wpd||{};wpd.taninverse=function(a,b){var c;0<a?c=Math.atan2(a,b):0>=a&&(c=Math.atan2(a,b)+2*Math.PI);c>=2*Math.PI&&(c=0);return c};wpd=wpd||{};
wpd.AveragingWindowAlgo=function(){return function(){this.getParamList=function(){};this.setParam=function(a,b){};this.run=function(a){}}}();
var averagingWindowAlgo={getParamList:function(){return[["\u0394X","Px","5"],["\u0394Y","Px","5"]]},run:function(){var a=[],b=0;xyData=[];pointsPicked=0;for(var c=document.getElementById("pv0"),c=parseFloat(c.value),d=document.getElementById("pv1"),d=parseFloat(d.value),e=canvasWidth,f=canvasHeight,h=[],g=0;g<e;g++){blobs=-1;firstbloby=-2*d;for(var k=bi=0;k<f;k++)!0===binaryData[k][g]&&(k>firstbloby+d?(blobs+=1,bi=1,firstbloby=h[blobs]=k):(bi+=1,h[blobs]=parseFloat((h[blobs]*(bi-1)+k)/parseFloat(bi))));
if(0<=blobs)for(xi=g,k=0;k<=blobs;k++)yi=h[k],a[b]=[],a[b][0]=parseFloat(xi),a[b][1]=parseFloat(yi),a[b][2]=1,b+=1}if(0===b)return 0;for(e=0;e<b;e++)if(1===a[e][2]){for(var f=1,h=e+1,g=a[e][0],k=a[e][1],m=g,n=k,l=1;1===f&&h<b;){var r=a[h][0],q=a[h][1];Math.abs(r-g)<=c&&Math.abs(q-k)<=d&&1===a[h][2]&&(m=(m*l+r)/(l+1),n=(n*l+q)/(l+1),l+=1,a[h][2]=0);r>g+2*c&&(f=0);h+=1}a[e][2]=0;xyData[pointsPicked]=[];xyData[pointsPicked][0]=parseFloat(m);xyData[pointsPicked][1]=parseFloat(n);pointsPicked+=1}}},averagingWindowWithStepSizeAlgo=
{getParamList:function(){if("XY"===plotType)return[["X_min","Units",axesAlignmentData[0].toString()],["\u0394X Step","Units","0.1"],["X_max","Units",axesAlignmentData[1].toString()],["Y_min","Units",axesAlignmentData[2].toString()],["Y_max","Units",axesAlignmentData[3].toString()],["Line width","Px","30"]];closePopup("testImageWindow");showPopup("xyAxesOnly");return[["X_min","Units","0"],["\u0394X Step","Units","0.1"],["X_max","Units","0"],["Y_min","Units","0"],["Y_max","Units","0"],["Line width",
"Px","30"]]},run:function(){if("XY"===plotType){xyData=[];pointsPicked=0;resetLayers();for(var a=canvasWidth,b=canvasHeight,c=document.getElementById("pv0"),d=document.getElementById("pv1"),e=document.getElementById("pv2"),f=document.getElementById("pv5"),h=document.getElementById("pv3"),g=document.getElementById("pv4"),c=parseFloat(c.value),d=parseFloat(d.value),e=parseFloat(e.value),f=parseFloat(f.value),h=parseFloat(h.value),g=parseFloat(g.value);c<=e;c+=d){var k,m,n,l;dataToPixel(c,h,"XY");k=
dataToPixelxy[0];n=dataToPixelxy[1];dataToPixel(c,g,"XY");m=dataToPixelxy[0];l=dataToPixelxy[1];k=Math.sqrt((l-n)*(l-n)+(m-k)*(m-k));m=(g-h)/k;n=!1;for(var r=l=0,q=!1,p=0;p<=k;p++)dataToPixel(c,1*-p*m+g,"XY"),xi_pix=dataToPixelxy[0],yi_pix=dataToPixelxy[1],0<=xi_pix&&xi_pix<a&&0<=yi_pix&&yi_pix<b&&(!0===binaryData[parseInt(yi_pix,10)][parseInt(xi_pix,10)]?(!1===n&&(r=l=p,n=!0,q=!1),!0===q&&(r=p,q=!1)):!1===q&&(r=p,q=!0),!0===n&&(p>l+f||p==k-1)&&(n=!1,l>r&&(r=p),dataToPixel(c,1*-((l+r)/2)*m+g,"XY"),
xyData[pointsPicked]=[],xyData[pointsPicked][0]=parseFloat(dataToPixelxy[0]),xyData[pointsPicked][1]=parseFloat(dataToPixelxy[1]),pointsPicked+=1))}}else showPopup("xyAxesOnly")}},blobDetectorAlgo={getParamList:function(){return[["Min size","Px","0"],["Max size","Px","1000"]]},run:function(){xyData=[];pointsPicked=0;for(var a=document.getElementById("pv0").value,b=document.getElementById("pv1").value,c=[],d=0;d<canvasHeight;d++){c[d]=[];for(var e=0;e<canvasWidth;e++)c[d][e]=!1}for(var d=0,e=[],f=
[],h=[],g=[],k=[],m=0;m<canvasHeight;m++)for(var n=0;n<canvasWidth;n++){if(!0===binaryData[m][n]&&!1===c[m][n]){c[m][n]=!0;d+=1;e[d-1]=1;g[d-1]=[];k[d-1]=[];g[d-1][0]=n;k[d-1][0]=m;f[d-1]=n;h[d-1]=m;for(var l=1,r=1;l<=r;){ai=k[d-1][l-1];bi=g[d-1][l-1];for(var q=-1;1>=q;q++)for(var p=-1;1>=p;p++)0<=ai+q&&0<=bi+p&&ai+q<canvasHeight&&bi+p<canvasWidth&&!0==binaryData[ai+q][bi+p]&&!1==c[ai+q][bi+p]&&(e[d-1]+=1,r=e[d-1],k[d-1][r-1]=ai+q,g[d-1][r-1]=bi+p,h[d-1]=(h[d-1]*(r-1)+(ai+q))/r,f[d-1]=(f[d-1]*(r-
1)+(bi+p))/r,c[ai+q][bi+p]=!0);l+=1}}c[m][n]=!0}for(c=0;c<d;c++)g=2*Math.sqrt(e[c]/Math.PI),g>=a&&g<=b&&(xyData[pointsPicked]=[],xyData[pointsPicked][0]=parseFloat(f[c]),xyData[pointsPicked][1]=parseFloat(h[c]),xyData[pointsPicked][2]=e[c],pointsPicked+=1)}},xStepAlgo={getParamList:function(){return[["\u0394X","Px","5"],["Line Width","Px","15"]]},run:function(){xyData=[];pointsPicked=0;resetLayers();for(var a=document.getElementById("pv0"),a=parseFloat(a.value),b=document.getElementById("pv1"),b=
parseFloat(b.value),c=canvasWidth,d=canvasHeight,e=[],f=1,h=0;h<c;){blobs=-1;firstbloby=-2*b;for(var g=bi=0;g<d;g++)!0===binaryData[g][h]&&(f=a,g>firstbloby+b?(blobs+=1,bi=1,firstbloby=e[blobs]=g):(bi+=1,e[blobs]=parseFloat((e[blobs]*(bi-1)+g)/parseFloat(bi))));if(0<=blobs)for(xi=h,g=0;g<=blobs;g++)yi=e[g],xyData[pointsPicked]=[],xyData[pointsPicked][0]=parseFloat(xi),xyData[pointsPicked][1]=parseFloat(yi),pointsPicked+=1;h+=f}}},yStepAlgo={getParamList:function(){return[["\u0394Y","Px","5"],["Line Width",
"Px","15"]]},run:function(){xyData=[];pointsPicked=0;resetLayers();for(var a=document.getElementById("pv0"),a=parseFloat(a.value),b=document.getElementById("pv1"),b=parseFloat(b.value),c=canvasWidth,d=[],e=-1,f=canvasHeight-1;0<=f;){blobs=-1;firstblobx=-2*b;for(var h=bi=0;h<c;h++)!0===binaryData[f][h]&&(e=-a,h>firstblobx+b?(blobs+=1,bi=1,firstblobx=d[blobs]=h):(bi+=1,d[blobs]=parseFloat((d[blobs]*(bi-1)+h)/parseFloat(bi))));if(0<=blobs)for(yi=f,h=0;h<=blobs;h++)xi=d[h],xyData[pointsPicked]=[],xyData[pointsPicked][0]=
parseFloat(xi),xyData[pointsPicked][1]=parseFloat(yi),pointsPicked+=1;f+=e}}},wpd=wpd||{};wpd.ImageAxes=function(){var a=function(){this.isCalibrated=function(){return!0};this.calibrate=function(){return!0};this.pixelToData=function(a,c){return[a,c]};this.dataToPixel=function(a,c){return{x:a,y:c}}};a.prototype.numCalibrationPointsRequired=function(){return 0};a.prototype.getDimensions=function(){return 2};return a}();wpd=wpd||{};
wpd.MapAxes=function(){var a=function(){var a=!1,c,d;this.isCalibrated=function(){return a};this.calibrate=function(e,f){var h=e.getPoint(0),g=e.getPoint(1);d=Math.sqrt((h.px-g.px)*(h.px-g.px)+(h.py-g.py)*(h.py-g.py));c=parseFloat(f);return a=!0};this.pixelToData=function(a,b){var h=[];h[0]=a*c/d;h[1]=b*c/d;return h};this.dataToPixel=function(a,b,c){return{x:0,y:0}}};a.prototype.numCalibrationPointsRequired=function(){return 2};a.prototype.getDimensions=function(){return 2};return a}();wpd=wpd||{};
wpd.PolarAxes=function(){var a=function(){var a=!1,c=!1,d,e,f,h,g,k,m,n,l,r,q,p,s,u;processCalibration=function(a,b,v){v=a.getPoint(0);var B=a.getPoint(1);a=a.getPoint(2);d=v.px;e=v.py;f=B.px;h=B.py;g=a.px;k=a.py;m=B.dx;n=B.dy;l=a.dx;c=b;!0===c&&(n*=Math.PI/180);r=Math.sqrt((f-d)*(f-d)+(h-e)*(h-e));q=Math.sqrt((g-d)*(g-d)+(k-e)*(k-e));p=q-r;s=wpd.taninverse(-(h-e),f-d);u=s-n;return!0};this.isCalibrated=function(){return a};this.calibrate=function(c,d,e){return a=processCalibration(c,d,e)};this.pixelToData=
function(a,b){var h=[],k,g;xp=parseFloat(a);yp=parseFloat(py1);k=(l-m)/p*(Math.sqrt((xp-d)*(xp-d)+(yp-e)*(yp-e))-r)+m;g=wpd.taninverse(-(yp-e),xp-d)-u;!0==c&&(g=180*g/Math.PI);h[0]=k;h[1]=g;return h};this.dataToPixel=function(a,b){return{x:0,y:0}}};a.prototype.numCalibrationPointsRequired=function(){return 3};a.prototype.getDimensions=function(){return 2};return a}();wpd=wpd||{};
wpd.TernaryAxes=function(){var a=function(){var a=!1,c,d,e,f,h,g,k,m,n;this.isCalibrated=function(){return a};this.calibrate=function(l,r,q){var p=l.getPoint(0),s=l.getPoint(1);l.getPoint(2);c=p.px;d=p.py;e=s.px;f=s.py;h=Math.sqrt((c-e)*(c-e)+(d-f)*(d-f));g=wpd.taninverse(-(f-d),e-c);k=Math.sqrt(3);m=r;n=q;return a=!0};this.pixelToData=function(a,b){var e=[],f,s,u,E;xp=parseFloat(a);yp=parseFloat(b);f=Math.sqrt((xp-c)*(xp-c)+(yp-d)*(yp-d));s=wpd.taninverse(-(yp-d),xp-c)-g;u=f*Math.cos(s)/h;s=f*Math.sin(s)/
h;f=1-u-s/k;u-=s/k;s=2*s/k;!1==n&&(E=u,u=f,f=s,s=E);!0==m&&(f*=100,u*=100,s*=100);e[0]=f;e[1]=u;e[2]=s;return e};this.dataToPixel=function(a,b,c){return{x:0,y:0}}};a.prototype.numCalibrationPointsRequired=function(){return 3};a.prototype.getDimensions=function(){return 3};return a}();wpd=wpd||{};
wpd.XYAxes=function(){var a=function(){var a=!1,c=!1,d=!1,e,f,h,g,k,m,n,l,r,q,p,s,u,E,K,v,B,H,C,x,F;this.isCalibrated=function(){return a};this.calibrate=function(w,P,L){if(4>w.getCount())a=!1;else{var M=w.getPoint(0),N=w.getPoint(1),D=w.getPoint(2);w=w.getPoint(3);e=M.px;k=M.py;f=N.px;m=N.py;h=D.px;n=D.py;g=w.px;l=w.py;r=M.dx;q=N.dx;p=D.dy;s=w.dy;c=P;d=L;!0===c&&(r=Math.log(r)/Math.log(10),q=Math.log(q)/Math.log(10));!0===d&&(p=Math.log(p)/Math.log(10),s=Math.log(s)/Math.log(10));u=q-r;E=s-p;K=Math.sqrt((e-
f)*(e-f)+(k-m)*(k-m));v=Math.sqrt((h-g)*(h-g)+(n-l)*(n-l));B=u/K;H=E/v;C=wpd.taninverse(-(m-k),f-e);x=wpd.taninverse(-(l-n),g-h);F=x-C;a=!0}return a};this.pixelToData=function(a,b){var f=[],g,m,l,q;g=parseFloat(a);m=parseFloat(b);l=Math.sqrt((g-e)*(g-e)+(m-k)*(m-k));q=wpd.taninverse(-(m-k),g-e)-C;l=(l*Math.cos(q)-l*Math.sin(q)/Math.tan(F))*B+r;q=Math.sqrt((g-h)*(g-h)+(m-n)*(m-n));g=x-wpd.taninverse(-(m-n),g-h);g=(q*Math.cos(g)-q*Math.sin(g)/Math.tan(F))*H+p;!0===c&&(l=Math.pow(10,l));!0===d&&(g=Math.pow(10,
g));f[0]=l;f[1]=g;return f};this.dataToPixel=function(a,b){return{x:0,y:0}}};a.prototype.numCalibrationPointsRequired=function(){return 4};a.prototype.getDimensions=function(){return 2};return a}();wpd=wpd||{};
wpd.graphicsWidget=function(){function a(a){var b=v.getBoundingClientRect();return{x:parseInt(a.pageX-(b.left+window.pageXOffset),10),y:parseInt(a.pageY-(b.top+window.pageYOffset),10)}}function b(a,b){return{x:a/G,y:b/G}}function c(a,b){a=parseInt(a,10);b=parseInt(b,10);P.style.width=a+"px";P.style.height=b+"px";v.width=a;B.width=a;H.width=a;C.width=a;x.width=a;v.height=b;B.height=b;H.height=b;C.height=b;x.height=b;V=a/(1*b);I=a;J=b;if(null!=R){L.fillStyle="rgb(255, 255, 255)";L.fillRect(0,0,I,J);
L.drawImage(F,0,0,I,J);if(null!=y&&void 0!=y.onRedraw)y.onRedraw();if(null!=t&&void 0!=t.onRedraw)t.onRedraw()}}function d(){v.width=v.width;B.width=B.width;H.width=H.width;C.width=C.width;x.width=x.width}function e(){var a=wpd.layoutManager.getGraphicsViewportSize();c(a.width,a.height);V>Q?(G=J/(1*z),c(J*Q,J)):(G=I/(1*A),c(I,I/Q))}function f(a){G=a;c(A*G,z*G)}function h(a){220===a.keyCode&&(a.preventDefault(),S=!S,C.width=C.width)}function g(a,b){var c=wpd.zoomView.getSize(),d=wpd.zoomView.getZoomRatio(),
e,h,g,f,k,m,l,n=0,p=0,q=c.width,r=c.height;g=c.width/d;f=c.height/d;e=a-g/2;h=b-f/2;m=e;c=h;k=e+g;l=h+f;0>e&&(m=0,n=-e*d);0>h&&(c=0,p=-h*d);e+g>=A&&(k=A,q-=d*(A-(e+g)));h+f>=z&&(l=z,r-=d*(z-(h+f)));g=O.getImageData(parseInt(m,10),parseInt(c,10),parseInt(k-m,10),parseInt(l-c,10));k=T.getImageData(parseInt(m,10),parseInt(c,10),parseInt(k-m,10),parseInt(l-c,10));for(l=0;l<k.data.length;l+=4)if(0!=k.data[l]||0!=k.data[l+1]||0!=k.data[l+2])g.data[l]=k.data[l],g.data[l+1]=k.data[l+1],g.data[l+2]=k.data[l+
2];m=d*(parseInt(m,10)-m);d*=parseInt(c,10)-c;wpd.zoomView.setZoomImage(g,parseInt(n+m,10),parseInt(p+d,10),parseInt(q-n,10),parseInt(r-p,10))}function k(c){clearTimeout(W);var d=setTimeout,e=a(c);c=e.x;var e=e.y,h=b(c,e);S&&(C.width=C.width,D.strokeStyle="rgba(0,0,0, 0.5)",D.beginPath(),D.moveTo(c,0),D.lineTo(c,J),D.moveTo(0,e),D.lineTo(I,e),D.stroke());g(h.x,h.y);wpd.zoomView.setCoords(h.x,h.y);W=d(void 0,10)}function m(){v=document.getElementById("mainCanvas");B=document.getElementById("dataCanvas");
H=document.getElementById("drawCanvas");C=document.getElementById("hoverCanvas");x=document.getElementById("topCanvas");F=document.createElement("canvas");w=document.createElement("canvas");L=v.getContext("2d");M=B.getContext("2d");D=C.getContext("2d");U=x.getContext("2d");N=H.getContext("2d");O=F.getContext("2d");T=w.getContext("2d");P=document.getElementById("canvasDiv");document.body.addEventListener("keydown",h,!1);x.addEventListener("mousemove",k,!1);x.addEventListener("dragover",function(a){a.preventDefault()},
!0);x.addEventListener("drop",function(a){a.preventDefault();a=a.dataTransfer.files;1===a.length&&l(a[0])},!0);x.addEventListener("mousemove",p,!1);x.addEventListener("click",s,!1);x.addEventListener("mouseup",u,!1);x.addEventListener("mousedown",E,!1);x.addEventListener("mouseout",K,!1);wpd.zoomView.initZoom();document.getElementById("fileLoadBox").addEventListener("change",r);window.addEventListener("paste",function(a){if(void 0!==a.clipboardData&&(a=a.clipboardData.items,void 0!==a))for(var b=
0;b<a.length;b++)if(-1!==a[b].type.indexOf("image")){var c=a[b].getAsFile();(window.URL||window.webkitURL).createObjectURL(c);l(c)}},!1)}function n(a){var b=document.createElement("img");b.onload=function(){null==v&&m();A=b.width;z=b.height;Q=A/(1*z);F.width=A;F.height=z;w.width=A;w.height=z;O.drawImage(b,0,0,A,z);R=O.getImageData(0,0,A,z);d();e();q()};b.src=a}function l(a){if(a.type.match("image.*")){var b=new FileReader;b.onload=function(){n(b.result)};b.readAsDataURL(a)}}function r(){var a=document.getElementById("fileLoadBox");
1==a.files.length&&l(a.files[0])}function q(){if(null!=t&&void 0!=t.onRemove)t.onRemove();t=null}function p(c){if(null!=t&&void 0!=t.onMouseMove){var e=a(c),d=b(e.x,e.y);t.onMouseMove(c,e,d)}}function s(c){if(null!=t&&void 0!=t.onMouseClick){var e=a(c),d=b(e.x,e.y);t.onMouseClick(c,e,d)}}function u(c){if(null!=t&&void 0!=t.onMouseUp){var e=a(c),d=b(e.x,e.y);t.onMouseUp(c,e,d)}}function E(c){if(null!=t&&void 0!=t.onMouseDown){var e=a(c),d=b(e.x,e.y);t.onMouseDown(c,e,d)}}function K(c){if(null!=t&&
void 0!=t.onMouseOut){var e=a(c),d=b(e.x,e.y);t.onMouseOut(c,e,d)}}var v,B,H,C,x,F,w,P,L,M,N,D,U,O,T,I,J,A,z,Q,V,R,G,S=!1,W,t,y;return{zoomIn:function(){f(1.2*G)},zoomOut:function(){f(G/1.2)},zoomFit:e,zoom100perc:function(){f(1)},setZoomRatio:f,loadImageFromURL:n,runImageOp:function(a){a=a(R,A,z);var b=a.imageData,c=a.height;A=a.width;z=c;Q=A/(1*z);F.width=A;F.height=z;w.width=A;w.height=z;O.putImageData(b,0,0);R=b;d();e();q()},setTool:function(a){if(null!=t&&void 0!=t.onRemove)t.onRemove();t=a;
if(null!=t&&void 0!=t.onAttach)t.onAttach()},removeTool:q,getAllContexts:function(){return{mainCtx:L,dataCtx:M,drawCtx:N,hoverCtx:D,topCtx:U,oriImageCtx:O,oriDataCtx:T}},resetData:function(){w.width=w.width;B.width=B.width},resetHover:function(){C.width=C.width},imagePx:b,screenPx:function(a,b){return{x:a*G,y:b*G}},updateZoomOnEvent:function(c){c=a(c);c=b(c.x,c.y);g(c.x,c.y);wpd.zoomView.setCoords(c.x,c.y)},getDisplaySize:function(){return{width:I,height:J}},getImageSize:function(){return{width:A,
height:z}},copyImageDataLayerToScreen:function(){M.drawImage(w,0,0,I,J)},setRepainter:function(a){if(null==y||void 0==y.painterName||null==a||void 0==a.painterName||y.painterName!=a.painterName){if(null!=y&&void 0!=y.onRemove)y.onRemove();y=a;if(null!=y&&void 0!=y.onAttach)y.onAttach()}},removeRepainter:function(){if(null!=y&&void 0!=y.onRemove)y.onRemove();y=null}}}();wpd=wpd||{};
wpd.layoutManager=function(){function a(){var a=parseInt(document.body.offsetWidth,10),b=parseInt(document.body.offsetHeight,10);e.style.height=b+"px";f.style.width=a-e.offsetWidth+"px";f.style.height=b+"px";d.style.height=b-44+"px"}function b(b){clearTimeout(c);c=setTimeout(a,80)}var c,d,e,f;return{initialLayout:function(){d=document.getElementById("graphicsContainer");e=document.getElementById("sidebarContainer");f=document.getElementById("mainContainer");a();window.addEventListener("resize",b,
!1)},getGraphicsViewportSize:function(){return{width:d.offsetWidth,height:d.offsetHeight}}}}();wpd=wpd||{};
wpd.popup=function(){return{show:function(a){document.getElementById("shadow").style.visibility="visible";a=document.getElementById(a);var b=parseInt(window.innerWidth),c=parseInt(window.innerHeight),d=parseInt(a.offsetWidth),e=parseInt(a.offsetHeight),c=(c-e)/2;a.style.left=(b-d)/2+"px";a.style.top=(60<c?60:c)+"px";a.style.visibility="visible"},close:function(a){document.getElementById("shadow").style.visibility="hidden";document.getElementById(a).style.visibility="hidden"}}}();
wpd.busyNote=function(){return{show:function(){document.getElementById("wait").style.visibility="visible"},close:function(){document.getElementById("wait").style.visibility="hidden"}}}();wpd.messagePopup=function(){return{show:function(a,b){wpd.popup.show("messagePopup");document.getElementById("message-popup-heading").innerHTML=a;document.getElementById("message-popup-text").innerHTML=b},close:function(){wpd.popup.close("messagePopup")}}}();wpd=wpd||{};
wpd.sidebar=function(){function a(){var a=document.getElementsByClassName("sidebar"),c;for(c=0;c<a.length;c++)a[c].style.visibility="hidden"}return{show:function(b){a();document.getElementById(b).style.visibility="visible"},clear:a}}();wpd=wpd||{};wpd.toolbar=function(){function a(){for(ii=0;ii<b.length;ii++)document.getElementById(b[ii]).style.visibility="hidden"}var b=["paintToolbar","colorPickerToolbar"];return{show:function(b){a();document.getElementById(b).style.visibility="visible"},clear:a}}();
wpd=wpd||{};
wpd.webcamCapture=function(){function a(){void 0!=b&&b.stop();wpd.popup.close("webcamCapture")}var b;return{start:function(){if(null==(navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia))wpd.messagePopup.show("Webcam Capture","Your browser does not support webcam capture using HTML5 APIs. A recent version of Google Chrome is recommended.");else{wpd.popup.show("webcamCapture");var a=document.getElementById("webcamVideo");navigator.getUserMedia=navigator.getUserMedia||
navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia;navigator.getUserMedia({video:!0},function(d){b=d;a.src=window.URL.createObjectURL(d)},function(){})}},cancel:function(){a()},capture:function(){var b=document.createElement("canvas"),d=document.getElementById("webcamVideo"),e=b.getContext("2d"),f;b.width=d.videoWidth;b.height=d.videoHeight;e.drawImage(d,0,0);f=e.getImageData(0,0,b.width,b.height);a();wpd.graphicsWidget.runImageOp(function(){return{imageData:f,width:b.width,
height:b.height}})}}}();wpd=wpd||{};
wpd.zoomView=function(){function a(){var a=document.getElementById("zoomCrossHair"),b=a.getContext("2d");a.width=a.width;b.strokeStyle="black"===m?"rgb(0,0,0)":"red"===m?"rgb(255,0,0)":"yellow"===m?"rgb(255,255,0)":"rgb(0,0,0)";b.beginPath();b.moveTo(f/2,0);b.lineTo(f/2,h);b.moveTo(0,h/2);b.lineTo(f,h/2);b.stroke()}var b,c,d,e,f=250,h=250,g,k,m="black";return{initZoom:function(){b=document.getElementById("zoomCanvas");c=b.getContext("2d");d=document.createElement("canvas");e=d.getContext("2d");g=
document.getElementById("mousePosition");k=5;a()},setZoomImage:function(a,h,g,f,m){d.width=f/k;d.height=m/k;e.putImageData(a,0,0);b.width=b.width;c.drawImage(d,h,g,f,m)},setCoords:function(a,b){if(wpd.appData.isAligned()){var c=wpd.appData.getPlotData().axes.pixelToData(a,b);g.innerText=c[0]+", "+c[1]}else g.innerText=a.toFixed(2)+", "+b.toFixed(2)},setZoomRatio:function(a){k=a},getZoomRatio:function(){return k},getSize:function(){return{width:f,height:h}},showSettingsWindow:function(){document.getElementById("zoom-magnification-value").value=
k;document.getElementById("zoom-crosshair-color-value").value=m;wpd.popup.show("zoom-settings-popup")},applySettings:function(){k=document.getElementById("zoom-magnification-value").value;m=document.getElementById("zoom-crosshair-color-value").value;a();wpd.popup.close("zoom-settings-popup")}}}();wpd=wpd||{};
wpd.xyCalibration=function(){function a(a){b=a;wpd.popup.show("xyAlignment")}var b;return{start:function(){b=null;wpd.popup.show("xyAxesInfo")},pickCorners:function(){wpd.popup.close("xyAxesInfo");var b=new wpd.AxesCornersTool(4,2);wpd.graphicsWidget.setTool(b);b.onComplete=a},align:function(){var a=parseFloat(document.getElementById("xmin").value),d=parseFloat(document.getElementById("xmax").value),e=parseFloat(document.getElementById("ymin").value),f=parseFloat(document.getElementById("ymax").value),
h=document.getElementById("xlog").value,g=document.getElementById("ylog").value,k=new wpd.XYAxes;b.setDataAt(0,a,e);b.setDataAt(1,d,e);b.setDataAt(2,a,e);b.setDataAt(3,d,f);k.calibrate(b,h,g);wpd.appData.getPlotData().axes=k;wpd.appData.isAligned(!0);wpd.popup.close("xyAlignment");b=null;wpd.alignAxes.alignmentCompleted()}}}();
wpd.polarCalibration=function(){function a(a){b=a;wpd.popup.show("polarAlignment")}var b;return{start:function(){b=null;wpd.popup.show("polarAxesInfo")},pickCorners:function(){wpd.popup.close("polarAxesInfo");var b=new wpd.AxesCornersTool(3,2);wpd.graphicsWidget.setTool(b);b.onComplete=a},align:function(){var a=parseFloat(document.getElementById("rpoint1").value),d=parseFloat(document.getElementById("thetapoint1").value),e=parseFloat(document.getElementById("rpoint2").value),f=parseFloat(document.getElementById("thetapoint2").value),
h=document.getElementById("degrees").checked;document.getElementById("radians");var g=document.getElementById("clockwise").checked,k=new wpd.PolarAxes;b.setDataAt(1,a,d);b.setDataAt(2,e,f);k.calibrate(b,h,g);wpd.appData.getPlotData().axes=k;wpd.appData.isAligned(!0);wpd.popup.close("polarAlignment");b=null;wpd.alignAxes.alignmentCompleted()}}}();
wpd.ternaryCalibration=function(){function a(a){b=a;wpd.popup.show("ternaryAlignment")}var b;return{start:function(){b=null;wpd.popup.show("ternaryAxesInfo")},pickCorners:function(){wpd.popup.close("ternaryAxesInfo");var b=new wpd.AxesCornersTool(3,3);wpd.graphicsWidget.setTool(b);b.onComplete=a},align:function(){document.getElementById("range0to1");var a=document.getElementById("range0to100").checked,d=document.getElementById("ternarynormal").checked,e=new wpd.TernaryAxes;e.calibrate(b,a,d);wpd.appData.getPlotData().axes=
e;wpd.appData.isAligned(!0);wpd.popup.close("ternaryAlignment");b=null;wpd.alignAxes.alignmentCompleted()}}}();
wpd.mapCalibration=function(){function a(a){b=a;wpd.popup.show("mapAlignment")}var b;return{start:function(){b=null;wpd.popup.show("mapAxesInfo")},pickCorners:function(){wpd.popup.close("mapAxesInfo");var b=new wpd.AxesCornersTool(2,2);wpd.graphicsWidget.setTool(b);b.onComplete=a},align:function(){var a=parseFloat(document.getElementById("scaleLength").value),d=new wpd.MapAxes;d.calibrate(b,a);wpd.appData.getPlotData().axes=d;wpd.appData.isAligned(!0);wpd.popup.close("mapAlignment");b=null;wpd.alignAxes.alignmentCompleted()}}}();
wpd.AxesCornersTool=function(){return function(a,b){var c=[],d=wpd.graphicsWidget.getAllContexts(),e=new wpd.Calibration(b);wpd.graphicsWidget.resetData();this.onMouseClick=function(b,h,g){var k=c.length;c[k]=g.x;c[k+1]=g.y;d.dataCtx.beginPath();d.dataCtx.fillStyle="rgb(200,0,0)";d.dataCtx.arc(h.x,h.y,3,0,2*Math.PI,!0);d.dataCtx.fill();d.oriDataCtx.beginPath();d.oriDataCtx.fillStyle="rgb(200,0,0)";d.oriDataCtx.arc(g.x,g.y,3,0,2*Math.PI,!0);d.oriDataCtx.fill();e.addPoint(g.x,g.y,0,0);k/2+1===a&&(wpd.graphicsWidget.removeTool(),
wpd.graphicsWidget.resetData(),this.onComplete(e));wpd.graphicsWidget.updateZoomOnEvent(b)};this.onRedraw=function(){for(var a=0;a<c.length;a+=2){var b=wpd.graphicsWidget.screenPx(c[a],c[a+1]);d.dataCtx.beginPath();d.dataCtx.fillStyle="rgb(200,0,0)";d.dataCtx.arc(b.x,b.y,3,0,2*Math.PI,!0);d.dataCtx.fill()}};this.onComplete=function(a){}}}();
wpd.alignAxes=function(){return{initiate:function(){xyEl=document.getElementById("r_xy");polarEl=document.getElementById("r_polar");ternaryEl=document.getElementById("r_ternary");mapEl=document.getElementById("r_map");imageEl=document.getElementById("r_image");wpd.popup.close("axesList");if(!0===xyEl.checked)wpd.xyCalibration.start();else if(!0===polarEl.checked)wpd.polarCalibration.start();else if(!0===ternaryEl.checked)wpd.ternaryCalibration.start();else if(!0===mapEl.checked)wpd.mapCalibration.start();
else if(!0===imageEl.checked){var a=new wpd.ImageAxes;a.calibrate();wpd.appData.getPlotData().axes=a;wpd.appData.isAligned(!0)}},alignmentCompleted:function(){wpd.acquireData.showSidebar()}}}();wpd=wpd||{};wpd.autoExtraction=function(){return{start:function(){wpd.sidebar.show("auto-extraction-sidebar");wpd.colorPicker.init()},changeAlgorithm:function(){},runAlgo:function(){},done:function(){}}}();wpd=wpd||{};
wpd.colorPicker=function(){function a(){var a=document.getElementById("color-button"),b=document.getElementById("color-distance-value"),c=wpd.appData.getPlotData().getAutoDetector(),d=document.getElementById("color-detection-mode-select"),k;k="fg"===c.colorDetectionMode?c.fgColor:c.bgColor;color_distance=c.colorDistance;a.style.backgroundColor="rgb("+k[0]+","+k[1]+","+k[2]+")";b.value=color_distance;d.value=c.colorDetectionMode}function b(){var a=wpd.appData.getPlotData().getAutoDetector().fgColor;
document.getElementById("color_red_fg").value=a[0];document.getElementById("color_green_fg").value=a[1];document.getElementById("color_blue_fg").value=a[2];wpd.popup.show("colorPickerFG")}function c(){var a=wpd.appData.getPlotData().getAutoDetector().bgColor;document.getElementById("color_red_bg").value=a[0];document.getElementById("color_green_bg").value=a[1];document.getElementById("color_blue_bg").value=a[2];wpd.popup.show("colorPickerBG")}function d(){var a=wpd.graphicsWidget.getAllContexts(),
b=wpd.appData.getPlotData().getAutoDetector(),c=wpd.graphicsWidget.getImageSize(),d,k,m;m=a.oriDataCtx.getImageData(0,0,c.width,c.height);b.generateBinaryData();if(null!=b.mask&&0!==b.mask.length){for(d=0;d<b.mask.length;d++)k=b.mask[d],!0===b.binaryData[k]?(parseInt(k/c.width,10),m.data[4*k]=255,m.data[4*k+1]=255,m.data[4*k+2]=0,m.data[4*k+3]=255):(m.data[4*k]=0,m.data[4*k+1]=0,m.data[4*k+2]=0,m.data[4*k+3]=150);a.oriDataCtx.putImageData(m,0,0);wpd.graphicsWidget.copyImageDataLayerToScreen()}}return{startPicker:function(){wpd.graphicsWidget.removeTool();
wpd.graphicsWidget.removeRepainter();wpd.graphicsWidget.resetData();"fg"===wpd.appData.getPlotData().getAutoDetector().colorDetectionMode?b():c()},changeDetectionMode:function(){var b=document.getElementById("color-detection-mode-select");wpd.appData.getPlotData().getAutoDetector().colorDetectionMode=b.value;a()},pickFGColor:function(a){wpd.popup.close("colorPickerFG");a=new wpd.ColorPickerTool;a.onComplete=function(a){wpd.appData.getPlotData().getAutoDetector().fgColor=a;wpd.graphicsWidget.removeTool();
b()};wpd.graphicsWidget.setTool(a)},pickBGColor:function(a){wpd.popup.close("colorPickerBG");a=new wpd.ColorPickerTool;a.onComplete=function(a){wpd.appData.getPlotData().getAutoDetector().bgColor=a;wpd.graphicsWidget.removeTool();c()};wpd.graphicsWidget.setTool(a)},setFGColor:function(){var b=[];b[0]=parseInt(document.getElementById("color_red_fg").value,10);b[1]=parseInt(document.getElementById("color_green_fg").value,10);b[2]=parseInt(document.getElementById("color_blue_fg").value,10);wpd.appData.getPlotData().getAutoDetector().fgColor=
b;wpd.popup.close("colorPickerFG");a()},setBGColor:function(){var b=[];b[0]=parseInt(document.getElementById("color_red_bg").value,10);b[1]=parseInt(document.getElementById("color_green_bg").value,10);b[2]=parseInt(document.getElementById("color_blue_bg").value,10);wpd.appData.getPlotData().getAutoDetector().bgColor=b;wpd.popup.close("colorPickerBG");a()},changeColorDistance:function(){var a=parseFloat(document.getElementById("color-distance-value").value);wpd.appData.getPlotData().getAutoDetector().colorDistance=
a},init:a,testColorDetection:function(){wpd.graphicsWidget.removeTool();wpd.graphicsWidget.resetData();wpd.graphicsWidget.setRepainter(new wpd.ColorFilterRepainter);d()},paintFilteredColor:d}}();wpd.ColorPickerTool=function(){return function(){var a=wpd.graphicsWidget.getAllContexts();this.onMouseClick=function(b,c,d){b=a.oriImageCtx.getImageData(d.x,d.y,1,1);this.onComplete([b.data[0],b.data[1],b.data[2]])};this.onComplete=function(a){}}}();
wpd.ColorFilterRepainter=function(){return function(){this.painterName="colorFilterRepainter";this.onRedraw=function(){wpd.colorPicker.paintFilteredColor()}}}();wpd=wpd||{};wpd.distanceMeasurement=function(){return{start:function(){},selectPairs:function(){},adjustPoints:function(){},viewData:function(){},saveImage:function(){}}}();
var imageOps=function(){return{hflip:function(a,b,c){var d,e,f,h,g,k;for(d=0;d<c;d++)for(e=0;e<b/2;e++)for(f=4*(d*b+e),h=4*((d+1)*b-(e+1)),k=0;4>k;k++)g=a.data[f+k],a.data[f+k]=a.data[h+k],a.data[h+k]=g;return{imageData:a,width:b,height:c}},vflip:function(a,b,c){var d,e,f,h,g,k;for(d=0;d<c/2;d++)for(e=0;e<b;e++)for(f=4*(d*b+e),h=4*((c-(d+2))*b+e),k=0;4>k;k++)g=a.data[f+k],a.data[f+k]=a.data[h+k],a.data[h+k]=g;return{imageData:a,width:b,height:c}}}}(),cropStatus=0,cropCoordinates=[0,0,0,0];
function hflip(){processingNote(!0);wpd.graphicsWidget.runImageOp(imageOps.hflip);processingNote(!1)}function vflip(){processingNote(!0);wpd.graphicsWidget.runImageOp(imageOps.vflip);processingNote(!1)}function cropPlot(){redrawCanvas();canvasMouseEvents.removeAll();canvasMouseEvents.add("mousedown",cropMousedown,!0);canvasMouseEvents.add("mouseup",cropMouseup,!0);canvasMouseEvents.add("mousemove",cropMousemove,!0)}
function cropMousedown(a){a=getPosition(a);var b=a.y;cropCoordinates[0]=a.x;cropCoordinates[1]=b;cropStatus=1}
function cropMouseup(a){a=getPosition(a);var b=a.y;cropCoordinates[2]=a.x;cropCoordinates[3]=b;cropStatus=0;hoverCanvas.width=hoverCanvas.width;cropWidth=cropCoordinates[2]-cropCoordinates[0];cropHeight=cropCoordinates[3]-cropCoordinates[1];if(0<cropWidth&&0<cropHeight){a=document.createElement("canvas");b=a.getContext("2d");a.width=cropWidth;a.height=cropHeight;var c=ctx.getImageData(cropCoordinates[0],cropCoordinates[1],cropWidth,cropHeight);b.putImageData(c,0,0);cropSrc=a.toDataURL();cropImg=new Image;
cropImg.src=cropSrc;cropImg.onload=function(){loadImage(cropImg)}}}function cropMousemove(a){var b=getPosition(a);a=b.x;b=b.y;1==cropStatus&&(hoverCanvas.width=hoverCanvas.width,hoverCtx.strokeStyle="rgb(0,0,0)",hoverCtx.strokeRect(cropCoordinates[0],cropCoordinates[1],a-cropCoordinates[0],b-cropCoordinates[1]))}function restoreOriginalImage(){loadImage(originalImage)}function rotateCanvas(){}wpd=wpd||{};
wpd.acquireData=function(){return{load:function(){wpd.appData.isAligned()?(wpd.sidebar.show("acquireDataSidebar"),wpd.graphicsWidget.removeTool(),wpd.graphicsWidget.setRepainter(new wpd.DataPointsRepainter)):wpd.messagePopup.show("Acquire Data","Please calibrate the axes before acquiring data.")},manualSelection:function(){var a=new wpd.ManualSelectionTool;wpd.graphicsWidget.setTool(a)},deletePoint:function(){var a=new wpd.DeleteDataPointTool;wpd.graphicsWidget.setTool(a)},clearAll:function(){wpd.appData.getPlotData().getActiveDataSeries().clearAll();
wpd.graphicsWidget.removeTool();wpd.graphicsWidget.resetData();wpd.dataPointCounter.setCount()},undo:function(){wpd.appData.getPlotData().getActiveDataSeries().removeLastPixel();wpd.graphicsWidget.resetData();redrawData();wpd.dataPointCounter.setCount()},showSidebar:function(){wpd.sidebar.show("acquireDataSidebar")}}}();
wpd.ManualSelectionTool=function(){return function(){var a=wpd.graphicsWidget.getAllContexts(),b=wpd.appData.getPlotData();this.onAttach=function(){document.getElementById("manual-select-button").classList.add("pressed-button");wpd.graphicsWidget.setRepainter(new wpd.DataPointsRepainter)};this.onMouseClick=function(c,d,e){b.getActiveDataSeries().addPixel(e.x,e.y);a.dataCtx.beginPath();a.dataCtx.fillStyle="rgb(200,0,0)";a.dataCtx.arc(d.x,d.y,3,0,2*Math.PI,!0);a.dataCtx.fill();a.oriDataCtx.beginPath();
a.oriDataCtx.fillStyle="rgb(200,0,0)";a.oriDataCtx.arc(e.x,e.y,3,0,2*Math.PI,!0);a.oriDataCtx.fill();wpd.graphicsWidget.updateZoomOnEvent(c);wpd.dataPointCounter.setCount()};this.onRemove=function(){document.getElementById("manual-select-button").classList.remove("pressed-button")}}}();
wpd.DeleteDataPointTool=function(){return function(){wpd.graphicsWidget.getAllContexts();var a=wpd.appData.getPlotData();this.onAttach=function(){document.getElementById("delete-point-button").classList.add("pressed-button");wpd.graphicsWidget.setRepainter(new wpd.DataPointsRepainter)};this.onMouseClick=function(b,c,d){a.getActiveDataSeries().removeNearestPixel(d.x,d.y);wpd.graphicsWidget.resetData();wpd.acquireData.redrawData();wpd.graphicsWidget.updateZoomOnEvent(b);wpd.dataPointCounter.setCount()};
this.onRemove=function(){document.getElementById("delete-point-button").classList.remove("pressed-button")}}}();
wpd.DataPointsRepainter=function(){return function(){var a=function(){var a=wpd.graphicsWidget.getAllContexts(),c=wpd.appData.getPlotData().getActiveDataSeries(),d,e,f;for(d=0;d<c.getCount();d++)e=c.getPixel(d),f=wpd.graphicsWidget.screenPx(e.x,e.y),a.dataCtx.beginPath(),a.dataCtx.fillStyle="rgb(200,0,0)",a.dataCtx.arc(f.x,f.y,3,0,2*Math.PI,!0),a.dataCtx.fill(),a.oriDataCtx.beginPath(),a.oriDataCtx.fillStyle="rgb(200,0,0)",a.oriDataCtx.arc(e.x,e.y,3,0,2*Math.PI,!0),a.oriDataCtx.fill()};this.painterName=
"dataPointsRepainter";this.onAttach=function(){wpd.graphicsWidget.resetData();a()};this.onRedraw=function(){a()}}}();wpd.dataPointCounter=function(){var a;return{setCount:function(){null==a&&(a=document.getElementById("pointsStatus"));a.innerHTML=wpd.appData.getPlotData().getActiveDataSeries().getCount()}}}();wpd=wpd||{};
wpd.dataMask=function(){return{grabMask:function(a){var b=wpd.graphicsWidget.getAllContexts(),c=wpd.graphicsWidget.getImageSize(),d=b.oriDataCtx.getImageData(0,0,c.width,c.height),e=[],f,h=0;for(f=0;f<d.data.length;f+=4)255===d.data[f]&&255===d.data[f+1]&&0===d.data[f+2]&&(e[h]=f/4,h++);wpd.appData.getPlotData().getAutoDetector().mask=e;!0===a&&(wpd.appData.getPlotData().getAutoDetector().imageData=b.oriImageCtx.getImageData(0,0,c.width,c.height))},drawMask:function(){var a=wpd.appData.getPlotData().getAutoDetector().mask;
if(null!=a&&0!==a.length){var b,c,d=wpd.graphicsWidget.getAllContexts(),e=wpd.graphicsWidget.getImageSize(),f=d.oriDataCtx.getImageData(0,0,e.width,e.height);for(b=0;b<a.length;b++)c=a[b],parseInt(c/e.height,10),f.data[4*c]=255,f.data[4*c+1]=255,f.data[4*c+2]=0,f.data[4*c+3]=200;d.oriDataCtx.putImageData(f,0,0,e.width,e.height);wpd.graphicsWidget.copyImageDataLayerToScreen()}},markBox:function(){var a=new wpd.BoxMaskTool;wpd.graphicsWidget.setTool(a)},markPen:function(){var a=new wpd.PenMaskTool;
wpd.graphicsWidget.setTool(a)},eraseMarks:function(){var a=new wpd.EraseMaskTool;wpd.graphicsWidget.setTool(a)},viewMask:function(){var a=new wpd.ViewMaskTool;wpd.graphicsWidget.setTool(a)}}}();
wpd.BoxMaskTool=function(){return function(){var a=!1,b,c,d=wpd.graphicsWidget.getAllContexts(),e,f,h=function(){wpd.graphicsWidget.resetHover();d.hoverCtx.strokeStyle="rgb(0,0,0)";d.hoverCtx.strokeRect(c.x,c.y,f.x-c.x,f.y-c.y)};this.onAttach=function(){wpd.graphicsWidget.setRepainter(new wpd.MaskPainter);document.getElementById("box-mask").classList.add("pressed-button");document.getElementById("view-mask").classList.add("pressed-button")};this.onMouseDown=function(d,e,h){!0!==a&&(a=!0,b=h,c=e)};
this.onMouseMove=function(b,c,d){!1!==a&&(f=c,clearTimeout(e),e=setTimeout(h,5))};this.onMouseOut=function(){!0===a&&(clearTimeout(e),a=!1,wpd.graphicsWidget.resetHover())};this.onMouseUp=function(h,k,f){!1!==a&&(clearTimeout(e),a=!1,wpd.graphicsWidget.resetHover(),d.dataCtx.fillStyle="rgba(255,255,0,0.8)",d.dataCtx.fillRect(c.x,c.y,k.x-c.x,k.y-c.y),d.oriDataCtx.fillStyle="rgba(255,255,0,0.8)",d.oriDataCtx.fillRect(b.x,b.y,f.x-b.x,f.y-b.y))};this.onRemove=function(){document.getElementById("box-mask").classList.remove("pressed-button");
document.getElementById("view-mask").classList.remove("pressed-button");wpd.dataMask.grabMask(!0)}}}();
wpd.PenMaskTool=function(){return function(){var a=wpd.graphicsWidget.getAllContexts(),b=!1,c,d,e,f=function(){a.dataCtx.strokeStyle="rgba(255,255,0,0.8)";a.dataCtx.lineTo(d.x,d.y);a.dataCtx.stroke();a.oriDataCtx.strokeStyle="rgba(255,255,0,0.8)";a.oriDataCtx.lineTo(e.x,e.y);a.oriDataCtx.stroke()};this.onAttach=function(){wpd.graphicsWidget.setRepainter(new wpd.MaskPainter);document.getElementById("pen-mask").classList.add("pressed-button");document.getElementById("view-mask").classList.add("pressed-button")};
this.onMouseDown=function(c,d,e){!0!==b&&(b=!0,a.dataCtx.strokeStyle="rgba(255,255,0,0.8)",a.dataCtx.lineWidth=20,a.dataCtx.beginPath(),a.dataCtx.moveTo(d.x,d.y),a.oriDataCtx.strokeStyle="rgba(255,255,0,0.8)",a.oriDataCtx.lineWidth=20,a.oriDataCtx.beginPath(),a.oriDataCtx.moveTo(e.x,e.y))};this.onMouseMove=function(a,g,k){!1!==b&&(d=g,e=k,clearTimeout(c),c=setTimeout(f,5))};this.onMouseUp=function(d,e,k){clearTimeout(c);a.dataCtx.closePath();a.dataCtx.lineWidth=1;a.oriDataCtx.closePath();a.oriDataCtx.lineWidth=
1;b=!1};this.onMouseOut=function(a,b,c){this.onMouseUp(a,b,c)};this.onRemove=function(){document.getElementById("pen-mask").classList.remove("pressed-button");document.getElementById("view-mask").classList.remove("pressed-button");wpd.dataMask.grabMask(!0)}}}();
wpd.EraseMaskTool=function(){return function(){var a=wpd.graphicsWidget.getAllContexts(),b=!1,c,d,e,f=function(){a.dataCtx.globalCompositeOperation="destination-out";a.oriDataCtx.globalCompositeOperation="destination-out";a.dataCtx.strokeStyle="rgba(255,255,0,1)";a.dataCtx.lineTo(d.x,d.y);a.dataCtx.stroke();a.oriDataCtx.strokeStyle="rgba(255,255,0,1)";a.oriDataCtx.lineTo(e.x,e.y);a.oriDataCtx.stroke()};this.onAttach=function(){wpd.graphicsWidget.setRepainter(new wpd.MaskPainter);document.getElementById("erase-mask").classList.add("pressed-button");
document.getElementById("view-mask").classList.add("pressed-button")};this.onMouseDown=function(c,d,e){!0!==b&&(b=!0,a.dataCtx.globalCompositeOperation="destination-out",a.oriDataCtx.globalCompositeOperation="destination-out",a.dataCtx.strokeStyle="rgba(0,0,0,1)",a.dataCtx.lineWidth=20,a.dataCtx.beginPath(),a.dataCtx.moveTo(d.x,d.y),a.oriDataCtx.strokeStyle="rgba(0,0,0,1)",a.oriDataCtx.lineWidth=20,a.oriDataCtx.beginPath(),a.oriDataCtx.moveTo(e.x,e.y))};this.onMouseMove=function(a,g,k){!1!==b&&(d=
g,e=k,clearTimeout(c),c=setTimeout(f,5))};this.onMouseOut=function(a,b,c){this.onMouseUp(a,b,c)};this.onMouseUp=function(d,e,k){clearTimeout(c);a.dataCtx.closePath();a.dataCtx.lineWidth=1;a.oriDataCtx.closePath();a.oriDataCtx.lineWidth=1;a.dataCtx.globalCompositeOperation="source-over";a.oriDataCtx.globalCompositeOperation="source-over";b=!1};this.onRemove=function(){document.getElementById("erase-mask").classList.remove("pressed-button");document.getElementById("view-mask").classList.remove("pressed-button");
wpd.dataMask.grabMask(!0)}}}();wpd.ViewMaskTool=function(){return function(){this.onAttach=function(){wpd.graphicsWidget.setRepainter(new wpd.MaskPainter);document.getElementById("view-mask").classList.add("pressed-button")};this.onRemove=function(){document.getElementById("view-mask").classList.remove("pressed-button");wpd.dataMask.grabMask(!0)}}}();
wpd.MaskPainter=function(){return function(){var a=wpd.graphicsWidget.getAllContexts(),b=wpd.appData.getPlotData().getAutoDetector(),c=function(){if(null!=b.mask&&0!==b.mask.length){var c,e;c=wpd.graphicsWidget.getImageSize();imgData=a.oriDataCtx.getImageData(0,0,c.width,c.height);for(c=0;c<b.mask.length;c++)e=b.mask[c],imgData.data[4*e]=255,imgData.data[4*e+1]=255,imgData.data[4*e+2]=0,imgData.data[4*e+3]=200;a.oriDataCtx.putImageData(imgData,0,0);wpd.graphicsWidget.copyImageDataLayerToScreen()}};
this.painterName="dataMaskPainter";this.onRedraw=function(){wpd.dataMask.grabMask(!0);c()};this.onAttach=function(){wpd.graphicsWidget.resetData();c()}}}();wpd=wpd||{};
wpd.dataTable=function(){function a(){b=wpd.appData.getPlotData().getDataFromActiveSeries();console.log(b)}var b,c,d;return{getSeriesData:a,showTable:function(){if(wpd.appData.isAligned()&&(wpd.popup.show("csvWindow"),a(),c=b,null!=b&&0!==b.length)){var e=wpd.appData.getPlotData().axes.getDimensions(),f=b.length,h,g,k,m=document.getElementById("digitizedDataTable");d="";for(h=0;h<f;h++){k=[];for(g=0;g<e;g++)k[g]=c[h][g];d+=k.join(", ");d+="\n"}m.value=d}},updateSortingControls:function(){},reSort:function(){},
selectAll:function(){var a=document.getElementById("digitizedDataTable");a.focus();a.select()},generateCSV:function(){var a,b,c,g=JSON.stringify(d);a=document.createElement("div");b=document.createElement("form");c=document.createElement("input");b.setAttribute("method","post");b.setAttribute("action","php/csvexport.php");c.setAttribute("type","text");c.setAttribute("name","data");b.appendChild(c);a.appendChild(b);document.body.appendChild(a);a.style.display="none";c.setAttribute("value",g);b.submit();
document.body.removeChild(a)},exportToPlotly:function(){}}}();
wpd.CSVExport=function(){function a(){var a=document.getElementById("dataSortOption"),b=document.getElementById("dataSortOrder");"NearestNeighbor"===a.value||"raw"===a.value?b.setAttribute("disabled",!0):b.removeAttribute("disabled");d()}function b(a){var b=document.getElementById("tarea");b.value="";if("XY"===plotType||"map"===plotType||"polar"===plotType||"image"===plotType)for(var d=0;d<pointsPicked;d++)b.value=b.value+c(a[d][0],"X")+","+c(a[d][1],"Y")+"\n";else if("ternary"===plotType)for(d=0;d<
pointsPicked;d++)b.value=b.value+a[d][0]+","+a[d][1]+","+a[d][2]+"\n";f=a}function c(a,b){if("XY"===plotType){if("X"===b&&axesAlignmentData[6]){var c=document.getElementById("xDateFormat");return dateConverter.formatDate(dateConverter.fromJD(a),c.value)}if("Y"===b&&axesAlignmentData[7])return c=document.getElementById("yDateFormat"),dateConverter.formatDate(dateConverter.fromJD(a),c.value)}return a}function d(){var a=document.getElementById("dataSortOption"),c="ascending"===document.getElementById("dataSortOrder").value,
d="raw"==a.value,f="NearestNeighbor"===a.value,n,l=e.slice(0),r="ternary"===plotType?3:2;if(d)b(l);else if(!f)n=parseInt(a.value,10),0>n||3<=n||(l.sort(function(a,b){return a[n]>b[n]?c?1:-1:a[n]<b[n]?c?-1:1:0}),b(l));else if(f){for(var q,f=[1,1,1],p=0;p<pointsPicked-1;p++){for(var d=-1,s=p+1;s<pointsPicked;s++)if(a=(l[p][0]-l[s][0])*(l[p][0]-l[s][0])+(l[p][1]-l[s][1])*(l[p][1]-l[s][1]),3===r&&(a+=(l[p][2]-l[s][2])*(l[p][2]-l[s][2])),a<q||-1===d)q=a,d=s;f[0]=l[d][0];l[d][0]=l[p+1][0];l[p+1][0]=f[0];
f[1]=l[d][1];l[d][1]=l[p+1][1];l[p+1][1]=f[1];3===r&&(f[2]=l[d][2],l[d][2]=l[p+1][2],l[p+1][2]=f[2])}b(l)}}var e,f=[];return{generate:function(){if(1===axesPicked&&1<=pointsPicked){wpd.popup.show("csvWindow");e=pixelToData(xyData,pointsPicked,plotType);document.getElementById("dataSortOrder");var c=document.getElementById("dataSortOption"),d=document.getElementById("dataVariables");c.innerHTML='<option value="raw">Raw Output</option>';"XY"===plotType||"map"===plotType||"image"===plotType?(c.innerHTML+=
'<option value="0">x</option>',c.innerHTML+='<option value="1">y</option>',d.innerHTML="x, y"):"ternary"===plotType?(c.innerHTML+='<option value="0">a</option>',c.innerHTML+='<option value="1">b</option>',c.innerHTML+='<option value="2">c</option>',d.innerHTML="a, b, c"):"polar"===plotType&&(c.innerHTML+='<option value="0">r</option>',c.innerHTML+='<option value="1">\u0398</option>',d.innerHTML="r, \u0398");c.innerHTML+='<option value="NearestNeighbor">Nearest Neighbor</option>';a();c=document.getElementById("csvDateFormatting");
if("XY"===plotType)if(!0===axesAlignmentData[6]||!0===axesAlignmentData[7]){c.style.display="inline-block";var c=document.getElementById("csvDateFormattingX"),d=document.getElementById("csvDateFormattingY"),f=document.getElementById("xDateFormat");document.getElementById("yDateFormat");axesAlignmentData[6]?(c.style.display="inline-block",f.value=axesAlignmentData[8]):c.style.display="none";axesAlignmentData[7]?(d.style.display="inline-block",yDateFormat.value=axesAlignmentData[9]):d.style.display=
"none"}else c.style.display="none";else c.style.display="none";b(e)}},reSort:d,updateSortingControls:a,selectAll:function(){var a=document.getElementById("tarea");a.focus();a.select()},getDisplayData:function(){return f}}}();wpd=wpd||{};
wpd.plotly=function(){function a(a,c){return"XY"===plotType&&("X"===c&&axesAlignmentData[6]||"Y"===c&&axesAlignmentData[7])?dateConverter.formatDate(dateConverter.fromJD(a),"yyyy-mm-dd"):a}return{exportData:function(){if(0!==pointsPicked){var b=document.createElement("div"),c=document.createElement("form"),d=document.createElement("input");c.setAttribute("method","post");c.setAttribute("action","https://plot.ly/external");c.setAttribute("target","_blank");d.setAttribute("type","text");d.setAttribute("name",
"data");c.appendChild(d);b.appendChild(c);document.body.appendChild(b);b.style.display="none";var e=[],f=[],h=[],g={data:[]},k=wpd.CSVExport.getDisplayData();if("XY"===plotType||"map"===plotType||"polar"===plotType||"image"===plotType){for(var m=0;m<pointsPicked;m++)e[m]=a(k[m][0],"X"),f[m]=a(k[m][1],"Y");g.data[0]={x:e,y:f}}else if("ternary"===plotType){for(m=0;m<pointsPicked;m++)e[m]=k[m][0],f[m]=k[m][1],h[m]=k[m][2];g.data[0]={x:e,y:f,z:h}}d.setAttribute("value",JSON.stringify(g));c.submit();document.body.removeChild(b)}}}}();
wpd=wpd||{};wpd.scriptInjector=function(){return{start:function(){wpd.popup.show("runScriptPopup")},cancel:function(){wpd.popup.close("runScriptPopup")},load:function(){var a=document.getElementById("runScriptFileInput");wpd.popup.close("runScriptPopup");if(1==a.files.length){var b=new FileReader;b.onload=function(){eval(b.result);wpdscript.run();window.wpdscript=wpdscript};b.readAsText(a.files[0])}}}}();
window.addEventListener("load",function(a){window.applicationCache.addEventListener("updateready",function(a){window.applicationCache.status==window.applicationCache.UPDATEREADY&&confirm("A new version of WebPlotDigitizer is available. Update?")&&window.location.reload()},!1)},!1);wpd=wpd||{};wpd.browserInfo=function(){return{checkBrowser:function(){window.FileReader||alert("\tWARNING!\nYour web browser is not supported. This program might not behave as intended. Please use a recent version of Google Chrome, Firefox or Safari browser.")}}}();
