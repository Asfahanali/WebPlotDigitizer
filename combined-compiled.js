var wpd=wpd||{};wpd.initApp=function(){wpd.browserInfo.checkBrowser();wpd.layoutManager.initialLayout();wpd.graphicsWidget.loadImageFromURL("start.png");document.getElementById("loadingCurtain").style.display="none";wpd.messagePopup.show("Unstable Version Warning!","You are using a beta version of WebPlotDigitizer. There may be some issues with the software that are expected.")};document.addEventListener("DOMContentLoaded",wpd.initApp,!0);wpd=wpd||{};
wpd.detectionAlgoManager=function(){return{setActiveAlgo:function(b){},getActiveAlgo:function(){return null},getAllApplicableAlgorithms:function(){}}}();wpd=wpd||{};wpd.appData=function(){function b(){null==c&&(c=new wpd.PlotData);return c}var a=!1,c;return{isAligned:function(c){null!=c&&(a=c);return a},getPlotData:b,reset:function(){a=!1;c=null},plotLoaded:function(a){b().topColors=wpd.colorAnalyzer.getTopColors(a)}}}();wpd=wpd||{};
wpd.AutoDetector=function(){return function(){this.fgColor=[0,0,200];this.bgColor=[255,255,255];this.mask=null;this.gridMask={xmin:null,xmax:null,ymin:null,ymax:null,pixels:[]};this.gridLineColor=[150,150,150];this.gridColorDistance=150;this.gridData=null;this.colorDetectionMode="fg";this.colorDistance=120;this.imageData=this.gridBinaryData=this.binaryData=this.algorithm=null;this.imageHeight=this.imageWidth=0;this.reset=function(){this.gridData=this.imageData=this.binaryData=this.mask=null;this.gridMask=
{xmin:null,xmax:null,ymin:null,ymax:null,pixels:[]}};this.generateBinaryDataFromMask=function(){var b,a,c,d="fg"===this.colorDetectionMode?this.fgColor:this.bgColor;for(b=0;b<this.mask.length;b++)a=this.mask[b],c=Math.sqrt((this.imageData.data[4*a]-d[0])*(this.imageData.data[4*a]-d[0])+(this.imageData.data[4*a+1]-d[1])*(this.imageData.data[4*a+1]-d[1])+(this.imageData.data[4*a+2]-d[2])*(this.imageData.data[4*a+2]-d[2])),"fg"===this.colorDetectionMode?c<=this.colorDistance&&(this.binaryData[a]=!0):
c>=this.colorDistance&&(this.binaryData[a]=!0)};this.generateBinaryDataUsingFullImage=function(){var b,a,c="fg"===this.colorDetectionMode?this.fgColor:this.bgColor;for(a=0;a<this.imageData.data.length/4;a++)b=Math.sqrt((this.imageData.data[4*a]-c[0])*(this.imageData.data[4*a]-c[0])+(this.imageData.data[4*a+1]-c[1])*(this.imageData.data[4*a+1]-c[1])+(this.imageData.data[4*a+2]-c[2])*(this.imageData.data[4*a+2]-c[2])),"fg"===this.colorDetectionMode?b<=this.colorDistance&&(this.binaryData[a]=!0):b>=
this.colorDistance&&(this.binaryData[a]=!0)};this.generateBinaryData=function(){this.binaryData=[];null==this.imageData?this.imageWidth=this.imageHeight=0:(this.imageHeight=this.imageData.height,this.imageWidth=this.imageData.width,null==this.mask||0===this.mask.length?this.generateBinaryDataUsingFullImage():this.generateBinaryDataFromMask())};this.generateGridBinaryData=function(){this.gridBinaryData=[];if(null!=this.gridMask.pixels&&0!==this.gridMask.pixels.length)if(null==this.imageData)this.imageHeight=
this.imageWidth=0;else{this.imageWidth=this.imageData.width;this.imageHeight=this.imageData.height;var b,a,c;for(b=0;b<this.gridMask.pixels.length;b++)a=this.gridMask.pixels[b],c=wpd.dist3d(this.gridLineColor[0],this.gridLineColor[1],this.gridLineColor[2],this.imageData.data[4*a],this.imageData.data[4*a+1],this.imageData.data[4*a+2]),c<this.gridColorDistance&&(this.gridBinaryData[a]=!0)}}}}();wpd=wpd||{};
wpd.ColorGroup=function(){return function(b){var a=0,c={r:0,g:0,b:0};b=null==b?100:b;this.getPixelCount=function(){return a};this.getAverageColor=function(){return c};this.isColorInGroup=function(d,e,f){return 0===a?!0:(c.r-d)*(c.r-d)+(c.g-e)*(c.g-e)+(c.b-f)*(c.b-f)<=b*b};this.addPixel=function(d,b,f){c.r=(c.r*a+d)/(a+1);c.g=(c.g*a+b)/(a+1);c.b=(c.b*a+f)/(a+1);a+=1}}}();
wpd.colorAnalyzer=function(){return{getTopColors:function(b){var a=[],c,d,e,f,g,h,l=[];a[0]=new wpd.ColorGroup(120);for(c=0;c<b.data.length;c+=4){d=b.data[c];e=b.data[c+1];f=b.data[c+2];h=!1;for(g=0;g<a.length;g++)if(a[g].isColorInGroup(d,e,f)){a[g].addPixel(d,e,f);h=!0;break}h||(a[a.length]=new wpd.ColorGroup(120),a[a.length-1].addPixel(d,e,f))}a.sort(function(a,c){return a.getPixelCount()>c.getPixelCount()?-1:a.getPixelCount()<c.getPixelCount()?1:0});for(g=0;g<a.length;g++)c=a[g].getAverageColor(),
l[g]={r:parseInt(c.r,10),g:parseInt(c.g,10),b:parseInt(c.b,10),pixels:a[g].getPixelCount(),percentage:100*a[g].getPixelCount()/(0.25*b.data.length)};return l}}}();wpd=wpd||{};wpd.dataEventNames={axesAligned:"axesAligned",imageLoaded:"imageLoaded"};wpd.dataEventManager=function(){return{fireEvent:function(b,a){},subscribe:function(b,a){},unsubscribe:function(b,a){},removeAllSubscriptionsForEvent:function(b){}}}();wpd=wpd||{};
wpd.Calibration=function(){return function(b){var a=[],c=[],d=null==b?2:b,e=[],f=[];this.labels=[];this.getCount=function(){return a.length};this.getDimensions=function(){return d};this.addPoint=function(b,f,l,p,m){var q=a.length,k=e.length;a[q]=b;c[q]=f;e[k]=l;e[k+1]=p;3===d&&(e[k+2]=m)};this.getPoint=function(b){return 0>b||b>=a.length?null:{px:a[b],py:c[b],dx:e[d*b],dy:e[d*b+1],dz:2===d?null:e[d*b+2]}};this.changePointPx=function(b,d,f){0>b||b>=a.length||(a[b]=d,c[b]=f)};this.setDataAt=function(c,
b,f,p){0>c||c>=a.length||(e[d*c]=b,e[d*c+1]=f,3===d&&(e[d*c+2]=p))};this.findNearestPoint=function(b,d,f){f=null==f?50:parseFloat(f);var e,m=-1,q,k;for(q=0;q<a.length;q++)if(k=Math.sqrt((b-a[q])*(b-a[q])+(d-c[q])*(d-c[q])),0>m&&k<=f||0<=m&&k<e)m=q,e=k;return m};this.selectPoint=function(a){0>f.indexOf(a)&&(f[f.length]=a)};this.selectNearestPoint=function(a,c,b){a=this.findNearestPoint(a,c,b);0<=a&&this.selectPoint(a)};this.getSelectedPoints=function(){return f};this.unselectAll=function(){f=[]};this.isPointSelected=
function(a){return 0<=f.indexOf(a)};this.dump=function(){console.log(a);console.log(c);console.log(e)}}}();
wpd.DataSeries=function(){return function(b){var a=[],c=[],d=!1,e=[];this.name="Default Dataset";this.variableNames=["x","y"];this.hasMetadata=function(){return d};this.setMetadataKeys=function(a){e=a};this.getMetadataKeys=function(){return e};this.addPixel=function(c,b,e){a[a.length]={x:c,y:b,metadata:e};null!=e&&(d=!0)};this.getPixel=function(c){return a[c]};this.setPixelAt=function(c,b,d){c<a.length&&(a[c].x=b,a[c].y=d)};this.setMetadataAt=function(c,b){c<a.length&&(a[c].metadata=b)};this.insertPixel=
function(c,b,d,e){a.splice(c,0,{x:b,y:d,metadata:e})};this.removePixelAtIndex=function(c){c<a.length&&a.splice(c,1)};this.removeLastPixel=function(){this.removePixelAtIndex(a.length-1)};this.findNearestPixel=function(c,b,d){d=null==d?50:parseFloat(d);var e,p=-1,m,q;for(m=0;m<a.length;m++)if(q=Math.sqrt((c-a[m].x)*(c-a[m].x)+(b-a[m].y)*(b-a[m].y)),0>p&&q<=d||0<=p&&q<e)p=m,e=q;return p};this.removeNearestPixel=function(a,c,b){a=this.findNearestPixel(a,c,b);0<=a&&this.removePixelAtIndex(a)};this.clearAll=
function(){a=[];d=!1;e=[]};this.getCount=function(){return a.length};this.selectPixel=function(a){0<=c.indexOf(a)||(c[c.length]=a)};this.unselectAll=function(){c=[]};this.selectNearestPixel=function(a,c,b){a=this.findNearestPixel(a,c,b);0<=a&&this.selectPixel(a)};this.getSelectedPixels=function(){return c}}}();
wpd.PlotData=function(){return function(){var b=0,a=new wpd.AutoDetector;this.axes=this.topColors=null;this.dataSeriesColl=[];this.distanceMeasurementData=this.angleMeasurementData=this.gridData=null;this.getActiveDataSeries=function(){null==this.dataSeriesColl[b]&&(this.dataSeriesColl[b]=new wpd.DataSeries);return this.dataSeriesColl[b]};this.getDataSeriesCount=function(){return this.dataSeriesColl.length};this.setActiveDataSeriesIndex=function(a){b=a};this.getActiveDataSeriesIndex=function(){return b};
this.getAutoDetector=function(){return a};this.getDataSeriesNames=function(){for(var a=[],b=0;b<this.dataSeriesColl.length;b++)a[b]=this.dataSeriesColl[b].name;return a};this.getDataFromActiveSeries=function(){var a=this.getActiveDataSeries();if(null==a||null==this.axes)return null;var d,e,f,g=[],h;d=a.hasMetadata();e=a.getMetadataKeys();var l=!0===d?e.length:0;for(d=0;d<a.getCount();d++){e=this.dataSeriesColl[b].getPixel(d);f=this.axes.pixelToData(e.x,e.y);g[d]=[];for(h=0;h<f.length;h++)g[d][h]=
f[h];for(h=0;h<l;h++)g[d][f.length+h]=e.metadata[h]}return g};this.reset=function(){this.distanceMeasurementData=this.angleMeasurementData=this.axes=null;this.dataSeriesColl=[];this.gridData=null;b=0;a=new wpd.AutoDetector}}}();
wpd.ConnectedPoints=function(){return function(b){var a=[],c=-1,d=-1;this.addConnection=function(c){a[a.length]=c};this.clearAll=function(){a=[]};this.getConnectionAt=function(c){if(c<a.length)return a[c]};this.replaceConnectionAt=function(c,b){c<a.length&&(a[c]=b)};this.deleteConnectionAt=function(c){c<a.length&&a.splice(c,1)};this.connectionCount=function(){return a.length};this.getDistance=function(c){if(c<a.length&&2===b)return Math.sqrt((a[c][0]-a[c][2])*(a[c][0]-a[c][2])+(a[c][1]-a[c][3])*(a[c][1]-
a[c][3]))};this.getAngle=function(c){if(c<a.length&&3===b){var d=wpd.taninverse(-(a[c][5]-a[c][3]),a[c][4]-a[c][2]);c=wpd.taninverse(-(a[c][1]-a[c][3]),a[c][0]-a[c][2]);d=180*(d-c)/Math.PI;return d=0>d?d+360:d}};this.findNearestPointAndConnection=function(c,d){var g=-1,h=-1,l,p,m,q;for(m=0;m<a.length;m++)for(q=0;q<2*b;q+=2)if(p=(a[m][q]-c)*(a[m][q]-c)+(a[m][q+1]-d)*(a[m][q+1]-d),-1===h||p<l)g=m,h=q/2,l=p;return{connectionIndex:g,pointIndex:h}};this.selectNearestPoint=function(a,b){var g=this.findNearestPointAndConnection(a,
b);0<=g.connectionIndex&&(c=g.connectionIndex,d=g.pointIndex)};this.deleteNearestConnection=function(a,c){var b=this.findNearestPointAndConnection(a,c);0<=b.connectionIndex&&this.deleteConnectionAt(b.connectionIndex)};this.isPointSelected=function(a,b){return d===b&&c===a?!0:!1};this.getSelectedConnectionAndPoint=function(){return{connectionIndex:c,pointIndex:d}};this.unselectConnectionAndPoint=function(){d=c=-1};this.setPointAt=function(c,b,d,h){a[c][2*b]=d;a[c][2*b+1]=h};this.getPointAt=function(c,
b){return{x:a[c][2*b],y:a[c][2*b+1]}}}}();wpd=wpd||{};
wpd.dateConverter=function(){function b(a,c){var b;b=c.replace("YYYY","yyyy");b=b.replace("YY","yy");b=b.replace("MMMM","mmmm");b=b.replace("MMM","mmm");b=b.replace("MM","mm");b=b.replace("DD","dd");b=b.replace("yyyy",a.getUTCFullYear());var e=a.getUTCFullYear()%100;b=b.replace("yy",10>e?"0"+e:e);b=b.replace("mmmm","January February March April May June July August September October November December".split(" ")[a.getUTCMonth()]);b=b.replace("mmm","Jan Feb Mar Apr May Jun Jul Aug Sep Oct Nov Dec".split(" ")[a.getUTCMonth()]);
b=b.replace("mm",a.getUTCMonth()+1);return b=b.replace("dd",a.getUTCDate())}return{parse:function(a){if(null==a||0>a.indexOf("/"))a=null;else{var c=a.split("/"),b;0>=c.length||3<c.length?a=null:(a=parseInt(c[0],10),b=parseInt(void 0===c[1]?0:c[1],10),date=parseInt(void 0===c[2]?1:c[2],10),isNaN(a)||isNaN(b)||isNaN(date)||12<b||1>b||31<date||1>date?a=null:(c=new Date,c.setUTCFullYear(a),c.setUTCMonth(b-1),c.setUTCDate(date),a=parseFloat(Date.parse(c)),a=isNaN(a)?null:a))}return a},getFormatString:function(a){a=
a.split("/");var c="yyyy/mm/dd";1<=a.length&&(c="yyyy");2<=a.length&&(c+="/mm");3===a.length&&(c+="/dd");return c},formatDate:b,formatDateNumber:function(a,c){var d;d=parseFloat(a);d=parseInt(864E5*Math.round(d/864E5),10);return b(new Date(d),c)}}}();wpd=wpd||{};
wpd.gridDetectionCore=function(){var b,a,c,d;return{run:function(){var e=[],f,g,h,l=wpd.appData.getPlotData().getAutoDetector(),p=l.gridMask.xmin,m=l.gridMask.xmax,q=l.gridMask.ymin,k=l.gridMask.ymax,n,u=l.imageWidth,r,t,s;if(a)for(f=p;f<=m;f+=c){h=[];t=[];r=0;for(n=f-c;n<=f+c;n++)for(g=q;g<=k;g++)s=g*u+parseInt(n,10),!0===l.gridBinaryData[s]&&(h[h.length]=s,!0!==t[g]&&(r++,t[g]=!0));if(r>0.3*(k-q))for(r=0;r<h.length;r++)e[h[r]]=!0}if(b)for(g=q;g<=k;g+=d){h=[];t=[];r=0;for(q=g-d;q<=g+d;q++)for(f=
p;f<=m;f++)s=parseInt(q,10)*u+f,!0===l.gridBinaryData[s]&&(h[h.length]=s,!0!==t[f]&&(r++,t[f]=!0));if(r>0.3*(m-p))for(r=0;r<h.length;r++)e[h[r]]=!0}wpd.appData.getPlotData().gridData=e},setHorizontalParameters:function(a,c,g){b=a;d=c},setVerticalParameters:function(b,d,g){a=b;c=d}}}();wpd=wpd||{};
wpd.InputParser=function(){return function(){this.parse=function(b){this.isDate=this.isValid=!1;this.formatting=null;if(null==b)return null;b=b.trim();if(0<=b.indexOf("^"))return null;var a=wpd.dateConverter.parse(b);if(null!=a)return this.isDate=this.isValid=!0,this.formatting=wpd.dateConverter.getFormatString(b),a;b=parseFloat(b);return isNaN(b)?null:(this.isValid=!0,b)};this.isDate=this.isValid=!1;this.formatting=null}}();wpd=wpd||{};
wpd.taninverse=function(b,a){var c;0<b?c=Math.atan2(b,a):0>=b&&(c=Math.atan2(b,a)+2*Math.PI);c>=2*Math.PI&&(c=0);return c};wpd.sqDist2d=function(b,a,c,d){return(b-c)*(b-c)+(a-d)*(a-d)};wpd.sqDist3d=function(b,a,c,d,e,f){return(b-d)*(b-d)+(a-e)*(a-e)+(c-f)*(c-f)};wpd.dist2d=function(b,a,c,d){return Math.sqrt(wpd.sqDist2d(b,a,c,d))};wpd.dist3d=function(b,a,c,d,e,f){return Math.sqrt(wpd.sqDist3d(b,a,c,d,e,f))};
wpd.mat=function(){function b(a){return a[0]*a[3]-a[1]*a[2]}return{det2x2:b,inv2x2:function(a){var c=b(a);return[a[3]/c,-a[1]/c,-a[2]/c,a[0]/c]},mult2x2:function(a,c){return[a[0]*c[0]+a[1]*c[2],a[0]*c[1]+a[1]*c[3],a[2]*c[0]+a[3]*c[2],a[2]*c[1]+a[3]*c[3]]},mult2x2Vec:function(a,c){return[a[0]*c[0]+a[1]*c[1],a[2]*c[0]+a[3]*c[1]]},multVec2x2:function(a,c){return[c[0]*a[0]+c[2]*a[1],c[1]*a[0]+c[3]*a[1]]}}}();wpd=wpd||{};
wpd.AveragingWindowAlgo=function(){return function(){var b=5,a=5;this.getParamList=function(){return[["\u0394X","Px",10],["\u0394Y","Px",10]]};this.setParam=function(c,d){0===c?b=d:1===c&&(a=d)};this.run=function(c){var d=c.getAutoDetector();c=c.getActiveDataSeries();(new wpd.AveragingWindowCore(d.binaryData,d.imageHeight,d.imageWidth,b,a,c)).run()}}}();wpd=wpd||{};
wpd.AveragingWindowCore=function(){return function(b,a,c,d,e,f){this.run=function(){var g=[],h=0,l=[],p,m,q,k,n,u,r,t,s;f.clearAll();for(p=0;p<c;p++){n=-1;q=-2*e;for(m=k=0;m<a;m++)!0===b[m*c+p]&&(m>q+e?(n+=1,k=1,q=l[n]=m):(k+=1,l[n]=parseFloat((l[n]*(k-1)+m)/parseFloat(k))));if(0<=n)for(q=p,m=0;m<=n;m++)k=l[m],g[h]=[],g[h][0]=parseFloat(q),g[h][1]=parseFloat(k),g[h][2]=!0,h+=1}if(0!==h){for(l=0;l<h;l++)if(!0===g[l][2]){p=!0;n=l+1;m=g[l][0];q=g[l][1];k=m;u=q;for(s=1;!0===p&&n<h;)r=g[n][0],t=g[n][1],
Math.abs(r-m)<=d&&Math.abs(t-q)<=e&&!0===g[n][2]&&(k=(k*s+r)/(s+1),u=(u*s+t)/(s+1),s+=1,g[n][2]=!1),r>m+2*d&&(p=!1),n+=1;g[l][2]=!1;f.addPixel(parseFloat(k),parseFloat(u))}return f}}}}();wpd=wpd||{};
wpd.AveragingWindowWithStepSizeAlgo=function(){return function(){var b,a,c,d,e,f;this.getParamList=function(){var a=wpd.appData.isAligned(),c=wpd.appData.getPlotData().axes;return a&&c instanceof wpd.XYAxes?(a=c.getBounds(),[["X_min","Units",a.x1],["\u0394X Step","Units",0.1],["X_max","Units",a.x2],["Y_min","Units",a.y3],["Y_max","Units",a.y4],["Line width","Px",30]]):[["X_min","Units",0],["\u0394X Step","Units",0.1],["X_max","Units",0],["Y_min","Units",0],["Y_max","Units",0],["Line width","Px",30]]};
this.setParam=function(g,h){0===g?b=h:1===g?a=h:2===g?c=h:3===g?e=h:4===g?f=h:5===g&&(d=h)};this.run=function(g){var h=g.getAutoDetector(),l=g.getActiveDataSeries();g=g.axes;var p=h.imageWidth,m=h.imageHeight,q,k,n,u,r,t,s,v,w;l.clearAll();for(q=b;q<=c;q+=a)for(w=g.dataToPixel(q,e),k=w.x,u=w.y,w=g.dataToPixel(q,f),n=w.x,r=w.y,k=Math.sqrt((r-u)*(r-u)+(n-k)*(n-k)),n=(f-e)/k,u=!1,t=r=0,s=!1,v=0;v<=k;v++)w=1*-v*n+f,w=g.dataToPixel(q,w),xi_pix=w.x,yi_pix=w.y,0<=xi_pix&&xi_pix<p&&0<=yi_pix&&yi_pix<m&&(!0===
h.binaryData[parseInt(yi_pix,10)*p+parseInt(xi_pix,10)]?(!1===u&&(t=r=v,u=!0,s=!1),!0===s&&(t=v,s=!1)):!1===s&&(t=v,s=!0),!0===u&&(v>r+d||v==k-1)&&(u=!1,r>t&&(t=v),w=(r+t)/2,w=1*-w*n+f,w=g.dataToPixel(q,w),l.addPixel(parseFloat(w.x),parseFloat(w.y))))}}}();wpd=wpd||{};
wpd.BlobDetectorAlgo=function(){return function(){var b,a;this.getParamList=function(){var a=wpd.appData.isAligned(),b=wpd.appData.getPlotData().axes;return a&&b instanceof wpd.MapAxes?[["Min Diameter","Units",0],["Max Diameter","Units",5E3]]:[["Min Diameter","Px",0],["Max Diameter","Px",5E3]]};this.setParam=function(c,d){0===c?b=parseFloat(d):1===c&&(a=parseFloat(d))};this.run=function(c){var d=c.getAutoDetector(),e=c.getActiveDataSeries(),f=d.imageWidth,g=d.imageHeight,h=[],l=[],p,m,q,k,n,u,r,t,
s;if(!(0>=f||0>=g||null==d.binaryData||0===d.binaryData.length)){e.clearAll();e.setMetadataKeys(["area","moment"]);for(p=0;p<f;p++)for(m=0;m<g;m++)if(!0===d.binaryData[m*f+p]&&!0!==h[m*f+p])for(h[m*f+p]=!0,k=l.length,l[k]={pixels:[{x:p,y:m}],centroid:{x:p,y:m},area:1,moment:0},q=0;q<l[k].pixels.length;){r=l[k].pixels[q].x;t=l[k].pixels[q].y;for(n=r-1;n<=r+1;n++)for(u=t-1;u<=t+1;u++)0<=n&&0<=u&&n<f&&u<g&&!0!==h[u*f+n]&&!0===d.binaryData[u*f+n]&&(h[u*f+n]=!0,s=l[k].pixels.length,l[k].pixels[s]={x:n,
y:u},l[k].centroid.x=(l[k].centroid.x*s+n)/(s+1),l[k].centroid.y=(l[k].centroid.y*s+u)/(s+1),l[k].area+=1);q+=1}for(k=0;k<l.length;k++){for(q=l[k].moment=0;q<l[k].pixels.length;q++)l[k].moment=l[k].moment+(l[k].pixels[q].x-l[k].centroid.x)*(l[k].pixels[q].x-l[k].centroid.x)+(l[k].pixels[q].y-l[k].centroid.y)*(l[k].pixels[q].y-l[k].centroid.y);c.axes instanceof wpd.MapAxes&&(l[k].area=c.axes.pixelToDataArea(l[k].area));d=2*Math.sqrt(l[k].area/Math.PI);d<=a&&d>=b&&e.addPixel(l[k].centroid.x,l[k].centroid.y,
[l[k].area,l[k].moment])}}}}}();wpd=wpd||{};
wpd.XStepWithInterpolationAlgo=function(){return function(){var b,a,c,d,e,f;this.getParamList=function(){var a=wpd.appData.isAligned(),c=wpd.appData.getPlotData().axes;return a&&c instanceof wpd.XYAxes?(a=c.getBounds(),[["X_min","Units",a.x1],["\u0394X Step","Units",(a.x2-a.x1)/50],["X_max","Units",a.x2],["Y_min","Units",a.y3],["Y_max","Units",a.y4],["Smoothing","Units",0]]):[["X_min","Units",0],["\u0394X Step","Units",0.1],["X_max","Units",0],["Y_min","Units",0],["Y_max","Units",0],["Smoothing",
"Units",0]]};this.setParam=function(g,h){0===g?b=h:1===g?a=h:2===g?c=h:3===g?e=h:4===g?f=h:5===g&&(d=h)};this.run=function(g){var h=g.getAutoDetector(),l=g.getActiveDataSeries();g=g.axes;var p=0,m=h.imageWidth,q=h.imageHeight,k,n,u,r,t,s,v=[],w=[];s=[];var y=[];l.clearAll();k=g.dataToPixel(b,e);n=g.dataToPixel(b,f);n=Math.sqrt((k.x-n.x)*(k.x-n.x)+(k.y-n.y)*(k.y-n.y));y=(f-e)/n;n=g.dataToPixel(c,e);k=Math.sqrt((k.x-n.x)*(k.x-n.x)+(k.y-n.y)*(k.y-n.y));n=(c-b)/k;for(k=b;0<n&&k<=c||0>n&&k>=c;){t=r=0;
for(u=e;0<y&&u<=f||0>y&&u>=f;)s=g.dataToPixel(k,u),0<s.x&&0<s.y&&s.x<m&&s.y<q&&!0===h.binaryData[parseInt(s.y,10)*m+parseInt(s.x,10)]&&(r=(r*t+u)/parseFloat(t+1),t++),u+=y;0<t&&(v[p]=parseFloat(k),w[p]=parseFloat(r),p+=1);k+=n}if(!(0>=v.length||0>=w.length)){if(0<d)for(s=[],y=[],k=v[0];0<n&&k<=v[v.length-1]||0>n&&k>=v[v.length-1];){for(h=t=m=p=0;h<v.length;h++)v[h]<k+d&&v[h]>k-d&&(p=(p*t+v[h])/parseFloat(t+1),m=(m*t+w[h])/parseFloat(t+1),t++);0<t&&(s[s.length]=p,y[y.length]=m);k=0<n?k+d:k-d}else s=
v,y=w;if(!(0>=s.length||0>=y.length||(v=[],h=0,k=b,0>n&&0<a||0<n&&0>a))){for(;0<n&&k<=c||0>n&&k>=c;)v[h]=k,h++,k+=a;w=numeric.spline(s,y).at(v);for(h=0;h<w.length;h++)isNaN(v[h])||isNaN(w[h])||(s=g.dataToPixel(v[h],w[h]),l.addPixel(s.x,s.y))}}}}}();wpd=wpd||{};
wpd.ImageAxes=function(){var b=function(){this.isCalibrated=function(){return!0};this.calibrate=function(){return!0};this.pixelToData=function(a,c){return[a,c]};this.dataToPixel=function(a,c){return{x:a,y:c}};this.pixelToLiveString=function(a,c){var b=this.pixelToData(a,c);return b[0].toFixed(2)+", "+b[1].toFixed(2)};this.getTransformationEquations=function(){return{pixelToData:["x_data = x_pixel","y_data = y_pixel"],dataToPixel:["x_pixel = x_data","y_pixel = y_data"]}}};b.prototype.numCalibrationPointsRequired=
function(){return 0};b.prototype.getDimensions=function(){return 2};b.prototype.getAxesLabels=function(){return["X","Y"]};return b}();wpd=wpd||{};
wpd.MapAxes=function(){var b=function(){var a=!1,c,b,e;this.isCalibrated=function(){return a};this.calibrate=function(f,g,h){var l=f.getPoint(0);f=f.getPoint(1);e=Math.sqrt((l.px-f.px)*(l.px-f.px)+(l.py-f.py)*(l.py-f.py));c=parseFloat(g);b=h;return a=!0};this.pixelToData=function(a,b){var d=[];d[0]=a*c/e;d[1]=b*c/e;return d};this.pixelToDataDistance=function(a){return a*c/e};this.pixelToDataArea=function(a){return a*c*c/(e*e)};this.dataToPixel=function(a,c,b){return{x:0,y:0}};this.pixelToLiveString=
function(a,c){var b=this.pixelToData(a,c);return b[0].toExponential(4)+", "+b[1].toExponential(4)};this.getScaleLength=function(){return c};this.getUnits=function(){return b};this.getTransformationEquations=function(){return{pixelToData:["x_data = "+c/e+"*x_pixel","y_data = "+c/e+"*y_pixel"],dataToPixel:["x_pixel = "+e/c+"*x_data","y_pixel = "+e/c+"*y_data"]}}};b.prototype.numCalibrationPointsRequired=function(){return 2};b.prototype.getDimensions=function(){return 2};b.prototype.getAxesLabels=function(){return["X",
"Y"]};return b}();wpd=wpd||{};
wpd.PolarAxes=function(){var b=function(){var a=!1,c=!1,b=!1,e,f,g,h,l,p,m,q,k,n,u,r,t,s;processCalibration=function(a,w,y){var z=a.getPoint(0),G=a.getPoint(1);a=a.getPoint(2);e=z.px;f=z.py;g=G.px;h=G.py;l=a.px;p=a.py;m=G.dx;q=G.dy;k=a.dx;c=w;b=y;!0===c&&(q*=Math.PI/180);n=Math.sqrt((g-e)*(g-e)+(h-f)*(h-f));u=Math.sqrt((l-e)*(l-e)+(p-f)*(p-f));r=u-n;t=wpd.taninverse(-(h-f),g-e);s=t-q;return!0};this.isCalibrated=function(){return a};this.calibrate=function(c,b,d){return a=processCalibration(c,b,d)};
this.isThetaDegrees=function(){return c};this.isThetaClockwise=function(){return b};this.pixelToData=function(a,b){var d=[],g,h;xp=parseFloat(a);yp=parseFloat(b);g=(k-m)/r*(Math.sqrt((xp-e)*(xp-e)+(yp-f)*(yp-f))-n)+m;h=wpd.taninverse(-(yp-f),xp-e)-s;!0==c&&(h=180*h/Math.PI);d[0]=g;d[1]=h;return d};this.dataToPixel=function(a,c){return{x:0,y:0}};this.pixelToLiveString=function(a,c){var b=this.pixelToData(a,c);return b[0].toExponential(4)+", "+b[1].toExponential(4)};this.getTransformationEquations=
function(){var a="r = ("+(k-m)/r+")*sqrt((x_pixel - "+e+")^2 + (y_pixel - "+f+")^2) + ("+(m-n*(k-m)/r)+")",b="atan2(("+f+" - y_pixel), (x_pixel - "+e+")) - ("+s+")",b=c?"theta = (180/PI)*("+b+"), theta = theta + 360 if theta < 0":"theta = "+b+" theta = theta + 2*PI if theta < 0";return{pixelToData:[a,b]}}};b.prototype.numCalibrationPointsRequired=function(){return 3};b.prototype.getDimensions=function(){return 2};b.prototype.getAxesLabels=function(){return["r","\u03b8"]};return b}();wpd=wpd||{};
wpd.TernaryAxes=function(){var b=function(){var a=!1,c,b,e,f,g,h,l,p,m;this.isCalibrated=function(){return a};this.calibrate=function(q,k,n){var u=q.getPoint(0),r=q.getPoint(1);q.getPoint(2);c=u.px;b=u.py;e=r.px;f=r.py;g=Math.sqrt((c-e)*(c-e)+(b-f)*(b-f));h=wpd.taninverse(-(f-b),e-c);l=Math.sqrt(3);p=k;m=n;return a=!0};this.isRange100=function(){return p};this.isNormalOrientation=function(){return m};this.pixelToData=function(a,f){var e=[],u,r,t,s;xp=parseFloat(a);yp=parseFloat(f);u=Math.sqrt((xp-
c)*(xp-c)+(yp-b)*(yp-b));r=wpd.taninverse(-(yp-b),xp-c)-h;t=u*Math.cos(r)/g;r=u*Math.sin(r)/g;u=1-t-r/l;t-=r/l;r=2*r/l;!1==m&&(s=t,t=u,u=r,r=s);!0==p&&(u*=100,t*=100,r*=100);e[0]=u;e[1]=t;e[2]=r;return e};this.dataToPixel=function(a,b,c){return{x:0,y:0}};this.pixelToLiveString=function(a,b){var c=this.pixelToData(a,b);return c[0].toExponential(4)+", "+c[1].toExponential(4)+", "+c[2].toExponential(4)};this.getTransformationEquations=function(){return{pixelToData:["x_data = x_pixel","y_data = y_pixel"],
dataToPixel:["x_pixel = x_data","y_pixel = y_data"]}}};b.prototype.numCalibrationPointsRequired=function(){return 3};b.prototype.getDimensions=function(){return 3};b.prototype.getAxesLabels=function(){return["a","b","c"]};return b}();wpd=wpd||{};
wpd.XYAxes=function(){var b=function(){var a=!1,b=!1,d=!1,e=!1,f=!1,g,h,l,p,m,q,k,n,u,r,t,s,v,w,y=[0,0,0,0],z=[0,0,0,0];c_vec=[0,0];processCalibration=function(a,K,F){if(4>a.getCount())return!1;var D=a.getPoint(0),I=a.getPoint(1),H=a.getPoint(2);a=a.getPoint(3);var E=new wpd.InputParser;l=D.px;k=D.py;p=I.px;n=I.py;m=H.px;u=H.py;q=a.px;r=a.py;t=D.dx;s=I.dx;v=H.dy;w=a.dy;t=E.parse(t);if(!E.isValid)return!1;e=E.isDate;s=E.parse(s);if(!E.isValid||E.isDate!=e)return!1;g=E.formatting;v=E.parse(v);if(!E.isValid)return!1;
f=E.isDate;w=E.parse(w);if(!E.isValid||E.isDate!=f)return!1;h=E.formatting;b=K;d=F;!0===b&&(t=Math.log(t)/Math.log(10),s=Math.log(s)/Math.log(10));!0===d&&(v=Math.log(v)/Math.log(10),w=Math.log(w)/Math.log(10));y=wpd.mat.mult2x2([t-s,0,0,v-w],wpd.mat.inv2x2([l-p,m-q,k-n,u-r]));z=wpd.mat.inv2x2(y);c_vec[0]=t-y[0]*l-y[1]*k;c_vec[1]=v-y[2]*m-y[3]*u;return!0};this.getBounds=function(){return{x1:t,x2:s,y3:v,y4:w}};this.isCalibrated=function(){return a};this.calibrate=function(b,c,d){return a=processCalibration(b,
c,d)};this.pixelToData=function(a,f){var e=[],g,h;g=parseFloat(a);h=parseFloat(f);h=wpd.mat.mult2x2Vec(y,[g,h]);h[0]+=c_vec[0];h[1]+=c_vec[1];g=h[0];h=h[1];!0===b&&(g=Math.pow(10,g));!0===d&&(h=Math.pow(10,h));e[0]=g;e[1]=h;return e};this.dataToPixel=function(a,b){var c;c=wpd.mat.mult2x2Vec(z,[a-c_vec[0],b-c_vec[1]]);return{x:c[0],y:c[1]}};this.pixelToLiveString=function(a,b){var c="",d=this.pixelToData(a,b),c=e?c+wpd.dateConverter.formatDateNumber(d[0],g):c+d[0].toExponential(4),c=c+", ";return c=
f?c+wpd.dateConverter.formatDateNumber(d[1],h):c+d[1].toExponential(4)};this.isDate=function(a){return 0===a?e:f};this.getInitialDateFormat=function(a){return 0===a?g:h};this.isLogX=function(){return b};this.isLogY=function(){return d};this.getTransformationEquations=function(){var a="("+y[0]+")*x_pixel + ("+y[1]+")*y_pixel + ("+c_vec[0]+")",f="("+y[2]+")*x_pixel + ("+y[3]+")*y_pixel + ("+c_vec[1]+")",e="x_pixel = ("+z[0]+")*x_data + ("+z[1]+")*y_data + ("+(-z[0]*c_vec[0]-z[1]*c_vec[1])+")",g="y_pixel = ("+
z[2]+")*x_data + ("+z[3]+")*y_data + ("+(-z[2]*c_vec[0]-z[3]*c_vec[1])+")",a=b?"x_data = pow(10, "+a+")":"x_data = "+a,f=d?"y_data = pow(10, "+f+")":"y_data = "+f;return b||d?{pixelToData:[a,f]}:{pixelToData:[a,f],dataToPixel:[e,g]}}};b.prototype.numCalibrationPointsRequired=function(){return 4};b.prototype.getDimensions=function(){return 2};b.prototype.getAxesLabels=function(){return["X","Y"]};return b}();wpd=wpd||{};
wpd.dataTable=function(){function b(){f=wpd.appData.getPlotData().getDataFromActiveSeries()}function a(){g=f.slice(0);var a=document.getElementById("data-sort-variables").value,b="ascending"===document.getElementById("data-sort-order").value,c="raw"===a,d="NearestNeighbor"===a,e,h=wpd.appData.getPlotData().axes.getDimensions();if(!c)if(!d)e=parseInt(a,10),g.sort(function(a,c){return a[e]>c[e]?b?1:-1:a[e]<c[e]?b?-1:1:0});else if(d){var u,d=[1,1,1],r,t,s=f.length;for(r=0;r<s-1;r++){c=-1;for(t=r+1;t<
s;t++)if(a=(g[r][0]-g[t][0])*(g[r][0]-g[t][0])+(g[r][1]-g[t][1])*(g[r][1]-g[t][1]),3===h&&(a+=(g[r][2]-g[t][2])*(g[r][2]-g[t][2])),a<u||-1===c)u=a,c=t;d[0]=g[c][0];g[c][0]=g[r+1][0];g[r+1][0]=d[0];d[1]=g[c][1];g[c][1]=g[r+1][1];g[r+1][1]=d[1];3===h&&(d[2]=g[c][2],g[c][2]=g[r+1][2],g[r+1][2]=d[2])}}}function c(){var a=document.getElementById("data-sort-variables").value,c=document.getElementById("data-sort-order");"NearestNeighbor"===a||"raw"===a?c.setAttribute("disabled",!0):c.removeAttribute("disabled")}
function d(){if(null!=f){var a=wpd.appData.getPlotData().axes,c=wpd.appData.getPlotData().getActiveDataSeries(),b=a.getDimensions(),c=c.getMetadataKeys().length,d=f.length,e,n,u,r=document.getElementById("digitizedDataTable"),t=[],s=parseInt(document.getElementById("data-number-format-digits").value,10),v=document.getElementById("data-number-format-style").value;h="";for(e=0;e<d;e++){u=[];for(n=0;n<b+c;n++)n<b&&null!=a.isDate&&a.isDate(n)?(void 0===t[n]&&(t[n]=document.getElementById("data-format-string-"+
n).value),u[n]=wpd.dateConverter.formatDateNumber(g[e][n],t[n])):u[n]="fixed"===v&&0<=s?g[e][n].toFixed(s):"precision"===v&&0<=s?g[e][n].toPrecision(s):"exponential"===v&&0<=s?g[e][n].toExponential(s):g[e][n];h+=u.join(", ");h+="\n"}r.value=h}}function e(){if(wpd.appData.isAligned()){wpd.popup.show("csvWindow");b();var e=document.getElementById("data-sort-variables"),f=document.getElementById("dataVariables"),g=document.getElementById("data-date-formatting-container"),h=document.getElementById("data-date-formatting"),
k=wpd.appData.getPlotData().axes,n=wpd.appData.getPlotData().getActiveDataSeries(),u=k.getAxesLabels(),r="",t=u.join(", "),s="";isAnyVariableDate=!1;tableVariables=u;dimCount=k.getDimensions();n.hasMetadata()&&(tableVariables=u.concat(n.getMetadataKeys()),t=tableVariables.join(", "));g.style.display="none";r+='<option value="raw">Raw</option>';for(n=0;n<tableVariables.length;n++)r+='<option value="'+n+'">'+tableVariables[n]+"</option>",n<dimCount&&null!=k.isDate&&null!=k.getInitialDateFormat&&k.isDate(n)&&
(s+="<p>"+u[n]+' <input type="text" length="15" value="'+k.getInitialDateFormat(n)+'" id="data-format-string-'+n+'"/></p>',isAnyVariableDate=!0);e.innerHTML=r+'<option value="NearestNeighbor">Nearest Neighbor</option>';f.innerHTML=t;isAnyVariableDate&&(g.style.display="inline-block",h.innerHTML=s);a();d();c();for(var e=document.getElementById("data-table-dataset-list"),f=wpd.appData.getPlotData(),g=f.getActiveDataSeriesIndex(),v,h=0;h<f.dataSeriesColl.length;h++)v+="<option>"+f.dataSeriesColl[h].name+
"</option>";e.innerHTML=v;e.selectedIndex=g}}var f,g,h;return{getSeriesData:b,showTable:e,updateSortingControls:c,reSort:function(){c();a();d()},selectAll:function(){var a=document.getElementById("digitizedDataTable");a.focus();a.select()},generateCSV:function(){var a,c,b,d=JSON.stringify(h);a=document.createElement("div");c=document.createElement("form");b=document.createElement("input");c.setAttribute("method","post");c.setAttribute("action","php/csvexport.php");b.setAttribute("type","text");b.setAttribute("name",
"data");c.appendChild(b);a.appendChild(c);document.body.appendChild(a);a.style.display="none";b.setAttribute("value",d);c.submit();document.body.removeChild(a)},exportToPlotly:function(){if(null!=f&&0!==f.length){var a=document.createElement("div"),c=document.createElement("form"),b=document.createElement("input");c.setAttribute("method","post");c.setAttribute("action","https://plot.ly/external");c.setAttribute("target","_blank");b.setAttribute("type","text");b.setAttribute("name","data");c.appendChild(b);
a.appendChild(c);document.body.appendChild(a);a.style.display="none";var d={data:[]},e=wpd.appData.getPlotData().axes,h=wpd.appData.getPlotData().getActiveDataSeries().getMetadataKeys(),u=h.length,r=e.getDimensions(),t=f.length,s,v,w=["x","y","z"];d.data[0]={};for(s=0;s<t;s++)for(rowValues=[],v=0;v<r+u;v++)0===s&&(v<r?d.data[0][w[v]]=[]:d.data[0][h[v-r]]=[]),v<r&&null!=e.isDate&&e.isDate(v)?d.data[0][w[v]][s]=wpd.dateConverter.formatDateNumber(g[s][v],"yyyy-mm-dd"):v<r?d.data[0][w[v]][s]=g[s][v]:
d.data[0][h[v-r]][s]=g[s][v];b.setAttribute("value",JSON.stringify(d));c.submit();document.body.removeChild(a)}},changeDataset:function(){var a=document.getElementById("data-table-dataset-list");wpd.appData.getPlotData().setActiveDataSeriesIndex(a.selectedIndex);wpd.graphicsWidget.forceHandlerRepaint();wpd.dataPointCounter.setCount();wpd.popup.close("csvWindow");e()}}}();wpd=wpd||{};
wpd.graphicsWidget=function(){function b(a){var c=z.getBoundingClientRect();return{x:parseInt(a.pageX-(c.left+window.pageXOffset),10),y:parseInt(a.pageY-(c.top+window.pageYOffset),10)}}function a(a,c){return{x:a/J,y:c/J}}function c(a,c){a=parseInt(a,10);c=parseInt(c,10);E.style.width=a+"px";E.style.height=c+"px";z.width=a;G.width=a;K.width=a;F.width=a;D.width=a;z.height=c;G.height=c;K.height=c;F.height=c;D.height=c;V=a/(1*c);L=a;M=c;if(null!=O){Q.fillStyle="rgb(255, 255, 255)";Q.fillRect(0,0,L,M);
Q.drawImage(I,0,0,L,M);if(null!=A&&void 0!=A.onRedraw)A.onRedraw();if(null!=x&&void 0!=x.onRedraw)x.onRedraw()}}function d(){z.width=z.width;G.width=G.width;K.width=K.width;F.width=F.width;D.width=D.width;H.width=H.width}function e(){if(null!=A&&void 0!=A.onRemove)A.onRemove();A=null}function f(){var a=wpd.layoutManager.getGraphicsViewportSize();c(a.width,a.height);V>R?(J=M/(1*B),c(M*R,M)):(J=L/(1*C),c(L,L/R))}function g(a){J=a;c(C*J,B*J)}function h(a){220===a.keyCode&&(a.preventDefault(),T=!T,F.width=
F.width)}function l(a,c){var b=wpd.zoomView.getSize(),d=wpd.zoomView.getZoomRatio(),e,f,g,h,l,m,k,q=0,p=0,n=b.width,r=b.height;g=b.width/d;h=b.height/d;e=a-g/2;f=c-h/2;m=e;b=f;l=e+g;k=f+h;0>e&&(m=0,q=-e*d);0>f&&(b=0,p=-f*d);e+g>=C&&(l=C,n-=d*(C-(e+g)));f+h>=B&&(k=B,r-=d*(B-(f+h)));g=P.getImageData(parseInt(m,10),parseInt(b,10),parseInt(l-m,10),parseInt(k-b,10));l=S.getImageData(parseInt(m,10),parseInt(b,10),parseInt(l-m,10),parseInt(k-b,10));for(k=0;k<l.data.length;k+=4)if(0!=l.data[k]||0!=l.data[k+
1]||0!=l.data[k+2])g.data[k]=l.data[k],g.data[k+1]=l.data[k+1],g.data[k+2]=l.data[k+2];m=d*(parseInt(m,10)-m);d*=parseInt(b,10)-b;wpd.zoomView.setZoomImage(g,parseInt(q+m,10),parseInt(p+d,10),parseInt(n-q,10),parseInt(r-p,10))}function p(c){clearTimeout(W);var d=setTimeout,e=b(c);c=e.x;var e=e.y,f=a(c,e);T&&(F.width=F.width,N.strokeStyle="rgba(0,0,0, 0.5)",N.beginPath(),N.moveTo(c,0),N.lineTo(c,M),N.moveTo(0,e),N.lineTo(L,e),N.stroke());l(f.x,f.y);wpd.zoomView.setCoords(f.x,f.y);W=d(void 0,10)}function m(){z=
document.getElementById("mainCanvas");G=document.getElementById("dataCanvas");K=document.getElementById("drawCanvas");F=document.getElementById("hoverCanvas");D=document.getElementById("topCanvas");I=document.createElement("canvas");H=document.createElement("canvas");Q=z.getContext("2d");U=G.getContext("2d");N=F.getContext("2d");X=D.getContext("2d");Y=K.getContext("2d");P=I.getContext("2d");S=H.getContext("2d");E=document.getElementById("canvasDiv");document.body.addEventListener("keydown",h,!1);
D.addEventListener("mousemove",p,!1);D.addEventListener("dragover",function(a){a.preventDefault()},!0);D.addEventListener("drop",function(a){a.preventDefault();wpd.busyNote.show();a=a.dataTransfer.files;1===a.length&&k(a[0])},!0);D.addEventListener("mousemove",r,!1);D.addEventListener("click",t,!1);D.addEventListener("mouseup",v,!1);D.addEventListener("mousedown",w,!1);D.addEventListener("mouseout",y,!0);document.addEventListener("mouseup",s,!1);document.addEventListener("mousedown",function(a){Z=
a.target===D?!0:!1},!1);document.addEventListener("keydown",function(a){if(Z&&null!=x&&void 0!=x.onKeyDown)x.onKeyDown(a)},!0);wpd.zoomView.initZoom();document.getElementById("fileLoadBox").addEventListener("change",n);window.addEventListener("paste",function(a){wpd.busyNote.show();if(void 0!==a.clipboardData&&(a=a.clipboardData.items,void 0!==a))for(var c=0;c<a.length;c++)if(-1!==a[c].type.indexOf("image")){var b=a[c].getAsFile();(window.URL||window.webkitURL).createObjectURL(b);k(b)}},!1)}function q(a){var c=
document.createElement("img");c.onload=function(){null==z&&m();wpd.appData.reset();wpd.sidebar.clear();u();e();C=c.width;B=c.height;R=C/(1*B);I.width=C;I.height=B;H.width=C;H.height=B;P.drawImage(c,0,0,C,B);O=P.getImageData(0,0,C,B);d();f();wpd.appData.plotLoaded(O);wpd.busyNote.close();!1===$&&wpd.popup.show("axesList");$=!1};c.src=a}function k(a){if(a.type.match("image.*")){var c=new FileReader;c.onload=function(){q(c.result)};c.readAsDataURL(a)}}function n(){wpd.busyNote.show();var a=document.getElementById("fileLoadBox");
1==a.files.length&&k(a.files[0])}function u(){if(null!=x&&void 0!=x.onRemove)x.onRemove();x=null}function r(c){if(null!=x&&void 0!=x.onMouseMove){var d=b(c),e=a(d.x,d.y);x.onMouseMove(c,d,e)}}function t(c){if(null!=x&&void 0!=x.onMouseClick){var d=b(c),e=a(d.x,d.y);x.onMouseClick(c,d,e)}}function s(c){if(null!=x&&void 0!=x.onDocumentMouseUp){var d=b(c),e=a(d.x,d.y);x.onDocumentMouseUp(c,d,e)}}function v(c){if(null!=x&&void 0!=x.onMouseUp){var d=b(c),e=a(d.x,d.y);x.onMouseUp(c,d,e)}}function w(c){if(null!=
x&&void 0!=x.onMouseDown){var d=b(c),e=a(d.x,d.y);x.onMouseDown(c,d,e)}}function y(c){if(null!=x&&void 0!=x.onMouseOut){var d=b(c),e=a(d.x,d.y);x.onMouseOut(c,d,e)}}var z,G,K,F,D,I,H,E,Q,U,Y,N,X,P,S,L,M,C,B,R,V,O,J,T=!1,W,x,A,Z=!1,$=!0;return{zoomIn:function(){g(1.2*J)},zoomOut:function(){g(J/1.2)},zoomFit:f,zoom100perc:function(){g(1)},setZoomRatio:g,getZoomRatio:function(){return J},loadImageFromURL:q,runImageOp:function(a){var c=a(O,C,B);a=c.imageData;var b=c.width,c=c.height;wpd.appData.reset();
u();e();C=b;B=c;R=C/(1*B);I.width=C;I.height=B;H.width=C;H.height=B;P.putImageData(a,0,0);O=a;d();f();wpd.appData.plotLoaded(O)},setTool:function(a){if(null!=x&&void 0!=x.onRemove)x.onRemove();x=a;if(null!=x&&void 0!=x.onAttach)x.onAttach()},removeTool:u,getAllContexts:function(){return{mainCtx:Q,dataCtx:U,drawCtx:Y,hoverCtx:N,topCtx:X,oriImageCtx:P,oriDataCtx:S}},resetData:function(){H.width=H.width;G.width=G.width},resetHover:function(){F.width=F.width},imagePx:a,screenPx:function(a,c){return{x:a*
J,y:c*J}},updateZoomOnEvent:function(c){c=b(c);c=a(c.x,c.y);l(c.x,c.y);wpd.zoomView.setCoords(c.x,c.y)},updateZoomToImagePosn:function(a,c){l(a,c);wpd.zoomView.setCoords(a,c)},getDisplaySize:function(){return{width:L,height:M}},getImageSize:function(){return{width:C,height:B}},copyImageDataLayerToScreen:function(){U.drawImage(H,0,0,L,M)},setRepainter:function(a){if(null==A||void 0==A.painterName||null==a||void 0==a.painterName||A.painterName!=a.painterName){if(null!=A&&void 0!=A.onRemove)A.onRemove();
A=a;if(null!=A&&void 0!=A.onAttach)A.onAttach()}},removeRepainter:e,forceHandlerRepaint:function(){if(null!=A&&void 0!=A.onForcedRedraw)A.onForcedRedraw()},getRepainter:function(){return A},saveImage:function(){var a=document.createElement("canvas"),c=a.getContext("2d"),b,d,e;a.width=C;a.height=B;c.drawImage(I,0,0,C,B);b=c.getImageData(0,0,C,B);e=S.getImageData(0,0,C,B);for(d=0;d<b.data.length;d+=4)if(0!=e.data[d]||0!=e.data[d+1]||0!=e.data[d+2])b.data[d]=e.data[d],b.data[d+1]=e.data[d+1],b.data[d+
2]=e.data[d+2];c.putImageData(b,0,0);window.open(a.toDataURL(),"_blank")}}}();wpd=wpd||{};
wpd.layoutManager=function(){function b(){var a=parseInt(document.body.offsetWidth,10),c=parseInt(document.body.offsetHeight,10);e.style.height=c+"px";f.style.height=c-280+"px";g.style.width=a-e.offsetWidth-5+"px";g.style.height=c+"px";d.style.height=c-44+"px";wpd.sidebar.resize()}function a(a){clearTimeout(c);c=setTimeout(b,80)}var c,d,e,f,g;return{initialLayout:function(){d=document.getElementById("graphicsContainer");e=document.getElementById("sidebarContainer");f=document.getElementById("sidebarControlsContainer");
g=document.getElementById("mainContainer");b();window.addEventListener("resize",a,!1)},getGraphicsViewportSize:function(){return{width:d.offsetWidth,height:d.offsetHeight}}}}();wpd=wpd||{};
wpd.popup=function(){return{show:function(b){document.getElementById("shadow").style.visibility="visible";b=document.getElementById(b);var a=parseInt(window.innerWidth),c=parseInt(window.innerHeight),d=parseInt(b.offsetWidth),e=parseInt(b.offsetHeight),c=(c-e)/2;b.style.left=(a-d)/2+"px";b.style.top=(60<c?60:c)+"px";b.style.visibility="visible"},close:function(b){document.getElementById("shadow").style.visibility="hidden";document.getElementById(b).style.visibility="hidden"}}}();
wpd.busyNote=function(){var b,a=!1;return{show:function(){a||(null==b&&(b=document.createElement("div"),b.id="wait",b.innerHTML='<p align="center">Processing...</p>'),document.body.appendChild(b),a=!0)},close:function(){null!=b&&!0===a&&(document.body.removeChild(b),a=!1)}}}();
wpd.messagePopup=function(){var b;return{show:function(a,c,d){wpd.popup.show("messagePopup");document.getElementById("message-popup-heading").innerHTML=a;document.getElementById("message-popup-text").innerHTML=c;b=d},close:function(){wpd.popup.close("messagePopup");null!=b&&b()}}}();
wpd.okCancelPopup=function(){var b,a;return{show:function(c,d,e,f){wpd.popup.show("okCancelPopup");document.getElementById("ok-cancel-popup-heading").innerHTML=c;document.getElementById("ok-cancel-popup-text").innerHTML=d;b=e;a=f},ok:function(){wpd.popup.close("okCancelPopup");b()},cancel:function(){wpd.popup.close("okCancelPopup");a()}}}();wpd.unsupported=function(){wpd.messagePopup.show("Unsupported Feature!","This feature has not been implemented in the current version. This may be available in a future release.")};
wpd=wpd||{};
wpd.sidebar=function(){function b(){var a=document.getElementsByClassName("sidebar"),c;for(c=0;c<a.length;c++)a[c].style.display="none"}return{show:function(a){b();a=document.getElementById(a);a.style.display="inline-block";a.style.height=parseInt(document.body.offsetHeight,10)-280+"px"},clear:b,resize:function(){var a=document.getElementsByClassName("sidebar"),c;for(c=0;c<a.length;c++)"inline-block"===a[c].style.display&&(a[c].style.height=parseInt(document.body.offsetHeight,10)-280+"px")}}}();
wpd=wpd||{};wpd.toolbar=function(){function b(){var a=document.getElementsByClassName("toolbar"),c;for(c=0;c<a.length;c++)a[c].style.visibility="hidden"}return{show:function(a){b();document.getElementById(a).style.visibility="visible"},clear:b}}();wpd=wpd||{};
wpd.transformationEquations=function(){return{show:function(){if(!1===wpd.appData.isAligned())wpd.messagePopup.show("Transformation Equations","Transformation equations are avilable only after axes have been calibrated.");else{wpd.popup.show("axes-transformation-equations-window");var b=document.getElementById("axes-transformation-equation-list"),a="",c=wpd.appData.getPlotData().axes.getTransformationEquations(),d;if(null!=c.pixelToData){a+="<p><b>Pixel to Data</b></p><ol>";for(d=0;d<c.pixelToData.length;d++)a+=
'<li><p class="footnote">'+c.pixelToData[d]+"</p></li>";a+="</ol>"}a+="<p>&nbsp;</p>";if(null!=c.dataToPixel){a+="<p><b>Data to Pixel</b></p><ol>";for(d=0;d<c.dataToPixel.length;d++)a+='<li><p class="footnote">'+c.dataToPixel[d]+"</p></li>";a+="</ol>"}b.innerHTML=a}}}}();wpd=wpd||{};
wpd.webcamCapture=function(){function b(){void 0!=a&&a.stop();wpd.popup.close("webcamCapture")}var a;return{start:function(){if(null==(navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia))wpd.messagePopup.show("Webcam Capture","Your browser does not support webcam capture using HTML5 APIs. A recent version of Google Chrome is recommended.");else{wpd.popup.show("webcamCapture");var c=document.getElementById("webcamVideo");navigator.getUserMedia=
navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia;navigator.getUserMedia({video:!0},function(b){a=b;c.src=window.URL.createObjectURL(b)},function(){})}},cancel:function(){b()},capture:function(){var a=document.createElement("canvas"),d=document.getElementById("webcamVideo"),e=a.getContext("2d"),f;a.width=d.videoWidth;a.height=d.videoHeight;e.drawImage(d,0,0);f=e.getImageData(0,0,a.width,a.height);b();wpd.graphicsWidget.runImageOp(function(){return{imageData:f,
width:a.width,height:a.height}})}}}();wpd=wpd||{};
wpd.zoomView=function(){function b(){var a=document.getElementById("zoomCrossHair"),c=a.getContext("2d");a.width=a.width;c.strokeStyle="black"===p?"rgba(0,0,0,1)":"red"===p?"rgba(255,0,0,1)":"yellow"===p?"rgba(255,255,0,1)":"rgba(0,0,0,1)";c.beginPath();c.moveTo(f/2,0);c.lineTo(f/2,g);c.moveTo(0,g/2);c.lineTo(f,g/2);c.stroke()}var a,c,d,e,f=250,g=250,h,l,p="black";return{initZoom:function(){a=document.getElementById("zoomCanvas");c=a.getContext("2d");d=document.createElement("canvas");e=d.getContext("2d");
h=document.getElementById("mousePosition");l=5;b()},setZoomImage:function(b,f,g,h,p){d.width=h/l;d.height=p/l;e.putImageData(b,0,0);a.width=a.width;c.drawImage(d,f,g,h,p)},setCoords:function(a,c){if(wpd.appData.isAligned()){var b=wpd.appData.getPlotData();h.innerHTML=b.axes.pixelToLiveString(a,c)}else h.innerHTML=a.toFixed(2)+", "+c.toFixed(2)},setZoomRatio:function(a){l=a},getZoomRatio:function(){return l},getSize:function(){return{width:f,height:g}},showSettingsWindow:function(){document.getElementById("zoom-magnification-value").value=
l;document.getElementById("zoom-crosshair-color-value").value=p;wpd.popup.show("zoom-settings-popup")},applySettings:function(){l=document.getElementById("zoom-magnification-value").value;p=document.getElementById("zoom-crosshair-color-value").value;b();wpd.popup.close("zoom-settings-popup")}}}();wpd=wpd||{};
wpd.xyCalibration=function(){function b(){wpd.popup.show("xyAlignment")}return{start:function(){wpd.popup.show("xyAxesInfo")},pickCorners:function(){wpd.popup.close("xyAxesInfo");var a=new wpd.AxesCornersTool(4,2,["X1","X2","Y1","Y2"]);wpd.graphicsWidget.setTool(a)},getCornerValues:b,align:function(){var a=document.getElementById("xmin").value,c=document.getElementById("xmax").value,d=document.getElementById("ymin").value,e=document.getElementById("ymax").value,f=document.getElementById("xlog").checked,
g=document.getElementById("ylog").checked,h=new wpd.XYAxes,l=wpd.alignAxes.getActiveCalib();l.setDataAt(0,a,d);l.setDataAt(1,c,d);l.setDataAt(2,a,d);l.setDataAt(3,c,e);if(!h.calibrate(l,f,g))return wpd.popup.close("xyAlignment"),wpd.messagePopup.show("Invalid Inputs","Please enter valid values for calibration.",b),!1;wpd.appData.getPlotData().axes=h;wpd.popup.close("xyAlignment");return!0}}}();
wpd.polarCalibration=function(){return{start:function(){wpd.popup.show("polarAxesInfo")},pickCorners:function(){wpd.popup.close("polarAxesInfo");var b=new wpd.AxesCornersTool(3,2,["Origin","P1","P2"]);wpd.graphicsWidget.setTool(b)},getCornerValues:function(){wpd.popup.show("polarAlignment")},align:function(){var b=parseFloat(document.getElementById("rpoint1").value),a=parseFloat(document.getElementById("thetapoint1").value),c=parseFloat(document.getElementById("rpoint2").value),d=parseFloat(document.getElementById("thetapoint2").value),
e=document.getElementById("degrees").checked;document.getElementById("radians");var f=document.getElementById("clockwise").checked,g=new wpd.PolarAxes,h=wpd.alignAxes.getActiveCalib();h.setDataAt(1,b,a);h.setDataAt(2,c,d);g.calibrate(h,e,f);wpd.appData.getPlotData().axes=g;wpd.popup.close("polarAlignment");return!0}}}();
wpd.ternaryCalibration=function(){return{start:function(){wpd.popup.show("ternaryAxesInfo")},pickCorners:function(){wpd.popup.close("ternaryAxesInfo");var b=new wpd.AxesCornersTool(3,3,["A","B","C"]);wpd.graphicsWidget.setTool(b)},getCornerValues:function(){wpd.popup.show("ternaryAlignment")},align:function(){document.getElementById("range0to1");var b=document.getElementById("range0to100").checked,a=document.getElementById("ternarynormal").checked,c=new wpd.TernaryAxes,d=wpd.alignAxes.getActiveCalib();
c.calibrate(d,b,a);wpd.appData.getPlotData().axes=c;wpd.popup.close("ternaryAlignment");return!0}}}();
wpd.mapCalibration=function(){function b(){wpd.popup.show("mapAlignment")}return{start:function(){wpd.popup.show("mapAxesInfo")},pickCorners:function(){wpd.popup.close("mapAxesInfo");var a=new wpd.AxesCornersTool(2,2,["P1","P2"]);wpd.graphicsWidget.setTool(a);a.onComplete=b},getCornerValues:b,align:function(){var a=parseFloat(document.getElementById("scaleLength").value),c=document.getElementById("scaleUnits").value,b=new wpd.MapAxes,e=wpd.alignAxes.getActiveCalib();b.calibrate(e,a,c);wpd.appData.getPlotData().axes=
b;wpd.popup.close("mapAlignment");return!0}}}();
wpd.AxesCornersTool=function(){return function(b,a,c){var d=0;a=new wpd.Calibration(a);var e=!0;a.labels=c;wpd.alignAxes.setActiveCalib(a);wpd.graphicsWidget.resetData();this.onMouseClick=function(a,c,h){e?(d+=1,c=wpd.alignAxes.getActiveCalib(),c.addPoint(h.x,h.y,0,0),c.unselectAll(),c.selectPoint(d-1),wpd.graphicsWidget.forceHandlerRepaint(),d===b&&(e=!1,wpd.alignAxes.calibrationCompleted())):(c=wpd.alignAxes.getActiveCalib(),c.unselectAll(),c.selectNearestPoint(h.x,h.y),wpd.graphicsWidget.forceHandlerRepaint());
wpd.graphicsWidget.updateZoomOnEvent(a)};this.onKeyDown=function(a){var c=wpd.alignAxes.getActiveCalib();if(0!==c.getSelectedPoints().length){var b=c.getPoint(c.getSelectedPoints()[0]),d=b.px,b=b.py,e=!0===a.shiftKey?5/wpd.graphicsWidget.getZoomRatio():0.5/wpd.graphicsWidget.getZoomRatio();if(wpd.keyCodes.isUp(a.keyCode))b-=e;else if(wpd.keyCodes.isDown(a.keyCode))b+=e;else if(wpd.keyCodes.isLeft(a.keyCode))d-=e;else if(wpd.keyCodes.isRight(a.keyCode))d+=e;else return;c.changePointPx(c.getSelectedPoints()[0],
d,b);wpd.graphicsWidget.forceHandlerRepaint();wpd.graphicsWidget.updateZoomToImagePosn(d,b);a.preventDefault();a.stopPropagation()}}}}();
wpd.AlignmentCornersRepainter=function(){return function(){var b=wpd.graphicsWidget.getAllContexts();this.painterName="AlignmentCornersReptainer";this.onForcedRedraw=function(){wpd.graphicsWidget.resetData();this.onRedraw()};this.onRedraw=function(){var a=wpd.alignAxes.getActiveCalib();if(null!=a){var c,d,e;for(c=0;c<a.getCount();c++)e=a.getPoint(c),d=wpd.graphicsWidget.screenPx(e.px,e.py),b.dataCtx.fillStyle="rgba(255,255,255,0.7)",b.dataCtx.fillRect(d.x-10,d.y-10,20,40),b.dataCtx.beginPath(),a.isPointSelected(c)?
b.dataCtx.fillStyle="rgba(0,200,0,1)":b.dataCtx.fillStyle="rgba(200,0,0,1)",b.dataCtx.arc(d.x,d.y,3,0,2*Math.PI,!0),b.dataCtx.fill(),b.dataCtx.font="14px sans-serif",b.dataCtx.fillText(a.labels[c],d.x-10,d.y+18),b.oriDataCtx.beginPath(),a.isPointSelected(c)?b.oriDataCtx.fillStyle="rgb(0,200,0)":b.oriDataCtx.fillStyle="rgb(200,0,0)",b.oriDataCtx.arc(e.px,e.py,3,0,2*Math.PI,!0),b.oriDataCtx.fill(),b.oriDataCtx.font="14px sans-serif",b.oriDataCtx.fillText(a.labels[c],parseInt(e.px-10,10),parseInt(e.py+
18,10))}}}}();
wpd.alignAxes=function(){var b,a;return{start:function(){xyEl=document.getElementById("r_xy");polarEl=document.getElementById("r_polar");ternaryEl=document.getElementById("r_ternary");mapEl=document.getElementById("r_map");imageEl=document.getElementById("r_image");wpd.popup.close("axesList");if(!0===xyEl.checked)a=wpd.xyCalibration;else if(!0===polarEl.checked)a=wpd.polarCalibration;else if(!0===ternaryEl.checked)a=wpd.ternaryCalibration;else if(!0===mapEl.checked)a=wpd.mapCalibration;else if(!0===
imageEl.checked){a=null;var c=new wpd.ImageAxes;c.calibrate();wpd.appData.getPlotData().axes=c;wpd.appData.isAligned(!0);wpd.acquireData.load()}null!=a&&(a.start(),wpd.graphicsWidget.setRepainter(new wpd.AlignmentCornersRepainter))},calibrationCompleted:function(){wpd.sidebar.show("axes-calibration-sidebar")},getCornerValues:function(){a.getCornerValues()},align:function(){wpd.graphicsWidget.removeTool();wpd.graphicsWidget.removeRepainter();wpd.graphicsWidget.resetData();a.align()&&(wpd.appData.isAligned(!0),
wpd.acquireData.load())},getActiveCalib:function(){return b},setActiveCalib:function(a){b=a}}}();wpd=wpd||{};
wpd.autoExtraction=function(){function b(){var a=wpd.appData.getPlotData();a.getActiveDataSeries();var b=a.getActiveDataSeriesIndex(),e=document.getElementById("automatic-sidebar-dataset-list"),f="",g;for(g=0;g<a.dataSeriesColl.length;g++)f+="<option>"+a.dataSeriesColl[g].name+"</option>";e.innerHTML=f;e.selectedIndex=b}function a(){var a=wpd.appData.getPlotData().getAutoDetector(),b=document.getElementById("auto-extract-algo-name").value;if("averagingWindow"===b)a.algorithm=new wpd.AveragingWindowAlgo;
else if("XStep"===b||"XStepWithInterpolation"===b){var e=wpd.appData.getPlotData().axes;e instanceof wpd.XYAxes&&!1===e.isLogX()&&!1===e.isLogY()?"XStep"===b?a.algorithm=new wpd.AveragingWindowWithStepSizeAlgo:"XStepWithInterpolation"===b&&(a.algorithm=new wpd.XStepWithInterpolationAlgo):(wpd.messagePopup.show("Not supported!","This algorithm is only supported for non log scale XY plots."),document.getElementById("auto-extract-algo-name").value="averagingWindow",a.algorithm=new wpd.AveragingWindowAlgo)}else"blobDetector"===
b&&(a.algorithm=new wpd.BlobDetectorAlgo);for(var b=a.algorithm,a=document.getElementById("algo-parameter-container"),b=b.getParamList(),f="<table>",e=0;e<b.length;e++)f+="<tr><td>"+b[e][0]+'</td><td><input type="text" size=3 id="algo-param-'+e+'" class="algo-params" value="'+b[e][2]+'"/></td><td>'+b[e][1]+"</td></tr>";a.innerHTML=f+"</table>"}return{start:function(){wpd.sidebar.show("auto-extraction-sidebar");b();wpd.colorPicker.init();a()},changeAlgorithm:a,runAlgo:function(){wpd.busyNote.show();
setTimeout(function(){var a=wpd.appData.getPlotData().getAutoDetector(),b=a.algorithm,e=new wpd.DataPointsRepainter,f=document.getElementsByClassName("algo-params"),g,h,l=wpd.graphicsWidget.getAllContexts(),p=wpd.graphicsWidget.getImageSize();for(g=0;g<f.length;g++)h=f[g].id,h=parseInt(h.replace("algo-param-",""),10),b.setParam(h,parseFloat(f[g].value));wpd.graphicsWidget.removeTool();a.imageData=l.oriImageCtx.getImageData(0,0,p.width,p.height);a.generateBinaryData();wpd.graphicsWidget.setRepainter(e);
b.run(wpd.appData.getPlotData());wpd.graphicsWidget.forceHandlerRepaint();wpd.dataPointCounter.setCount();wpd.busyNote.close();return!0},10)},updateDatasetControl:b,changeDataset:function(){var a=document.getElementById("automatic-sidebar-dataset-list").selectedIndex;wpd.appData.getPlotData().setActiveDataSeriesIndex(a);wpd.graphicsWidget.forceHandlerRepaint();wpd.dataPointCounter.setCount()}}}();wpd=wpd||{};
wpd.colorSelectionWidget=function(){function b(){document.getElementById("color-selection-selected-color-box").style.backgroundColor="rgb("+a[0]+","+a[1]+","+a[2]+")";document.getElementById("color-selection-red").value=a[0];document.getElementById("color-selection-green").value=a[1];document.getElementById("color-selection-blue").value=a[2];var c=document.getElementById("color-selection-options"),b=wpd.appData.getPlotData().topColors,d=10<b.length?10:b.length,e,p="",m,q;for(e=0;e<d;e++)q="rgb("+
b[e].r+","+b[e].g+","+b[e].b+");",m=b[e].percentage.toFixed(3)+"%",p+='<div class="colorOptionBox" style="background-color: '+q+'" title="'+m+'" onclick="wpd.colorSelectionWidget.selectTopColor('+e+');"></div>';c.innerHTML=p;wpd.popup.show("color-selection-widget")}var a,c,d,e;return{setParams:function(b){a=b.color;c=b.triggerElementId;d=b.title;e=b.setColorDelegate;document.getElementById("color-selection-title").innerHTML=d},startPicker:b,pickColor:function(){wpd.popup.close("color-selection-widget");
var c=new wpd.ColorPickerTool;c.onComplete=function(c){a=c;e(c);wpd.graphicsWidget.removeTool();b()};wpd.graphicsWidget.setTool(c)},setColor:function(){var b=[];b[0]=parseInt(document.getElementById("color-selection-red").value,10);b[1]=parseInt(document.getElementById("color-selection-green").value,10);b[2]=parseInt(document.getElementById("color-selection-blue").value,10);a=b;e(b);wpd.popup.close("color-selection-widget");document.getElementById(c).style.backgroundColor="rgb("+a[0]+","+a[1]+","+
a[2]+")"},selectTopColor:function(c){var d=[],h=wpd.appData.getPlotData().topColors;d[0]=h[c].r;d[1]=h[c].g;d[2]=h[c].b;a=d;e(d);b()},paintFilteredColor:function(a,c){var b=wpd.graphicsWidget.getAllContexts();wpd.appData.getPlotData().getAutoDetector();var d=wpd.graphicsWidget.getImageSize(),e,m,q;q=b.oriDataCtx.getImageData(0,0,d.width,d.height);if(null!=c&&0!==c.length){for(e=0;e<c.length;e++)m=c[e],!0===a[m]?(parseInt(m/d.width,10),q.data[4*m]=255,q.data[4*m+1]=255,q.data[4*m+2]=0,q.data[4*m+3]=
255):(q.data[4*m]=0,q.data[4*m+1]=0,q.data[4*m+2]=0,q.data[4*m+3]=150);b.oriDataCtx.putImageData(q,0,0);wpd.graphicsWidget.copyImageDataLayerToScreen()}}}}();
wpd.colorPicker=function(){function b(){return{color:wpd.appData.getPlotData().getAutoDetector().fgColor,triggerElementId:"color-button",title:"Specify Plot (Foreground) Color",setColorDelegate:function(a){wpd.appData.getPlotData().getAutoDetector().fgColor=a}}}function a(){return{color:wpd.appData.getPlotData().getAutoDetector().bgColor,triggerElementId:"color-button",title:"Specify Background Color",setColorDelegate:function(a){wpd.appData.getPlotData().getAutoDetector().bgColor=a}}}function c(){var a=
document.getElementById("color-button"),c=document.getElementById("color-distance-value"),b=wpd.appData.getPlotData().getAutoDetector(),g=document.getElementById("color-detection-mode-select"),h;h="fg"===b.colorDetectionMode?b.fgColor:b.bgColor;color_distance=b.colorDistance;a.style.backgroundColor="rgb("+h[0]+","+h[1]+","+h[2]+")";c.value=color_distance;g.value=b.colorDetectionMode}return{startPicker:function(){wpd.graphicsWidget.removeTool();wpd.graphicsWidget.removeRepainter();wpd.graphicsWidget.resetData();
"fg"===wpd.appData.getPlotData().getAutoDetector().colorDetectionMode?wpd.colorSelectionWidget.setParams(b()):wpd.colorSelectionWidget.setParams(a());wpd.colorSelectionWidget.startPicker()},changeDetectionMode:function(){var a=document.getElementById("color-detection-mode-select");wpd.appData.getPlotData().getAutoDetector().colorDetectionMode=a.value;c()},changeColorDistance:function(){var a=parseFloat(document.getElementById("color-distance-value").value);wpd.appData.getPlotData().getAutoDetector().colorDistance=
a},init:c,testColorDetection:function(){wpd.graphicsWidget.removeTool();wpd.graphicsWidget.resetData();wpd.graphicsWidget.setRepainter(new wpd.ColorFilterRepainter);var a=wpd.graphicsWidget.getAllContexts(),c=wpd.appData.getPlotData().getAutoDetector(),b=wpd.graphicsWidget.getImageSize();c.imageData=a.oriImageCtx.getImageData(0,0,b.width,b.height);c.generateBinaryData();wpd.colorSelectionWidget.paintFilteredColor(c.binaryData,c.mask)}}}();
wpd.ColorPickerTool=function(){return function(){var b=wpd.graphicsWidget.getAllContexts();this.onMouseClick=function(a,c,d){a=b.oriImageCtx.getImageData(d.x,d.y,1,1);this.onComplete([a.data[0],a.data[1],a.data[2]])};this.onComplete=function(a){}}}();wpd.ColorFilterRepainter=function(){return function(){this.painterName="colorFilterRepainter";this.onRedraw=function(){var b=wpd.appData.getPlotData().getAutoDetector();wpd.colorSelectionWidget.paintFilteredColor(b.binaryData,b.mask)}}}();wpd=wpd||{};
wpd.dataSeriesManagement=function(){function b(){if(wpd.appData.isAligned()){var a=document.getElementById("manage-data-series-name"),c=document.getElementById("manage-data-series-point-count"),b=document.getElementById("manage-data-series-list"),d=wpd.appData.getPlotData(),l=d.getActiveDataSeries(),p=d.getDataSeriesNames(),d=d.getActiveDataSeriesIndex(),m="";a.value=l.name;c.innerHTML=l.getCount();for(a=0;a<p.length;a++)m+='<option value="'+a+'">'+p[a]+"</option>";b.innerHTML=m;b.selectedIndex=d;
wpd.popup.show("manage-data-series-window")}else wpd.messagePopup.show("Manage Dataset","Please calibrate the axes before managing datasets.")}function a(){wpd.graphicsWidget.forceHandlerRepaint();wpd.autoExtraction.updateDatasetControl();wpd.acquireData.updateDatasetControl();wpd.dataPointCounter.setCount()}function c(){wpd.popup.close("manage-data-series-window")}var d=1;return{manage:b,addSeries:function(){var e=wpd.appData.getPlotData(),f="Dataset "+d,g=e.dataSeriesColl.length;c();e.dataSeriesColl[g]=
new wpd.DataSeries;e.dataSeriesColl[g].name=f;e.setActiveDataSeriesIndex(g);a();d++;b()},deleteSeries:function(){c();1===wpd.appData.getPlotData().dataSeriesColl.length?wpd.messagePopup.show("Can Not Delete!","You can not delete this dataset as at least one dataset is required.",b):wpd.okCancelPopup.show("Delete Dataset","Are you sure that you want to delete the dataset and all containing data points?",function(){var a=wpd.appData.getPlotData(),c=a.getActiveDataSeriesIndex();a.dataSeriesColl.splice(c,
1);a.setActiveDataSeriesIndex(0);b()},function(){b()})},viewData:function(){c();wpd.dataTable.showTable()},changeSelectedSeries:function(){var d=document.getElementById("manage-data-series-list"),f=wpd.appData.getPlotData();c();f.setActiveDataSeriesIndex(d.selectedIndex);a();b()},editSeriesName:function(){var d=wpd.appData.getPlotData().getActiveDataSeries(),f=document.getElementById("manage-data-series-name");c();d.name=f.value;a();b()}}}();wpd=wpd||{};
wpd.gridDetection=function(){return{start:function(){wpd.graphicsWidget.removeTool();wpd.graphicsWidget.removeRepainter();wpd.graphicsWidget.resetData();wpd.sidebar.show("grid-detection-sidebar")},markBox:function(){var b=new wpd.GridBoxTool;wpd.graphicsWidget.setTool(b)},clearMask:function(){wpd.graphicsWidget.removeTool();wpd.graphicsWidget.removeRepainter();wpd.appData.getPlotData().getAutoDetector().gridMask={xmin:null,xmax:null,ymin:null,ymax:null,pixels:[]};wpd.graphicsWidget.resetData()},viewMask:function(){var b=
new wpd.GridViewMaskTool;wpd.graphicsWidget.setTool(b)},grabMask:function(){var b=wpd.graphicsWidget.getAllContexts(),a=wpd.graphicsWidget.getImageSize(),b=b.oriDataCtx.getImageData(0,0,a.width,a.height),c=[],d,e=0,f=wpd.appData.getPlotData().getAutoDetector(),g,h;for(d=0;d<b.data.length;d+=4)255===b.data[d]&&255===b.data[d+1]&&0===b.data[d+2]&&(c[e]=d/4,e++,g=parseInt(d/4%a.width,10),h=parseInt(d/4/a.width,10),1===e?(f.gridMask.xmin=g,f.gridMask.xmax=g,f.gridMask.ymin=h,f.gridMask.ymax=h):(g<f.gridMask.xmin&&
(f.gridMask.xmin=g),g>f.gridMask.xmax&&(f.gridMask.xmax=g),h<f.gridMask.ymin&&(f.gridMask.ymin=h),h>f.gridMask.ymax&&(f.gridMask.ymax=h)));f.gridMask.pixels=c},startColorPicker:function(){wpd.colorSelectionWidget.setParams({color:wpd.appData.getPlotData().getAutoDetector().gridLineColor,triggerElementId:"grid-color-picker-button",title:"Specify Grid Line Color",setColorDelegate:function(b){wpd.appData.getPlotData().getAutoDetector().gridLineColor=b}});wpd.colorSelectionWidget.startPicker()},changeColorDistance:function(){var b=
parseFloat(document.getElementById("grid-color-distance").value);wpd.appData.getPlotData().getAutoDetector().gridColorDistance=b},testColor:function(){wpd.graphicsWidget.removeTool();wpd.graphicsWidget.resetData();wpd.graphicsWidget.setRepainter(new wpd.GridColorFilterRepainter);var b=wpd.graphicsWidget.getAllContexts(),a=wpd.appData.getPlotData().getAutoDetector(),c=wpd.graphicsWidget.getImageSize();a.imageData=b.oriImageCtx.getImageData(0,0,c.width,c.height);a.generateGridBinaryData();wpd.colorSelectionWidget.paintFilteredColor(a.gridBinaryData,
a.gridMask.pixels)},run:function(){wpd.graphicsWidget.removeTool();wpd.graphicsWidget.removeRepainter();var b=wpd.appData.getPlotData().getAutoDetector(),a=wpd.graphicsWidget.getAllContexts(),c=wpd.graphicsWidget.getImageSize();b.imageData=a.oriImageCtx.getImageData(0,0,c.width,c.height);b.generateGridBinaryData();wpd.gridDetectionCore.setHorizontalParameters(!0,5,5);wpd.gridDetectionCore.setVerticalParameters(!0,5,5);wpd.gridDetectionCore.run()},clear:function(){wpd.graphicsWidget.removeTool();wpd.appData.getPlotData().gridData=
null;wpd.graphicsWidget.removeRepainter();wpd.graphicsWidget.resetData()}}}();wpd.GridColorFilterRepainter=function(){return function(){this.painterName="gridColorFilterRepainter";this.onRedraw=function(){var b=wpd.appData.getPlotData().getAutoDetector();wpd.colorSelectionWidget.paintFilteredColor(b.gridBinaryData,b.gridMask.pixels)}}}();
wpd.GridBoxTool=function(){return function(){var b=!1,a,c,d=wpd.graphicsWidget.getAllContexts(),e,f,g=function(){wpd.graphicsWidget.resetHover();d.hoverCtx.strokeStyle="rgb(0,0,0)";d.hoverCtx.strokeRect(c.x,c.y,f.x-c.x,f.y-c.y)},h=function(f,g,h){!1!==b&&(clearTimeout(e),b=!1,wpd.graphicsWidget.resetHover(),d.dataCtx.fillStyle="rgba(255,255,0,0.8)",d.dataCtx.fillRect(c.x,c.y,g.x-c.x,g.y-c.y),d.oriDataCtx.fillStyle="rgba(255,255,0,0.8)",d.oriDataCtx.fillRect(a.x,a.y,h.x-a.x,h.y-a.y))},l=null,p=null;
this.onAttach=function(){wpd.graphicsWidget.setRepainter(new wpd.GridMaskPainter);document.getElementById("grid-mask-box").classList.add("pressed-button");document.getElementById("grid-mask-view").classList.add("pressed-button")};this.onMouseDown=function(d,e,f){!0!==b&&(b=!0,a=f,c=e)};this.onMouseMove=function(a,c,d){!1!==b&&(f=c,clearTimeout(e),e=setTimeout(g,2))};this.onMouseOut=function(a,c,d){!0===b&&(clearTimeout(e),l=c,p=d)};this.onDocumentMouseUp=function(a,c,b){null!=l&&null!=p?h(a,l,p):
h(a,c,b);p=l=null};this.onMouseUp=function(a,c,b){h(a,c,b)};this.onRemove=function(){document.getElementById("grid-mask-box").classList.remove("pressed-button");document.getElementById("grid-mask-view").classList.remove("pressed-button");wpd.gridDetection.grabMask()}}}();
wpd.GridViewMaskTool=function(){return function(){this.onAttach=function(){wpd.graphicsWidget.setRepainter(new wpd.GridMaskPainter);document.getElementById("grid-mask-view").classList.add("pressed-button")};this.onRemove=function(){document.getElementById("grid-mask-view").classList.remove("pressed-button");wpd.gridDetection.grabMask()}}}();
wpd.GridMaskPainter=function(){return function(){var b=wpd.graphicsWidget.getAllContexts(),a=wpd.appData.getPlotData().getAutoDetector(),c=function(){if(null!=a.gridMask.pixels&&0!==a.gridMask.pixels.length){var c,e;c=wpd.graphicsWidget.getImageSize();imgData=b.oriDataCtx.getImageData(0,0,c.width,c.height);for(c=0;c<a.gridMask.pixels.length;c++)e=a.gridMask.pixels[c],imgData.data[4*e]=255,imgData.data[4*e+1]=255,imgData.data[4*e+2]=0,imgData.data[4*e+3]=200;b.oriDataCtx.putImageData(imgData,0,0);
wpd.graphicsWidget.copyImageDataLayerToScreen()}};this.painterName="gridMaskPainter";this.onRedraw=function(){wpd.gridDetection.grabMask();c()};this.onAttach=function(){wpd.graphicsWidget.resetData();c()}}}();wpd=wpd||{};
wpd.imageOps=function(){function b(a,b,e){var f,g,h,l,p,m;for(f=0;f<e;f++)for(g=0;g<b/2;g++)for(h=4*(f*b+g),l=4*((f+1)*b-(g+1)),m=0;4>m;m++)p=a.data[h+m],a.data[h+m]=a.data[l+m],a.data[l+m]=p;return{imageData:a,width:b,height:e}}function a(a,b,e){var f,g,h,l,p,m;for(f=0;f<e/2;f++)for(g=0;g<b;g++)for(h=4*(f*b+g),l=4*((e-(f+2))*b+g),m=0;4>m;m++)p=a.data[h+m],a.data[h+m]=a.data[l+m],a.data[l+m]=p;return{imageData:a,width:b,height:e}}return{hflip:function(){wpd.graphicsWidget.runImageOp(b)},vflip:function(){wpd.graphicsWidget.runImageOp(a)}}}();
wpd=wpd||{};wpd.keyCodes=function(){return{isUp:function(b){return 38===b},isDown:function(b){return 40===b},isLeft:function(b){return 37===b},isRight:function(b){return 39===b},isAlphabet:function(b,a){return 90<b||65>b?!1:String.fromCharCode(b).toLowerCase()===a}}}();wpd=wpd||{};
wpd.acquireData=function(){function b(){var a=new wpd.ManualSelectionTool;wpd.graphicsWidget.setTool(a)}function a(){var a=new wpd.DeleteDataPointTool;wpd.graphicsWidget.setTool(a)}function c(){wpd.sidebar.show("acquireDataSidebar");d();wpd.dataPointCounter.setCount()}function d(){var a=wpd.appData.getPlotData();a.getActiveDataSeries();var c=a.getActiveDataSeriesIndex(),b=document.getElementById("manual-sidebar-dataset-list"),d="",e;for(e=0;e<a.dataSeriesColl.length;e++)d+="<option>"+a.dataSeriesColl[e].name+
"</option>";b.innerHTML=d;b.selectedIndex=c}function e(){wpd.graphicsWidget.setTool(new wpd.AdjustDataPointTool)}return{load:function(){wpd.appData.isAligned()?(c(),wpd.dataPointCounter.setCount(),wpd.graphicsWidget.removeTool(),wpd.graphicsWidget.setRepainter(new wpd.DataPointsRepainter),b()):wpd.messagePopup.show("Acquire Data","Please calibrate the axes before acquiring data.")},manualSelection:b,adjustPoints:e,deletePoint:a,clearAll:function(){wpd.appData.getPlotData().getActiveDataSeries().clearAll();
wpd.graphicsWidget.removeTool();wpd.graphicsWidget.resetData();wpd.dataPointCounter.setCount();wpd.graphicsWidget.removeRepainter()},undo:function(){wpd.appData.getPlotData().getActiveDataSeries().removeLastPixel();wpd.graphicsWidget.resetData();wpd.graphicsWidget.forceHandlerRepaint();wpd.dataPointCounter.setCount()},showSidebar:c,switchToolOnKeyPress:function(c){switch(c){case "d":a();break;case "a":b();break;case "s":e()}},updateDatasetControl:d,changeDataset:function(){var a=document.getElementById("manual-sidebar-dataset-list").selectedIndex;
wpd.appData.getPlotData().setActiveDataSeriesIndex(a);wpd.graphicsWidget.forceHandlerRepaint();wpd.dataPointCounter.setCount()}}}();
wpd.ManualSelectionTool=function(){return function(){var b=wpd.graphicsWidget.getAllContexts(),a=wpd.appData.getPlotData();this.onAttach=function(){document.getElementById("manual-select-button").classList.add("pressed-button");wpd.graphicsWidget.setRepainter(new wpd.DataPointsRepainter)};this.onMouseClick=function(c,d,e){a.getActiveDataSeries().addPixel(e.x,e.y);b.dataCtx.beginPath();b.dataCtx.fillStyle="rgb(200,0,0)";b.dataCtx.arc(d.x,d.y,3,0,2*Math.PI,!0);b.dataCtx.fill();b.oriDataCtx.beginPath();
b.oriDataCtx.fillStyle="rgb(200,0,0)";b.oriDataCtx.arc(e.x,e.y,3,0,2*Math.PI,!0);b.oriDataCtx.fill();wpd.graphicsWidget.updateZoomOnEvent(c);wpd.dataPointCounter.setCount()};this.onRemove=function(){document.getElementById("manual-select-button").classList.remove("pressed-button")};this.onKeyDown=function(c){var b=a.getActiveDataSeries(),e=b.getCount()-1,f=b.getPixel(e),g=0.5/wpd.graphicsWidget.getZoomRatio();if(wpd.keyCodes.isUp(c.keyCode))f.y-=g;else if(wpd.keyCodes.isDown(c.keyCode))f.y+=g;else if(wpd.keyCodes.isLeft(c.keyCode))f.x-=
g;else if(wpd.keyCodes.isRight(c.keyCode))f.x+=g;else{(wpd.keyCodes.isAlphabet(c.keyCode,"a")||wpd.keyCodes.isAlphabet(c.keyCode,"s")||wpd.keyCodes.isAlphabet(c.keyCode,"d"))&&wpd.acquireData.switchToolOnKeyPress(String.fromCharCode(c.keyCode).toLowerCase());return}b.setPixelAt(e,f.x,f.y);wpd.graphicsWidget.resetData();wpd.graphicsWidget.forceHandlerRepaint();wpd.graphicsWidget.updateZoomToImagePosn(f.x,f.y);c.preventDefault()}}}();
wpd.DeleteDataPointTool=function(){return function(){wpd.graphicsWidget.getAllContexts();var b=wpd.appData.getPlotData();this.onAttach=function(){document.getElementById("delete-point-button").classList.add("pressed-button");wpd.graphicsWidget.setRepainter(new wpd.DataPointsRepainter)};this.onMouseClick=function(a,c,d){b.getActiveDataSeries().removeNearestPixel(d.x,d.y);wpd.graphicsWidget.resetData();wpd.graphicsWidget.forceHandlerRepaint();wpd.graphicsWidget.updateZoomOnEvent(a);wpd.dataPointCounter.setCount()};
this.onKeyDown=function(a){(wpd.keyCodes.isAlphabet(a.keyCode,"a")||wpd.keyCodes.isAlphabet(a.keyCode,"s")||wpd.keyCodes.isAlphabet(a.keyCode,"d"))&&wpd.acquireData.switchToolOnKeyPress(String.fromCharCode(a.keyCode).toLowerCase())};this.onRemove=function(){document.getElementById("delete-point-button").classList.remove("pressed-button")}}}();
wpd.DataPointsRepainter=function(){return function(){var b=function(){var a=wpd.graphicsWidget.getAllContexts(),c=wpd.appData.getPlotData().getActiveDataSeries(),b,e,f,g;for(b=0;b<c.getCount();b++)e=c.getPixel(b),g=0<=c.getSelectedPixels().indexOf(b),f=wpd.graphicsWidget.screenPx(e.x,e.y),a.dataCtx.beginPath(),a.dataCtx.fillStyle=g?"rgb(0,200,0)":"rgb(200,0,0)",a.dataCtx.arc(f.x,f.y,3,0,2*Math.PI,!0),a.dataCtx.fill(),a.oriDataCtx.beginPath(),a.oriDataCtx.fillStyle=g?"rgb(0,200,0)":"rgb(200,0,0)",
a.oriDataCtx.arc(e.x,e.y,3,0,2*Math.PI,!0),a.oriDataCtx.fill()};this.painterName="dataPointsRepainter";this.onAttach=function(){wpd.graphicsWidget.resetData();b()};this.onRedraw=function(){b()};this.onForcedRedraw=function(){wpd.graphicsWidget.resetData();b()}}}();
wpd.AdjustDataPointTool=function(){return function(){this.onAttach=function(){document.getElementById("manual-adjust-button").classList.add("pressed-button");wpd.graphicsWidget.setRepainter(new wpd.DataPointsRepainter)};this.onRemove=function(){wpd.appData.getPlotData().getActiveDataSeries().unselectAll();wpd.graphicsWidget.forceHandlerRepaint();document.getElementById("manual-adjust-button").classList.remove("pressed-button")};this.onMouseClick=function(b,a,c){a=wpd.appData.getPlotData().getActiveDataSeries();
a.unselectAll();a.selectNearestPixel(c.x,c.y);wpd.graphicsWidget.forceHandlerRepaint();wpd.graphicsWidget.updateZoomOnEvent(b)};this.onKeyDown=function(b){if(wpd.keyCodes.isAlphabet(b.keyCode,"a")||wpd.keyCodes.isAlphabet(b.keyCode,"s")||wpd.keyCodes.isAlphabet(b.keyCode,"d"))wpd.acquireData.switchToolOnKeyPress(String.fromCharCode(b.keyCode).toLowerCase());else{var a=wpd.appData.getPlotData().getActiveDataSeries(),c=a.getSelectedPixels()[0];if(null!=c){var d=a.getPixel(c),e=d.x,d=d.y,f=!0===b.shiftKey?
5/wpd.graphicsWidget.getZoomRatio():0.5/wpd.graphicsWidget.getZoomRatio();if(wpd.keyCodes.isUp(b.keyCode))d-=f;else if(wpd.keyCodes.isDown(b.keyCode))d+=f;else if(wpd.keyCodes.isLeft(b.keyCode))e-=f;else if(wpd.keyCodes.isRight(b.keyCode))e+=f;else return;a.setPixelAt(c,e,d);wpd.graphicsWidget.forceHandlerRepaint();wpd.graphicsWidget.updateZoomToImagePosn(e,d);b.preventDefault();b.stopPropagation()}}}}}();
wpd.dataPointCounter=function(){return{setCount:function(){var b=document.getElementsByClassName("data-point-counter"),a;for(a=0;a<b.length;a++)b[a].innerHTML=wpd.appData.getPlotData().getActiveDataSeries().getCount()}}}();wpd=wpd||{};
wpd.dataMask=function(){function b(){var a=wpd.graphicsWidget.getAllContexts(),c=wpd.graphicsWidget.getImageSize(),a=a.oriDataCtx.getImageData(0,0,c.width,c.height),c=[],b,e=0,f=wpd.appData.getPlotData().getAutoDetector();for(b=0;b<a.data.length;b+=4)255===a.data[b]&&255===a.data[b+1]&&0===a.data[b+2]&&(c[e]=b/4,e++);f.mask=c}return{grabMask:b,markBox:function(){var a=new wpd.BoxMaskTool;wpd.graphicsWidget.setTool(a)},markPen:function(){var a=new wpd.PenMaskTool;wpd.graphicsWidget.setTool(a)},eraseMarks:function(){var a=
new wpd.EraseMaskTool;wpd.graphicsWidget.setTool(a)},viewMask:function(){var a=new wpd.ViewMaskTool;wpd.graphicsWidget.setTool(a)},clearMask:function(){wpd.graphicsWidget.resetData();b()}}}();
wpd.BoxMaskTool=function(){return function(){var b=!1,a,c,d=wpd.graphicsWidget.getAllContexts(),e,f,g=function(){wpd.graphicsWidget.resetHover();d.hoverCtx.strokeStyle="rgb(0,0,0)";d.hoverCtx.strokeRect(c.x,c.y,f.x-c.x,f.y-c.y)},h=function(f,g,h){!1!==b&&(clearTimeout(e),b=!1,wpd.graphicsWidget.resetHover(),d.dataCtx.fillStyle="rgba(255,255,0,0.8)",d.dataCtx.fillRect(c.x,c.y,g.x-c.x,g.y-c.y),d.oriDataCtx.fillStyle="rgba(255,255,0,0.8)",d.oriDataCtx.fillRect(a.x,a.y,h.x-a.x,h.y-a.y))},l=null,p=null;
this.onAttach=function(){wpd.graphicsWidget.setRepainter(new wpd.MaskPainter);document.getElementById("box-mask").classList.add("pressed-button");document.getElementById("view-mask").classList.add("pressed-button")};this.onMouseDown=function(d,e,f){!0!==b&&(b=!0,a=f,c=e)};this.onMouseMove=function(a,c,d){!1!==b&&(f=c,clearTimeout(e),e=setTimeout(g,2))};this.onMouseOut=function(a,c,d){!0===b&&(clearTimeout(e),l=c,p=d)};this.onDocumentMouseUp=function(a,b,c){null!=l&&null!=p?h(a,l,p):h(a,b,c);p=l=null};
this.onMouseUp=function(a,b,c){h(a,b,c)};this.onRemove=function(){document.getElementById("box-mask").classList.remove("pressed-button");document.getElementById("view-mask").classList.remove("pressed-button");wpd.dataMask.grabMask()}}}();
wpd.PenMaskTool=function(){return function(){var b=wpd.graphicsWidget.getAllContexts(),a=!1,c,d,e,f=function(){b.dataCtx.strokeStyle="rgba(255,255,0,0.8)";b.dataCtx.lineTo(d.x,d.y);b.dataCtx.stroke();b.oriDataCtx.strokeStyle="rgba(255,255,0,0.8)";b.oriDataCtx.lineTo(e.x,e.y);b.oriDataCtx.stroke()};this.onAttach=function(){wpd.graphicsWidget.setRepainter(new wpd.MaskPainter);document.getElementById("pen-mask").classList.add("pressed-button");document.getElementById("view-mask").classList.add("pressed-button");
wpd.toolbar.show("paintToolbar")};this.onMouseDown=function(c,d,e){!0!==a&&(c=parseInt(document.getElementById("paintThickness").value,10),a=!0,b.dataCtx.strokeStyle="rgba(255,255,0,0.8)",b.dataCtx.lineWidth=c*wpd.graphicsWidget.getZoomRatio(),b.dataCtx.beginPath(),b.dataCtx.moveTo(d.x,d.y),b.oriDataCtx.strokeStyle="rgba(255,255,0,0.8)",b.oriDataCtx.lineWidth=c,b.oriDataCtx.beginPath(),b.oriDataCtx.moveTo(e.x,e.y))};this.onMouseMove=function(b,h,l){!1!==a&&(d=h,e=l,clearTimeout(c),c=setTimeout(f,
2))};this.onMouseUp=function(d,e,f){clearTimeout(c);b.dataCtx.closePath();b.dataCtx.lineWidth=1;b.oriDataCtx.closePath();b.oriDataCtx.lineWidth=1;a=!1};this.onMouseOut=function(a,c,b){this.onMouseUp(a,c,b)};this.onRemove=function(){document.getElementById("pen-mask").classList.remove("pressed-button");document.getElementById("view-mask").classList.remove("pressed-button");wpd.dataMask.grabMask();wpd.toolbar.clear()}}}();
wpd.EraseMaskTool=function(){return function(){var b=wpd.graphicsWidget.getAllContexts(),a=!1,c,d,e,f=function(){b.dataCtx.globalCompositeOperation="destination-out";b.oriDataCtx.globalCompositeOperation="destination-out";b.dataCtx.strokeStyle="rgba(255,255,0,1)";b.dataCtx.lineTo(d.x,d.y);b.dataCtx.stroke();b.oriDataCtx.strokeStyle="rgba(255,255,0,1)";b.oriDataCtx.lineTo(e.x,e.y);b.oriDataCtx.stroke()};this.onAttach=function(){wpd.graphicsWidget.setRepainter(new wpd.MaskPainter);document.getElementById("erase-mask").classList.add("pressed-button");
document.getElementById("view-mask").classList.add("pressed-button");wpd.toolbar.show("eraseToolbar")};this.onMouseDown=function(c,d,e){!0!==a&&(c=parseInt(document.getElementById("eraseThickness").value,10),a=!0,b.dataCtx.globalCompositeOperation="destination-out",b.oriDataCtx.globalCompositeOperation="destination-out",b.dataCtx.strokeStyle="rgba(0,0,0,1)",b.dataCtx.lineWidth=c*wpd.graphicsWidget.getZoomRatio(),b.dataCtx.beginPath(),b.dataCtx.moveTo(d.x,d.y),b.oriDataCtx.strokeStyle="rgba(0,0,0,1)",
b.oriDataCtx.lineWidth=c,b.oriDataCtx.beginPath(),b.oriDataCtx.moveTo(e.x,e.y))};this.onMouseMove=function(b,h,l){!1!==a&&(d=h,e=l,clearTimeout(c),c=setTimeout(f,2))};this.onMouseOut=function(a,c,b){this.onMouseUp(a,c,b)};this.onMouseUp=function(d,e,f){clearTimeout(c);b.dataCtx.closePath();b.dataCtx.lineWidth=1;b.oriDataCtx.closePath();b.oriDataCtx.lineWidth=1;b.dataCtx.globalCompositeOperation="source-over";b.oriDataCtx.globalCompositeOperation="source-over";a=!1};this.onRemove=function(){document.getElementById("erase-mask").classList.remove("pressed-button");
document.getElementById("view-mask").classList.remove("pressed-button");wpd.dataMask.grabMask();wpd.toolbar.clear()}}}();wpd.ViewMaskTool=function(){return function(){this.onAttach=function(){wpd.graphicsWidget.setRepainter(new wpd.MaskPainter);document.getElementById("view-mask").classList.add("pressed-button")};this.onRemove=function(){document.getElementById("view-mask").classList.remove("pressed-button");wpd.dataMask.grabMask()}}}();
wpd.MaskPainter=function(){return function(){var b=wpd.graphicsWidget.getAllContexts(),a=wpd.appData.getPlotData().getAutoDetector(),c=function(){if(null!=a.mask&&0!==a.mask.length){var c,e;c=wpd.graphicsWidget.getImageSize();imgData=b.oriDataCtx.getImageData(0,0,c.width,c.height);for(c=0;c<a.mask.length;c++)e=a.mask[c],imgData.data[4*e]=255,imgData.data[4*e+1]=255,imgData.data[4*e+2]=0,imgData.data[4*e+3]=200;b.oriDataCtx.putImageData(imgData,0,0);wpd.graphicsWidget.copyImageDataLayerToScreen()}};
this.painterName="dataMaskPainter";this.onRedraw=function(){wpd.dataMask.grabMask();c()};this.onAttach=function(){wpd.graphicsWidget.resetData();c()}}}();wpd=wpd||{};
wpd.distanceMeasurement=function(){return{start:function(){wpd.graphicsWidget.removeTool();wpd.graphicsWidget.resetData();var b=wpd.appData.getPlotData();null==b.distanceMeasurementData&&(b.distanceMeasurementData=new wpd.ConnectedPoints(2));wpd.sidebar.show("measure-distances-sidebar");wpd.graphicsWidget.setTool(new wpd.AddMeasurementTool("distance"));wpd.graphicsWidget.forceHandlerRepaint()},addPair:function(){wpd.graphicsWidget.setTool(new wpd.AddMeasurementTool("distance"))},deletePair:function(){wpd.graphicsWidget.setTool(new wpd.DeleteMeasurementTool("distance"))},
clearAll:function(){wpd.graphicsWidget.removeTool();wpd.graphicsWidget.resetData();wpd.appData.getPlotData().distanceMeasurementData=new wpd.ConnectedPoints(2)}}}();
wpd.angleMeasurement=function(){return{start:function(){wpd.graphicsWidget.removeTool();wpd.graphicsWidget.resetData();var b=wpd.appData.getPlotData();null==b.angleMeasurementData&&(b.angleMeasurementData=new wpd.ConnectedPoints(3));wpd.sidebar.show("measure-angles-sidebar");wpd.graphicsWidget.setTool(new wpd.AddMeasurementTool("angle"));wpd.graphicsWidget.forceHandlerRepaint()},addAngle:function(){wpd.graphicsWidget.setTool(new wpd.AddMeasurementTool("angle"))},deleteAngle:function(){wpd.graphicsWidget.setTool(new wpd.DeleteMeasurementTool("angle"))},
clearAll:function(){wpd.graphicsWidget.removeTool();wpd.graphicsWidget.resetData();wpd.appData.getPlotData().angleMeasurementData=new wpd.ConnectedPoints(3)}}}();
wpd.measurementData=function(){var b;return{showAngleData:function(){wpd.popup.show("measurement-data-window");var a=wpd.appData.getPlotData().angleMeasurementData,c=a.connectionCount(),d,e=document.getElementById("measurement-data-table");b="";for(d=0;d<c;d++)b+=d.toString()+", "+a.getAngle(d)+"\n";e.value=b},showDistanceData:function(){wpd.popup.show("measurement-data-window");var a=wpd.appData.getPlotData().distanceMeasurementData,c=a.connectionCount(),d,e=document.getElementById("measurement-data-table"),
f=wpd.appData.getPlotData().axes;b="";for(d=0;d<c;d++)b=!0===wpd.appData.isAligned()&&f instanceof wpd.MapAxes?b+(d.toString()+", "+f.pixelToDataDistance(a.getDistance(d))+"\n"):b+(d.toString()+", "+a.getDistance(d)+"\n");e.value=b},selectAll:function(){var a=document.getElementById("measurement-data-table");a.focus();a.select()},generateCSV:function(){var a,c,d,e=JSON.stringify(b);a=document.createElement("div");c=document.createElement("form");d=document.createElement("input");c.setAttribute("method",
"post");c.setAttribute("action","php/csvexport.php");d.setAttribute("type","text");d.setAttribute("name","data");c.appendChild(d);a.appendChild(c);document.body.appendChild(a);a.style.display="none";d.setAttribute("value",e);c.submit();document.body.removeChild(a)},close:function(){b="";wpd.popup.close("measurement-data-window")}}}();
wpd.AddMeasurementTool=function(){return function(b){var a="distance"===b,c=wpd.graphicsWidget.getAllContexts(),d=wpd.appData.getPlotData(),e=0,f=!0,g=[],h=a?2:3;this.onAttach=function(){document.getElementById(!0===a?"add-pair-button":"add-angle-button").classList.add("pressed-button");wpd.graphicsWidget.setRepainter(new wpd.MeasurementRepainter(b))};this.onRemove=function(){document.getElementById(!0===a?"add-pair-button":"add-angle-button").classList.remove("pressed-button")};this.onMouseClick=
function(l,p,m){if(f){wpd.graphicsWidget.resetHover();g[2*e]=m.x;g[2*e+1]=m.y;e+=1;e===h&&(f=!1,a?d.distanceMeasurementData.addConnection(g):d.angleMeasurementData.addConnection(g),wpd.graphicsWidget.forceHandlerRepaint(),wpd.graphicsWidget.setTool(new wpd.AdjustMeasurementTool(b)));if(1<e){var q=wpd.graphicsWidget.screenPx(g[2*(e-2)],g[2*(e-2)+1]);c.dataCtx.beginPath();c.dataCtx.strokeStyle="rgb(0,0,10)";c.dataCtx.moveTo(q.x,q.y);c.dataCtx.lineTo(p.x,p.y);c.dataCtx.stroke();c.oriDataCtx.beginPath();
c.oriDataCtx.strokeStyle="rgb(0,0,10)";c.oriDataCtx.moveTo(g[2*(e-2)],g[2*(e-2)+1]);c.oriDataCtx.lineTo(m.x,m.y);c.oriDataCtx.stroke()}c.dataCtx.beginPath();c.dataCtx.fillStyle="rgb(200, 0, 0)";c.dataCtx.arc(p.x,p.y,3,0,2*Math.PI,!0);c.dataCtx.fill();c.oriDataCtx.beginPath();c.oriDataCtx.fillStyle="rgb(200,0,0)";c.oriDataCtx.arc(m.x,m.y,3,0,2*Math.PI,!0);c.oriDataCtx.fill()}wpd.graphicsWidget.updateZoomOnEvent(l)};this.onMouseMove=function(a,b,d){f&&1<=e&&(wpd.graphicsWidget.resetHover(),a=wpd.graphicsWidget.screenPx(g[2*
(e-1)],g[2*(e-1)+1]),c.hoverCtx.beginPath(),c.hoverCtx.strokeStyle="rgb(0,0,0)",c.hoverCtx.moveTo(a.x,a.y),c.hoverCtx.lineTo(b.x,b.y),c.hoverCtx.stroke())};this.onKeyDown=function(a){}}}();
wpd.DeleteMeasurementTool=function(){return function(b){var a="distance"===b;wpd.graphicsWidget.getAllContexts();var c=wpd.appData.getPlotData();this.onAttach=function(){document.getElementById(!0===a?"delete-pair-button":"delete-angle-button").classList.add("pressed-button");wpd.graphicsWidget.setRepainter(new wpd.MeasurementRepainter(b))};this.onRemove=function(){document.getElementById(!0===a?"delete-pair-button":"delete-angle-button").classList.remove("pressed-button")};this.onMouseClick=function(d,
e,f){a?c.distanceMeasurementData.deleteNearestConnection(f.x,f.y):c.angleMeasurementData.deleteNearestConnection(f.x,f.y);wpd.graphicsWidget.setTool(new wpd.AdjustMeasurementTool(b));wpd.graphicsWidget.resetData();wpd.graphicsWidget.forceHandlerRepaint();wpd.graphicsWidget.updateZoomOnEvent(d)}}}();
wpd.AdjustMeasurementTool=function(){return function(b){this.onAttach=function(){wpd.graphicsWidget.setRepainter(new wpd.MeasurementRepainter(b))};this.onMouseClick=function(a,c,d){c=wpd.appData.getPlotData();"distance"===b?c.distanceMeasurementData.selectNearestPoint(d.x,d.y):"angle"===b&&c.angleMeasurementData.selectNearestPoint(d.x,d.y);wpd.graphicsWidget.forceHandlerRepaint();wpd.graphicsWidget.updateZoomOnEvent(a)};this.onKeyDown=function(a){if(wpd.keyCodes.isAlphabet(a.keyCode,"a"))wpd.graphicsWidget.setTool(new wpd.AddMeasurementTool(b));
else if(wpd.keyCodes.isAlphabet(a.keyCode,"d"))wpd.graphicsWidget.setTool(new wpd.DeleteMeasurementTool(b));else{var c=wpd.appData.getPlotData(),c="distance"===b?c.distanceMeasurementData:c.angleMeasurementData,d=c.getSelectedConnectionAndPoint();if(0<=d.connectionIndex&&0<=d.pointIndex){var e=!0===a.shiftKey?5/wpd.graphicsWidget.getZoomRatio():0.5/wpd.graphicsWidget.getZoomRatio(),f=c.getPointAt(d.connectionIndex,d.pointIndex);if(wpd.keyCodes.isUp(a.keyCode))f.y-=e;else if(wpd.keyCodes.isDown(a.keyCode))f.y+=
e;else if(wpd.keyCodes.isLeft(a.keyCode))f.x-=e;else if(wpd.keyCodes.isRight(a.keyCode))f.x+=e;else return;c.setPointAt(d.connectionIndex,d.pointIndex,f.x,f.y);wpd.graphicsWidget.forceHandlerRepaint();wpd.graphicsWidget.updateZoomToImagePosn(f.x,f.y);a.preventDefault();a.stopPropagation()}}}}}();
wpd.MeasurementRepainter=function(){return function(b){var a="distance"===b,c="angle"===b,d=wpd.graphicsWidget.getAllContexts(),e=function(a,c,b,e,f,g,n,u){d.dataCtx.beginPath();d.dataCtx.strokeStyle="rgb(0,0,10)";d.dataCtx.moveTo(a,c);d.dataCtx.lineTo(b,e);d.dataCtx.stroke();d.oriDataCtx.beginPath();d.oriDataCtx.strokeStyle="rgb(0,0,10)";d.oriDataCtx.moveTo(f,g);d.oriDataCtx.lineTo(n,u);d.oriDataCtx.stroke()},f=function(a,c,b,e,f){d.dataCtx.beginPath();d.dataCtx.fillStyle=f?"rgb(0, 200, 0)":"rgb(200, 0, 0)";
d.dataCtx.arc(a,c,3,0,2*Math.PI,!0);d.dataCtx.fill();d.oriDataCtx.beginPath();d.oriDataCtx.fillStyle=f?"rgb(0,200,0)":"rgb(200,0,0)";d.oriDataCtx.arc(b,e,3,0,2*Math.PI,!0);d.oriDataCtx.fill()},g=function(a,c,b,e,f){d.dataCtx.font="14px sans-serif";d.dataCtx.fillText(f,parseInt(a,10),parseInt(c,10));d.oriDataCtx.font="14px sans-serif";d.oriDataCtx.fillText(f,parseInt(b,10),parseInt(e,10))};this.painterName="measurementRepainter-"+b;this.onAttach=function(){wpd.graphicsWidget.resetData()};this.onRedraw=
function(){if(a){var b=wpd.appData.getPlotData().distanceMeasurementData,l=b.connectionCount(),p,m,q,k,n,u,r,t,s,v,w=wpd.appData.getPlotData().axes;for(p=0;p<l;p++)m=b.getConnectionAt(p),q=m[0],k=m[1],n=m[2],m=m[3],s=b.isPointSelected(p,0),v=b.isPointSelected(p,1),t=!0===wpd.appData.isAligned()&&w instanceof wpd.MapAxes?"["+p.toString()+"]: "+w.pixelToDataDistance(b.getDistance(p)).toFixed(2)+" "+w.getUnits():"["+p.toString()+"]: "+b.getDistance(p).toFixed(2)+" px",u=wpd.graphicsWidget.screenPx(q,
k),r=wpd.graphicsWidget.screenPx(n,m),e(u.x,u.y,r.x,r.y,q,k,n,m),f(u.x,u.y,q,k,s),f(r.x,r.y,n,m,v),g(0.5*(u.x+r.x),0.5*(u.y+r.y),0.5*(q+n),0.5*(k+m),t)}if(c){var b=wpd.appData.getPlotData().angleMeasurementData,l=b.connectionCount(),y,z,G,K,F;for(p=0;p<l;p++)n=b.getConnectionAt(p),r=n[0],t=n[1],q=n[2],k=n[3],s=n[4],v=n[5],G=b.isPointSelected(p,0),K=b.isPointSelected(p,1),F=b.isPointSelected(p,2),w="["+p.toString()+"]: "+b.getAngle(p).toFixed(2)+"\u00b0",u=Math.atan2(t-k,r-q),m=Math.atan2(v-k,s-q),
y=wpd.graphicsWidget.screenPx(r,t),n=wpd.graphicsWidget.screenPx(q,k),z=wpd.graphicsWidget.screenPx(s,v),e(y.x,y.y,n.x,n.y,r,t,q,k),e(n.x,n.y,z.x,z.y,q,k,s,v),f(y.x,y.y,r,t,G),f(n.x,n.y,q,k,K),f(z.x,z.y,s,v,F),r=n.x,t=n.y,s=q,v=k,d.dataCtx.beginPath(),d.dataCtx.strokeStyle="rgb(0,0,10)",d.dataCtx.arc(r,t,15,u,m,!0),d.dataCtx.stroke(),d.oriDataCtx.beginPath(),d.oriDataCtx.strokeStyle="rgb(0,0,10)",d.oriDataCtx.arc(s,v,15,u,m,!0),d.oriDataCtx.stroke(),g(n.x+10,n.y+15,q+10,k+15,w)}};this.onForcedRedraw=
function(){wpd.graphicsWidget.resetData();this.onRedraw()}}}();wpd=wpd||{};
wpd.saveResume=function(){return{save:function(){var b=wpd.appData.getPlotData(),a=wpd.alignAxes.getActiveCalib(),c={wpd:{version:"3.4",axesType:"unknown",axesParameters:{},calibration:[],dataSeries:[],distanceMeasurementData:[],angleMeasurementData:[]}},d="",e;if(null!=a)for(d=0;d<a.getCount();d++)c.wpd.calibration[d]=a.getPoint(d);null!=b.axes&&(b.axes instanceof wpd.XYAxes?(c.wpd.axesType="XYAxes",c.wpd.axesParameters={isLogX:b.axes.isLogX(),isLogY:b.axes.isLogY(),isDateX:b.axes.isDate(0),isDateY:b.axes.isDate(1),
initialDateFormattingX:b.axes.getInitialDateFormat(0),initialDateFormattingY:b.axes.getInitialDateFormat(1)}):b.axes instanceof wpd.PolarAxes?(c.wpd.axesType="PolarAxes",c.wpd.axesParameters={isDegrees:b.axes.isThetaDegrees(),isClockwise:b.axes.isThetaClockwise()}):b.axes instanceof wpd.TernaryAxes?(c.wpd.axesType="TernaryAxes",c.wpd.axesParameters={isRange100:b.axes.isRange100(),isNormalOrientation:b.axes.isNormalOrientation()}):b.axes instanceof wpd.MapAxes?(c.wpd.axesType="MapAxes",c.wpd.axesParameters=
{scaleLength:b.axes.getScaleLength(),unitString:b.axes.getUnits()}):b.axes instanceof wpd.ImageAxes&&(c.wpd.axesType="ImageAxes"));for(d=0;d<b.dataSeriesColl.length;d++)for(e=b.dataSeriesColl[d],c.wpd.dataSeries[d]={name:e.name,data:[]},a=0;a<e.getCount();a++)c.wpd.dataSeries[d].data[a]=e.getPixel(a);if(null!=b.distanceMeasurementData)for(d=0;d<b.distanceMeasurementData.connectionCount();d++)c.wpd.distanceMeasurementData[d]=b.distanceMeasurementData.getConnectionAt(d);if(null!=b.angleMeasurementData)for(d=
0;d<b.angleMeasurementData.connectionCount();d++)c.wpd.angleMeasurementData[d]=b.angleMeasurementData.getConnectionAt(d);d=JSON.stringify(c);window.open("data:text/html,"+encodeURIComponent(d)).focus()}}}();wpd=wpd||{};
wpd.scriptInjector=function(){return{start:function(){wpd.popup.show("runScriptPopup")},cancel:function(){wpd.popup.close("runScriptPopup")},load:function(){var b=document.getElementById("runScriptFileInput");wpd.popup.close("runScriptPopup");if(1==b.files.length){var a=new FileReader;a.onload=function(){eval(a.result);wpdscript.run();window.wpdscript=wpdscript};a.readAsText(b.files[0])}}}}();wpd=wpd||{};wpd.browserInfo=function(){return{checkBrowser:function(){window.FileReader||alert("\tWARNING!\nYour web browser is not supported. This program might not behave as intended. Please use a recent version of Google Chrome, Firefox or Safari browser.")}}}();
