var wpd=wpd||{};wpd.initApp=function(){wpd.browserInfo.checkBrowser();wpd.layoutManager.initialLayout();wpd.graphicsWidget.loadImageFromURL("start.png");document.getElementById("loadingCurtain").style.display="none";wpd.messagePopup.show("Unstable Version Warning!","You are using a beta version of WebPlotDigitizer. There may be some issues with the software that are expected.")};document.addEventListener("DOMContentLoaded",wpd.initApp,!0);wpd=wpd||{};
wpd.detectionAlgoManager=function(){return{setActiveAlgo:function(b){},getActiveAlgo:function(){return null},getAllApplicableAlgorithms:function(){}}}();wpd=wpd||{};wpd.appData=function(){function b(){null==d&&(d=new wpd.PlotData);return d}var c=!1,d;return{isAligned:function(a){null!=a&&(c=a);return c},getPlotData:b,reset:function(){c=!1;d=null},plotLoaded:function(a){b().topColors=wpd.colorAnalyzer.getTopColors(a);console.log(b().topColors)}}}();wpd=wpd||{};
wpd.AutoDetector=function(){return function(){this.fgColor=[0,0,200];this.bgColor=[255,255,255];this.mask=null;this.colorDetectionMode="fg";this.colorDistance=120;this.imageData=this.binaryData=this.algorithm=null;this.imageHeight=this.imageWidth=0;this.generateBinaryData=function(){if(null!=this.mask&&0!==this.mask.length){this.binaryData=[];var b,c,d,a="fg"===this.colorDetectionMode?this.fgColor:this.bgColor;for(b=0;b<this.mask.length;b++)c=this.mask[b],d=Math.sqrt((this.imageData.data[4*c]-a[0])*
(this.imageData.data[4*c]-a[0])+(this.imageData.data[4*c+1]-a[1])*(this.imageData.data[4*c+1]-a[1])+(this.imageData.data[4*c+2]-a[2])*(this.imageData.data[4*c+2]-a[2])),"fg"===this.colorDetectionMode?d<=this.colorDistance&&(this.binaryData[c]=!0):d>=this.colorDistance&&(this.binaryData[c]=!0)}}}}();wpd=wpd||{};
wpd.ColorGroup=function(){return function(b){var c=0,d={r:0,g:0,b:0};b=null==b?100:b;this.getPixelCount=function(){return c};this.getAverageColor=function(){return d};this.isColorInGroup=function(a,e,f){return 0===c?!0:(d.r-a)*(d.r-a)+(d.g-e)*(d.g-e)+(d.b-f)*(d.b-f)<=b*b};this.addPixel=function(a,b,f){d.r=(d.r*c+a)/(c+1);d.g=(d.g*c+b)/(c+1);d.b=(d.b*c+f)/(c+1);c+=1}}}();
wpd.colorAnalyzer=function(){return{getTopColors:function(b){var c=[],d,a,e,f,g,h,l=[];c[0]=new wpd.ColorGroup(120);for(d=0;d<b.data.length;d+=4){a=b.data[d];e=b.data[d+1];f=b.data[d+2];h=!1;for(g=0;g<c.length;g++)if(c[g].isColorInGroup(a,e,f)){c[g].addPixel(a,e,f);h=!0;break}h||(c[c.length]=new wpd.ColorGroup(120),c[c.length-1].addPixel(a,e,f))}c.sort(function(a,c){return a.getPixelCount()>c.getPixelCount()?-1:a.getPixelCount()<c.getPixelCount()?1:0});for(g=0;g<c.length;g++)d=c[g].getAverageColor(),
l[g]={r:parseInt(d.r,10),g:parseInt(d.g,10),b:parseInt(d.b,10),pixels:c[g].getPixelCount(),percentage:100*c[g].getPixelCount()/(0.25*b.data.length)};return l}}}();wpd=wpd||{};wpd.dataEventNames={axesAligned:"axesAligned",imageLoaded:"imageLoaded"};wpd.dataEventManager=function(){return{fireEvent:function(b,c){},subscribe:function(b,c){},unsubscribe:function(b,c){},removeAllSubscriptionsForEvent:function(b){}}}();wpd=wpd||{};
wpd.Calibration=function(){return function(b){var c=[],d=[],a=null==b?2:b,e=[],f=[];this.labels=[];this.getCount=function(){return c.length};this.getDimensions=function(){return a};this.addPoint=function(b,f,l,n,k){var m=c.length,q=e.length;c[m]=b;d[m]=f;e[q]=l;e[q+1]=n;3===a&&(e[q+2]=k)};this.getPoint=function(b){return 0>b||b>=c.length?null:{px:c[b],py:d[b],dx:e[a*b],dy:e[a*b+1],dz:2===a?null:e[a*b+2]}};this.changePointPx=function(a,b,f){0>a||a>=c.length||(c[a]=b,d[a]=f)};this.setDataAt=function(d,
b,f,n){0>d||d>=c.length||(e[a*d]=b,e[a*d+1]=f,3===a&&(e[a*d+2]=n))};this.findNearestPoint=function(a,b,f){f=null==f?50:parseFloat(f);var e,k=-1,m,q;for(m=0;m<c.length;m++)if(q=Math.sqrt((a-c[m])*(a-c[m])+(b-d[m])*(b-d[m])),0>k&&q<=f||0<=k&&q<e)k=m,e=q;return k};this.selectPoint=function(a){0>f.indexOf(a)&&(f[f.length]=a)};this.selectNearestPoint=function(a,c,d){a=this.findNearestPoint(a,c,d);0<=a&&this.selectPoint(a)};this.getSelectedPoints=function(){return f};this.unselectAll=function(){f=[]};this.isPointSelected=
function(a){return 0<=f.indexOf(a)};this.dump=function(){console.log(c);console.log(d);console.log(e)}}}();
wpd.DataSeries=function(){return function(b){var c=[],d=[];this.name="Data Series";this.variableNames=["x","y"];this.addPixel=function(a,d){var b=c.length;c[b]=a;c[b+1]=d};this.getPixel=function(a){return{x:c[2*a],y:c[2*a+1]}};this.setPixelAt=function(a,d,b){2*a<c.length&&(c[2*a]=d,c[2*a+1]=b)};this.insertPixel=function(a,d,b){c.splice(2*a,0,d);c.splice(2*a+1,0,b)};this.removePixelAtIndex=function(a){2*a<c.length&&c.splice(2*a,2)};this.removeLastPixel=function(){this.removePixelAtIndex(c.length/2-
1)};this.findNearestPixel=function(a,d,b){b=null==b?50:parseFloat(b);var g,h=-1,l,n;for(l=0;l<c.length;l+=2)if(n=Math.sqrt((a-c[l])*(a-c[l])+(d-c[l+1])*(d-c[l+1])),0>h&&n<=b||0<=h&&n<g)h=l/2,g=n;return h};this.removeNearestPixel=function(a,c,d){a=this.findNearestPixel(a,c,d);0<=a&&this.removePixelAtIndex(a)};this.clearAll=function(){c=[]};this.getCount=function(){return c.length/2};this.selectPixel=function(a){0<=d.indexOf(a)||(d[d.length]=a)};this.unselectAll=function(){d=[]};this.selectNearestPixel=
function(a,c,d){a=this.findNearestPixel(a,c,d);0<=a&&this.selectPixel(a)};this.getSelectedPixels=function(){return d}}}();
wpd.PlotData=function(){return function(){var b=0,c=new wpd.AutoDetector;this.axes=this.topColors=null;this.dataSeriesColl=[];this.distanceMeasurementData=this.angleMeasurementData=null;this.getActiveDataSeries=function(){null==this.dataSeriesColl[b]&&(this.dataSeriesColl[b]=new wpd.DataSeries);return this.dataSeriesColl[b]};this.getDataSeriesCount=function(){return this.dataSeriesColl.length};this.setActiveDataSeriesIndex=function(c){b=c};this.getAutoDetector=function(){return c};this.getDataFromActiveSeries=
function(){if(null==this.dataSeriesColl[b]||null==this.axes)return null;var c,a,e=[],f;for(c=0;c<this.dataSeriesColl[b].getCount();c++)for(a=this.dataSeriesColl[b].getPixel(c),a=this.axes.pixelToData(a.x,a.y),e[c]=[],f=0;f<a.length;f++)e[c][f]=a[f];return e};this.reset=function(){this.distanceMeasurementData=this.angleMeasurementData=this.axes=null;this.dataSeriesColl=[];b=0;c=new wpd.AutoDetector}}}();
wpd.ConnectedPoints=function(){return function(b){var c=[],d=-1,a=-1;this.addConnection=function(a){c[c.length]=a};this.clearAll=function(){c=[]};this.getConnectionAt=function(a){if(a<c.length)return c[a]};this.replaceConnectionAt=function(a,b){a<c.length&&(c[a]=b)};this.deleteConnectionAt=function(a){a<c.length&&c.splice(a,1)};this.connectionCount=function(){return c.length};this.getDistance=function(a){if(a<c.length&&2===b)return Math.sqrt((c[a][0]-c[a][2])*(c[a][0]-c[a][2])+(c[a][1]-c[a][3])*(c[a][1]-
c[a][3]))};this.getAngle=function(a){if(a<c.length&&3===b){var d=wpd.taninverse(-(c[a][5]-c[a][3]),c[a][4]-c[a][2]);a=wpd.taninverse(-(c[a][1]-c[a][3]),c[a][0]-c[a][2]);d=180*(d-a)/Math.PI;return d=0>d?d+360:d}};this.findNearestPointAndConnection=function(a,d){var g=-1,h=-1,l,n,k,m;for(k=0;k<c.length;k++)for(m=0;m<2*b;m+=2)if(n=(c[k][m]-a)*(c[k][m]-a)+(c[k][m+1]-d)*(c[k][m+1]-d),-1===h||n<l)g=k,h=m/2,l=n;return{connectionIndex:g,pointIndex:h}};this.selectNearestPoint=function(c,b){var g=this.findNearestPointAndConnection(c,
b);0<=g.connectionIndex&&(d=g.connectionIndex,a=g.pointIndex)};this.deleteNearestConnection=function(a,c){var d=this.findNearestPointAndConnection(a,c);0<=d.connectionIndex&&this.deleteConnectionAt(d.connectionIndex)};this.isPointSelected=function(c,b){return a===b&&d===c?!0:!1};this.getSelectedConnectionAndPoint=function(){return{connectionIndex:d,pointIndex:a}};this.unselectConnectionAndPoint=function(){a=d=-1};this.setPointAt=function(a,d,b,h){c[a][2*d]=b;c[a][2*d+1]=h};this.getPointAt=function(a,
d){return{x:c[a][2*d],y:c[a][2*d+1]}}}}();wpd=wpd||{};
wpd.dateConverter=function(){function b(c,d){var a;a=d.replace("YYYY","yyyy");a=a.replace("YY","yy");a=a.replace("MMMM","mmmm");a=a.replace("MMM","mmm");a=a.replace("MM","mm");a=a.replace("DD","dd");a=a.replace("yyyy",c.getUTCFullYear());var b=c.getUTCFullYear()%100;a=a.replace("yy",10>b?"0"+b:b);a=a.replace("mmmm","January February March April May June July August September October November December".split(" ")[c.getUTCMonth()]);a=a.replace("mmm","Jan Feb Mar Apr May Jun Jul Aug Sep Oct Nov Dec".split(" ")[c.getUTCMonth()]);
a=a.replace("mm",c.getUTCMonth()+1);return a=a.replace("dd",c.getUTCDate())}return{parse:function(c){if(null==c||0>c.indexOf("/"))c=null;else{var d=c.split("/"),a;0>=d.length||3<d.length?c=null:(c=parseInt(d[0],10),a=parseInt(void 0===d[1]?0:d[1],10),date=parseInt(void 0===d[2]?1:d[2],10),isNaN(c)||isNaN(a)||isNaN(date)||12<a||1>a||31<date||1>date?c=null:(d=new Date,d.setUTCFullYear(c),d.setUTCMonth(a-1),d.setUTCDate(date),c=parseFloat(Date.parse(d)),c=isNaN(c)?null:c))}return c},getFormatString:function(c){c=
c.split("/");var d="yyyy/mm/dd";1<=c.length&&(d="yyyy");2<=c.length&&(d+="/mm");3===c.length&&(d+="/dd");return d},formatDate:b,formatDateNumber:function(c,d){var a;a=parseFloat(c);a=parseInt(864E5*Math.round(a/864E5),10);return b(new Date(a),d)}}}();wpd=wpd||{};
wpd.InputParser=function(){return function(){this.parse=function(b){this.isDate=this.isValid=!1;this.formatting=null;if(null==b)return null;b=b.trim();if(0<=b.indexOf("^"))return null;var c=wpd.dateConverter.parse(b);if(null!=c)return this.isDate=this.isValid=!0,this.formatting=wpd.dateConverter.getFormatString(b),c;b=parseFloat(b);return isNaN(b)?null:(this.isValid=!0,b)};this.isDate=this.isValid=!1;this.formatting=null}}();wpd=wpd||{};
wpd.taninverse=function(b,c){var d;0<b?d=Math.atan2(b,c):0>=b&&(d=Math.atan2(b,c)+2*Math.PI);d>=2*Math.PI&&(d=0);return d};wpd=wpd||{};
wpd.AveragingWindowAlgo=function(){return function(){var b=5,c=5;this.getParamList=function(){return[["\u0394X","Px",10],["\u0394Y","Px",10]]};this.setParam=function(d,a){0===d?b=a:1===d&&(c=a)};this.run=function(d){var a=d.getAutoDetector();d=d.getActiveDataSeries();var e=[],f=0,g=a.imageWidth,h=a.imageHeight,l=[],n,k,m,q,r,p;d.clearAll();for(n=0;n<g;n++){r=-1;m=-2*c;for(k=q=0;k<h;k++)!0===a.binaryData[k*g+n]&&(k>m+c?(r+=1,q=1,m=l[r]=k):(q+=1,l[r]=parseFloat((l[r]*(q-1)+k)/parseFloat(q))));if(0<=
r)for(m=n,k=0;k<=r;k++)q=l[k],e[f]=[],e[f][0]=parseFloat(m),e[f][1]=parseFloat(q),e[f][2]=!0,f+=1}if(0!==f)for(a=0;a<f;a++)if(!0===e[a][2]){g=!0;h=a+1;l=e[a][0];n=e[a][1];r=l;k=n;for(p=1;!0===g&&h<f;)m=e[h][0],q=e[h][1],Math.abs(m-l)<=b&&Math.abs(q-n)<=c&&!0===e[h][2]&&(r=(r*p+m)/(p+1),k=(k*p+q)/(p+1),p+=1,e[h][2]=!1),m>l+2*b&&(g=!1),h+=1;e[a][2]=!1;d.addPixel(parseFloat(r),parseFloat(k))}}}}();wpd=wpd||{};
wpd.AveragingWindowWithStepSizeAlgo=function(){return function(){var b,c,d,a,e,f;this.getParamList=function(){var a=wpd.appData.isAligned(),c=wpd.appData.getPlotData().axes;return a&&c instanceof wpd.XYAxes?(a=c.getBounds(),[["X_min","Units",a.x1],["\u0394X Step","Units",0.1],["X_max","Units",a.x2],["Y_min","Units",a.y3],["Y_max","Units",a.y4],["Line width","Px",30]]):[["X_min","Units",0],["\u0394X Step","Units",0.1],["X_max","Units",0],["Y_min","Units",0],["Y_max","Units",0],["Line width","Px",30]]};
this.setParam=function(g,h){0===g?b=h:1===g?c=h:2===g?d=h:3===g?e=h:4===g?f=h:5===g&&(a=h)};this.run=function(g){var h=g.getAutoDetector(),l=g.getActiveDataSeries();g=g.axes;var n=h.imageWidth,k=h.imageHeight,m,q,r,p,s,t,x,v,u;l.clearAll();for(m=b;m<=d;m+=c)for(u=g.dataToPixel(m,e),q=u.x,p=u.y,u=g.dataToPixel(m,f),r=u.x,s=u.y,q=Math.sqrt((s-p)*(s-p)+(r-q)*(r-q)),r=(f-e)/q,p=!1,t=s=0,x=!1,v=0;v<=q;v++)u=1*-v*r+f,u=g.dataToPixel(m,u),xi_pix=u.x,yi_pix=u.y,0<=xi_pix&&xi_pix<n&&0<=yi_pix&&yi_pix<k&&(!0===
h.binaryData[parseInt(yi_pix,10)*n+parseInt(xi_pix,10)]?(!1===p&&(t=s=v,p=!0,x=!1),!0===x&&(t=v,x=!1)):!1===x&&(t=v,x=!0),!0===p&&(v>s+a||v==q-1)&&(p=!1,s>t&&(t=v),u=(s+t)/2,u=1*-u*r+f,u=g.dataToPixel(m,u),l.addPixel(parseFloat(u.x),parseFloat(u.y))))}}}();
var blobDetectorAlgo={getParamList:function(){return[["Min size","Px","0"],["Max size","Px","1000"]]},run:function(){xyData=[];pointsPicked=0;for(var b=document.getElementById("pv0").value,c=document.getElementById("pv1").value,d=[],a=0;a<canvasHeight;a++){d[a]=[];for(var e=0;e<canvasWidth;e++)d[a][e]=!1}for(var a=0,e=[],f=[],g=[],h=[],l=[],n=0;n<canvasHeight;n++)for(var k=0;k<canvasWidth;k++){if(!0===binaryData[n][k]&&!1===d[n][k]){d[n][k]=!0;a+=1;e[a-1]=1;h[a-1]=[];l[a-1]=[];h[a-1][0]=k;l[a-1][0]=
n;f[a-1]=k;g[a-1]=n;for(var m=1,q=1;m<=q;){ai=l[a-1][m-1];bi=h[a-1][m-1];for(var r=-1;1>=r;r++)for(var p=-1;1>=p;p++)0<=ai+r&&0<=bi+p&&ai+r<canvasHeight&&bi+p<canvasWidth&&!0==binaryData[ai+r][bi+p]&&!1==d[ai+r][bi+p]&&(e[a-1]+=1,q=e[a-1],l[a-1][q-1]=ai+r,h[a-1][q-1]=bi+p,g[a-1]=(g[a-1]*(q-1)+(ai+r))/q,f[a-1]=(f[a-1]*(q-1)+(bi+p))/q,d[ai+r][bi+p]=!0);m+=1}}d[n][k]=!0}for(d=0;d<a;d++)h=2*Math.sqrt(e[d]/Math.PI),h>=b&&h<=c&&(xyData[pointsPicked]=[],xyData[pointsPicked][0]=parseFloat(f[d]),xyData[pointsPicked][1]=
parseFloat(g[d]),xyData[pointsPicked][2]=e[d],pointsPicked+=1)}},xStepAlgo={getParamList:function(){return[["\u0394X","Px","5"],["Line Width","Px","15"]]},run:function(){xyData=[];pointsPicked=0;resetLayers();for(var b=document.getElementById("pv0"),b=parseFloat(b.value),c=document.getElementById("pv1"),c=parseFloat(c.value),d=canvasWidth,a=canvasHeight,e=[],f=1,g=0;g<d;){blobs=-1;firstbloby=-2*c;for(var h=bi=0;h<a;h++)!0===binaryData[h][g]&&(f=b,h>firstbloby+c?(blobs+=1,bi=1,firstbloby=e[blobs]=
h):(bi+=1,e[blobs]=parseFloat((e[blobs]*(bi-1)+h)/parseFloat(bi))));if(0<=blobs)for(xi=g,h=0;h<=blobs;h++)yi=e[h],xyData[pointsPicked]=[],xyData[pointsPicked][0]=parseFloat(xi),xyData[pointsPicked][1]=parseFloat(yi),pointsPicked+=1;g+=f}}},yStepAlgo={getParamList:function(){return[["\u0394Y","Px","5"],["Line Width","Px","15"]]},run:function(){xyData=[];pointsPicked=0;resetLayers();for(var b=document.getElementById("pv0"),b=parseFloat(b.value),c=document.getElementById("pv1"),c=parseFloat(c.value),
d=canvasWidth,a=[],e=-1,f=canvasHeight-1;0<=f;){blobs=-1;firstblobx=-2*c;for(var g=bi=0;g<d;g++)!0===binaryData[f][g]&&(e=-b,g>firstblobx+c?(blobs+=1,bi=1,firstblobx=a[blobs]=g):(bi+=1,a[blobs]=parseFloat((a[blobs]*(bi-1)+g)/parseFloat(bi))));if(0<=blobs)for(yi=f,g=0;g<=blobs;g++)xi=a[g],xyData[pointsPicked]=[],xyData[pointsPicked][0]=parseFloat(xi),xyData[pointsPicked][1]=parseFloat(yi),pointsPicked+=1;f+=e}}},wpd=wpd||{};
wpd.ImageAxes=function(){var b=function(){this.isCalibrated=function(){return!0};this.calibrate=function(){return!0};this.pixelToData=function(c,d){return[c,d]};this.dataToPixel=function(c,d){return{x:c,y:d}};this.pixelToLiveString=function(c,d){var a=this.pixelToData(c,d);return a[0].toFixed(2)+", "+a[1].toFixed(2)}};b.prototype.numCalibrationPointsRequired=function(){return 0};b.prototype.getDimensions=function(){return 2};b.prototype.getAxesLabels=function(){return["X","Y"]};return b}();
wpd=wpd||{};
wpd.MapAxes=function(){var b=function(){var c=!1,d,a,b;this.isCalibrated=function(){return c};this.calibrate=function(f,g,h){var l=f.getPoint(0);f=f.getPoint(1);b=Math.sqrt((l.px-f.px)*(l.px-f.px)+(l.py-f.py)*(l.py-f.py));d=parseFloat(g);a=h;return c=!0};this.pixelToData=function(a,c){var h=[];h[0]=a*d/b;h[1]=c*d/b;return h};this.pixelToDataDistance=function(a){return a*d/b};this.dataToPixel=function(a,c,b){return{x:0,y:0}};this.pixelToLiveString=function(a,c){var b=this.pixelToData(a,c);return b[0].toExponential(4)+
", "+b[1].toExponential(4)};this.getUnits=function(){return a}};b.prototype.numCalibrationPointsRequired=function(){return 2};b.prototype.getDimensions=function(){return 2};b.prototype.getAxesLabels=function(){return["X","Y"]};return b}();wpd=wpd||{};
wpd.PolarAxes=function(){var b=function(){var c=!1,b=!1,a,e,f,g,h,l,n,k,m,q,r,p,s,t;processCalibration=function(c,v,u){u=c.getPoint(0);var A=c.getPoint(1);c=c.getPoint(2);a=u.px;e=u.py;f=A.px;g=A.py;h=c.px;l=c.py;n=A.dx;k=A.dy;m=c.dx;b=v;!0===b&&(k*=Math.PI/180);q=Math.sqrt((f-a)*(f-a)+(g-e)*(g-e));r=Math.sqrt((h-a)*(h-a)+(l-e)*(l-e));p=r-q;s=wpd.taninverse(-(g-e),f-a);t=s-k;return!0};this.isCalibrated=function(){return c};this.calibrate=function(a,b,d){return c=processCalibration(a,b,d)};this.pixelToData=
function(c,f){var h=[],g,l;xp=parseFloat(c);yp=parseFloat(f);g=(m-n)/p*(Math.sqrt((xp-a)*(xp-a)+(yp-e)*(yp-e))-q)+n;l=wpd.taninverse(-(yp-e),xp-a)-t;!0==b&&(l=180*l/Math.PI);h[0]=g;h[1]=l;return h};this.dataToPixel=function(a,c){return{x:0,y:0}};this.pixelToLiveString=function(a,c){var b=this.pixelToData(a,c);return b[0].toExponential(4)+", "+b[1].toExponential(4)}};b.prototype.numCalibrationPointsRequired=function(){return 3};b.prototype.getDimensions=function(){return 2};b.prototype.getAxesLabels=
function(){return["r","\u03b8"]};return b}();wpd=wpd||{};
wpd.TernaryAxes=function(){var b=function(){var c=!1,b,a,e,f,g,h,l,n,k;this.isCalibrated=function(){return c};this.calibrate=function(m,q,r){var p=m.getPoint(0),s=m.getPoint(1);m.getPoint(2);b=p.px;a=p.py;e=s.px;f=s.py;g=Math.sqrt((b-e)*(b-e)+(a-f)*(a-f));h=wpd.taninverse(-(f-a),e-b);l=Math.sqrt(3);n=q;k=r;return c=!0};this.pixelToData=function(c,f){var e=[],p,s,t,x;xp=parseFloat(c);yp=parseFloat(f);p=Math.sqrt((xp-b)*(xp-b)+(yp-a)*(yp-a));s=wpd.taninverse(-(yp-a),xp-b)-h;t=p*Math.cos(s)/g;s=p*Math.sin(s)/
g;p=1-t-s/l;t-=s/l;s=2*s/l;!1==k&&(x=t,t=p,p=s,s=x);!0==n&&(p*=100,t*=100,s*=100);e[0]=p;e[1]=t;e[2]=s;return e};this.dataToPixel=function(a,c,b){return{x:0,y:0}};this.pixelToLiveString=function(a,c){var b=this.pixelToData(a,c);return b[0].toExponential(4)+", "+b[1].toExponential(4)+", "+b[2].toExponential(4)}};b.prototype.numCalibrationPointsRequired=function(){return 3};b.prototype.getDimensions=function(){return 3};b.prototype.getAxesLabels=function(){return["a","b","c"]};return b}();
wpd=wpd||{};
wpd.XYAxes=function(){var b=function(){var c=!1,b=!1,a=!1,e=!1,f=!1,g,h,l,n,k,m,q,r,p,s,t,x,v,u,A,F,J,E,z,H,G,N,O,R=function(c,L,T){if(4>c.getCount())return!1;var M=c.getPoint(0),P=c.getPoint(1),I=c.getPoint(2);c=c.getPoint(3);var y=new wpd.InputParser;l=M.px;q=M.py;n=P.px;r=P.py;k=I.px;p=I.py;m=c.px;s=c.py;t=M.dx;x=P.dx;v=I.dy;u=c.dy;t=y.parse(t);if(!y.isValid)return!1;e=y.isDate;x=y.parse(x);if(!y.isValid||y.isDate!=e)return!1;g=y.formatting;v=y.parse(v);if(!y.isValid)return!1;f=y.isDate;u=y.parse(u);
if(!y.isValid||y.isDate!=f)return!1;h=y.formatting;b=L;a=T;!0===b&&(t=Math.log(t)/Math.log(10),x=Math.log(x)/Math.log(10));!0===a&&(v=Math.log(v)/Math.log(10),u=Math.log(u)/Math.log(10));A=x-t;F=u-v;J=Math.sqrt((l-n)*(l-n)+(q-r)*(q-r));E=Math.sqrt((k-m)*(k-m)+(p-s)*(p-s));z=A/J;H=F/E;G=wpd.taninverse(-(r-q),n-l);N=wpd.taninverse(-(s-p),m-k);O=N-G;return!0};this.getBounds=function(){return{x1:t,x2:x,y3:v,y4:u}};this.isCalibrated=function(){return c};this.calibrate=function(a,b,d){return c=R(a,b,d)};
this.pixelToData=function(c,f){var e=[],h,g,n,m;h=parseFloat(c);g=parseFloat(f);n=Math.sqrt((h-l)*(h-l)+(g-q)*(g-q));m=wpd.taninverse(-(g-q),h-l)-G;n=(n*Math.cos(m)-n*Math.sin(m)/Math.tan(O))*z+t;m=Math.sqrt((h-k)*(h-k)+(g-p)*(g-p));h=N-wpd.taninverse(-(g-p),h-k);h=(m*Math.cos(h)-m*Math.sin(h)/Math.tan(O))*H+v;!0===b&&(n=Math.pow(10,n));!0===a&&(h=Math.pow(10,h));e[0]=n;e[1]=h;return e};this.dataToPixel=function(a,c){var b,d;b=(l-n)*(p-s)-(q-r)*(k-m);d=this.pixelToData(((l*r-q*n)*(k-m)-(l-n)*(k*s-
p*m))/b,((l*r-q*n)*(p-s)-(q-r)*(k*s-p*m))/b);b=d[0];d=d[1];d=(a-t)*Math.cos(G)/z+(c-d)*Math.cos(N)/H+l;b=p-(a-b)*Math.sin(G)/z-(c-v)*Math.sin(N)/H;return{x:d,y:b}};this.pixelToLiveString=function(a,c){var b="",d=this.pixelToData(a,c),b=e?b+wpd.dateConverter.formatDateNumber(d[0],g):b+d[0].toExponential(4),b=b+", ";return b=f?b+wpd.dateConverter.formatDateNumber(d[1],h):b+d[1].toExponential(4)};this.isDate=function(a){return 0===a?e:f};this.getInitialDateFormat=function(a){return 0===a?g:h};this.isLogX=
function(){return b};this.isLogY=function(){return a}};b.prototype.numCalibrationPointsRequired=function(){return 4};b.prototype.getDimensions=function(){return 2};b.prototype.getAxesLabels=function(){return["X","Y"]};return b}();wpd=wpd||{};
wpd.dataTable=function(){function b(){e=wpd.appData.getPlotData().getDataFromActiveSeries()}function c(){f=e.slice(0);var a=document.getElementById("data-sort-variables").value,c="ascending"===document.getElementById("data-sort-order").value,b="raw"===a,d="NearestNeighbor"===a,g,q=wpd.appData.getPlotData().axes.getDimensions();if(!b)if(!d)g=parseInt(a,10),f.sort(function(a,b){return a[g]>b[g]?c?1:-1:a[g]<b[g]?c?-1:1:0});else if(d){var r,d=[1,1,1],p,s,t=e.length;for(p=0;p<t-1;p++){b=-1;for(s=p+1;s<
t;s++)if(a=(f[p][0]-f[s][0])*(f[p][0]-f[s][0])+(f[p][1]-f[s][1])*(f[p][1]-f[s][1]),3===q&&(a+=(f[p][2]-f[s][2])*(f[p][2]-f[s][2])),a<r||-1===b)r=a,b=s;d[0]=f[b][0];f[b][0]=f[p+1][0];f[p+1][0]=d[0];d[1]=f[b][1];f[b][1]=f[p+1][1];f[p+1][1]=d[1];3===q&&(d[2]=f[b][2],f[b][2]=f[p+1][2],f[p+1][2]=d[2])}}}function d(){var a=document.getElementById("data-sort-variables").value,c=document.getElementById("data-sort-order");"NearestNeighbor"===a||"raw"===a?c.setAttribute("disabled",!0):c.removeAttribute("disabled")}
function a(){if(null!=e){var a=wpd.appData.getPlotData().axes,c=a.getDimensions(),b=e.length,d,m,q,r=document.getElementById("digitizedDataTable"),p=[];g="";for(d=0;d<b;d++){q=[];for(m=0;m<c;m++)null!=a.isDate&&a.isDate(m)?(void 0===p[m]&&(p[m]=document.getElementById("data-format-string-"+m).value),q[m]=wpd.dateConverter.formatDateNumber(f[d][m],p[m])):q[m]=f[d][m];g+=q.join(", ");g+="\n"}r.value=g}}var e,f,g;return{getSeriesData:b,showTable:function(){if(wpd.appData.isAligned()){wpd.popup.show("csvWindow");
b();var f=document.getElementById("data-sort-variables"),e=document.getElementById("dataVariables"),g=document.getElementById("data-date-formatting-container"),k=document.getElementById("data-date-formatting"),m=wpd.appData.getPlotData().axes,q=m.getAxesLabels(),r,p="",s=q.join(", "),t="";isAnyVariableDate=!1;g.style.display="none";p+='<option value="raw">Raw</option>';for(r=0;r<q.length;r++)p+='<option value="'+r+'">'+q[r]+"</option>",null!=m.isDate&&null!=m.getInitialDateFormat&&m.isDate(r)&&(t+=
q[r]+' <input type="text" length="15" value="'+m.getInitialDateFormat(r)+'" id="data-format-string-'+r+'"/>',isAnyVariableDate=!0);f.innerHTML=p+'<option value="NearestNeighbor">Nearest Neighbor</option>';e.innerHTML=s;isAnyVariableDate&&(g.style.display="inline-block",k.innerHTML=t);c();a();d()}},updateSortingControls:d,reSort:function(){d();c();a()},selectAll:function(){var a=document.getElementById("digitizedDataTable");a.focus();a.select()},generateCSV:function(){var a,c,b,d=JSON.stringify(g);
a=document.createElement("div");c=document.createElement("form");b=document.createElement("input");c.setAttribute("method","post");c.setAttribute("action","php/csvexport.php");b.setAttribute("type","text");b.setAttribute("name","data");c.appendChild(b);a.appendChild(c);document.body.appendChild(a);a.style.display="none";b.setAttribute("value",d);c.submit();document.body.removeChild(a)},exportToPlotly:function(){if(null!=e&&0!==e.length){var a=document.createElement("div"),c=document.createElement("form"),
b=document.createElement("input");c.setAttribute("method","post");c.setAttribute("action","https://plot.ly/external");c.setAttribute("target","_blank");b.setAttribute("type","text");b.setAttribute("name","data");c.appendChild(b);a.appendChild(c);document.body.appendChild(a);a.style.display="none";var d={data:[]},g=wpd.appData.getPlotData().axes,q=g.getDimensions(),r=e.length,p,s,t=["x","y","z"];d.data[0]={};for(p=0;p<r;p++)for(rowValues=[],s=0;s<q;s++)0===p&&(d.data[0][t[s]]=[]),null!=g.isDate&&g.isDate(s)?
d.data[0][t[s]][p]=wpd.dateConverter.formatDateNumber(f[p][s],"yyyy-mm-dd"):d.data[0][t[s]][p]=f[p][s];b.setAttribute("value",JSON.stringify(d));c.submit();document.body.removeChild(a)}}}}();wpd=wpd||{};
wpd.graphicsWidget=function(){function b(a){var c=A.getBoundingClientRect();return{x:parseInt(a.pageX-(c.left+window.pageXOffset),10),y:parseInt(a.pageY-(c.top+window.pageYOffset),10)}}function c(a,c){return{x:a/K,y:c/K}}function d(a,c){a=parseInt(a,10);c=parseInt(c,10);N.style.width=a+"px";N.style.height=c+"px";A.width=a;F.width=a;J.width=a;E.width=a;z.width=a;A.height=c;F.height=c;J.height=c;E.height=c;z.height=c;W=a/(1*c);I=a;y=c;if(null!=Q){O.fillStyle="rgb(255, 255, 255)";O.fillRect(0,0,I,y);
O.drawImage(H,0,0,I,y);if(null!=B&&void 0!=B.onRedraw)B.onRedraw();if(null!=w&&void 0!=w.onRedraw)w.onRedraw()}}function a(){A.width=A.width;F.width=F.width;J.width=J.width;E.width=E.width;z.width=z.width;G.width=G.width}function e(){if(null!=B&&void 0!=B.onRemove)B.onRemove();B=null}function f(){var a=wpd.layoutManager.getGraphicsViewportSize();d(a.width,a.height);W>S?(K=y/(1*C),d(y*S,y)):(K=I/(1*D),d(I,I/S))}function g(a){K=a;d(D*K,C*K)}function h(a){220===a.keyCode&&(a.preventDefault(),U=!U,E.width=
E.width)}function l(a,c){var b=wpd.zoomView.getSize(),d=wpd.zoomView.getZoomRatio(),f,e,g,h,l,n,k,m=0,p=0,q=b.width,r=b.height;g=b.width/d;h=b.height/d;f=a-g/2;e=c-h/2;n=f;b=e;l=f+g;k=e+h;0>f&&(n=0,m=-f*d);0>e&&(b=0,p=-e*d);f+g>=D&&(l=D,q-=d*(D-(f+g)));e+h>=C&&(k=C,r-=d*(C-(e+h)));g=M.getImageData(parseInt(n,10),parseInt(b,10),parseInt(l-n,10),parseInt(k-b,10));l=P.getImageData(parseInt(n,10),parseInt(b,10),parseInt(l-n,10),parseInt(k-b,10));for(k=0;k<l.data.length;k+=4)if(0!=l.data[k]||0!=l.data[k+
1]||0!=l.data[k+2])g.data[k]=l.data[k],g.data[k+1]=l.data[k+1],g.data[k+2]=l.data[k+2];n=d*(parseInt(n,10)-n);d*=parseInt(b,10)-b;wpd.zoomView.setZoomImage(g,parseInt(m+n,10),parseInt(p+d,10),parseInt(q-m,10),parseInt(r-p,10))}function n(a){clearTimeout(X);var d=setTimeout,f=b(a);a=f.x;var f=f.y,e=c(a,f);U&&(E.width=E.width,L.strokeStyle="rgba(0,0,0, 0.5)",L.beginPath(),L.moveTo(a,0),L.lineTo(a,y),L.moveTo(0,f),L.lineTo(I,f),L.stroke());l(e.x,e.y);wpd.zoomView.setCoords(e.x,e.y);X=d(void 0,10)}function k(){A=
document.getElementById("mainCanvas");F=document.getElementById("dataCanvas");J=document.getElementById("drawCanvas");E=document.getElementById("hoverCanvas");z=document.getElementById("topCanvas");H=document.createElement("canvas");G=document.createElement("canvas");O=A.getContext("2d");R=F.getContext("2d");L=E.getContext("2d");T=z.getContext("2d");V=J.getContext("2d");M=H.getContext("2d");P=G.getContext("2d");N=document.getElementById("canvasDiv");document.body.addEventListener("keydown",h,!1);
z.addEventListener("mousemove",n,!1);z.addEventListener("dragover",function(a){a.preventDefault()},!0);z.addEventListener("drop",function(a){a.preventDefault();a=a.dataTransfer.files;1===a.length&&q(a[0])},!0);z.addEventListener("mousemove",s,!1);z.addEventListener("click",t,!1);z.addEventListener("mouseup",x,!1);z.addEventListener("mousedown",v,!1);z.addEventListener("mouseout",u,!0);document.addEventListener("mousedown",function(a){Y=a.target===z?!0:!1},!1);document.addEventListener("keydown",function(a){if(Y&&
null!=w&&void 0!=w.onKeyDown)w.onKeyDown(a)},!0);wpd.zoomView.initZoom();document.getElementById("fileLoadBox").addEventListener("change",r);window.addEventListener("paste",function(a){if(void 0!==a.clipboardData&&(a=a.clipboardData.items,void 0!==a))for(var c=0;c<a.length;c++)if(-1!==a[c].type.indexOf("image")){var b=a[c].getAsFile();(window.URL||window.webkitURL).createObjectURL(b);q(b)}},!1)}function m(c){var b=document.createElement("img");b.onload=function(){null==A&&k();wpd.appData.reset();
wpd.sidebar.clear();p();e();D=b.width;C=b.height;S=D/(1*C);H.width=D;H.height=C;G.width=D;G.height=C;M.drawImage(b,0,0,D,C);Q=M.getImageData(0,0,D,C);a();f();wpd.appData.plotLoaded(Q)};b.src=c}function q(a){if(a.type.match("image.*")){var c=new FileReader;c.onload=function(){m(c.result)};c.readAsDataURL(a)}}function r(){var a=document.getElementById("fileLoadBox");1==a.files.length&&q(a.files[0])}function p(){if(null!=w&&void 0!=w.onRemove)w.onRemove();w=null}function s(a){if(null!=w&&void 0!=w.onMouseMove){var d=
b(a),f=c(d.x,d.y);w.onMouseMove(a,d,f)}}function t(a){if(null!=w&&void 0!=w.onMouseClick){var d=b(a),f=c(d.x,d.y);w.onMouseClick(a,d,f)}}function x(a){if(null!=w&&void 0!=w.onMouseUp){var d=b(a),f=c(d.x,d.y);w.onMouseUp(a,d,f)}}function v(a){if(null!=w&&void 0!=w.onMouseDown){var d=b(a),f=c(d.x,d.y);w.onMouseDown(a,d,f)}}function u(a){if(null!=w&&void 0!=w.onMouseOut){var d=b(a),f=c(d.x,d.y);w.onMouseOut(a,d,f)}}var A,F,J,E,z,H,G,N,O,R,V,L,T,M,P,I,y,D,C,S,W,Q,K,U=!1,X,w,B,Y=!1;return{zoomIn:function(){g(1.2*
K)},zoomOut:function(){g(K/1.2)},zoomFit:f,zoom100perc:function(){g(1)},setZoomRatio:g,getZoomRatio:function(){return K},loadImageFromURL:m,runImageOp:function(c){var b=c(Q,D,C);c=b.imageData;var d=b.width,b=b.height;wpd.appData.reset();p();e();D=d;C=b;S=D/(1*C);H.width=D;H.height=C;G.width=D;G.height=C;M.putImageData(c,0,0);Q=c;a();f();wpd.appData.plotLoaded(Q)},setTool:function(a){if(null!=w&&void 0!=w.onRemove)w.onRemove();w=a;if(null!=w&&void 0!=w.onAttach)w.onAttach()},removeTool:p,getAllContexts:function(){return{mainCtx:O,
dataCtx:R,drawCtx:V,hoverCtx:L,topCtx:T,oriImageCtx:M,oriDataCtx:P}},resetData:function(){G.width=G.width;F.width=F.width},resetHover:function(){E.width=E.width},imagePx:c,screenPx:function(a,c){return{x:a*K,y:c*K}},updateZoomOnEvent:function(a){a=b(a);a=c(a.x,a.y);l(a.x,a.y);wpd.zoomView.setCoords(a.x,a.y)},updateZoomToImagePosn:function(a,c){l(a,c);wpd.zoomView.setCoords(a,c)},getDisplaySize:function(){return{width:I,height:y}},getImageSize:function(){return{width:D,height:C}},copyImageDataLayerToScreen:function(){R.drawImage(G,
0,0,I,y)},setRepainter:function(a){if(null==B||void 0==B.painterName||null==a||void 0==a.painterName||B.painterName!=a.painterName){if(null!=B&&void 0!=B.onRemove)B.onRemove();B=a;if(null!=B&&void 0!=B.onAttach)B.onAttach()}},removeRepainter:e,forceHandlerRepaint:function(){if(null!=B&&void 0!=B.onForcedRedraw)B.onForcedRedraw()},getRepainter:function(){return B},saveImage:function(){var a=document.createElement("canvas"),c=a.getContext("2d"),b,d,f;a.width=D;a.height=C;c.drawImage(H,0,0,D,C);b=c.getImageData(0,
0,D,C);f=P.getImageData(0,0,D,C);for(d=0;d<b.data.length;d+=4)if(0!=f.data[d]||0!=f.data[d+1]||0!=f.data[d+2])b.data[d]=f.data[d],b.data[d+1]=f.data[d+1],b.data[d+2]=f.data[d+2];c.putImageData(b,0,0);window.open(a.toDataURL(),"_blank")}}}();wpd=wpd||{};
wpd.layoutManager=function(){function b(){var c=parseInt(document.body.offsetWidth,10),b=parseInt(document.body.offsetHeight,10);e.style.height=b+"px";f.style.width=c-e.offsetWidth-5+"px";f.style.height=b+"px";a.style.height=b-44+"px"}function c(a){clearTimeout(d);d=setTimeout(b,80)}var d,a,e,f;return{initialLayout:function(){a=document.getElementById("graphicsContainer");e=document.getElementById("sidebarContainer");f=document.getElementById("mainContainer");b();window.addEventListener("resize",
c,!1)},getGraphicsViewportSize:function(){return{width:a.offsetWidth,height:a.offsetHeight}}}}();wpd=wpd||{};
wpd.popup=function(){return{show:function(b){document.getElementById("shadow").style.visibility="visible";b=document.getElementById(b);var c=parseInt(window.innerWidth),d=parseInt(window.innerHeight),a=parseInt(b.offsetWidth),e=parseInt(b.offsetHeight),d=(d-e)/2;b.style.left=(c-a)/2+"px";b.style.top=(60<d?60:d)+"px";b.style.visibility="visible"},close:function(b){document.getElementById("shadow").style.visibility="hidden";document.getElementById(b).style.visibility="hidden"}}}();
wpd.busyNote=function(){return{show:function(){document.getElementById("wait").style.visibility="visible"},close:function(){document.getElementById("wait").style.visibility="hidden"}}}();wpd.messagePopup=function(){var b;return{show:function(c,d,a){wpd.popup.show("messagePopup");document.getElementById("message-popup-heading").innerHTML=c;document.getElementById("message-popup-text").innerHTML=d;b=a},close:function(){wpd.popup.close("messagePopup");null!=b&&b()}}}();
wpd.unsupported=function(){wpd.messagePopup.show("Unsupported Feature!","This feature has not been implemented in the current version. This may be available in a future release.")};wpd=wpd||{};wpd.sidebar=function(){function b(){var c=document.getElementsByClassName("sidebar"),b;for(b=0;b<c.length;b++)c[b].style.visibility="hidden"}return{show:function(c){b();document.getElementById(c).style.visibility="visible"},clear:b}}();wpd=wpd||{};
wpd.toolbar=function(){function b(){var c=document.getElementsByClassName("toolbar"),b;for(b=0;b<c.length;b++)c[b].style.visibility="hidden"}return{show:function(c){b();document.getElementById(c).style.visibility="visible"},clear:b}}();wpd=wpd||{};
wpd.webcamCapture=function(){function b(){void 0!=c&&c.stop();wpd.popup.close("webcamCapture")}var c;return{start:function(){if(null==(navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia))wpd.messagePopup.show("Webcam Capture","Your browser does not support webcam capture using HTML5 APIs. A recent version of Google Chrome is recommended.");else{wpd.popup.show("webcamCapture");var b=document.getElementById("webcamVideo");navigator.getUserMedia=
navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia;navigator.getUserMedia({video:!0},function(a){c=a;b.src=window.URL.createObjectURL(a)},function(){})}},cancel:function(){b()},capture:function(){var c=document.createElement("canvas"),a=document.getElementById("webcamVideo"),e=c.getContext("2d"),f;c.width=a.videoWidth;c.height=a.videoHeight;e.drawImage(a,0,0);f=e.getImageData(0,0,c.width,c.height);b();wpd.graphicsWidget.runImageOp(function(){return{imageData:f,
width:c.width,height:c.height}})}}}();wpd=wpd||{};
wpd.zoomView=function(){function b(){var a=document.getElementById("zoomCrossHair"),c=a.getContext("2d");a.width=a.width;c.strokeStyle="black"===n?"rgba(0,0,0,1)":"red"===n?"rgba(255,0,0,1)":"yellow"===n?"rgba(255,255,0,1)":"rgba(0,0,0,1)";c.beginPath();c.moveTo(f/2,0);c.lineTo(f/2,g);c.moveTo(0,g/2);c.lineTo(f,g/2);c.stroke()}var c,d,a,e,f=250,g=250,h,l,n="black";return{initZoom:function(){c=document.getElementById("zoomCanvas");d=c.getContext("2d");a=document.createElement("canvas");e=a.getContext("2d");
h=document.getElementById("mousePosition");l=5;b()},setZoomImage:function(b,f,g,h,n){a.width=h/l;a.height=n/l;e.putImageData(b,0,0);c.width=c.width;d.drawImage(a,f,g,h,n)},setCoords:function(a,c){if(wpd.appData.isAligned()){var b=wpd.appData.getPlotData();h.innerHTML=b.axes.pixelToLiveString(a,c)}else h.innerHTML=a.toFixed(2)+", "+c.toFixed(2)},setZoomRatio:function(a){l=a},getZoomRatio:function(){return l},getSize:function(){return{width:f,height:g}},showSettingsWindow:function(){document.getElementById("zoom-magnification-value").value=
l;document.getElementById("zoom-crosshair-color-value").value=n;wpd.popup.show("zoom-settings-popup")},applySettings:function(){l=document.getElementById("zoom-magnification-value").value;n=document.getElementById("zoom-crosshair-color-value").value;b();wpd.popup.close("zoom-settings-popup")}}}();wpd=wpd||{};
wpd.xyCalibration=function(){function b(){wpd.popup.show("xyAlignment")}return{start:function(){wpd.popup.show("xyAxesInfo")},pickCorners:function(){wpd.popup.close("xyAxesInfo");var c=new wpd.AxesCornersTool(4,2,["X1","X2","Y1","Y2"]);wpd.graphicsWidget.setTool(c)},getCornerValues:b,align:function(){var c=document.getElementById("xmin").value,d=document.getElementById("xmax").value,a=document.getElementById("ymin").value,e=document.getElementById("ymax").value,f=document.getElementById("xlog").checked,
g=document.getElementById("ylog").checked,h=new wpd.XYAxes,l=wpd.alignAxes.getActiveCalib();l.setDataAt(0,c,a);l.setDataAt(1,d,a);l.setDataAt(2,c,a);l.setDataAt(3,d,e);if(!h.calibrate(l,f,g))return wpd.popup.close("xyAlignment"),wpd.messagePopup.show("Invalid Inputs","Please enter valid values for calibration.",b),!1;wpd.appData.getPlotData().axes=h;wpd.popup.close("xyAlignment");return!0}}}();
wpd.polarCalibration=function(){return{start:function(){wpd.popup.show("polarAxesInfo")},pickCorners:function(){wpd.popup.close("polarAxesInfo");var b=new wpd.AxesCornersTool(3,2,["Origin","P1","P2"]);wpd.graphicsWidget.setTool(b)},getCornerValues:function(){wpd.popup.show("polarAlignment")},align:function(){var b=parseFloat(document.getElementById("rpoint1").value),c=parseFloat(document.getElementById("thetapoint1").value),d=parseFloat(document.getElementById("rpoint2").value),a=parseFloat(document.getElementById("thetapoint2").value),
e=document.getElementById("degrees").checked;document.getElementById("radians");var f=document.getElementById("clockwise").checked,g=new wpd.PolarAxes,h=wpd.alignAxes.getActiveCalib();h.setDataAt(1,b,c);h.setDataAt(2,d,a);g.calibrate(h,e,f);wpd.appData.getPlotData().axes=g;wpd.popup.close("polarAlignment");return!0}}}();
wpd.ternaryCalibration=function(){return{start:function(){wpd.popup.show("ternaryAxesInfo")},pickCorners:function(){wpd.popup.close("ternaryAxesInfo");var b=new wpd.AxesCornersTool(3,3,["A","B","C"]);wpd.graphicsWidget.setTool(b)},getCornerValues:function(){wpd.popup.show("ternaryAlignment")},align:function(){document.getElementById("range0to1");var b=document.getElementById("range0to100").checked,c=document.getElementById("ternarynormal").checked,d=new wpd.TernaryAxes,a=wpd.alignAxes.getActiveCalib();
d.calibrate(a,b,c);wpd.appData.getPlotData().axes=d;wpd.popup.close("ternaryAlignment");return!0}}}();
wpd.mapCalibration=function(){function b(){wpd.popup.show("mapAlignment")}return{start:function(){wpd.popup.show("mapAxesInfo")},pickCorners:function(){wpd.popup.close("mapAxesInfo");var c=new wpd.AxesCornersTool(2,2,["P1","P2"]);wpd.graphicsWidget.setTool(c);c.onComplete=b},getCornerValues:b,align:function(){var c=parseFloat(document.getElementById("scaleLength").value),b=document.getElementById("scaleUnits").value,a=new wpd.MapAxes,e=wpd.alignAxes.getActiveCalib();a.calibrate(e,c,b);wpd.appData.getPlotData().axes=
a;wpd.popup.close("mapAlignment");return!0}}}();
wpd.AxesCornersTool=function(){return function(b,c,d){var a=0;c=new wpd.Calibration(c);var e=!0;c.labels=d;wpd.alignAxes.setActiveCalib(c);wpd.graphicsWidget.resetData();this.onMouseClick=function(c,d,h){e?(a+=1,d=wpd.alignAxes.getActiveCalib(),d.addPoint(h.x,h.y,0,0),d.unselectAll(),d.selectPoint(a-1),wpd.graphicsWidget.forceHandlerRepaint(),a===b&&(e=!1,wpd.alignAxes.calibrationCompleted())):(d=wpd.alignAxes.getActiveCalib(),d.unselectAll(),d.selectNearestPoint(h.x,h.y),wpd.graphicsWidget.forceHandlerRepaint());
wpd.graphicsWidget.updateZoomOnEvent(c)};this.onKeyDown=function(a){var c=wpd.alignAxes.getActiveCalib();if(0!==c.getSelectedPoints().length){var b=c.getPoint(c.getSelectedPoints()[0]),d=b.px,b=b.py,e=!0===a.shiftKey?5/wpd.graphicsWidget.getZoomRatio():0.5/wpd.graphicsWidget.getZoomRatio();if(wpd.keyCodes.isUp(a.keyCode))b-=e;else if(wpd.keyCodes.isDown(a.keyCode))b+=e;else if(wpd.keyCodes.isLeft(a.keyCode))d-=e;else if(wpd.keyCodes.isRight(a.keyCode))d+=e;else return;c.changePointPx(c.getSelectedPoints()[0],
d,b);wpd.graphicsWidget.forceHandlerRepaint();wpd.graphicsWidget.updateZoomToImagePosn(d,b);a.preventDefault();a.stopPropagation()}}}}();
wpd.AlignmentCornersRepainter=function(){return function(){var b=wpd.graphicsWidget.getAllContexts();this.painterName="AlignmentCornersReptainer";this.onForcedRedraw=function(){wpd.graphicsWidget.resetData();this.onRedraw()};this.onRedraw=function(){var c=wpd.alignAxes.getActiveCalib();if(null!=c){var d,a,e;for(d=0;d<c.getCount();d++)e=c.getPoint(d),a=wpd.graphicsWidget.screenPx(e.px,e.py),b.dataCtx.fillStyle="rgba(255,255,255,0.7)",b.dataCtx.fillRect(a.x-10,a.y-10,20,40),b.dataCtx.beginPath(),c.isPointSelected(d)?
b.dataCtx.fillStyle="rgba(0,200,0,1)":b.dataCtx.fillStyle="rgba(200,0,0,1)",b.dataCtx.arc(a.x,a.y,3,0,2*Math.PI,!0),b.dataCtx.fill(),b.dataCtx.font="14px sans-serif",b.dataCtx.fillText(c.labels[d],a.x-10,a.y+18),b.oriDataCtx.beginPath(),c.isPointSelected(d)?b.oriDataCtx.fillStyle="rgb(0,200,0)":b.oriDataCtx.fillStyle="rgb(200,0,0)",b.oriDataCtx.arc(e.px,e.py,3,0,2*Math.PI,!0),b.oriDataCtx.fill(),b.oriDataCtx.font="14px sans-serif",b.oriDataCtx.fillText(c.labels[d],parseInt(e.px-10,10),parseInt(e.py+
18,10))}}}}();
wpd.alignAxes=function(){var b,c;return{start:function(){xyEl=document.getElementById("r_xy");polarEl=document.getElementById("r_polar");ternaryEl=document.getElementById("r_ternary");mapEl=document.getElementById("r_map");imageEl=document.getElementById("r_image");wpd.popup.close("axesList");if(!0===xyEl.checked)c=wpd.xyCalibration;else if(!0===polarEl.checked)c=wpd.polarCalibration;else if(!0===ternaryEl.checked)c=wpd.ternaryCalibration;else if(!0===mapEl.checked)c=wpd.mapCalibration;else if(!0===
imageEl.checked){c=null;var b=new wpd.ImageAxes;b.calibrate();wpd.appData.getPlotData().axes=b;wpd.appData.isAligned(!0);wpd.acquireData.load()}null!=c&&(c.start(),wpd.graphicsWidget.setRepainter(new wpd.AlignmentCornersRepainter))},calibrationCompleted:function(){wpd.sidebar.show("axes-calibration-sidebar")},getCornerValues:function(){c.getCornerValues()},align:function(){wpd.graphicsWidget.removeTool();wpd.graphicsWidget.removeRepainter();wpd.graphicsWidget.resetData();c.align()&&(wpd.appData.isAligned(!0),
wpd.acquireData.load())},getActiveCalib:function(){return b},setActiveCalib:function(c){b=c}}}();wpd=wpd||{};
wpd.autoExtraction=function(){function b(){var c=wpd.appData.getPlotData().getAutoDetector(),b=document.getElementById("auto-extract-algo-name").value;"averagingWindow"===b?c.algorithm=new wpd.AveragingWindowAlgo:"XStep"===b&&(b=wpd.appData.getPlotData().axes,b instanceof wpd.XYAxes&&!1===b.isLogX()&&!1===b.isLogY()?c.algorithm=new wpd.AveragingWindowWithStepSizeAlgo:(wpd.messagePopup.show("Not supported!","This algorithm is only supported for non log scale XY plots."),document.getElementById("auto-extract-algo-name").value=
"averagingWindow",c.algorithm=new wpd.AveragingWindowAlgo));var b=c.algorithm,c=document.getElementById("algo-parameter-container"),b=b.getParamList(),a,e="<table>";for(a=0;a<b.length;a++)e+="<tr><td>"+b[a][0]+'</td><td><input type="text" size=3 id="algo-param-'+a+'" class="algo-params" value="'+b[a][2]+'"/></td><td>'+b[a][1]+"</td></tr>";c.innerHTML=e+"</table>"}return{start:function(){wpd.sidebar.show("auto-extraction-sidebar");wpd.colorPicker.init();b()},changeAlgorithm:b,runAlgo:function(){var b=
wpd.appData.getPlotData().getAutoDetector(),d=b.algorithm,a=new wpd.DataPointsRepainter,e=document.getElementsByClassName("algo-params"),f,g;for(f=0;f<e.length;f++)g=e[f].id,g=parseInt(g.replace("algo-param-",""),10),d.setParam(g,parseFloat(e[f].value));wpd.graphicsWidget.removeTool();b.generateBinaryData();wpd.graphicsWidget.setRepainter(a);d.run(wpd.appData.getPlotData());wpd.graphicsWidget.forceHandlerRepaint();wpd.dataPointCounter.setCount()}}}();wpd=wpd||{};
wpd.colorPicker=function(){function b(){var a=document.getElementById("color-button"),b=document.getElementById("color-distance-value"),c=wpd.appData.getPlotData().getAutoDetector(),d=document.getElementById("color-detection-mode-select"),e;e="fg"===c.colorDetectionMode?c.fgColor:c.bgColor;color_distance=c.colorDistance;a.style.backgroundColor="rgb("+e[0]+","+e[1]+","+e[2]+")";b.value=color_distance;d.value=c.colorDetectionMode}function c(){var b=wpd.appData.getPlotData().getAutoDetector().fgColor;
document.getElementById("selectedFGColorBox").style.backgroundColor="rgb("+b[0]+","+b[1]+","+b[2]+")";document.getElementById("color_red_fg").value=b[0];document.getElementById("color_green_fg").value=b[1];document.getElementById("color_blue_fg").value=b[2];a("fg");wpd.popup.show("colorPickerFG")}function d(){var b=wpd.appData.getPlotData().getAutoDetector().bgColor;document.getElementById("selectedBGColorBox").style.backgroundColor="rgb("+b[0]+","+b[1]+","+b[2]+")";document.getElementById("color_red_bg").value=
b[0];document.getElementById("color_green_bg").value=b[1];document.getElementById("color_blue_bg").value=b[2];a("bg");wpd.popup.show("colorPickerBG")}function a(a){var b=document.getElementById("fg"===a?"fgColorOptions":"bgColorOptions"),c=wpd.appData.getPlotData().topColors,d=10<c.length?10:c.length,e,k="",m,q;for(e=0;e<d;e++)q="rgb("+c[e].r+","+c[e].g+","+c[e].b+");",m=c[e].percentage.toFixed(3)+"%",k+='<div class="colorOptionBox" style="background-color: '+q+'" title="'+m+'" onclick="wpd.colorPicker.selectTopColor('+
e+",'"+a+"');\"></div>";b.innerHTML=k}function e(){var a=wpd.graphicsWidget.getAllContexts(),b=wpd.appData.getPlotData().getAutoDetector(),c=wpd.graphicsWidget.getImageSize(),d,e,k;k=a.oriDataCtx.getImageData(0,0,c.width,c.height);b.generateBinaryData();if(null!=b.mask&&0!==b.mask.length){for(d=0;d<b.mask.length;d++)e=b.mask[d],!0===b.binaryData[e]?(parseInt(e/c.width,10),k.data[4*e]=255,k.data[4*e+1]=255,k.data[4*e+2]=0,k.data[4*e+3]=255):(k.data[4*e]=0,k.data[4*e+1]=0,k.data[4*e+2]=0,k.data[4*e+
3]=150);a.oriDataCtx.putImageData(k,0,0);wpd.graphicsWidget.copyImageDataLayerToScreen()}}return{startPicker:function(){wpd.graphicsWidget.removeTool();wpd.graphicsWidget.removeRepainter();wpd.graphicsWidget.resetData();"fg"===wpd.appData.getPlotData().getAutoDetector().colorDetectionMode?c():d()},changeDetectionMode:function(){var a=document.getElementById("color-detection-mode-select");wpd.appData.getPlotData().getAutoDetector().colorDetectionMode=a.value;b()},pickFGColor:function(){wpd.popup.close("colorPickerFG");
var a=new wpd.ColorPickerTool;a.onComplete=function(a){wpd.appData.getPlotData().getAutoDetector().fgColor=a;wpd.graphicsWidget.removeTool();c()};wpd.graphicsWidget.setTool(a)},pickBGColor:function(){wpd.popup.close("colorPickerBG");var a=new wpd.ColorPickerTool;a.onComplete=function(a){wpd.appData.getPlotData().getAutoDetector().bgColor=a;wpd.graphicsWidget.removeTool();d()};wpd.graphicsWidget.setTool(a)},setFGColor:function(){var a=[];a[0]=parseInt(document.getElementById("color_red_fg").value,
10);a[1]=parseInt(document.getElementById("color_green_fg").value,10);a[2]=parseInt(document.getElementById("color_blue_fg").value,10);wpd.appData.getPlotData().getAutoDetector().fgColor=a;wpd.popup.close("colorPickerFG");b()},setBGColor:function(){var a=[];a[0]=parseInt(document.getElementById("color_red_bg").value,10);a[1]=parseInt(document.getElementById("color_green_bg").value,10);a[2]=parseInt(document.getElementById("color_blue_bg").value,10);wpd.appData.getPlotData().getAutoDetector().bgColor=
a;wpd.popup.close("colorPickerBG");b()},changeColorDistance:function(){var a=parseFloat(document.getElementById("color-distance-value").value);wpd.appData.getPlotData().getAutoDetector().colorDistance=a},init:b,testColorDetection:function(){wpd.graphicsWidget.removeTool();wpd.graphicsWidget.resetData();wpd.graphicsWidget.setRepainter(new wpd.ColorFilterRepainter);e()},paintFilteredColor:e,selectTopColor:function(a,b){var e=[],l=wpd.appData.getPlotData().topColors;e[0]=l[a].r;e[1]=l[a].g;e[2]=l[a].b;
"fg"===b?(wpd.appData.getPlotData().getAutoDetector().fgColor=e,c()):(wpd.appData.getPlotData().getAutoDetector().bgColor=e,d())}}}();wpd.ColorPickerTool=function(){return function(){var b=wpd.graphicsWidget.getAllContexts();this.onMouseClick=function(c,d,a){c=b.oriImageCtx.getImageData(a.x,a.y,1,1);this.onComplete([c.data[0],c.data[1],c.data[2]])};this.onComplete=function(b){}}}();wpd.ColorFilterRepainter=function(){return function(){this.painterName="colorFilterRepainter";this.onRedraw=function(){wpd.colorPicker.paintFilteredColor()}}}();
wpd=wpd||{};
wpd.imageOps=function(){function b(b,a,c){var f,g,h,l,n,k;for(f=0;f<c;f++)for(g=0;g<a/2;g++)for(h=4*(f*a+g),l=4*((f+1)*a-(g+1)),k=0;4>k;k++)n=b.data[h+k],b.data[h+k]=b.data[l+k],b.data[l+k]=n;return{imageData:b,width:a,height:c}}function c(b,a,c){var f,g,h,l,n,k;for(f=0;f<c/2;f++)for(g=0;g<a;g++)for(h=4*(f*a+g),l=4*((c-(f+2))*a+g),k=0;4>k;k++)n=b.data[h+k],b.data[h+k]=b.data[l+k],b.data[l+k]=n;return{imageData:b,width:a,height:c}}return{hflip:function(){wpd.graphicsWidget.runImageOp(b)},vflip:function(){wpd.graphicsWidget.runImageOp(c)}}}();
wpd=wpd||{};wpd.keyCodes=function(){return{isUp:function(b){return 38===b},isDown:function(b){return 40===b},isLeft:function(b){return 37===b},isRight:function(b){return 39===b},isAlphabet:function(b,c){return 90<b||65>b?!1:String.fromCharCode(b).toLowerCase()===c}}}();wpd=wpd||{};
wpd.acquireData=function(){function b(){var a=new wpd.ManualSelectionTool;wpd.graphicsWidget.setTool(a)}function c(){var a=new wpd.DeleteDataPointTool;wpd.graphicsWidget.setTool(a)}function d(){wpd.graphicsWidget.setTool(new wpd.AdjustDataPointTool)}return{load:function(){wpd.appData.isAligned()?(wpd.sidebar.show("acquireDataSidebar"),wpd.dataPointCounter.setCount(),wpd.graphicsWidget.removeTool(),wpd.graphicsWidget.setRepainter(new wpd.DataPointsRepainter),b()):wpd.messagePopup.show("Acquire Data",
"Please calibrate the axes before acquiring data.")},manualSelection:b,adjustPoints:d,deletePoint:c,clearAll:function(){wpd.appData.getPlotData().getActiveDataSeries().clearAll();wpd.graphicsWidget.removeTool();wpd.graphicsWidget.resetData();wpd.dataPointCounter.setCount()},undo:function(){wpd.appData.getPlotData().getActiveDataSeries().removeLastPixel();wpd.graphicsWidget.resetData();wpd.graphicsWidget.forceHandlerRepaint();wpd.dataPointCounter.setCount()},showSidebar:function(){wpd.sidebar.show("acquireDataSidebar")},
switchToolOnKeyPress:function(a){switch(a){case "d":c();break;case "a":b();break;case "s":d()}}}}();
wpd.ManualSelectionTool=function(){return function(){var b=wpd.graphicsWidget.getAllContexts(),c=wpd.appData.getPlotData();this.onAttach=function(){document.getElementById("manual-select-button").classList.add("pressed-button");wpd.graphicsWidget.setRepainter(new wpd.DataPointsRepainter)};this.onMouseClick=function(d,a,e){c.getActiveDataSeries().addPixel(e.x,e.y);b.dataCtx.beginPath();b.dataCtx.fillStyle="rgb(200,0,0)";b.dataCtx.arc(a.x,a.y,3,0,2*Math.PI,!0);b.dataCtx.fill();b.oriDataCtx.beginPath();
b.oriDataCtx.fillStyle="rgb(200,0,0)";b.oriDataCtx.arc(e.x,e.y,3,0,2*Math.PI,!0);b.oriDataCtx.fill();wpd.graphicsWidget.updateZoomOnEvent(d);wpd.dataPointCounter.setCount()};this.onRemove=function(){document.getElementById("manual-select-button").classList.remove("pressed-button")};this.onKeyDown=function(b){var a=c.getActiveDataSeries(),e=a.getCount()-1,f=a.getPixel(e),g=0.5/wpd.graphicsWidget.getZoomRatio();if(wpd.keyCodes.isUp(b.keyCode))f.y-=g;else if(wpd.keyCodes.isDown(b.keyCode))f.y+=g;else if(wpd.keyCodes.isLeft(b.keyCode))f.x-=
g;else if(wpd.keyCodes.isRight(b.keyCode))f.x+=g;else{(wpd.keyCodes.isAlphabet(b.keyCode,"a")||wpd.keyCodes.isAlphabet(b.keyCode,"s")||wpd.keyCodes.isAlphabet(b.keyCode,"d"))&&wpd.acquireData.switchToolOnKeyPress(String.fromCharCode(b.keyCode).toLowerCase());return}a.setPixelAt(e,f.x,f.y);wpd.graphicsWidget.resetData();wpd.graphicsWidget.forceHandlerRepaint();wpd.graphicsWidget.updateZoomToImagePosn(f.x,f.y);b.preventDefault()}}}();
wpd.DeleteDataPointTool=function(){return function(){wpd.graphicsWidget.getAllContexts();var b=wpd.appData.getPlotData();this.onAttach=function(){document.getElementById("delete-point-button").classList.add("pressed-button");wpd.graphicsWidget.setRepainter(new wpd.DataPointsRepainter)};this.onMouseClick=function(c,d,a){b.getActiveDataSeries().removeNearestPixel(a.x,a.y);wpd.graphicsWidget.resetData();wpd.graphicsWidget.forceHandlerRepaint();wpd.graphicsWidget.updateZoomOnEvent(c);wpd.dataPointCounter.setCount()};
this.onKeyDown=function(b){(wpd.keyCodes.isAlphabet(b.keyCode,"a")||wpd.keyCodes.isAlphabet(b.keyCode,"s")||wpd.keyCodes.isAlphabet(b.keyCode,"d"))&&wpd.acquireData.switchToolOnKeyPress(String.fromCharCode(b.keyCode).toLowerCase())};this.onRemove=function(){document.getElementById("delete-point-button").classList.remove("pressed-button")}}}();
wpd.DataPointsRepainter=function(){return function(){var b=function(){var b=wpd.graphicsWidget.getAllContexts(),d=wpd.appData.getPlotData().getActiveDataSeries(),a,e,f,g;for(a=0;a<d.getCount();a++)e=d.getPixel(a),g=0<=d.getSelectedPixels().indexOf(a),f=wpd.graphicsWidget.screenPx(e.x,e.y),b.dataCtx.beginPath(),b.dataCtx.fillStyle=g?"rgb(0,200,0)":"rgb(200,0,0)",b.dataCtx.arc(f.x,f.y,3,0,2*Math.PI,!0),b.dataCtx.fill(),b.oriDataCtx.beginPath(),b.oriDataCtx.fillStyle=g?"rgb(0,200,0)":"rgb(200,0,0)",
b.oriDataCtx.arc(e.x,e.y,3,0,2*Math.PI,!0),b.oriDataCtx.fill()};this.painterName="dataPointsRepainter";this.onAttach=function(){wpd.graphicsWidget.resetData();b()};this.onRedraw=function(){b()};this.onForcedRedraw=function(){wpd.graphicsWidget.resetData();b()}}}();
wpd.AdjustDataPointTool=function(){return function(){this.onAttach=function(){document.getElementById("manual-adjust-button").classList.add("pressed-button");wpd.graphicsWidget.setRepainter(new wpd.DataPointsRepainter)};this.onRemove=function(){wpd.appData.getPlotData().getActiveDataSeries().unselectAll();wpd.graphicsWidget.forceHandlerRepaint();document.getElementById("manual-adjust-button").classList.remove("pressed-button")};this.onMouseClick=function(b,c,d){c=wpd.appData.getPlotData().getActiveDataSeries();
c.unselectAll();c.selectNearestPixel(d.x,d.y);wpd.graphicsWidget.forceHandlerRepaint();wpd.graphicsWidget.updateZoomOnEvent(b)};this.onKeyDown=function(b){if(wpd.keyCodes.isAlphabet(b.keyCode,"a")||wpd.keyCodes.isAlphabet(b.keyCode,"s")||wpd.keyCodes.isAlphabet(b.keyCode,"d"))wpd.acquireData.switchToolOnKeyPress(String.fromCharCode(b.keyCode).toLowerCase());else{var c=wpd.appData.getPlotData().getActiveDataSeries(),d=c.getSelectedPixels()[0];if(null!=d){var a=c.getPixel(d),e=a.x,a=a.y,f=!0===b.shiftKey?
5/wpd.graphicsWidget.getZoomRatio():0.5/wpd.graphicsWidget.getZoomRatio();if(wpd.keyCodes.isUp(b.keyCode))a-=f;else if(wpd.keyCodes.isDown(b.keyCode))a+=f;else if(wpd.keyCodes.isLeft(b.keyCode))e-=f;else if(wpd.keyCodes.isRight(b.keyCode))e+=f;else return;c.setPixelAt(d,e,a);wpd.graphicsWidget.forceHandlerRepaint();wpd.graphicsWidget.updateZoomToImagePosn(e,a);b.preventDefault();b.stopPropagation()}}}}}();
wpd.dataPointCounter=function(){return{setCount:function(){var b=document.getElementsByClassName("data-point-counter"),c;for(c=0;c<b.length;c++)b[c].innerHTML=wpd.appData.getPlotData().getActiveDataSeries().getCount()}}}();wpd=wpd||{};
wpd.dataMask=function(){return{grabMask:function(b){var c=wpd.graphicsWidget.getAllContexts(),d=wpd.graphicsWidget.getImageSize(),a=c.oriDataCtx.getImageData(0,0,d.width,d.height),e=[],f,g=0,h=wpd.appData.getPlotData().getAutoDetector();for(f=0;f<a.data.length;f+=4)255===a.data[f]&&255===a.data[f+1]&&0===a.data[f+2]&&(e[g]=f/4,g++);h.mask=e;!0===b&&(h.imageData=c.oriImageCtx.getImageData(0,0,d.width,d.height),h.imageWidth=d.width,h.imageHeight=d.height)},drawMask:function(){var b=wpd.appData.getPlotData().getAutoDetector().mask;
if(null!=b&&0!==b.length){var c,d,a=wpd.graphicsWidget.getAllContexts(),e=wpd.graphicsWidget.getImageSize(),f=a.oriDataCtx.getImageData(0,0,e.width,e.height);for(c=0;c<b.length;c++)d=b[c],parseInt(d/e.height,10),f.data[4*d]=255,f.data[4*d+1]=255,f.data[4*d+2]=0,f.data[4*d+3]=200;a.oriDataCtx.putImageData(f,0,0,e.width,e.height);wpd.graphicsWidget.copyImageDataLayerToScreen()}},markBox:function(){var b=new wpd.BoxMaskTool;wpd.graphicsWidget.setTool(b)},markPen:function(){var b=new wpd.PenMaskTool;
wpd.graphicsWidget.setTool(b)},eraseMarks:function(){var b=new wpd.EraseMaskTool;wpd.graphicsWidget.setTool(b)},viewMask:function(){var b=new wpd.ViewMaskTool;wpd.graphicsWidget.setTool(b)}}}();
wpd.BoxMaskTool=function(){return function(){var b=!1,c,d,a=wpd.graphicsWidget.getAllContexts(),e,f,g=function(){wpd.graphicsWidget.resetHover();a.hoverCtx.strokeStyle="rgb(0,0,0)";a.hoverCtx.strokeRect(d.x,d.y,f.x-d.x,f.y-d.y)};this.onAttach=function(){wpd.graphicsWidget.setRepainter(new wpd.MaskPainter);document.getElementById("box-mask").classList.add("pressed-button");document.getElementById("view-mask").classList.add("pressed-button")};this.onMouseDown=function(a,e,f){!0!==b&&(b=!0,c=f,d=e)};
this.onMouseMove=function(a,c,d){!1!==b&&(f=c,clearTimeout(e),e=setTimeout(g,5))};this.onMouseOut=function(){!0===b&&(clearTimeout(e),b=!1,wpd.graphicsWidget.resetHover())};this.onMouseUp=function(f,g,n){!1!==b&&(clearTimeout(e),b=!1,wpd.graphicsWidget.resetHover(),a.dataCtx.fillStyle="rgba(255,255,0,0.8)",a.dataCtx.fillRect(d.x,d.y,g.x-d.x,g.y-d.y),a.oriDataCtx.fillStyle="rgba(255,255,0,0.8)",a.oriDataCtx.fillRect(c.x,c.y,n.x-c.x,n.y-c.y))};this.onRemove=function(){document.getElementById("box-mask").classList.remove("pressed-button");
document.getElementById("view-mask").classList.remove("pressed-button");wpd.dataMask.grabMask(!0)}}}();
wpd.PenMaskTool=function(){return function(){var b=wpd.graphicsWidget.getAllContexts(),c=!1,d,a,e,f=function(){b.dataCtx.strokeStyle="rgba(255,255,0,0.8)";b.dataCtx.lineTo(a.x,a.y);b.dataCtx.stroke();b.oriDataCtx.strokeStyle="rgba(255,255,0,0.8)";b.oriDataCtx.lineTo(e.x,e.y);b.oriDataCtx.stroke()};this.onAttach=function(){wpd.graphicsWidget.setRepainter(new wpd.MaskPainter);document.getElementById("pen-mask").classList.add("pressed-button");document.getElementById("view-mask").classList.add("pressed-button");
wpd.toolbar.show("paintToolbar")};this.onMouseDown=function(a,d,e){!0!==c&&(a=parseInt(document.getElementById("paintThickness").value,10),c=!0,b.dataCtx.strokeStyle="rgba(255,255,0,0.8)",b.dataCtx.lineWidth=a*wpd.graphicsWidget.getZoomRatio(),b.dataCtx.beginPath(),b.dataCtx.moveTo(d.x,d.y),b.oriDataCtx.strokeStyle="rgba(255,255,0,0.8)",b.oriDataCtx.lineWidth=a,b.oriDataCtx.beginPath(),b.oriDataCtx.moveTo(e.x,e.y))};this.onMouseMove=function(b,h,l){!1!==c&&(a=h,e=l,clearTimeout(d),d=setTimeout(f,
5))};this.onMouseUp=function(a,e,f){clearTimeout(d);b.dataCtx.closePath();b.dataCtx.lineWidth=1;b.oriDataCtx.closePath();b.oriDataCtx.lineWidth=1;c=!1};this.onMouseOut=function(a,b,c){this.onMouseUp(a,b,c)};this.onRemove=function(){document.getElementById("pen-mask").classList.remove("pressed-button");document.getElementById("view-mask").classList.remove("pressed-button");wpd.dataMask.grabMask(!0);wpd.toolbar.clear()}}}();
wpd.EraseMaskTool=function(){return function(){var b=wpd.graphicsWidget.getAllContexts(),c=!1,d,a,e,f=function(){b.dataCtx.globalCompositeOperation="destination-out";b.oriDataCtx.globalCompositeOperation="destination-out";b.dataCtx.strokeStyle="rgba(255,255,0,1)";b.dataCtx.lineTo(a.x,a.y);b.dataCtx.stroke();b.oriDataCtx.strokeStyle="rgba(255,255,0,1)";b.oriDataCtx.lineTo(e.x,e.y);b.oriDataCtx.stroke()};this.onAttach=function(){wpd.graphicsWidget.setRepainter(new wpd.MaskPainter);document.getElementById("erase-mask").classList.add("pressed-button");
document.getElementById("view-mask").classList.add("pressed-button");wpd.toolbar.show("paintToolbar")};this.onMouseDown=function(a,d,e){!0!==c&&(a=parseInt(document.getElementById("paintThickness").value,10),c=!0,b.dataCtx.globalCompositeOperation="destination-out",b.oriDataCtx.globalCompositeOperation="destination-out",b.dataCtx.strokeStyle="rgba(0,0,0,1)",b.dataCtx.lineWidth=a*wpd.graphicsWidget.getZoomRatio(),b.dataCtx.beginPath(),b.dataCtx.moveTo(d.x,d.y),b.oriDataCtx.strokeStyle="rgba(0,0,0,1)",
b.oriDataCtx.lineWidth=a,b.oriDataCtx.beginPath(),b.oriDataCtx.moveTo(e.x,e.y))};this.onMouseMove=function(b,h,l){!1!==c&&(a=h,e=l,clearTimeout(d),d=setTimeout(f,5))};this.onMouseOut=function(a,b,c){this.onMouseUp(a,b,c)};this.onMouseUp=function(a,e,f){clearTimeout(d);b.dataCtx.closePath();b.dataCtx.lineWidth=1;b.oriDataCtx.closePath();b.oriDataCtx.lineWidth=1;b.dataCtx.globalCompositeOperation="source-over";b.oriDataCtx.globalCompositeOperation="source-over";c=!1};this.onRemove=function(){document.getElementById("erase-mask").classList.remove("pressed-button");
document.getElementById("view-mask").classList.remove("pressed-button");wpd.dataMask.grabMask(!0);wpd.toolbar.clear()}}}();wpd.ViewMaskTool=function(){return function(){this.onAttach=function(){wpd.graphicsWidget.setRepainter(new wpd.MaskPainter);document.getElementById("view-mask").classList.add("pressed-button")};this.onRemove=function(){document.getElementById("view-mask").classList.remove("pressed-button");wpd.dataMask.grabMask(!0)}}}();
wpd.MaskPainter=function(){return function(){var b=wpd.graphicsWidget.getAllContexts(),c=wpd.appData.getPlotData().getAutoDetector(),d=function(){if(null!=c.mask&&0!==c.mask.length){var a,d;a=wpd.graphicsWidget.getImageSize();imgData=b.oriDataCtx.getImageData(0,0,a.width,a.height);for(a=0;a<c.mask.length;a++)d=c.mask[a],imgData.data[4*d]=255,imgData.data[4*d+1]=255,imgData.data[4*d+2]=0,imgData.data[4*d+3]=200;b.oriDataCtx.putImageData(imgData,0,0);wpd.graphicsWidget.copyImageDataLayerToScreen()}};
this.painterName="dataMaskPainter";this.onRedraw=function(){wpd.dataMask.grabMask(!0);d()};this.onAttach=function(){wpd.graphicsWidget.resetData();d()}}}();wpd=wpd||{};
wpd.distanceMeasurement=function(){return{start:function(){wpd.graphicsWidget.removeTool();wpd.graphicsWidget.resetData();var b=wpd.appData.getPlotData();null==b.distanceMeasurementData&&(b.distanceMeasurementData=new wpd.ConnectedPoints(2));wpd.sidebar.show("measure-distances-sidebar");wpd.graphicsWidget.setTool(new wpd.AddMeasurementTool("distance"));wpd.graphicsWidget.forceHandlerRepaint()},addPair:function(){wpd.graphicsWidget.setTool(new wpd.AddMeasurementTool("distance"))},deletePair:function(){wpd.graphicsWidget.setTool(new wpd.DeleteMeasurementTool("distance"))},
clearAll:function(){wpd.graphicsWidget.removeTool();wpd.graphicsWidget.resetData();wpd.appData.getPlotData().distanceMeasurementData=new wpd.ConnectedPoints(2)}}}();
wpd.angleMeasurement=function(){return{start:function(){wpd.graphicsWidget.removeTool();wpd.graphicsWidget.resetData();var b=wpd.appData.getPlotData();null==b.angleMeasurementData&&(b.angleMeasurementData=new wpd.ConnectedPoints(3));wpd.sidebar.show("measure-angles-sidebar");wpd.graphicsWidget.setTool(new wpd.AddMeasurementTool("angle"));wpd.graphicsWidget.forceHandlerRepaint()},addAngle:function(){wpd.graphicsWidget.setTool(new wpd.AddMeasurementTool("angle"))},deleteAngle:function(){wpd.graphicsWidget.setTool(new wpd.DeleteMeasurementTool("angle"))},
clearAll:function(){wpd.graphicsWidget.removeTool();wpd.graphicsWidget.resetData();wpd.appData.getPlotData().angleMeasurementData=new wpd.ConnectedPoints(3)}}}();
wpd.measurementData=function(){var b;return{showAngleData:function(){wpd.popup.show("measurement-data-window");var c=wpd.appData.getPlotData().angleMeasurementData,d=c.connectionCount(),a,e=document.getElementById("measurement-data-table");b="";for(a=0;a<d;a++)b+=a.toString()+", "+c.getAngle(a)+"\n";e.value=b},showDistanceData:function(){wpd.popup.show("measurement-data-window");var c=wpd.appData.getPlotData().distanceMeasurementData,d=c.connectionCount(),a,e=document.getElementById("measurement-data-table"),
f=wpd.appData.getPlotData().axes;b="";for(a=0;a<d;a++)b=!0===wpd.appData.isAligned()&&f instanceof wpd.MapAxes?b+(a.toString()+", "+f.pixelToDataDistance(c.getDistance(a))+"\n"):b+(a.toString()+", "+c.getDistance(a)+"\n");e.value=b},selectAll:function(){var b=document.getElementById("measurement-data-table");b.focus();b.select()},generateCSV:function(){var c,d,a,e=JSON.stringify(b);c=document.createElement("div");d=document.createElement("form");a=document.createElement("input");d.setAttribute("method",
"post");d.setAttribute("action","php/csvexport.php");a.setAttribute("type","text");a.setAttribute("name","data");d.appendChild(a);c.appendChild(d);document.body.appendChild(c);c.style.display="none";a.setAttribute("value",e);d.submit();document.body.removeChild(c)},close:function(){b="";wpd.popup.close("measurement-data-window")}}}();
wpd.AddMeasurementTool=function(){return function(b){var c="distance"===b,d=wpd.graphicsWidget.getAllContexts(),a=wpd.appData.getPlotData(),e=0,f=!0,g=[],h=c?2:3;this.onAttach=function(){document.getElementById(!0===c?"add-pair-button":"add-angle-button").classList.add("pressed-button");wpd.graphicsWidget.setRepainter(new wpd.MeasurementRepainter(b))};this.onRemove=function(){document.getElementById(!0===c?"add-pair-button":"add-angle-button").classList.remove("pressed-button")};this.onMouseClick=
function(l,n,k){if(f){wpd.graphicsWidget.resetHover();g[2*e]=k.x;g[2*e+1]=k.y;e+=1;e===h&&(f=!1,c?a.distanceMeasurementData.addConnection(g):a.angleMeasurementData.addConnection(g),wpd.graphicsWidget.forceHandlerRepaint(),wpd.graphicsWidget.setTool(new wpd.AdjustMeasurementTool(b)));if(1<e){var m=wpd.graphicsWidget.screenPx(g[2*(e-2)],g[2*(e-2)+1]);d.dataCtx.beginPath();d.dataCtx.strokeStyle="rgb(0,0,10)";d.dataCtx.moveTo(m.x,m.y);d.dataCtx.lineTo(n.x,n.y);d.dataCtx.stroke();d.oriDataCtx.beginPath();
d.oriDataCtx.strokeStyle="rgb(0,0,10)";d.oriDataCtx.moveTo(g[2*(e-2)],g[2*(e-2)+1]);d.oriDataCtx.lineTo(k.x,k.y);d.oriDataCtx.stroke()}d.dataCtx.beginPath();d.dataCtx.fillStyle="rgb(200, 0, 0)";d.dataCtx.arc(n.x,n.y,3,0,2*Math.PI,!0);d.dataCtx.fill();d.oriDataCtx.beginPath();d.oriDataCtx.fillStyle="rgb(200,0,0)";d.oriDataCtx.arc(k.x,k.y,3,0,2*Math.PI,!0);d.oriDataCtx.fill()}wpd.graphicsWidget.updateZoomOnEvent(l)};this.onMouseMove=function(a,b,c){f&&1<=e&&(wpd.graphicsWidget.resetHover(),a=wpd.graphicsWidget.screenPx(g[2*
(e-1)],g[2*(e-1)+1]),d.hoverCtx.beginPath(),d.hoverCtx.strokeStyle="rgb(0,0,0)",d.hoverCtx.moveTo(a.x,a.y),d.hoverCtx.lineTo(b.x,b.y),d.hoverCtx.stroke())};this.onKeyDown=function(a){}}}();
wpd.DeleteMeasurementTool=function(){return function(b){var c="distance"===b;wpd.graphicsWidget.getAllContexts();var d=wpd.appData.getPlotData();this.onAttach=function(){document.getElementById(!0===c?"delete-pair-button":"delete-angle-button").classList.add("pressed-button");wpd.graphicsWidget.setRepainter(new wpd.MeasurementRepainter(b))};this.onRemove=function(){document.getElementById(!0===c?"delete-pair-button":"delete-angle-button").classList.remove("pressed-button")};this.onMouseClick=function(a,
e,f){c?d.distanceMeasurementData.deleteNearestConnection(f.x,f.y):d.angleMeasurementData.deleteNearestConnection(f.x,f.y);wpd.graphicsWidget.setTool(new wpd.AdjustMeasurementTool(b));wpd.graphicsWidget.resetData();wpd.graphicsWidget.forceHandlerRepaint();wpd.graphicsWidget.updateZoomOnEvent(a)}}}();
wpd.AdjustMeasurementTool=function(){return function(b){this.onAttach=function(){wpd.graphicsWidget.setRepainter(new wpd.MeasurementRepainter(b))};this.onMouseClick=function(c,d,a){d=wpd.appData.getPlotData();"distance"===b?d.distanceMeasurementData.selectNearestPoint(a.x,a.y):"angle"===b&&d.angleMeasurementData.selectNearestPoint(a.x,a.y);wpd.graphicsWidget.forceHandlerRepaint();wpd.graphicsWidget.updateZoomOnEvent(c)};this.onKeyDown=function(c){if(wpd.keyCodes.isAlphabet(c.keyCode,"a"))wpd.graphicsWidget.setTool(new wpd.AddMeasurementTool(b));
else if(wpd.keyCodes.isAlphabet(c.keyCode,"d"))wpd.graphicsWidget.setTool(new wpd.DeleteMeasurementTool(b));else{var d=wpd.appData.getPlotData(),d="distance"===b?d.distanceMeasurementData:d.angleMeasurementData,a=d.getSelectedConnectionAndPoint();if(0<=a.connectionIndex&&0<=a.pointIndex){var e=!0===c.shiftKey?5/wpd.graphicsWidget.getZoomRatio():0.5/wpd.graphicsWidget.getZoomRatio(),f=d.getPointAt(a.connectionIndex,a.pointIndex);if(wpd.keyCodes.isUp(c.keyCode))f.y-=e;else if(wpd.keyCodes.isDown(c.keyCode))f.y+=
e;else if(wpd.keyCodes.isLeft(c.keyCode))f.x-=e;else if(wpd.keyCodes.isRight(c.keyCode))f.x+=e;else return;d.setPointAt(a.connectionIndex,a.pointIndex,f.x,f.y);wpd.graphicsWidget.forceHandlerRepaint();wpd.graphicsWidget.updateZoomToImagePosn(f.x,f.y);c.preventDefault();c.stopPropagation()}}}}}();
wpd.MeasurementRepainter=function(){return function(b){var c="distance"===b,d="angle"===b,a=wpd.graphicsWidget.getAllContexts(),e=function(b,c,d,e,f,g,r,p){a.dataCtx.beginPath();a.dataCtx.strokeStyle="rgb(0,0,10)";a.dataCtx.moveTo(b,c);a.dataCtx.lineTo(d,e);a.dataCtx.stroke();a.oriDataCtx.beginPath();a.oriDataCtx.strokeStyle="rgb(0,0,10)";a.oriDataCtx.moveTo(f,g);a.oriDataCtx.lineTo(r,p);a.oriDataCtx.stroke()},f=function(b,c,d,e,f){a.dataCtx.beginPath();a.dataCtx.fillStyle=f?"rgb(0, 200, 0)":"rgb(200, 0, 0)";
a.dataCtx.arc(b,c,3,0,2*Math.PI,!0);a.dataCtx.fill();a.oriDataCtx.beginPath();a.oriDataCtx.fillStyle=f?"rgb(0,200,0)":"rgb(200,0,0)";a.oriDataCtx.arc(d,e,3,0,2*Math.PI,!0);a.oriDataCtx.fill()},g=function(b,c,d,f,e){a.dataCtx.font="14px sans-serif";a.dataCtx.fillText(e,parseInt(b,10),parseInt(c,10));a.oriDataCtx.font="14px sans-serif";a.oriDataCtx.fillText(e,parseInt(d,10),parseInt(f,10))};this.painterName="measurementRepainter-"+b;this.onAttach=function(){wpd.graphicsWidget.resetData()};this.onRedraw=
function(){if(c){var b=wpd.appData.getPlotData().distanceMeasurementData,l=b.connectionCount(),n,k,m,q,r,p,s,t,x,v,u=wpd.appData.getPlotData().axes;for(n=0;n<l;n++)k=b.getConnectionAt(n),m=k[0],q=k[1],r=k[2],k=k[3],x=b.isPointSelected(n,0),v=b.isPointSelected(n,1),t=!0===wpd.appData.isAligned()&&u instanceof wpd.MapAxes?"["+n.toString()+"]: "+u.pixelToDataDistance(b.getDistance(n)).toFixed(2)+" "+u.getUnits():"["+n.toString()+"]: "+b.getDistance(n).toFixed(2)+" px",p=wpd.graphicsWidget.screenPx(m,
q),s=wpd.graphicsWidget.screenPx(r,k),e(p.x,p.y,s.x,s.y,m,q,r,k),f(p.x,p.y,m,q,x),f(s.x,s.y,r,k,v),g(0.5*(p.x+s.x),0.5*(p.y+s.y),0.5*(m+r),0.5*(q+k),t)}if(d){var b=wpd.appData.getPlotData().angleMeasurementData,l=b.connectionCount(),A,F,J,E,z;for(n=0;n<l;n++)r=b.getConnectionAt(n),s=r[0],t=r[1],m=r[2],q=r[3],x=r[4],v=r[5],J=b.isPointSelected(n,0),E=b.isPointSelected(n,1),z=b.isPointSelected(n,2),u="["+n.toString()+"]: "+b.getAngle(n).toFixed(2)+"\u00b0",p=Math.atan2(t-q,s-m),k=Math.atan2(v-q,x-m),
A=wpd.graphicsWidget.screenPx(s,t),r=wpd.graphicsWidget.screenPx(m,q),F=wpd.graphicsWidget.screenPx(x,v),e(A.x,A.y,r.x,r.y,s,t,m,q),e(r.x,r.y,F.x,F.y,m,q,x,v),f(A.x,A.y,s,t,J),f(r.x,r.y,m,q,E),f(F.x,F.y,x,v,z),s=r.x,t=r.y,x=m,v=q,a.dataCtx.beginPath(),a.dataCtx.strokeStyle="rgb(0,0,10)",a.dataCtx.arc(s,t,15,p,k,!0),a.dataCtx.stroke(),a.oriDataCtx.beginPath(),a.oriDataCtx.strokeStyle="rgb(0,0,10)",a.oriDataCtx.arc(x,v,15,p,k,!0),a.oriDataCtx.stroke(),g(r.x+10,r.y+15,m+10,q+15,u)}};this.onForcedRedraw=
function(){wpd.graphicsWidget.resetData();this.onRedraw()}}}();wpd=wpd||{};wpd.saveResume=function(){return{save:function(){var b=wpd.appData.getPlotData().getAutoDetector().imageData,c=new XMLHttpRequest,d=new FormData;c.open("POST","php/test.php",!0);c.onload=function(a){console.log("done")};b=new Blob(BSON.serialize(b),{type:"application/bson"});d.append("file.bson",b,"file.bson");c.send(d)}}}();wpd=wpd||{};
wpd.scriptInjector=function(){return{start:function(){wpd.popup.show("runScriptPopup")},cancel:function(){wpd.popup.close("runScriptPopup")},load:function(){var b=document.getElementById("runScriptFileInput");wpd.popup.close("runScriptPopup");if(1==b.files.length){var c=new FileReader;c.onload=function(){eval(c.result);wpdscript.run();window.wpdscript=wpdscript};c.readAsText(b.files[0])}}}}();wpd=wpd||{};wpd.browserInfo=function(){return{checkBrowser:function(){window.FileReader||alert("\tWARNING!\nYour web browser is not supported. This program might not behave as intended. Please use a recent version of Google Chrome, Firefox or Safari browser.")}}}();
