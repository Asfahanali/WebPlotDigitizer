var loadScript;function loadJS(a){""!=a&&(unloadJS(),loadScript=document.createElement("script"),loadScript.setAttribute("type","text/javascript"),loadScript.setAttribute("src",a),loadScript.setAttribute("Id","loadedJS"),loadScript.setAttribute("onerror","alert('Error loading file!');"),"undefined"!=typeof loadScript?document.getElementsByTagName("head")[0].appendChild(loadScript):alert("Error loading script!"))}
function unloadJS(){var a=document.getElementById("loadedJS");a&&a.parentNode.removeChild(a)}function AEObject(){this.getParamList=function(){};this.run=function(){}}var axesPicked,axesN,axesNmax,xyAxes,axesAlignmentData=[],plotType;
function initiatePlotAlignment(){axesPicked=0;xyEl=document.getElementById("r_xy");polarEl=document.getElementById("r_polar");ternaryEl=document.getElementById("r_ternary");mapEl=document.getElementById("r_map");imageEl=document.getElementById("r_image");popup.close("axesList");!0===xyEl.checked?setAxes("XY"):!0===polarEl.checked?setAxes("polar"):!0===ternaryEl.checked?setAxes("ternary"):!0===mapEl.checked?setAxes("map"):!0===imageEl.checked&&setAxes("image")}
function setAxes(a){plotType=a;sidebar.clear();canvasMouseEvents.removeAll();canvasMouseEvents.add("click",pickCorners,!0);axesN=0;xyAxes=[];"XY"===plotType||"bar"===plotType?(axesNmax=4,popup.show("xyAxesInfo")):"polar"===plotType?(axesNmax=3,popup.show("polarAxesInfo")):"ternary"===plotType?(axesNmax=3,popup.show("ternaryAxesInfo")):"map"===plotType?(axesNmax=2,popup.show("mapAxesInfo")):"image"===plotType&&(axesNmax=0,alignAxes())}
function pickCorners(a){if(axesN<axesNmax){var b=getPosition(a),c=b.x,b=b.y;xyAxes[axesN]=[];xyAxes[axesN][0]=parseFloat(c);xyAxes[axesN][1]=parseFloat(b);axesN+=1;dataCtx.beginPath();dataCtx.fillStyle="rgb(0,0,200)";dataCtx.arc(c,b,3,0,2*Math.PI,!0);dataCtx.fill();zoomView.updateZoom(a);axesN===axesNmax&&(axesPicked=1,canvasMouseEvents.remove("click",pickCorners,!0),"XY"===plotType?popup.show("xyAlignment"):"polar"===plotType?popup.show("polarAlignment"):"ternary"===plotType?popup.show("ternaryAlignment"):
"map"===plotType&&popup.show("mapAlignment"),dataCanvas.width=dataCanvas.width)}}
function alignAxes(){if("XY"===plotType){var a=document.getElementById("xmin"),b=document.getElementById("xmax"),c=document.getElementById("ymin"),e=document.getElementById("ymax"),g=document.getElementById("xlog"),d=document.getElementById("ylog"),f=new InputParser,h,k=!1,m=!1,r=!1,l=!1,n=function(a){return!f.isValid||null==a?(popup.close("xyAlignment"),popup.show("inputError"),null):a};h=n(f.parse(a.value));if(null===h)return;axesAlignmentData[0]=h;f.isDate&&(k=!0);h=n(f.parse(b.value));if(null===
h)return;axesAlignmentData[1]=h;f.isDate&&(r=!0);h=n(f.parse(c.value));if(null===h)return;axesAlignmentData[2]=h;f.isDate&&(m=!0);h=n(f.parse(e.value));if(null===h)return;axesAlignmentData[3]=h;f.isDate&&(l=!0);axesAlignmentData[4]=!0===g.checked?!0:!1;axesAlignmentData[5]=!0===d.checked?!0:!1;if(k!==r||m!==l){popup.close("xyAlignment");popup.show("inputError");return}k&&r?(axesAlignmentData[6]=!0,axesAlignmentData[8]=dateConverter.getFormatString(a.value)):axesAlignmentData[6]=!1;m&&l?(axesAlignmentData[7]=
!0,axesAlignmentData[9]=dateConverter.getFormatString(c.value)):axesAlignmentData[7]=!1;popup.close("xyAlignment")}else"polar"==plotType?(a=document.getElementById("rpoint1"),b=document.getElementById("thetapoint1"),c=document.getElementById("rpoint2"),e=document.getElementById("thetapoint2"),g=document.getElementById("degrees"),document.getElementById("radians"),d=document.getElementById("clockwise"),axesAlignmentData[0]=parseFloat(a.value),axesAlignmentData[1]=parseFloat(b.value),axesAlignmentData[2]=
parseFloat(c.value),axesAlignmentData[3]=parseFloat(e.value),axesAlignmentData[4]=!0===g.checked?!0:!1,axesAlignmentData[5]=!0===d.checked?!0:!1,popup.close("polarAlignment")):"ternary"===plotType?(document.getElementById("range0to1"),a=document.getElementById("range0to100"),b=document.getElementById("ternarynormal"),axesAlignmentData[0]=!0===a.checked?!0:!1,axesAlignmentData[1]=!0===b.checked?!0:!1,popup.close("ternaryAlignment")):"map"===plotType?(a=document.getElementById("scaleLength"),axesAlignmentData[0]=
parseFloat(a.value),popup.close("mapAlignment")):"image"===plotType&&(axesPicked=1,axesAlignmentData[0]=imageDimensions[0],axesAlignmentData[1]=imageDimensions[2],axesAlignmentData[2]=imageDimensions[1],axesAlignmentData[3]=imageDimensions[3]);1===axesPicked&&acquireData()}
window.addEventListener("load",function(a){window.applicationCache.addEventListener("updateready",function(a){window.applicationCache.status==window.applicationCache.UPDATEREADY&&confirm("A new version of WebPlotDigitizer is available. Update?")&&window.location.reload()},!1)},!1);var fg_color=[0,0,0],bg_color=[255,255,255],colorPickerMode="fg",testImgCanvas,testImgContext,boxCoordinates=[0,0,1,1],drawingBox=!1,drawingPen=!1,drawingEraser=!1,binaryData;
function colorPickerWindow(a){colorPickerMode=a;"fg"===a?popup.show("colorPickerFG"):"bg"===a&&popup.show("colorPickerBG")}function pickColor(){canvasMouseEvents.removeAll();canvasMouseEvents.add("click",colorPicker,!0)}
function colorPicker(a){var b=getPosition(a);a=b.x;var c=b.y,b=ctx.getImageData(cx0,cy0,currentImageWidth,currentImageHeight);if(a<currentImageWidth+cx0&&c<currentImageHeight+cy0&&a>cx0&&c>cy0){a=4*(c-cy0)*currentImageWidth+4*(a-cx0);a=[b.data[a],b.data[a+1],b.data[a+2]];var b=document.getElementById("color_red"),c=document.getElementById("color_green"),e=document.getElementById("color_blue");canvasMouseEvents.remove("click",colorPicker,!0);"fg"===colorPickerMode?(assignColor("fg",a),b=document.getElementById("color_red_fg"),
c=document.getElementById("color_green_fg"),e=document.getElementById("color_blue_fg"),popup.show("colorPickerFG")):"bg"===colorPickerMode&&(assignColor("bg",a),b=document.getElementById("color_red_bg"),c=document.getElementById("color_green_bg"),e=document.getElementById("color_blue_bg"),popup.show("colorPickerBG"));b.value=a[0];c.value=a[1];e.value=a[2]}}
function assignColor(a,b){"fg"===a?(b||(redEl=document.getElementById("color_red_fg"),greenEl=document.getElementById("color_green_fg"),blueEl=document.getElementById("color_blue_fg"),b=[],b[0]=redEl.value,b[1]=greenEl.value,b[2]=blueEl.value),fg_color=b,document.getElementById("autoFGBtn").style.borderColor="rgb("+fg_color[0]+","+fg_color[1]+","+fg_color[2]+")"):"bg"===a&&(b||(redEl=document.getElementById("color_red_bg"),greenEl=document.getElementById("color_green_bg"),blueEl=document.getElementById("color_blue_bg"),
b=[],b[0]=redEl.value,b[1]=greenEl.value,b[2]=blueEl.value),bg_color=b,document.getElementById("autoBGBtn").style.borderColor="rgb("+bg_color[0]+","+bg_color[1]+","+bg_color[2]+")")}function boxPaint(){canvasMouseEvents.removeAll();canvasMouseEvents.add("mousedown",boxPaintMousedown,!0);canvasMouseEvents.add("mouseup",boxPaintMouseup,!0);canvasMouseEvents.add("mousemove",boxPaintMousedrag,!0)}
function boxPaintMousedown(a){a=getPosition(a);boxCoordinates[0]=a.x;boxCoordinates[1]=a.y;drawingBox=!0}function boxPaintMouseup(a){a=getPosition(a);boxCoordinates[2]=a.x;boxCoordinates[3]=a.y;hoverCanvas.width=hoverCanvas.width;dataCtx.fillStyle="rgba(255,255,0,1)";dataCtx.fillRect(boxCoordinates[0],boxCoordinates[1],boxCoordinates[2]-boxCoordinates[0],boxCoordinates[3]-boxCoordinates[1]);drawingBox=!1}
function boxPaintMousedrag(a){if(!0===drawingBox){var b=getPosition(a);a=b.x;b=b.y;hoverCanvas.width=hoverCanvas.width;hoverCtx.strokeStyle="rgb(0,0,0)";hoverCtx.strokeRect(boxCoordinates[0],boxCoordinates[1],a-boxCoordinates[0],b-boxCoordinates[1])}}function penPaint(){canvasMouseEvents.removeAll();toolbar.show("paintToolbar");canvasMouseEvents.add("mousedown",penPaintMousedown,!0);canvasMouseEvents.add("mouseup",penPaintMouseup,!0);canvasMouseEvents.add("mousemove",penPaintMousedrag,!0)}
function penPaintMousedown(a){if(!1===drawingPen){var b=getPosition(a);a=b.x;b=b.y;drawingPen=!0;ctx.strokeStyle="rgba(255,255,0,1)";thkRange=document.getElementById("paintThickness");dataCtx.lineWidth=parseInt(thkRange.value);dataCtx.beginPath();dataCtx.moveTo(a,b)}}function penPaintMouseup(a){dataCtx.closePath();dataCtx.lineWidth=1;drawingPen=!1}
function penPaintMousedrag(a){if(!0===drawingPen){var b=getPosition(a);a=b.x;b=b.y;dataCtx.strokeStyle="rgba(255,255,0,1)";dataCtx.lineTo(a,b);dataCtx.stroke()}}function eraser(){canvasMouseEvents.removeAll();toolbar.show("paintToolbar");canvasMouseEvents.add("mousedown",eraserMousedown,!0);canvasMouseEvents.add("mouseup",eraserMouseup,!0);canvasMouseEvents.add("mousemove",eraserMousedrag,!0);dataCtx.globalCompositeOperation="destination-out"}
function eraserMousedown(a){if(!1===drawingEraser){var b=getPosition(a);a=b.x;b=b.y;drawingEraser=!0;dataCtx.globalCompositeOperation="destination-out";dataCtx.strokeStyle="rgba(0,0,0,1)";thkRange=document.getElementById("paintThickness");dataCtx.lineWidth=parseInt(thkRange.value);dataCtx.beginPath();dataCtx.moveTo(a,b)}}function eraserMouseup(a){dataCtx.closePath();dataCtx.lineWidth=1;dataCtx.globalCompositeOperation="source-over";drawingEraser=!1}
function eraserMousedrag(a){if(!0===drawingEraser){var b=getPosition(a);a=b.x;b=b.y;dataCtx.globalCompositeOperation="destination-out";dataCtx.strokeStyle="rgba(0,0,0,1)";dataCtx.lineTo(a,b);dataCtx.stroke()}}
function updateTestWindow(){colorModeEl=document.getElementById("colorModeFG");colorDistanceEl=document.getElementById("colorDistance");!0===colorModeEl.checked?(colmode="fg",chosenColor=fg_color):(colmode="bg",chosenColor=bg_color);cdistance=parseInt(colorDistanceEl.value);tempImgCanvas=document.createElement("canvas");tempImgCanvas.width=canvasWidth;tempImgCanvas.height=canvasHeight;tempImgContext=tempImgCanvas.getContext("2d");timgData=tempImgContext.getImageData(0,0,canvasWidth,canvasHeight);
timgData=getImageDataBasedOnSelection(timgData,colmode,chosenColor,cdistance);tempImgContext.putImageData(timgData,0,0);testImage=tempImgCanvas.toDataURL();var a=document.createElement("img");a.onload=function(){testImgContext.drawImage(a,0,0,canvasWidth/2,canvasHeight/2);processingNote(!1)};a.src=testImage}function saveTest(){window.open().location=testImgCanvas.toDataURL()}function launchTestWindow(){processingNote(!0);setTimeout("updateTestWindow();popup.show('testImageWindow');",100)}
function scanPlot(){autoStepEl=document.getElementById("autostepalgo");xStepEl=document.getElementById("xstepalgo");yStepEl=document.getElementById("ystepalgo");var a=document.getElementById("colorModeFG"),b=document.getElementById("colorDistance");!0===a.checked?(a="fg",chosenColor=fg_color):(a="bg",chosenColor=bg_color);cdistance=parseInt(b.value);popup.close("testImageWindow");binaryData=selectFromMarkedRegion(a,chosenColor,cdistance);xyData=[];pointsPicked=0;resetLayers();AEObject.run();pointsStatus(pointsPicked);
for(b=0;b<pointsPicked;b++)dataCtx.beginPath(),dataCtx.fillStyle="rgb(200,0,200)",dataCtx.arc(xyData[b][0],xyData[b][1],3,0,2*Math.PI,!0),dataCtx.fill()}function displayParameters(){var a=document.getElementById("curvesAlgoSelect");document.getElementById("paramZone");var b=document.getElementById("URLinput");"customAlgorithm"!==a.value&&(b.style.display="none",AEObject=window[a.value],makeParameterTable())}
function makeParameterTable(){if(AEObject.getParamList){var a=AEObject.getParamList(),b=document.getElementById("paramZone");b.innerHTML="";for(var c=0;c<a.length;c++)b.innerHTML+="<p>"+a[c][0]+" ("+a[c][1]+") <input type='text' value='"+a[c][2]+"' size=3 id='pv"+c+"'></p>"}}
var mainCanvas,dataCanvas,drawCanvas,hoverCanvas,topCanvas,cx0,cy0,canvasWidth,canvasHeight,cwidth,cheight,caspectratio,currentImage,originalImage,currentImageHeight,currentImageWidth,currentImageData,imageDimensions=[],onScreenDimensions=[],ctx,dataCtx,drawCtx,hoverCtx,topCtx,originalScreen,mainScreen,dataScreen,drawScreen,hoverScreen,topScreen;
function loadImage(a){var b=parseInt(a.height),c=parseInt(a.width),e=b/c,g=b,d=c;e>caspectratio?(g=cheight,d=cheight/e):(d=cwidth,g=cwidth*e);currentImage=a;currentImageHeight=parseInt(g);currentImageWidth=parseInt(d);ctx.fillStyle="rgb(255,255,255)";ctx.fillRect(0,0,canvasWidth,canvasHeight);ctx.drawImage(a,cx0,cy0,d,g);currentScreen=getCanvasData();imageDimensions[0]=1;imageDimensions[1]=1;imageDimensions[2]=c;imageDimensions[3]=b;onScreenDimensions[0]=cx0;onScreenDimensions[1]=cy0;onScreenDimensions[2]=
d+cx0;onScreenDimensions[3]=g+cy0}function saveCanvasImage(){var a=ctx.getImageData(cx0,cy0,currentImageWidth,currentImageHeight),b=document.createElement("canvas");b.width=currentImageWidth;b.height=currentImageHeight;tCanvasContext=b.getContext("2d");tCanvasContext.putImageData(a,0,0);newImage=document.createElement("img");newImage.src=b.toDataURL();newImage.onload=function(){currentImage=newImage;currentScreen=getCanvasData()}}
function getCanvasData(){return ctx.getImageData(0,0,canvasWidth,canvasHeight)}function putCanvasData(a){mainCanvas.width=mainCanvas.width;ctx.putImageData(a,0,0)}function reloadPlot(){mainCanvas.width=mainCanvas.width;ctx.drawImage(currentImage,cx0,cy0,currentImageWidth,currentImageHeight)}function redrawCanvas(){mainCanvas.width=mainCanvas.width;putCanvasData(currentScreen)}
function resetLayers(){dataCanvas.width=dataCanvas.width;drawCanvas.width=drawCanvas.width;hoverCanvas.width=hoverCanvas.width;topCanvas.width=topCanvas.width}function savePNG(){window.open().location=mainCanvas.toDataURL()}function getPosition(a){var b=mainCanvas.getBoundingClientRect();return{x:parseInt(a.pageX-(b.left+window.pageXOffset),10),y:parseInt(a.pageY-(b.top+window.pageYOffset),10)}}function dropHandler(a){a=a.dataTransfer.files;1==a.length&&fileLoader(a[0])}
function pasteHandler(a){if(void 0!==a.clipboardData&&(a=a.clipboardData.items,void 0!==a))for(var b=0;b<a.length;b++)if(-1!==a[b].type.indexOf("image")){var c=a[b].getAsFile();(window.URL||window.webkitURL).createObjectURL(c);fileLoader(c)}}
function fileLoader(a){if(a.type.match("image.*")){var b=new FileReader;b.onload=function(){var a=b.result,e=document.createElement("img");e.onload=function(){loadImage(e);originalScreen=getCanvasData();originalImage=e;setDefaultState()};e.src=a};b.readAsDataURL(a)}}function loadNewFile(){var a=document.getElementById("fileLoadBox");1==a.files.length&&fileLoader(a.files[0]);popup.close("loadNewImage")}var dataToPixelxy;
function pixelToData(a,b,c){if(1===axesPicked&&1<=b){var e=[];if("XY"===c){c=xyAxes[0][0];var g=xyAxes[0][1],d=xyAxes[1][0],f=xyAxes[1][1],h=xyAxes[2][0],k=xyAxes[2][1],m=xyAxes[3][0],r=xyAxes[3][1],l=axesAlignmentData[0],n=axesAlignmentData[1],q=axesAlignmentData[2],p=axesAlignmentData[3];!0===axesAlignmentData[4]&&(l=Math.log(l)/Math.log(10),n=Math.log(n)/Math.log(10));!0===axesAlignmentData[5]&&(q=Math.log(q)/Math.log(10),p=Math.log(p)/Math.log(10));var n=n-l,p=p-q,s=Math.sqrt((c-d)*(c-d)+(g-f)*
(g-f)),t=Math.sqrt((h-m)*(h-m)+(k-r)*(k-r)),n=n/s,p=p/t,t=taninverse(-(f-g),d-c),r=taninverse(-(r-k),m-h),s=r-t;for(ii=0;ii<b;ii++){var d=a[ii][0],f=a[ii][1],m=Math.sqrt((d-c)*(d-c)+(f-g)*(f-g)),u=taninverse(-(f-g),d-c)-t,m=m*Math.cos(u)-m*Math.sin(u)/Math.tan(s),m=m*n+l,u=Math.sqrt((d-h)*(d-h)+(f-k)*(f-k)),d=r-taninverse(-(f-k),d-h),d=u*Math.cos(d)-u*Math.sin(d)/Math.tan(s),d=d*p+q;!0===axesAlignmentData[4]&&(m=Math.pow(10,m));!0===axesAlignmentData[5]&&(d=Math.pow(10,d));e[ii]=[];e[ii][0]=m;e[ii][1]=
d}}else if("image"===c){c=onScreenDimensions[0];g=onScreenDimensions[1];d=onScreenDimensions[2];f=onScreenDimensions[1];h=onScreenDimensions[0];k=onScreenDimensions[1];m=onScreenDimensions[0];r=onScreenDimensions[3];l=axesAlignmentData[0];n=axesAlignmentData[1];q=axesAlignmentData[2];p=axesAlignmentData[3];n-=l;p-=q;t=0.5*(d-c)/(n+1);s=0.5*(f-g)/(p+1);c+=t;d-=t;g+=s;f-=s;s=Math.sqrt((c-d)*(c-d)+(g-f)*(g-f));t=Math.sqrt((h-m)*(h-m)+(k-r)*(k-r));n/=s;p/=t;t=taninverse(-(f-g),d-c);r=taninverse(-(r-k),
m-h);s=r-t;for(ii=0;ii<b;ii++)d=a[ii][0],f=a[ii][1],m=Math.sqrt((d-c)*(d-c)+(f-g)*(f-g)),u=taninverse(-(f-g),d-c)-t,m=m*Math.cos(u)-m*Math.sin(u)/Math.tan(s),m=m*n+l,u=Math.sqrt((d-h)*(d-h)+(f-k)*(f-k)),d=r-taninverse(-(f-k),d-h),d=u*Math.cos(d)-u*Math.sin(d)/Math.tan(s),d=d*p+q,e[ii]=[],e[ii][0]=Math.round(m),e[ii][1]=Math.round(d)}else if("map"===c){my0=canvasHeight;my2=my1=0;h=canvasWidth;my3=canvasHeight;c=0;g=-(my1-my0);h-=0;k=-(my3-my0);l=xyAxes[0][0];q=xyAxes[0][1];d=xyAxes[1][0];f=xyAxes[1][1];
d=axesAlignmentData[0]/Math.sqrt((l-d)*(l-d)+(q-f)*(q-f));l=0;n=canvasWidth*d;q=0;p=canvasHeight*d;n-=l;p-=q;f=c*k-g*h;for(ii=0;ii<b;ii++)d=a[ii][0]-0,t=-(a[ii][1]-my0),m=(-g*n*d+c*n*t)/f+l,d=(k*p*d-h*p*t)/f+q,e[ii]=[],e[ii][0]=m,e[ii][1]=d}else if("polar"===c){l=parseFloat(xyAxes[0][0]);q=parseFloat(xyAxes[0][1]);c=parseFloat(xyAxes[1][0]);g=parseFloat(xyAxes[1][1]);d=parseFloat(xyAxes[2][0]);f=parseFloat(xyAxes[2][1]);h=parseFloat(axesAlignmentData[0]);t=parseFloat(axesAlignmentData[1]);k=parseFloat(axesAlignmentData[2]);
parseFloat(axesAlignmentData[3]);n=axesAlignmentData[4];!0===n&&(t*=Math.PI/180);p=Math.sqrt((c-l)*(c-l)+(g-q)*(g-q));m=Math.sqrt((d-l)*(d-l)+(f-q)*(f-q))-p;c=taninverse(-(g-q),c-l);c-=t;for(ii=0;ii<b;ii++)d=a[ii][0],f=a[ii][1],g=(k-h)/m*(Math.sqrt((d-l)*(d-l)+(f-q)*(f-q))-p)+h,d=taninverse(-(f-q),d-l)-c,!0==n&&(d=180*d/Math.PI),e[ii]=[],e[ii][0]=g,e[ii][1]=d}else if("ternary"===plotType){l=xyAxes[0][0];q=xyAxes[0][1];c=xyAxes[1][0];g=xyAxes[1][1];h=Math.sqrt((l-c)*(l-c)+(q-g)*(q-g));c=taninverse(-(g-
q),c-l);k=Math.sqrt(3);n=axesAlignmentData[0];p=axesAlignmentData[1];for(ii=0;ii<b;ii++)d=a[ii][0],f=a[ii][1],g=Math.sqrt((d-l)*(d-l)+(f-q)*(f-q)),d=taninverse(-(f-q),d-l)-c,f=g*Math.cos(d)/h,m=g*Math.sin(d)/h,g=1-f-m/k,d=f-m/k,f=2*m/k,!1==p&&(m=d,d=g,g=f,f=m),!0==n&&(g*=100,d*=100,f*=100),e[ii]=[],e[ii][0]=g,e[ii][1]=d,e[ii][2]=f}return e}return 0}
function dataToPixel(a,b,c){dataToPixelxy=[];if("XY"===c){var e=xyAxes[0][0],g=xyAxes[0][1],d=xyAxes[1][0],f=xyAxes[1][1],h=xyAxes[2][0];c=xyAxes[2][1];var k=xyAxes[3][0],m=xyAxes[3][1],r=axesAlignmentData[0],l=axesAlignmentData[1],n=axesAlignmentData[2],q=axesAlignmentData[3];!0===axesAlignmentData[4]&&(r=Math.log(r)/Math.log(10),l=Math.log(l)/Math.log(10));!0===axesAlignmentData[5]&&(n=Math.log(n)/Math.log(10),q=Math.log(q)/Math.log(10));var p=(e-d)*(c-m)-(g-f)*(h-k),s=[[]];s[0][0]=((e*f-g*d)*(h-
k)-(e-d)*(h*m-c*k))/p;s[0][1]=((e*f-g*d)*(c-m)-(g-f)*(h*m-c*k))/p;var s=pixelToData(s,1,"XY"),p=s[0][0],s=s[0][1],l=l-r,t=q-n,q=Math.sqrt((e-d)*(e-d)+(g-f)*(g-f)),u=Math.sqrt((h-k)*(h-k)+(c-m)*(c-m)),q=l/q,l=t/u,g=taninverse(-(f-g),d-e),h=taninverse(-(m-c),k-h),e=(a-r)*Math.cos(g)/q+(b-s)*Math.cos(h)/l+e;a=c-(a-p)*Math.sin(g)/q-(b-n)*Math.sin(h)/l;dataToPixelxy[0]=e;dataToPixelxy[1]=a}return 0}
var CSVExport=function(){function a(){var a=document.getElementById("dataSortOption"),b=document.getElementById("dataSortOrder");"NearestNeighbor"===a.value||"raw"===a.value?b.setAttribute("disabled",!0):b.removeAttribute("disabled");e()}function b(a){var b=document.getElementById("tarea");b.value="";if("XY"===plotType||"map"===plotType||"polar"===plotType||"image"===plotType)for(var e=0;e<pointsPicked;e++)b.value=b.value+c(a[e][0],"X")+","+c(a[e][1],"Y")+"\n";else if("ternary"===plotType)for(e=0;e<
pointsPicked;e++)b.value=b.value+a[e][0]+","+a[e][1]+","+a[e][2]+"\n";d=a}function c(a,b){if("XY"===plotType){if("X"===b&&axesAlignmentData[6]){var c=document.getElementById("xDateFormat");return dateConverter.formatDate(dateConverter.fromJD(a),c.value)}if("Y"===b&&axesAlignmentData[7])return c=document.getElementById("yDateFormat"),dateConverter.formatDate(dateConverter.fromJD(a),c.value)}return a}function e(){var a=document.getElementById("dataSortOption"),c="ascending"===document.getElementById("dataSortOrder").value,
d="raw"==a.value,e="NearestNeighbor"===a.value,r,l=g.slice(0),n="ternary"===plotType?3:2;if(d)b(l);else if(e){if(e){for(var q,e=[1,1,1],p=0;p<pointsPicked-1;p++){for(var d=-1,s=p+1;s<pointsPicked;s++)if(a=(l[p][0]-l[s][0])*(l[p][0]-l[s][0])+(l[p][1]-l[s][1])*(l[p][1]-l[s][1]),3===n&&(a+=(l[p][2]-l[s][2])*(l[p][2]-l[s][2])),a<q||-1===d)q=a,d=s;e[0]=l[d][0];l[d][0]=l[p+1][0];l[p+1][0]=e[0];e[1]=l[d][1];l[d][1]=l[p+1][1];l[p+1][1]=e[1];3===n&&(e[2]=l[d][2],l[d][2]=l[p+1][2],l[p+1][2]=e[2])}b(l)}}else r=
parseInt(a.value,10),0>r||3<=r||(l.sort(function(a,b){return a[r]>b[r]?c?1:-1:a[r]<b[r]?c?-1:1:0}),b(l))}var g,d;return{generate:function(){if(1===axesPicked&&1<=pointsPicked){popup.show("csvWindow");g=pixelToData(xyData,pointsPicked,plotType);document.getElementById("dataSortOrder");var c=document.getElementById("dataSortOption"),d=document.getElementById("dataVariables");c.innerHTML='<option value="raw">Raw Output</option>';"XY"===plotType||"map"===plotType||"image"===plotType?(c.innerHTML+='<option value="0">x</option>',
c.innerHTML+='<option value="1">y</option>',d.innerHTML="x, y"):"ternary"===plotType?(c.innerHTML+='<option value="0">a</option>',c.innerHTML+='<option value="1">b</option>',c.innerHTML+='<option value="2">c</option>',d.innerHTML="a, b, c"):"polar"===plotType&&(c.innerHTML+='<option value="0">r</option>',c.innerHTML+='<option value="1">\u0398</option>',d.innerHTML="r, \u0398");c.innerHTML+='<option value="NearestNeighbor">Nearest Neighbor</option>';a();c=document.getElementById("csvDateFormatting");
if("XY"===plotType)if(!0===axesAlignmentData[6]||!0===axesAlignmentData[7]){c.style.display="inline-block";var c=document.getElementById("csvDateFormattingX"),d=document.getElementById("csvDateFormattingY"),e=document.getElementById("xDateFormat");document.getElementById("yDateFormat");axesAlignmentData[6]?(c.style.display="inline-block",e.value=axesAlignmentData[8]):c.style.display="none";axesAlignmentData[7]?(d.style.display="inline-block",yDateFormat.value=axesAlignmentData[9]):d.style.display=
"none"}else c.style.display="none";else c.style.display="none";b(g)}},reSort:e,updateSortingControls:a,selectAll:function(){var a=document.getElementById("tarea");a.focus();a.select()},displayData:d}}(),dateConverter={parse:function(a){return null==a||-1===a.indexOf("/")?null:this.toJD(a)},toJD:function(a){var b=a.split("/"),c;if(0>=b.length||3<b.length)return null;a=parseInt(b[0],10);c=parseInt(void 0===b[1]?0:b[1],10);date=parseInt(void 0===b[2]?1:b[2],10);if(isNaN(a)||isNaN(c)||isNaN(date)||12<
c||1>c||31<date||1>date)return null;b=new Date;b.setUTCFullYear(a);b.setUTCMonth(c-1);b.setUTCDate(date);a=parseFloat(Date.parse(b));return!isNaN(a)?a:null},fromJD:function(a){a=parseFloat(a);a=parseInt(864E5*Math.round(a/864E5),10);return new Date(a)},formatDate:function(a,b){var c;c=b.replace("YYYY","yyyy");c=c.replace("YY","yy");c=c.replace("MMMM","mmmm");c=c.replace("MMM","mmm");c=c.replace("MM","mm");c=c.replace("DD","dd");c=c.replace("yyyy",a.getUTCFullYear());var e=a.getUTCFullYear()%100;c=
c.replace("yy",10>e?"0"+e:e);c=c.replace("mmmm","January February March April May June July August September October November December".split(" ")[a.getUTCMonth()]);c=c.replace("mmm","Jan Feb Mar Apr May Jun Jul Aug Sep Oct Nov Dec".split(" ")[a.getUTCMonth()]);c=c.replace("mm",a.getUTCMonth()+1);return c=c.replace("dd",a.getUTCDate())},getFormatString:function(a){a=a.split("/");var b="yyyy/mm/dd";1<=a.length&&(b="yyyy");2<=a.length&&(b+="/mm");3===a.length&&(b+="/dd");return b}},cropStatus=0,cropCoordinates=
[0,0,0,0];function hflip(){processingNote(!0);for(var a=ctx.getImageData(cx0,cy0,currentImageWidth,currentImageHeight),b=0;b<currentImageHeight;b++)for(var c=0;c<currentImageWidth/2;c++)for(var e=4*b*currentImageWidth+4*c,g=4*(b+1)*currentImageWidth-4*(c+1),d=0;4>d;d++){var f=a.data[e+d];a.data[e+d]=a.data[g+d];a.data[g+d]=f}ctx.putImageData(a,cx0,cy0);saveCanvasImage();processingNote(!1)}
function vflip(){processingNote(!0);for(var a=ctx.getImageData(cx0,cy0,currentImageWidth,currentImageHeight),b=0;b<currentImageWidth;b++)for(var c=0;c<currentImageHeight/2;c++)for(var e=4*c*currentImageWidth+4*b,g=4*(currentImageHeight-(c+2))*currentImageWidth+4*b,d=0;4>d;d++){var f=a.data[e+d];a.data[e+d]=a.data[g+d];a.data[g+d]=f}ctx.putImageData(a,cx0,cy0);saveCanvasImage();processingNote(!1)}
function cropPlot(){redrawCanvas();canvasMouseEvents.removeAll();canvasMouseEvents.add("mousedown",cropMousedown,!0);canvasMouseEvents.add("mouseup",cropMouseup,!0);canvasMouseEvents.add("mousemove",cropMousemove,!0)}function cropMousedown(a){a=getPosition(a);var b=a.y;cropCoordinates[0]=a.x;cropCoordinates[1]=b;cropStatus=1}
function cropMouseup(a){a=getPosition(a);var b=a.y;cropCoordinates[2]=a.x;cropCoordinates[3]=b;cropStatus=0;hoverCanvas.width=hoverCanvas.width;cropWidth=cropCoordinates[2]-cropCoordinates[0];cropHeight=cropCoordinates[3]-cropCoordinates[1];if(0<cropWidth&&0<cropHeight){a=document.createElement("canvas");b=a.getContext("2d");a.width=cropWidth;a.height=cropHeight;var c=ctx.getImageData(cropCoordinates[0],cropCoordinates[1],cropWidth,cropHeight);b.putImageData(c,0,0);cropSrc=a.toDataURL();cropImg=new Image;
cropImg.src=cropSrc;cropImg.onload=function(){loadImage(cropImg)}}}function cropMousemove(a){var b=getPosition(a);a=b.x;b=b.y;1==cropStatus&&(hoverCanvas.width=hoverCanvas.width,hoverCtx.strokeStyle="rgb(0,0,0)",hoverCtx.strokeRect(cropCoordinates[0],cropCoordinates[1],a-cropCoordinates[0],b-cropCoordinates[1]))}function restoreOriginalImage(){loadImage(originalImage)}function rotateCanvas(){}
function findDifference(a,b){for(var c=canvasWidth,e=canvasHeight,g=[],d=0;d<e;d++){g[d]=[];for(var f=0;f<c;f++){var h=4*d*c+4*f;g[d][f]=!1;for(var k=0;4>k;k++)a.data[h+k]!=b.data[h+k]&&(g[d][f]=!0)}}return g}function copyUsingDifference(a,b,c){for(var e=canvasWidth,g=canvasHeight,d=0;d<g;d++)for(var f=0;f<e;f++){var h=4*d*e+4*f;if(!0===c[d][f])for(var k=0;4>k;k++)a.data[h+k]=b.data[h+k]}return a}
function colorSelect(a,b,c,e){dw=canvasWidth;dh=canvasHeight;redv=c[0];greenv=c[1];bluev=c[2];c=[];for(var g=0;g<dh;g++){c[g]=[];for(var d=0;d<dw;d++)index=4*g*dw+4*d,ir=a.data[index],ig=a.data[index+1],ib=a.data[index+2],dist=Math.sqrt((ir-redv)*(ir-redv)+(ig-greenv)*(ig-greenv)+(ib+bluev)*(ib+bluev)),c[g][d]=!1,"fg"===b?dist<=e&&(c[g][d]=!0):"bg"===b&&dist>e&&(c[g][d]=!0)}return c}
function colorSelectDiff(a,b,c,e,g){dw=canvasWidth;dh=canvasHeight;redv=c[0];greenv=c[1];bluev=c[2];c=[];for(var d=0;d<dh;d++){c[d]=[];for(var f=0;f<dw;f++){index=4*d*dw+4*f;var h=a.data[index],k=a.data[index+1],m=a.data[index+2],h=Math.sqrt((h-redv)*(h-redv)+(k-greenv)*(k-greenv)+(m-bluev)*(m-bluev));c[d][f]=!1;"fg"===b&&1===g[d][f]?h<=e&&(c[d][f]=!0):"bg"===b&&1===g[d][f]&&h>e&&(c[d][f]=!0)}}return c}
function selectFromMarkedRegion(a,b,c){dw=canvasWidth;dh=canvasHeight;redv=b[0];greenv=b[1];bluev=b[2];b=dataCtx.getImageData(0,0,canvasWidth,canvasHeight);for(var e=getCanvasData(),g=[],d=0;d<dh;d++){g[d]=[];for(var f=0;f<dw;f++){index=4*d*dw+4*f;var h=b.data[index],k=b.data[index+1],m=b.data[index+2],r=e.data[index],l=e.data[index+1],n=e.data[index+2];g[d][f]=!1;255===h&&(255===k&&0===m)&&(h=Math.sqrt((r-redv)*(r-redv)+(l-greenv)*(l-greenv)+(n-bluev)*(n-bluev)),"fg"===a&&h<=c?g[d][f]=!0:"bg"===
a&&h>c&&(g[d][f]=!0))}}return g}function binaryToImageData(a,b){dw=canvasWidth;dh=canvasHeight;for(var c=0;c<dh;c++)for(var e=0;e<dw;e++)index=4*c*dw+4*e,!1===a[c][e]?(b.data[index]=255,b.data[index+1]=255,b.data[index+2]=255):(b.data[index]=0,b.data[index+1]=0,b.data[index+2]=0),b.data[index+3]=255;return b}
function getImageDataBasedOnSelection(a,b,c,e){var g=canvasWidth,d=canvasHeight,f,h,k,m=c[0],r=c[1],l=c[2],n=dataCtx.getImageData(0,0,canvasWidth,canvasHeight),q=currentScreen,p,s,t,u,w,v;for(c=0;c<d;c++)for(f=0;f<g;f++)h=4*c*g+4*f,k=n.data[h],p=n.data[h+1],s=n.data[h+2],t=q.data[h],u=q.data[h+1],w=q.data[h+2],v=!0,255===k&&(255===p&&0===s)&&(k=(t-m)*(t-m)+(u-r)*(u-r)+(w-l)*(w-l),"fg"===b&&k<=e*e?v=!1:"bg"===b&&k>e*e&&(v=!1)),v?(a.data[h]=255,a.data[h+1]=255,a.data[h+2]=255):(a.data[h]=0,a.data[h+
1]=0,a.data[h+2]=0),a.data[h+3]=255;return a}var InputParser=function(){var a=this;a.parse=function(b){a.isValid=!1;a.isDate=!1;if(null==b)return null;b=b.trim();if(-1!==b.indexOf("^"))return null;var c=dateConverter.parse(b);if(null!==c)return a.isValid=!0,a.isDate=!0,c;b=parseFloat(b);return!isNaN(b)?(a.isValid=!0,b):null};a.isValid=!1;a.isDate=!1};
function init(){checkBrowser();mainCanvas=document.getElementById("mainCanvas");dataCanvas=document.getElementById("dataCanvas");drawCanvas=document.getElementById("drawCanvas");hoverCanvas=document.getElementById("hoverCanvas");topCanvas=document.getElementById("topCanvas");var a=document.getElementById("canvasDiv");cx0=zoomView.zoom_dx/2;cy0=zoomView.zoom_dy/2;canvasWidth=parseFloat(a.offsetWidth);canvasHeight=parseFloat(a.offsetHeight);mainCanvas.height=canvasHeight;mainCanvas.width=canvasWidth;
dataCanvas.height=canvasHeight;dataCanvas.width=canvasWidth;drawCanvas.height=canvasHeight;drawCanvas.width=canvasWidth;hoverCanvas.height=canvasHeight;hoverCanvas.width=canvasWidth;topCanvas.height=canvasHeight;topCanvas.width=canvasWidth;cheight=canvasHeight-zoomView.zoom_dy;cwidth=canvasWidth-zoomView.zoom_dx;caspectratio=cheight/cwidth;ctx=mainCanvas.getContext("2d");dataCtx=dataCanvas.getContext("2d");drawCtx=drawCanvas.getContext("2d");hoverCtx=hoverCanvas.getContext("2d");topCtx=topCanvas.getContext("2d");
img=document.createElement("img");img.onload=function(){loadImage(img);originalImage=img};img.src="start.png";testImgCanvas=document.getElementById("testImg");testImgCanvas.width=canvasWidth/2;testImgCanvas.height=canvasHeight/2;testImgContext=testImgCanvas.getContext("2d");topCanvas.addEventListener("mousemove",zoomView.updateZoomEventHandler,!1);document.body.addEventListener("keydown",zoomView.toggleCrosshair,!1);topCanvas.addEventListener("dragover",function(a){a.preventDefault()},!0);topCanvas.addEventListener("drop",
function(a){a.preventDefault();dropHandler(a)},!0);window.addEventListener("paste",function(a){pasteHandler(a)},!1);setDefaultState();zoomView.initZoom();activeScreen=originalScreen=getCanvasData();displayParameters()}function setDefaultState(){pointsPicked=axesPicked=0;xyData=[];axesAlignmentData=[];clearPoints();sidebar.clear()}
function checkBrowser(){window.FileReader||alert("\tWARNING!\nYou are using an unsupported browser. Please use Google Chrome 6+ or Firefox 3.6+.\n Sorry for the inconvenience.")}var xyData=[],pointsPicked=0;function acquireData(){0===axesPicked?popup.show("alignAxes"):(sidebar.show("manualMode"),canvasMouseEvents.removeAll())}
function pickPoints(){0===axesPicked?alert("Define the axes first!"):(canvasMouseEvents.removeAll(),canvasMouseEvents.add("click",clickPoints,!0),pointsStatus(pointsPicked),sidebar.show("manualMode"))}
function clickPoints(a){var b=getPosition(a),c=b.x,b=b.y;xyData[pointsPicked]=[];xyData[pointsPicked][0]=parseFloat(c);xyData[pointsPicked][1]=parseFloat(b);pointsPicked+=1;dataCtx.beginPath();dataCtx.fillStyle="rgb(200,0,0)";dataCtx.arc(c,b,3,0,2*Math.PI,!0);dataCtx.fill();pointsStatus(pointsPicked);zoomView.updateZoom(a)}function clearPoints(){pointsPicked=0;pointsStatus(pointsPicked);resetLayers();canvasMouseEvents.removeAll()}
function undoPointSelection(){if(1<=pointsPicked){pointsPicked-=1;pointsStatus(pointsPicked);resetLayers();for(ii=0;ii<pointsPicked;ii++)xi=xyData[ii][0],yi=xyData[ii][1],dataCtx.beginPath(),dataCtx.fillStyle="rgb(200,0,0)",dataCtx.arc(xi,yi,3,0,2*Math.PI,!0),dataCtx.fill()}}function pointsStatus(a){var b=document.getElementById("pointsStatus"),c=document.getElementById("autoPointsStatus");b.innerHTML=a;c.innerHTML=a}
function deleteSpecificPoint(){canvasMouseEvents.removeAll();canvasMouseEvents.add("click",deleteSpecificPointHandler,!0)}
function deleteSpecificPointHandler(a){for(var b=getPosition(a),c=parseFloat(b.x),b=parseFloat(b.y),e=10,g=0,d=0,f=0;f<pointsPicked;f++){var h=parseFloat(xyData[f][0]),k=parseFloat(xyData[f][1]),h=Math.sqrt((h-c)*(h-c)+(k-b)*(k-b));h<e&&(g=1,d=f,e=h)}if(1===g){xyData.splice(d,1);pointsPicked-=1;pointsStatus(pointsPicked);resetLayers();for(f=0;f<pointsPicked;f++)xp=xyData[f][0],yp=xyData[f][1],dataCtx.beginPath(),dataCtx.fillStyle="rgb(200,0,0)",dataCtx.arc(xp,yp,3,0,2*Math.PI,!0),dataCtx.fill()}zoomView.updateZoom(a)}
function taninverse(a,b){var c;0<a?c=Math.atan2(a,b):0>=a&&(c=Math.atan2(a,b)+2*Math.PI);c>=2*Math.PI&&(c=0);return c}
var canvasMouseEvents=function(){var a=[],b=[],c=[],e=0;return{add:function(g,d,f){for(var h=!1,k=0;k<e;k++)g===a[k]&&(d===b[k]&&f===c[k])&&(h=!0);!1===h&&(topCanvas.addEventListener(g,d,f),a[e]=g,b[e]=d,c[e]=f,e+=1)},remove:function(g,d,f){for(var h=!1,k=0,m=0;m<e;m++)g===a[m]&&(d===b[m]&&f===c[m])&&(h=!0,k=m);!0===h&&(topCanvas.removeEventListener(g,d,f),e-=1,a.splice(k,1),b.splice(k,1),c.splice(k,1))},removeAll:function(){if(0<e){for(var g=0;g<e;g++)topCanvas.removeEventListener(a[g],b[g],c[g]);
e=0;a=[];moueEventFunction=[];c=[]}toolbar.clear()}}}(),plotly=function(){function a(a,c){return"XY"===plotType&&("X"===c&&axesAlignmentData[6]||"Y"===c&&axesAlignmentData[7])?dateConverter.formatDate(dateConverter.fromJD(a),"yyyy-mm-dd"):a}return{exportData:function(){if(0!==pointsPicked){var b=document.createElement("div"),c=document.createElement("form"),e=document.createElement("input");c.setAttribute("method","post");c.setAttribute("action","https://plot.ly/external");c.setAttribute("target",
"_blank");e.setAttribute("type","text");e.setAttribute("name","data");c.appendChild(e);b.appendChild(c);document.body.appendChild(b);b.style.display="none";var g=[],d=[],f=[],h={data:[]};if("XY"===plotType||"map"===plotType||"polar"===plotType||"image"===plotType){for(var k=0;k<pointsPicked;k++)g[k]=a(CSVExport.displayData[k][0],"X"),d[k]=a(CSVExport.displayData[k][1],"Y");h.data[0]={x:g,y:d}}else if("ternary"===plotType){for(k=0;k<pointsPicked;k++)g[k]=CSVExport.displayData[k][0],d[k]=CSVExport.displayData[k][1],
f[k]=CSVExport.displayData[k][2];h.data[0]={x:g,y:d,z:f}}e.setAttribute("value",JSON.stringify(h));c.submit();document.body.removeChild(b)}}}}(),popup=function(){return{show:function(a){document.getElementById("shadow").style.visibility="visible";a=document.getElementById(a);var b=parseInt(window.innerWidth),c=parseInt(window.innerHeight),e=parseInt(a.offsetWidth),g=parseInt(a.offsetHeight);a.style.left=(b-e)/2+"px";a.style.top=(c-g)/2+"px";a.style.visibility="visible"},close:function(a){document.getElementById("shadow").style.visibility=
"hidden";document.getElementById(a).style.visibility="hidden"}}}();function processingNote(a){document.getElementById("wait").style.visibility=!0===a?"visible":"hidden"}
var sidebar=function(){function a(){for(ii=0;ii<b.length;ii++)document.getElementById(b[ii]).style.visibility="hidden"}var b=["editImageToolbar","manualMode","autoMode"];return{show:function(c){a();document.getElementById(c).style.visibility="visible"},clear:a}}(),toolbar=function(){function a(){for(ii=0;ii<b.length;ii++)document.getElementById(b[ii]).style.visibility="hidden"}var b=["paintToolbar","colorPickerToolbar"];return{show:function(c){a();document.getElementById(c).style.visibility="visible"},
clear:a}}(),zoomView=function(){function a(a){var b=getPosition(a);a=b.x;var n=b.y,t=d,u=f;1!=axesPicked?m.innerHTML=a+", "+n:1==axesPicked&&(l[0][0]=parseFloat(a),l[0][1]=parseFloat(n),b=pixelToData(l,1,plotType),"image"===plotType?m.innerHTML=b[0][0]+", "+b[0][1]:("XY"===plotType?(m.innerHTML=!0===axesAlignmentData[6]?dateConverter.formatDate(dateConverter.fromJD(b[0][0]),axesAlignmentData[8]):parseFloat(b[0][0]).toExponential(4),m.innerHTML=!0===axesAlignmentData[7]?m.innerHTML+(", "+dateConverter.formatDate(dateConverter.fromJD(b[0][1]),
axesAlignmentData[9])):m.innerHTML+(", "+parseFloat(b[0][1]).toExponential(4))):m.innerHTML=parseFloat(b[0][0]).toExponential(4)+", "+parseFloat(b[0][1]).toExponential(4),"ternary"===plotType&&(m.innerHTML+=", "+parseFloat(b[0][2]).toExponential(4))));!0===r&&(hoverCanvas.width=hoverCanvas.width,hoverCtx.strokeStyle="rgba(0,0,0, 0.5)",hoverCtx.beginPath(),hoverCtx.moveTo(a,0),hoverCtx.lineTo(a,canvasHeight),hoverCtx.moveTo(0,n),hoverCtx.lineTo(canvasWidth,n),hoverCtx.stroke());if(0<=a-t/2&&0<=n-u/
2&&a+t/2<=canvasWidth&&n+u/2<=canvasHeight){b=ctx.getImageData(a-t/2,n-u/2,t,u);a=dataCtx.getImageData(a-t/2,n-u/2,t,u);for(n=0;n<a.data.length;n+=4)0!=a.data[n]+a.data[n+1]+a.data[n+2]+a.data[n+3]&&(b.data[n]=a.data[n],b.data[n+1]=a.data[n+1],b.data[n+2]=a.data[n+2]);g.clearRect(0,0,d,f);g.putImageData(b,0,0);c.drawImage(e,0,0,h,k)}}var b,c,e,g,d=20,f=20,h=200,k=200,m,r=!1,l=[],n;l[0]=[];return{initZoom:function(){b=document.getElementById("zoomCanvas");c=b.getContext("2d");e=document.createElement("canvas");
g=e.getContext("2d");e.width=d;e.height=f;m=document.getElementById("mousePosition");var a=document.getElementById("zoomCrossHair").getContext("2d");a.strokeStyle="rgb(0,0,0)";a.beginPath();a.moveTo(h/2,0);a.lineTo(h/2,k);a.moveTo(0,k/2);a.lineTo(h,k/2);a.stroke()},updateZoomEventHandler:function(b){clearTimeout(n);n=setTimeout(a(b),5)},updateZoom:a,toggleCrosshair:function(a){220===a.keyCode&&(a.preventDefault(),r=!r,hoverCanvas.width=hoverCanvas.width)},zoom_dx:d,zoom_dy:f,mPosn:m}}(),averagingWindowAlgo=
{getParamList:function(){return[["\u0394X","Px","5"],["\u0394Y","Px","5"]]},run:function(){var a=[],b=0;xyData=[];pointsPicked=0;for(var c=document.getElementById("pv0"),c=parseFloat(c.value),e=document.getElementById("pv1"),e=parseFloat(e.value),g=canvasWidth,d=canvasHeight,f=[],h=0;h<g;h++){blobs=-1;firstbloby=-2*e;for(var k=bi=0;k<d;k++)!0===binaryData[k][h]&&(k>firstbloby+e?(blobs+=1,bi=1,firstbloby=f[blobs]=k):(bi+=1,f[blobs]=parseFloat((f[blobs]*(bi-1)+k)/parseFloat(bi))));if(0<=blobs){xi=h;
for(k=0;k<=blobs;k++)yi=f[k],a[b]=[],a[b][0]=parseFloat(xi),a[b][1]=parseFloat(yi),a[b][2]=1,b+=1}}if(0===b)return 0;for(g=0;g<b;g++)if(1===a[g][2]){for(var d=1,f=g+1,h=a[g][0],k=a[g][1],m=h,r=k,l=1;1===d&&f<b;){var n=a[f][0],q=a[f][1];Math.abs(n-h)<=c&&(Math.abs(q-k)<=e&&1===a[f][2])&&(m=(m*l+n)/(l+1),r=(r*l+q)/(l+1),l+=1,a[f][2]=0);n>h+2*c&&(d=0);f+=1}a[g][2]=0;xyData[pointsPicked]=[];xyData[pointsPicked][0]=parseFloat(m);xyData[pointsPicked][1]=parseFloat(r);pointsPicked+=1}}},averagingWindowWithStepSizeAlgo=
{getParamList:function(){if("XY"===plotType)return[["X_min","Units",axesAlignmentData[0].toString()],["\u0394X Step","Units","0.1"],["X_max","Units",axesAlignmentData[1].toString()],["Y_min","Units",axesAlignmentData[2].toString()],["Y_max","Units",axesAlignmentData[3].toString()],["Line width","Px","30"]];closePopup("testImageWindow");showPopup("xyAxesOnly");return[["X_min","Units","0"],["\u0394X Step","Units","0.1"],["X_max","Units","0"],["Y_min","Units","0"],["Y_max","Units","0"],["Line width",
"Px","30"]]},run:function(){if("XY"===plotType){xyData=[];pointsPicked=0;resetLayers();for(var a=canvasWidth,b=canvasHeight,c=document.getElementById("pv0"),e=document.getElementById("pv1"),g=document.getElementById("pv2"),d=document.getElementById("pv5"),f=document.getElementById("pv3"),h=document.getElementById("pv4"),c=parseFloat(c.value),e=parseFloat(e.value),g=parseFloat(g.value),d=parseFloat(d.value),f=parseFloat(f.value),h=parseFloat(h.value);c<=g;c+=e){var k,m,r,l;dataToPixel(c,f,"XY");k=
dataToPixelxy[0];r=dataToPixelxy[1];dataToPixel(c,h,"XY");m=dataToPixelxy[0];l=dataToPixelxy[1];k=Math.sqrt((l-r)*(l-r)+(m-k)*(m-k));m=(h-f)/k;r=!1;for(var n=l=0,q=!1,p=0;p<=k;p++)if(dataToPixel(c,1*-p*m+h,"XY"),xi_pix=dataToPixelxy[0],yi_pix=dataToPixelxy[1],0<=xi_pix&&(xi_pix<a&&0<=yi_pix&&yi_pix<b)&&(!0===binaryData[parseInt(yi_pix,10)][parseInt(xi_pix,10)]?(!1===r&&(n=l=p,r=!0,q=!1),!0===q&&(n=p,q=!1)):!1===q&&(n=p,q=!0),!0===r&&(p>l+d||p==k-1)))r=!1,l>n&&(n=p),dataToPixel(c,1*-((l+n)/2)*m+h,
"XY"),xyData[pointsPicked]=[],xyData[pointsPicked][0]=parseFloat(dataToPixelxy[0]),xyData[pointsPicked][1]=parseFloat(dataToPixelxy[1]),pointsPicked+=1}}else showPopup("xyAxesOnly")}},blobDetectorAlgo={getParamList:function(){return[["Min size","Px","0"],["Max size","Px","1000"]]},run:function(){xyData=[];pointsPicked=0;for(var a=document.getElementById("pv0").value,b=document.getElementById("pv1").value,c=[],e=0;e<canvasHeight;e++){c[e]=[];for(var g=0;g<canvasWidth;g++)c[e][g]=!1}for(var e=0,g=[],
d=[],f=[],h=[],k=[],m=0;m<canvasHeight;m++)for(var r=0;r<canvasWidth;r++){if(!0===binaryData[m][r]&&!1===c[m][r]){c[m][r]=!0;e+=1;g[e-1]=1;h[e-1]=[];k[e-1]=[];h[e-1][0]=r;k[e-1][0]=m;d[e-1]=r;f[e-1]=m;for(var l=1,n=1;l<=n;){ai=k[e-1][l-1];bi=h[e-1][l-1];for(var q=-1;1>=q;q++)for(var p=-1;1>=p;p++)0<=ai+q&&(0<=bi+p&&ai+q<canvasHeight&&bi+p<canvasWidth)&&(!0==binaryData[ai+q][bi+p]&&!1==c[ai+q][bi+p])&&(g[e-1]+=1,n=g[e-1],k[e-1][n-1]=ai+q,h[e-1][n-1]=bi+p,f[e-1]=(f[e-1]*(n-1)+(ai+q))/n,d[e-1]=(d[e-
1]*(n-1)+(bi+p))/n,c[ai+q][bi+p]=!0);l+=1}}c[m][r]=!0}for(c=0;c<e;c++)h=2*Math.sqrt(g[c]/Math.PI),h>=a&&h<=b&&(xyData[pointsPicked]=[],xyData[pointsPicked][0]=parseFloat(d[c]),xyData[pointsPicked][1]=parseFloat(f[c]),xyData[pointsPicked][2]=g[c],pointsPicked+=1)}},xStepAlgo={getParamList:function(){return[["\u0394X","Px","5"],["Line Width","Px","15"]]},run:function(){xyData=[];pointsPicked=0;resetLayers();for(var a=document.getElementById("pv0"),a=parseFloat(a.value),b=document.getElementById("pv1"),
b=parseFloat(b.value),c=canvasWidth,e=canvasHeight,g=[],d=1,f=0;f<c;){blobs=-1;firstbloby=-2*b;for(var h=bi=0;h<e;h++)!0===binaryData[h][f]&&(d=a,h>firstbloby+b?(blobs+=1,bi=1,firstbloby=g[blobs]=h):(bi+=1,g[blobs]=parseFloat((g[blobs]*(bi-1)+h)/parseFloat(bi))));if(0<=blobs){xi=f;for(h=0;h<=blobs;h++)yi=g[h],xyData[pointsPicked]=[],xyData[pointsPicked][0]=parseFloat(xi),xyData[pointsPicked][1]=parseFloat(yi),pointsPicked+=1}f+=d}}},yStepAlgo={getParamList:function(){return[["\u0394Y","Px","5"],["Line Width",
"Px","15"]]},run:function(){xyData=[];pointsPicked=0;resetLayers();for(var a=document.getElementById("pv0"),a=parseFloat(a.value),b=document.getElementById("pv1"),b=parseFloat(b.value),c=canvasWidth,e=[],g=-1,d=canvasHeight-1;0<=d;){blobs=-1;firstblobx=-2*b;for(var f=bi=0;f<c;f++)!0===binaryData[d][f]&&(g=-a,f>firstblobx+b?(blobs+=1,bi=1,firstblobx=e[blobs]=f):(bi+=1,e[blobs]=parseFloat((e[blobs]*(bi-1)+f)/parseFloat(bi))));if(0<=blobs){yi=d;for(f=0;f<=blobs;f++)xi=e[f],xyData[pointsPicked]=[],xyData[pointsPicked][0]=
parseFloat(xi),xyData[pointsPicked][1]=parseFloat(yi),pointsPicked+=1}d+=g}}};
