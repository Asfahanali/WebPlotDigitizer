var wpd=wpd||{};wpd.initApp=function(){wpd.browserInfo.checkBrowser();wpd.layoutManager.initialLayout();wpd.graphicsWidget.loadImageFromURL("start.png");document.getElementById("loadingCurtain").style.display="none";wpd.messagePopup.show("Unstable Version Warning!","You are using a beta version of WebPlotDigitizer. There may be some issues with the software that are expected.")};document.addEventListener("DOMContentLoaded",wpd.initApp,!0);wpd=wpd||{};
wpd.detectionAlgoManager=function(){return{setActiveAlgo:function(a){},getActiveAlgo:function(){return null},getAllApplicableAlgorithms:function(){}}}();wpd=wpd||{};wpd.appData=function(){function a(){null==d&&(d=new wpd.PlotData);return d}var b=!1,d;return{isAligned:function(d){null!=d&&(b=d);return b},getPlotData:a,reset:function(){b=!1;d=null},plotLoaded:function(b){a().topColors=wpd.colorAnalyzer.getTopColors(b)}}}();wpd=wpd||{};
wpd.AutoDetector=function(){return function(){this.fgColor=[0,0,200];this.bgColor=[255,255,255];this.mask=null;this.gridMask={xmin:null,xmax:null,ymin:null,ymax:null,pixels:[]};this.gridLineColor=[150,150,150];this.gridColorDistance=150;this.gridData=null;this.colorDetectionMode="fg";this.colorDistance=120;this.imageData=this.gridBinaryData=this.binaryData=this.algorithm=null;this.imageHeight=this.imageWidth=0;this.reset=function(){this.gridData=this.imageData=this.binaryData=this.mask=null;this.gridMask=
{xmin:null,xmax:null,ymin:null,ymax:null,pixels:[]}};this.generateBinaryDataFromMask=function(){var a,b,d,c="fg"===this.colorDetectionMode?this.fgColor:this.bgColor;for(a=0;a<this.mask.length;a++)b=this.mask[a],d=Math.sqrt((this.imageData.data[4*b]-c[0])*(this.imageData.data[4*b]-c[0])+(this.imageData.data[4*b+1]-c[1])*(this.imageData.data[4*b+1]-c[1])+(this.imageData.data[4*b+2]-c[2])*(this.imageData.data[4*b+2]-c[2])),"fg"===this.colorDetectionMode?d<=this.colorDistance&&(this.binaryData[b]=!0):
d>=this.colorDistance&&(this.binaryData[b]=!0)};this.generateBinaryDataUsingFullImage=function(){var a,b,d="fg"===this.colorDetectionMode?this.fgColor:this.bgColor;for(b=0;b<this.imageData.data.length/4;b++)a=Math.sqrt((this.imageData.data[4*b]-d[0])*(this.imageData.data[4*b]-d[0])+(this.imageData.data[4*b+1]-d[1])*(this.imageData.data[4*b+1]-d[1])+(this.imageData.data[4*b+2]-d[2])*(this.imageData.data[4*b+2]-d[2])),"fg"===this.colorDetectionMode?a<=this.colorDistance&&(this.binaryData[b]=!0):a>=
this.colorDistance&&(this.binaryData[b]=!0)};this.generateBinaryData=function(){this.binaryData=[];null==this.imageData?this.imageWidth=this.imageHeight=0:(this.imageHeight=this.imageData.height,this.imageWidth=this.imageData.width,null==this.mask||0===this.mask.length?this.generateBinaryDataUsingFullImage():this.generateBinaryDataFromMask())};this.generateGridBinaryData=function(){this.gridBinaryData=[];if(null!=this.gridMask.pixels&&0!==this.gridMask.pixels.length)if(null==this.imageData)this.imageHeight=
this.imageWidth=0;else{this.imageWidth=this.imageData.width;this.imageHeight=this.imageData.height;var a,b,d;for(a=0;a<this.gridMask.pixels.length;a++)b=this.gridMask.pixels[a],d=wpd.dist3d(this.gridLineColor[0],this.gridLineColor[1],this.gridLineColor[2],this.imageData.data[4*b],this.imageData.data[4*b+1],this.imageData.data[4*b+2]),d<this.gridColorDistance&&(this.gridBinaryData[b]=!0)}}}}();wpd=wpd||{};
wpd.ColorGroup=function(){return function(a){var b=0,d={r:0,g:0,b:0};a=null==a?100:a;this.getPixelCount=function(){return b};this.getAverageColor=function(){return d};this.isColorInGroup=function(c,f,e){return 0===b?!0:(d.r-c)*(d.r-c)+(d.g-f)*(d.g-f)+(d.b-e)*(d.b-e)<=a*a};this.addPixel=function(a,f,e){d.r=(d.r*b+a)/(b+1);d.g=(d.g*b+f)/(b+1);d.b=(d.b*b+e)/(b+1);b+=1}}}();
wpd.colorAnalyzer=function(){return{getTopColors:function(a){var b=[],d,c,f,e,g,h,l=[];b[0]=new wpd.ColorGroup(120);for(d=0;d<a.data.length;d+=4){c=a.data[d];f=a.data[d+1];e=a.data[d+2];h=!1;for(g=0;g<b.length;g++)if(b[g].isColorInGroup(c,f,e)){b[g].addPixel(c,f,e);h=!0;break}h||(b[b.length]=new wpd.ColorGroup(120),b[b.length-1].addPixel(c,f,e))}b.sort(function(b,d){return b.getPixelCount()>d.getPixelCount()?-1:b.getPixelCount()<d.getPixelCount()?1:0});for(g=0;g<b.length;g++)d=b[g].getAverageColor(),
l[g]={r:parseInt(d.r,10),g:parseInt(d.g,10),b:parseInt(d.b,10),pixels:b[g].getPixelCount(),percentage:100*b[g].getPixelCount()/(0.25*a.data.length)};return l}}}();wpd=wpd||{};
wpd.Calibration=function(){return function(a){var b=[],d=[],c=null==a?2:a,f=[],e=[];this.labels=[];this.getCount=function(){return b.length};this.getDimensions=function(){return c};this.addPoint=function(a,e,l,n,p){var m=b.length,k=f.length;b[m]=a;d[m]=e;f[k]=l;f[k+1]=n;3===c&&(f[k+2]=p)};this.getPoint=function(a){return 0>a||a>=b.length?null:{px:b[a],py:d[a],dx:f[c*a],dy:f[c*a+1],dz:2===c?null:f[c*a+2]}};this.changePointPx=function(a,c,e){0>a||a>=b.length||(b[a]=c,d[a]=e)};this.setDataAt=function(a,
d,e,n){0>a||a>=b.length||(f[c*a]=d,f[c*a+1]=e,3===c&&(f[c*a+2]=n))};this.findNearestPoint=function(a,c,e){e=null==e?50:parseFloat(e);var f,p=-1,m,k;for(m=0;m<b.length;m++)if(k=Math.sqrt((a-b[m])*(a-b[m])+(c-d[m])*(c-d[m])),0>p&&k<=e||0<=p&&k<f)p=m,f=k;return p};this.selectPoint=function(b){0>e.indexOf(b)&&(e[e.length]=b)};this.selectNearestPoint=function(b,a,d){b=this.findNearestPoint(b,a,d);0<=b&&this.selectPoint(b)};this.getSelectedPoints=function(){return e};this.unselectAll=function(){e=[]};this.isPointSelected=
function(b){return 0<=e.indexOf(b)};this.dump=function(){console.log(b);console.log(d);console.log(f)}}}();
wpd.DataSeries=function(){return function(a){var b=[],d=[],c=!1,f=[];this.name="Data Series";this.variableNames=["x","y"];this.hasMetadata=function(){return c};this.setMetadataKeys=function(b){f=b};this.getMetadataKeys=function(){return f};this.addPixel=function(a,d,f){b[b.length]={x:a,y:d,metadata:f};null!=f&&(c=!0)};this.getPixel=function(a){return b[a]};this.setPixelAt=function(a,d,c){a<b.length&&(b[a].x=d,b[a].y=c)};this.setMetadataAt=function(a,d){a<b.length&&(b[a].metadata=d)};this.insertPixel=
function(a,d,c,f){b.splice(a,0,{x:d,y:c,metadata:f})};this.removePixelAtIndex=function(a){a<b.length&&b.splice(a,1)};this.removeLastPixel=function(){this.removePixelAtIndex(b.length-1)};this.findNearestPixel=function(a,d,c){c=null==c?50:parseFloat(c);var f,n=-1,p,m;for(p=0;p<b.length;p++)if(m=Math.sqrt((a-b[p].x)*(a-b[p].x)+(d-b[p].y)*(d-b[p].y)),0>n&&m<=c||0<=n&&m<f)n=p,f=m;return n};this.removeNearestPixel=function(b,a,d){b=this.findNearestPixel(b,a,d);0<=b&&this.removePixelAtIndex(b)};this.clearAll=
function(){b=[];c=!1;f=[]};this.getCount=function(){return b.length};this.selectPixel=function(b){0<=d.indexOf(b)||(d[d.length]=b)};this.unselectAll=function(){d=[]};this.selectNearestPixel=function(b,a,d){b=this.findNearestPixel(b,a,d);0<=b&&this.selectPixel(b)};this.getSelectedPixels=function(){return d}}}();
wpd.PlotData=function(){return function(){var a=0,b=new wpd.AutoDetector;this.axes=this.topColors=null;this.dataSeriesColl=[];this.distanceMeasurementData=this.angleMeasurementData=this.gridData=null;this.getActiveDataSeries=function(){null==this.dataSeriesColl[a]&&(this.dataSeriesColl[a]=new wpd.DataSeries);return this.dataSeriesColl[a]};this.getDataSeriesCount=function(){return this.dataSeriesColl.length};this.setActiveDataSeriesIndex=function(b){a=b};this.getAutoDetector=function(){return b};this.getDataFromActiveSeries=
function(){var b=this.getActiveDataSeries();if(null==b||null==this.axes)return null;var c,f,e,g=[],h;c=b.hasMetadata();f=b.getMetadataKeys();var l=!0===c?f.length:0;for(c=0;c<b.getCount();c++){f=this.dataSeriesColl[a].getPixel(c);e=this.axes.pixelToData(f.x,f.y);g[c]=[];for(h=0;h<e.length;h++)g[c][h]=e[h];for(h=0;h<l;h++)g[c][e.length+h]=f.metadata[h]}return g};this.reset=function(){this.distanceMeasurementData=this.angleMeasurementData=this.axes=null;this.dataSeriesColl=[];this.gridData=null;a=0;
b=new wpd.AutoDetector}}}();
wpd.ConnectedPoints=function(){return function(a){var b=[],d=-1,c=-1;this.addConnection=function(a){b[b.length]=a};this.clearAll=function(){b=[]};this.getConnectionAt=function(a){if(a<b.length)return b[a]};this.replaceConnectionAt=function(a,d){a<b.length&&(b[a]=d)};this.deleteConnectionAt=function(a){a<b.length&&b.splice(a,1)};this.connectionCount=function(){return b.length};this.getDistance=function(d){if(d<b.length&&2===a)return Math.sqrt((b[d][0]-b[d][2])*(b[d][0]-b[d][2])+(b[d][1]-b[d][3])*(b[d][1]-
b[d][3]))};this.getAngle=function(d){if(d<b.length&&3===a){var c=wpd.taninverse(-(b[d][5]-b[d][3]),b[d][4]-b[d][2]);d=wpd.taninverse(-(b[d][1]-b[d][3]),b[d][0]-b[d][2]);c=180*(c-d)/Math.PI;return c=0>c?c+360:c}};this.findNearestPointAndConnection=function(d,c){var g=-1,h=-1,l,n,p,m;for(p=0;p<b.length;p++)for(m=0;m<2*a;m+=2)if(n=(b[p][m]-d)*(b[p][m]-d)+(b[p][m+1]-c)*(b[p][m+1]-c),-1===h||n<l)g=p,h=m/2,l=n;return{connectionIndex:g,pointIndex:h}};this.selectNearestPoint=function(b,a){var g=this.findNearestPointAndConnection(b,
a);0<=g.connectionIndex&&(d=g.connectionIndex,c=g.pointIndex)};this.deleteNearestConnection=function(b,a){var d=this.findNearestPointAndConnection(b,a);0<=d.connectionIndex&&this.deleteConnectionAt(d.connectionIndex)};this.isPointSelected=function(b,a){return c===a&&d===b?!0:!1};this.getSelectedConnectionAndPoint=function(){return{connectionIndex:d,pointIndex:c}};this.unselectConnectionAndPoint=function(){c=d=-1};this.setPointAt=function(a,d,c,h){b[a][2*d]=c;b[a][2*d+1]=h};this.getPointAt=function(a,
d){return{x:b[a][2*d],y:b[a][2*d+1]}}}}();wpd=wpd||{};
wpd.dateConverter=function(){function a(b,a){var c;c=a.replace("YYYY","yyyy");c=c.replace("YY","yy");c=c.replace("MMMM","mmmm");c=c.replace("MMM","mmm");c=c.replace("MM","mm");c=c.replace("DD","dd");c=c.replace("yyyy",b.getUTCFullYear());var f=b.getUTCFullYear()%100;c=c.replace("yy",10>f?"0"+f:f);c=c.replace("mmmm","January February March April May June July August September October November December".split(" ")[b.getUTCMonth()]);c=c.replace("mmm","Jan Feb Mar Apr May Jun Jul Aug Sep Oct Nov Dec".split(" ")[b.getUTCMonth()]);
c=c.replace("mm",b.getUTCMonth()+1);return c=c.replace("dd",b.getUTCDate())}return{parse:function(b){if(null==b||0>b.indexOf("/"))b=null;else{var a=b.split("/"),c;0>=a.length||3<a.length?b=null:(b=parseInt(a[0],10),c=parseInt(void 0===a[1]?0:a[1],10),date=parseInt(void 0===a[2]?1:a[2],10),isNaN(b)||isNaN(c)||isNaN(date)||12<c||1>c||31<date||1>date?b=null:(a=new Date,a.setUTCFullYear(b),a.setUTCMonth(c-1),a.setUTCDate(date),b=parseFloat(Date.parse(a)),b=isNaN(b)?null:b))}return b},getFormatString:function(b){b=
b.split("/");var a="yyyy/mm/dd";1<=b.length&&(a="yyyy");2<=b.length&&(a+="/mm");3===b.length&&(a+="/dd");return a},formatDate:a,formatDateNumber:function(b,d){var c;c=parseFloat(b);c=parseInt(864E5*Math.round(c/864E5),10);return a(new Date(c),d)}}}();wpd=wpd||{};
wpd.gridDetectionCore=function(){var a,b,d,c;return{run:function(){var f=[],e,g,h,l=wpd.appData.getPlotData().getAutoDetector(),n=l.gridMask.xmin,p=l.gridMask.xmax,m=l.gridMask.ymin,k=l.gridMask.ymax,q,r=l.imageWidth,s,t,u;if(b)for(e=n;e<=p;e+=d){h=[];t=[];s=0;for(q=e-d;q<=e+d;q++)for(g=m;g<=k;g++)u=g*r+parseInt(q,10),!0===l.gridBinaryData[u]&&(h[h.length]=u,!0!==t[g]&&(s++,t[g]=!0));if(s>0.3*(k-m))for(s=0;s<h.length;s++)f[h[s]]=!0}if(a)for(g=m;g<=k;g+=c){h=[];t=[];s=0;for(m=g-c;m<=g+c;m++)for(e=
n;e<=p;e++)u=parseInt(m,10)*r+e,!0===l.gridBinaryData[u]&&(h[h.length]=u,!0!==t[e]&&(s++,t[e]=!0));if(s>0.3*(p-n))for(s=0;s<h.length;s++)f[h[s]]=!0}wpd.appData.getPlotData().gridData=f},setHorizontalParameters:function(b,d,g){a=b;c=d},setVerticalParameters:function(a,c,g){b=a;d=c}}}();wpd=wpd||{};
wpd.InputParser=function(){return function(){this.parse=function(a){this.isDate=this.isValid=!1;this.formatting=null;if(null==a)return null;a=a.trim();if(0<=a.indexOf("^"))return null;var b=wpd.dateConverter.parse(a);if(null!=b)return this.isDate=this.isValid=!0,this.formatting=wpd.dateConverter.getFormatString(a),b;a=parseFloat(a);return isNaN(a)?null:(this.isValid=!0,a)};this.isDate=this.isValid=!1;this.formatting=null}}();wpd=wpd||{};
wpd.taninverse=function(a,b){var d;0<a?d=Math.atan2(a,b):0>=a&&(d=Math.atan2(a,b)+2*Math.PI);d>=2*Math.PI&&(d=0);return d};wpd.sqDist2d=function(a,b,d,c){return(a-d)*(a-d)+(b-c)*(b-c)};wpd.sqDist3d=function(a,b,d,c,f,e){return(a-c)*(a-c)+(b-f)*(b-f)+(d-e)*(d-e)};wpd.dist2d=function(a,b,d,c){return Math.sqrt(wpd.sqDist2d(a,b,d,c))};wpd.dist3d=function(a,b,d,c,f,e){return Math.sqrt(wpd.sqDist3d(a,b,d,c,f,e))};wpd=wpd||{};
wpd.AveragingWindowCore=function(){return function(a,b,d,c,f,e){this.run=function(){var g=[],h=0,l=[],n,p,m,k,q,r,s,t,u;e.clearAll();for(n=0;n<d;n++){q=-1;m=-2*f;for(p=k=0;p<b;p++)!0===a[p*d+n]&&(p>m+f?(q+=1,k=1,m=l[q]=p):(k+=1,l[q]=parseFloat((l[q]*(k-1)+p)/parseFloat(k))));if(0<=q)for(m=n,p=0;p<=q;p++)k=l[p],g[h]=[],g[h][0]=parseFloat(m),g[h][1]=parseFloat(k),g[h][2]=!0,h+=1}if(0!==h){for(l=0;l<h;l++)if(!0===g[l][2]){n=!0;q=l+1;p=g[l][0];m=g[l][1];k=p;r=m;for(u=1;!0===n&&q<h;)s=g[q][0],t=g[q][1],
Math.abs(s-p)<=c&&Math.abs(t-m)<=f&&!0===g[q][2]&&(k=(k*u+s)/(u+1),r=(r*u+t)/(u+1),u+=1,g[q][2]=!1),s>p+2*c&&(n=!1),q+=1;g[l][2]=!1;e.addPixel(parseFloat(k),parseFloat(r))}return e}}}}();wpd=wpd||{};
wpd.AveragingWindowAlgo=function(){return function(){var a=5,b=5;this.getParamList=function(){return[["\u0394X","Px",10],["\u0394Y","Px",10]]};this.setParam=function(d,c){0===d?a=c:1===d&&(b=c)};this.run=function(d){var c=d.getAutoDetector();d=d.getActiveDataSeries();(new wpd.AveragingWindowCore(c.binaryData,c.imageHeight,c.imageWidth,a,b,d)).run()}}}();wpd=wpd||{};
wpd.AveragingWindowWithStepSizeAlgo=function(){return function(){var a,b,d,c,f,e;this.getParamList=function(){var b=wpd.appData.isAligned(),a=wpd.appData.getPlotData().axes;return b&&a instanceof wpd.XYAxes?(b=a.getBounds(),[["X_min","Units",b.x1],["\u0394X Step","Units",0.1],["X_max","Units",b.x2],["Y_min","Units",b.y3],["Y_max","Units",b.y4],["Line width","Px",30]]):[["X_min","Units",0],["\u0394X Step","Units",0.1],["X_max","Units",0],["Y_min","Units",0],["Y_max","Units",0],["Line width","Px",30]]};
this.setParam=function(g,h){0===g?a=h:1===g?b=h:2===g?d=h:3===g?f=h:4===g?e=h:5===g&&(c=h)};this.run=function(g){var h=g.getAutoDetector(),l=g.getActiveDataSeries();g=g.axes;var n=h.imageWidth,p=h.imageHeight,m,k,q,r,s,t,u,v,w;l.clearAll();for(m=a;m<=d;m+=b)for(w=g.dataToPixel(m,f),k=w.x,r=w.y,w=g.dataToPixel(m,e),q=w.x,s=w.y,k=Math.sqrt((s-r)*(s-r)+(q-k)*(q-k)),q=(e-f)/k,r=!1,t=s=0,u=!1,v=0;v<=k;v++)w=1*-v*q+e,w=g.dataToPixel(m,w),xi_pix=w.x,yi_pix=w.y,0<=xi_pix&&xi_pix<n&&0<=yi_pix&&yi_pix<p&&(!0===
h.binaryData[parseInt(yi_pix,10)*n+parseInt(xi_pix,10)]?(!1===r&&(t=s=v,r=!0,u=!1),!0===u&&(t=v,u=!1)):!1===u&&(t=v,u=!0),!0===r&&(v>s+c||v==k-1)&&(r=!1,s>t&&(t=v),w=(s+t)/2,w=1*-w*q+e,w=g.dataToPixel(m,w),l.addPixel(parseFloat(w.x),parseFloat(w.y))))}}}();wpd=wpd||{};
wpd.BlobDetectorAlgo=function(){return function(){var a,b;this.getParamList=function(){var b=wpd.appData.isAligned(),a=wpd.appData.getPlotData().axes;return b&&a instanceof wpd.MapAxes?[["Min Diameter","Units",0],["Max Diameter","Units",5E3]]:[["Min Diameter","Px",0],["Max Diameter","Px",5E3]]};this.setParam=function(d,c){0===d?a=parseFloat(c):1===d&&(b=parseFloat(c))};this.run=function(d){var c=d.getAutoDetector(),f=d.getActiveDataSeries(),e=c.imageWidth,g=c.imageHeight,h=[],l=[],n,p,m,k,q,r,s,t,
u;if(!(0>=e||0>=g||null==c.binaryData||0===c.binaryData.length)){f.clearAll();f.setMetadataKeys(["area","moment"]);for(n=0;n<e;n++)for(p=0;p<g;p++)if(!0===c.binaryData[p*e+n]&&!0!==h[p*e+n])for(h[p*e+n]=!0,k=l.length,l[k]={pixels:[{x:n,y:p}],centroid:{x:n,y:p},area:1,moment:0},m=0;m<l[k].pixels.length;){s=l[k].pixels[m].x;t=l[k].pixels[m].y;for(q=s-1;q<=s+1;q++)for(r=t-1;r<=t+1;r++)0<=q&&0<=r&&q<e&&r<g&&!0!==h[r*e+q]&&!0===c.binaryData[r*e+q]&&(h[r*e+q]=!0,u=l[k].pixels.length,l[k].pixels[u]={x:q,
y:r},l[k].centroid.x=(l[k].centroid.x*u+q)/(u+1),l[k].centroid.y=(l[k].centroid.y*u+r)/(u+1),l[k].area+=1);m+=1}for(k=0;k<l.length;k++){for(m=l[k].moment=0;m<l[k].pixels.length;m++)l[k].moment=l[k].moment+(l[k].pixels[m].x-l[k].centroid.x)*(l[k].pixels[m].x-l[k].centroid.x)+(l[k].pixels[m].y-l[k].centroid.y)*(l[k].pixels[m].y-l[k].centroid.y);d.axes instanceof wpd.MapAxes&&(l[k].area=d.axes.pixelToDataArea(l[k].area));c=2*Math.sqrt(l[k].area/Math.PI);c<=b&&c>=a&&f.addPixel(l[k].centroid.x,l[k].centroid.y,
[l[k].area,l[k].moment])}}}}}();wpd=wpd||{};
wpd.XStepWithInterpolationAlgo=function(){return function(){var a,b,d,c,f,e;this.getParamList=function(){var b=wpd.appData.isAligned(),a=wpd.appData.getPlotData().axes;return b&&a instanceof wpd.XYAxes?(b=a.getBounds(),[["X_min","Units",b.x1],["\u0394X Step","Units",(b.x2-b.x1)/50],["X_max","Units",b.x2],["Y_min","Units",b.y3],["Y_max","Units",b.y4],["Smoothing","Units",0]]):[["X_min","Units",0],["\u0394X Step","Units",0.1],["X_max","Units",0],["Y_min","Units",0],["Y_max","Units",0],["Smoothing",
"Units",0]]};this.setParam=function(g,h){0===g?a=h:1===g?b=h:2===g?d=h:3===g?f=h:4===g?e=h:5===g&&(c=h)};this.run=function(g){var h=g.getAutoDetector(),l=g.getActiveDataSeries();g=g.axes;var n=0,p=h.imageWidth,m=h.imageHeight,k,q,r,s,t,u,v=[],w=[];u=[];var y=[];l.clearAll();k=g.dataToPixel(a,f);q=g.dataToPixel(a,e);q=Math.sqrt((k.x-q.x)*(k.x-q.x)+(k.y-q.y)*(k.y-q.y));y=(e-f)/q;q=g.dataToPixel(d,f);k=Math.sqrt((k.x-q.x)*(k.x-q.x)+(k.y-q.y)*(k.y-q.y));q=(d-a)/k;for(k=a;0<q&&k<=d||0>q&&k>=d;){t=s=0;
for(r=f;0<y&&r<=e||0>y&&r>=e;)u=g.dataToPixel(k,r),0<u.x&&0<u.y&&u.x<p&&u.y<m&&!0===h.binaryData[parseInt(u.y,10)*p+parseInt(u.x,10)]&&(s=(s*t+r)/parseFloat(t+1),t++),r+=y;0<t&&(v[n]=parseFloat(k),w[n]=parseFloat(s),n+=1);k+=q}if(!(0>=v.length||0>=w.length)){if(0<c)for(u=[],y=[],k=v[0];0<q&&k<=v[v.length-1]||0>q&&k>=v[v.length-1];){for(h=t=p=n=0;h<v.length;h++)v[h]<k+c&&v[h]>k-c&&(n=(n*t+v[h])/parseFloat(t+1),p=(p*t+w[h])/parseFloat(t+1),t++);0<t&&(u[u.length]=n,y[y.length]=p);k=0<q?k+c:k-c}else u=
v,y=w;if(!(0>=u.length||0>=y.length||(v=[],h=0,k=a,0>q&&0<b||0<q&&0>b))){for(;0<q&&k<=d||0>q&&k>=d;)v[h]=k,h++,k+=b;w=numeric.spline(u,y).at(v);for(h=0;h<w.length;h++)isNaN(v[h])||isNaN(w[h])||(u=g.dataToPixel(v[h],w[h]),l.addPixel(u.x,u.y))}}}}}();wpd=wpd||{};
wpd.ImageAxes=function(){var a=function(){this.isCalibrated=function(){return!0};this.calibrate=function(){return!0};this.pixelToData=function(b,a){return[b,a]};this.dataToPixel=function(b,a){return{x:b,y:a}};this.pixelToLiveString=function(b,a){var c=this.pixelToData(b,a);return c[0].toFixed(2)+", "+c[1].toFixed(2)}};a.prototype.numCalibrationPointsRequired=function(){return 0};a.prototype.getDimensions=function(){return 2};a.prototype.getAxesLabels=function(){return["X","Y"]};return a}();
wpd=wpd||{};
wpd.MapAxes=function(){var a=function(){var b=!1,a,c,f;this.isCalibrated=function(){return b};this.calibrate=function(e,g,h){var l=e.getPoint(0);e=e.getPoint(1);f=Math.sqrt((l.px-e.px)*(l.px-e.px)+(l.py-e.py)*(l.py-e.py));a=parseFloat(g);c=h;return b=!0};this.pixelToData=function(b,c){var h=[];h[0]=b*a/f;h[1]=c*a/f;return h};this.pixelToDataDistance=function(b){return b*a/f};this.pixelToDataArea=function(b){return b*a*a/(f*f)};this.dataToPixel=function(b,a,d){return{x:0,y:0}};this.pixelToLiveString=function(b,
a){var d=this.pixelToData(b,a);return d[0].toExponential(4)+", "+d[1].toExponential(4)};this.getUnits=function(){return c}};a.prototype.numCalibrationPointsRequired=function(){return 2};a.prototype.getDimensions=function(){return 2};a.prototype.getAxesLabels=function(){return["X","Y"]};return a}();wpd=wpd||{};
wpd.PolarAxes=function(){var a=function(){var b=!1,a=!1,c,f,e,g,h,l,n,p,m,k,q,r,s,t;processCalibration=function(b,v,w){w=b.getPoint(0);var y=b.getPoint(1);b=b.getPoint(2);c=w.px;f=w.py;e=y.px;g=y.py;h=b.px;l=b.py;n=y.dx;p=y.dy;m=b.dx;a=v;!0===a&&(p*=Math.PI/180);k=Math.sqrt((e-c)*(e-c)+(g-f)*(g-f));q=Math.sqrt((h-c)*(h-c)+(l-f)*(l-f));r=q-k;s=wpd.taninverse(-(g-f),e-c);t=s-p;return!0};this.isCalibrated=function(){return b};this.calibrate=function(a,d,c){return b=processCalibration(a,d,c)};this.pixelToData=
function(b,e){var h=[],g,l;xp=parseFloat(b);yp=parseFloat(e);g=(m-n)/r*(Math.sqrt((xp-c)*(xp-c)+(yp-f)*(yp-f))-k)+n;l=wpd.taninverse(-(yp-f),xp-c)-t;!0==a&&(l=180*l/Math.PI);h[0]=g;h[1]=l;return h};this.dataToPixel=function(b,a){return{x:0,y:0}};this.pixelToLiveString=function(b,a){var d=this.pixelToData(b,a);return d[0].toExponential(4)+", "+d[1].toExponential(4)}};a.prototype.numCalibrationPointsRequired=function(){return 3};a.prototype.getDimensions=function(){return 2};a.prototype.getAxesLabels=
function(){return["r","\u03b8"]};return a}();wpd=wpd||{};
wpd.TernaryAxes=function(){var a=function(){var b=!1,a,c,f,e,g,h,l,n,p;this.isCalibrated=function(){return b};this.calibrate=function(m,k,q){var r=m.getPoint(0),s=m.getPoint(1);m.getPoint(2);a=r.px;c=r.py;f=s.px;e=s.py;g=Math.sqrt((a-f)*(a-f)+(c-e)*(c-e));h=wpd.taninverse(-(e-c),f-a);l=Math.sqrt(3);n=k;p=q;return b=!0};this.pixelToData=function(b,e){var f=[],r,s,t,u;xp=parseFloat(b);yp=parseFloat(e);r=Math.sqrt((xp-a)*(xp-a)+(yp-c)*(yp-c));s=wpd.taninverse(-(yp-c),xp-a)-h;t=r*Math.cos(s)/g;s=r*Math.sin(s)/
g;r=1-t-s/l;t-=s/l;s=2*s/l;!1==p&&(u=t,t=r,r=s,s=u);!0==n&&(r*=100,t*=100,s*=100);f[0]=r;f[1]=t;f[2]=s;return f};this.dataToPixel=function(b,a,d){return{x:0,y:0}};this.pixelToLiveString=function(b,a){var d=this.pixelToData(b,a);return d[0].toExponential(4)+", "+d[1].toExponential(4)+", "+d[2].toExponential(4)}};a.prototype.numCalibrationPointsRequired=function(){return 3};a.prototype.getDimensions=function(){return 3};a.prototype.getAxesLabels=function(){return["a","b","c"]};return a}();
wpd=wpd||{};
wpd.XYAxes=function(){var a=function(){var b=!1,a=!1,c=!1,f=!1,e=!1,g,h,l,n,p,m,k,q,r,s,t,u,v,w,y,F,H,J,D,E,I,G,P,Q=function(b,U,L){if(4>b.getCount())return!1;var R=b.getPoint(0),M=b.getPoint(1),O=b.getPoint(2);b=b.getPoint(3);var z=new wpd.InputParser;l=R.px;k=R.py;n=M.px;q=M.py;p=O.px;r=O.py;m=b.px;s=b.py;t=R.dx;u=M.dx;v=O.dy;w=b.dy;t=z.parse(t);if(!z.isValid)return!1;f=z.isDate;u=z.parse(u);if(!z.isValid||z.isDate!=f)return!1;g=z.formatting;v=z.parse(v);if(!z.isValid)return!1;e=z.isDate;w=z.parse(w);
if(!z.isValid||z.isDate!=e)return!1;h=z.formatting;a=U;c=L;!0===a&&(t=Math.log(t)/Math.log(10),u=Math.log(u)/Math.log(10));!0===c&&(v=Math.log(v)/Math.log(10),w=Math.log(w)/Math.log(10));y=u-t;F=w-v;H=Math.sqrt((l-n)*(l-n)+(k-q)*(k-q));J=Math.sqrt((p-m)*(p-m)+(r-s)*(r-s));D=y/H;E=F/J;I=wpd.taninverse(-(q-k),n-l);G=wpd.taninverse(-(s-r),m-p);P=G-I;return!0};this.getBounds=function(){return{x1:t,x2:u,y3:v,y4:w}};this.isCalibrated=function(){return b};this.calibrate=function(a,d,c){return b=Q(a,d,c)};
this.pixelToData=function(b,e){var f=[],h,g,m,n;h=parseFloat(b);g=parseFloat(e);m=Math.sqrt((h-l)*(h-l)+(g-k)*(g-k));n=wpd.taninverse(-(g-k),h-l)-I;m=(m*Math.cos(n)-m*Math.sin(n)/Math.tan(P))*D+t;n=Math.sqrt((h-p)*(h-p)+(g-r)*(g-r));h=G-wpd.taninverse(-(g-r),h-p);h=(n*Math.cos(h)-n*Math.sin(h)/Math.tan(P))*E+v;!0===a&&(m=Math.pow(10,m));!0===c&&(h=Math.pow(10,h));f[0]=m;f[1]=h;return f};this.dataToPixel=function(b,a){var d,c;d=(l-n)*(r-s)-(k-q)*(p-m);c=this.pixelToData(((l*q-k*n)*(p-m)-(l-n)*(p*s-
r*m))/d,((l*q-k*n)*(r-s)-(k-q)*(p*s-r*m))/d);d=c[0];c=c[1];c=(b-t)*Math.cos(I)/D+(a-c)*Math.cos(G)/E+l;d=r-(b-d)*Math.sin(I)/D-(a-v)*Math.sin(G)/E;return{x:c,y:d}};this.pixelToLiveString=function(b,a){var d="",c=this.pixelToData(b,a),d=f?d+wpd.dateConverter.formatDateNumber(c[0],g):d+c[0].toExponential(4),d=d+", ";return d=e?d+wpd.dateConverter.formatDateNumber(c[1],h):d+c[1].toExponential(4)};this.isDate=function(b){return 0===b?f:e};this.getInitialDateFormat=function(b){return 0===b?g:h};this.isLogX=
function(){return a};this.isLogY=function(){return c}};a.prototype.numCalibrationPointsRequired=function(){return 4};a.prototype.getDimensions=function(){return 2};a.prototype.getAxesLabels=function(){return["X","Y"]};return a}();wpd=wpd||{};
wpd.dataTable=function(){function a(){f=wpd.appData.getPlotData().getDataFromActiveSeries()}function b(){e=f.slice(0);var b=document.getElementById("data-sort-variables").value,a="ascending"===document.getElementById("data-sort-order").value,d="raw"===b,c="NearestNeighbor"===b,g,k=wpd.appData.getPlotData().axes.getDimensions();if(!d)if(!c)g=parseInt(b,10),e.sort(function(b,d){return b[g]>d[g]?a?1:-1:b[g]<d[g]?a?-1:1:0});else if(c){var q,c=[1,1,1],r,s,t=f.length;for(r=0;r<t-1;r++){d=-1;for(s=r+1;s<
t;s++)if(b=(e[r][0]-e[s][0])*(e[r][0]-e[s][0])+(e[r][1]-e[s][1])*(e[r][1]-e[s][1]),3===k&&(b+=(e[r][2]-e[s][2])*(e[r][2]-e[s][2])),b<q||-1===d)q=b,d=s;c[0]=e[d][0];e[d][0]=e[r+1][0];e[r+1][0]=c[0];c[1]=e[d][1];e[d][1]=e[r+1][1];e[r+1][1]=c[1];3===k&&(c[2]=e[d][2],e[d][2]=e[r+1][2],e[r+1][2]=c[2])}}}function d(){var b=document.getElementById("data-sort-variables").value,a=document.getElementById("data-sort-order");"NearestNeighbor"===b||"raw"===b?a.setAttribute("disabled",!0):a.removeAttribute("disabled")}
function c(){if(null!=f){var b=wpd.appData.getPlotData().axes,a=wpd.appData.getPlotData().getActiveDataSeries(),d=b.getDimensions(),a=a.getMetadataKeys().length,c=f.length,m,k,q,r=document.getElementById("digitizedDataTable"),s=[];g="";for(m=0;m<c;m++){q=[];for(k=0;k<d+a;k++)k<d&&null!=b.isDate&&b.isDate(k)?(void 0===s[k]&&(s[k]=document.getElementById("data-format-string-"+k).value),q[k]=wpd.dateConverter.formatDateNumber(e[m][k],s[k])):q[k]=e[m][k];g+=q.join(", ");g+="\n"}r.value=g}}var f,e,g;return{getSeriesData:a,
showTable:function(){if(wpd.appData.isAligned()){wpd.popup.show("csvWindow");a();var e=document.getElementById("data-sort-variables"),f=document.getElementById("dataVariables"),g=document.getElementById("data-date-formatting-container"),p=document.getElementById("data-date-formatting"),m=wpd.appData.getPlotData().axes,k=wpd.appData.getPlotData().getActiveDataSeries(),q=m.getAxesLabels(),r="",s=q.join(", "),t="";isAnyVariableDate=!1;tableVariables=q;dimCount=m.getDimensions();k.hasMetadata()&&(tableVariables=
q.concat(k.getMetadataKeys()),s=tableVariables.join(", "));g.style.display="none";r+='<option value="raw">Raw</option>';for(k=0;k<tableVariables.length;k++)r+='<option value="'+k+'">'+tableVariables[k]+"</option>",k<dimCount&&null!=m.isDate&&null!=m.getInitialDateFormat&&m.isDate(k)&&(t+=q[k]+' <input type="text" length="15" value="'+m.getInitialDateFormat(k)+'" id="data-format-string-'+k+'"/>',isAnyVariableDate=!0);e.innerHTML=r+'<option value="NearestNeighbor">Nearest Neighbor</option>';f.innerHTML=
s;isAnyVariableDate&&(g.style.display="inline-block",p.innerHTML=t);b();c();d()}},updateSortingControls:d,reSort:function(){d();b();c()},selectAll:function(){var b=document.getElementById("digitizedDataTable");b.focus();b.select()},generateCSV:function(){var b,a,d,c=JSON.stringify(g);b=document.createElement("div");a=document.createElement("form");d=document.createElement("input");a.setAttribute("method","post");a.setAttribute("action","php/csvexport.php");d.setAttribute("type","text");d.setAttribute("name",
"data");a.appendChild(d);b.appendChild(a);document.body.appendChild(b);b.style.display="none";d.setAttribute("value",c);a.submit();document.body.removeChild(b)},exportToPlotly:function(){if(null!=f&&0!==f.length){var b=document.createElement("div"),a=document.createElement("form"),d=document.createElement("input");a.setAttribute("method","post");a.setAttribute("action","https://plot.ly/external");a.setAttribute("target","_blank");d.setAttribute("type","text");d.setAttribute("name","data");a.appendChild(d);
b.appendChild(a);document.body.appendChild(b);b.style.display="none";var c={data:[]},g=wpd.appData.getPlotData().axes,k=wpd.appData.getPlotData().getActiveDataSeries().getMetadataKeys(),q=k.length,r=g.getDimensions(),s=f.length,t,u,v=["x","y","z"];c.data[0]={};for(t=0;t<s;t++)for(rowValues=[],u=0;u<r+q;u++)0===t&&(u<r?c.data[0][v[u]]=[]:c.data[0][k[u-r]]=[]),u<r&&null!=g.isDate&&g.isDate(u)?c.data[0][v[u]][t]=wpd.dateConverter.formatDateNumber(e[t][u],"yyyy-mm-dd"):u<r?c.data[0][v[u]][t]=e[t][u]:
c.data[0][k[u-r]][t]=e[t][u];d.setAttribute("value",JSON.stringify(c));a.submit();document.body.removeChild(b)}}}}();wpd=wpd||{};
wpd.graphicsWidget=function(){function a(b){var a=F.getBoundingClientRect();return{x:parseInt(b.pageX-(a.left+window.pageXOffset),10),y:parseInt(b.pageY-(a.top+window.pageYOffset),10)}}function b(b,a){return{x:b/K,y:a/K}}function d(b,a){b=parseInt(b,10);a=parseInt(a,10);P.style.width=b+"px";P.style.height=a+"px";F.width=b;H.width=b;J.width=b;D.width=b;E.width=b;F.height=a;H.height=a;J.height=a;D.height=a;E.height=a;X=b/(1*a);z=b;N=a;if(null!=S){Q.fillStyle="rgb(255, 255, 255)";Q.fillRect(0,0,z,N);
Q.drawImage(I,0,0,z,N);if(null!=A&&void 0!=A.onRedraw)A.onRedraw();if(null!=x&&void 0!=x.onRedraw)x.onRedraw()}}function c(){F.width=F.width;H.width=H.width;J.width=J.width;D.width=D.width;E.width=E.width;G.width=G.width}function f(){if(null!=A&&void 0!=A.onRemove)A.onRemove();A=null}function e(){var b=wpd.layoutManager.getGraphicsViewportSize();d(b.width,b.height);X>T?(K=N/(1*B),d(N*T,N)):(K=z/(1*C),d(z,z/T))}function g(b){K=b;d(C*K,B*K)}function h(b){220===b.keyCode&&(b.preventDefault(),W=!W,D.width=
D.width)}function l(b,a){var d=wpd.zoomView.getSize(),c=wpd.zoomView.getZoomRatio(),e,f,g,h,l,k,m,p=0,n=0,q=d.width,r=d.height;g=d.width/c;h=d.height/c;e=b-g/2;f=a-h/2;k=e;d=f;l=e+g;m=f+h;0>e&&(k=0,p=-e*c);0>f&&(d=0,n=-f*c);e+g>=C&&(l=C,q-=c*(C-(e+g)));f+h>=B&&(m=B,r-=c*(B-(f+h)));g=M.getImageData(parseInt(k,10),parseInt(d,10),parseInt(l-k,10),parseInt(m-d,10));l=O.getImageData(parseInt(k,10),parseInt(d,10),parseInt(l-k,10),parseInt(m-d,10));for(m=0;m<l.data.length;m+=4)if(0!=l.data[m]||0!=l.data[m+
1]||0!=l.data[m+2])g.data[m]=l.data[m],g.data[m+1]=l.data[m+1],g.data[m+2]=l.data[m+2];k=c*(parseInt(k,10)-k);c*=parseInt(d,10)-d;wpd.zoomView.setZoomImage(g,parseInt(p+k,10),parseInt(n+c,10),parseInt(q-p,10),parseInt(r-n,10))}function n(d){clearTimeout(Y);var c=setTimeout,e=a(d);d=e.x;var e=e.y,f=b(d,e);W&&(D.width=D.width,L.strokeStyle="rgba(0,0,0, 0.5)",L.beginPath(),L.moveTo(d,0),L.lineTo(d,N),L.moveTo(0,e),L.lineTo(z,e),L.stroke());l(f.x,f.y);wpd.zoomView.setCoords(f.x,f.y);Y=c(void 0,10)}function p(){F=
document.getElementById("mainCanvas");H=document.getElementById("dataCanvas");J=document.getElementById("drawCanvas");D=document.getElementById("hoverCanvas");E=document.getElementById("topCanvas");I=document.createElement("canvas");G=document.createElement("canvas");Q=F.getContext("2d");V=H.getContext("2d");L=D.getContext("2d");R=E.getContext("2d");U=J.getContext("2d");M=I.getContext("2d");O=G.getContext("2d");P=document.getElementById("canvasDiv");document.body.addEventListener("keydown",h,!1);
E.addEventListener("mousemove",n,!1);E.addEventListener("dragover",function(b){b.preventDefault()},!0);E.addEventListener("drop",function(b){b.preventDefault();wpd.busyNote.show();b=b.dataTransfer.files;1===b.length&&k(b[0])},!0);E.addEventListener("mousemove",s,!1);E.addEventListener("click",t,!1);E.addEventListener("mouseup",v,!1);E.addEventListener("mousedown",w,!1);E.addEventListener("mouseout",y,!0);document.addEventListener("mouseup",u,!1);document.addEventListener("mousedown",function(b){Z=
b.target===E?!0:!1},!1);document.addEventListener("keydown",function(b){if(Z&&null!=x&&void 0!=x.onKeyDown)x.onKeyDown(b)},!0);wpd.zoomView.initZoom();document.getElementById("fileLoadBox").addEventListener("change",q);window.addEventListener("paste",function(b){wpd.busyNote.show();if(void 0!==b.clipboardData&&(b=b.clipboardData.items,void 0!==b))for(var a=0;a<b.length;a++)if(-1!==b[a].type.indexOf("image")){var d=b[a].getAsFile();(window.URL||window.webkitURL).createObjectURL(d);k(d)}},!1)}function m(b){var a=
document.createElement("img");a.onload=function(){null==F&&p();wpd.appData.reset();wpd.sidebar.clear();r();f();C=a.width;B=a.height;T=C/(1*B);I.width=C;I.height=B;G.width=C;G.height=B;M.drawImage(a,0,0,C,B);S=M.getImageData(0,0,C,B);c();e();wpd.appData.plotLoaded(S);wpd.busyNote.close();!1===$&&wpd.popup.show("axesList");$=!1};a.src=b}function k(b){if(b.type.match("image.*")){var a=new FileReader;a.onload=function(){m(a.result)};a.readAsDataURL(b)}}function q(){wpd.busyNote.show();var b=document.getElementById("fileLoadBox");
1==b.files.length&&k(b.files[0])}function r(){if(null!=x&&void 0!=x.onRemove)x.onRemove();x=null}function s(d){if(null!=x&&void 0!=x.onMouseMove){var c=a(d),e=b(c.x,c.y);x.onMouseMove(d,c,e)}}function t(d){if(null!=x&&void 0!=x.onMouseClick){var c=a(d),e=b(c.x,c.y);x.onMouseClick(d,c,e)}}function u(d){if(null!=x&&void 0!=x.onDocumentMouseUp){var c=a(d),e=b(c.x,c.y);x.onDocumentMouseUp(d,c,e)}}function v(d){if(null!=x&&void 0!=x.onMouseUp){var c=a(d),e=b(c.x,c.y);x.onMouseUp(d,c,e)}}function w(d){if(null!=
x&&void 0!=x.onMouseDown){var c=a(d),e=b(c.x,c.y);x.onMouseDown(d,c,e)}}function y(d){if(null!=x&&void 0!=x.onMouseOut){var c=a(d),e=b(c.x,c.y);x.onMouseOut(d,c,e)}}var F,H,J,D,E,I,G,P,Q,V,U,L,R,M,O,z,N,C,B,T,X,S,K,W=!1,Y,x,A,Z=!1,$=!0;return{zoomIn:function(){g(1.2*K)},zoomOut:function(){g(K/1.2)},zoomFit:e,zoom100perc:function(){g(1)},setZoomRatio:g,getZoomRatio:function(){return K},loadImageFromURL:m,runImageOp:function(b){var a=b(S,C,B);b=a.imageData;var d=a.width,a=a.height;wpd.appData.reset();
r();f();C=d;B=a;T=C/(1*B);I.width=C;I.height=B;G.width=C;G.height=B;M.putImageData(b,0,0);S=b;c();e();wpd.appData.plotLoaded(S)},setTool:function(b){if(null!=x&&void 0!=x.onRemove)x.onRemove();x=b;if(null!=x&&void 0!=x.onAttach)x.onAttach()},removeTool:r,getAllContexts:function(){return{mainCtx:Q,dataCtx:V,drawCtx:U,hoverCtx:L,topCtx:R,oriImageCtx:M,oriDataCtx:O}},resetData:function(){G.width=G.width;H.width=H.width},resetHover:function(){D.width=D.width},imagePx:b,screenPx:function(b,a){return{x:b*
K,y:a*K}},updateZoomOnEvent:function(d){d=a(d);d=b(d.x,d.y);l(d.x,d.y);wpd.zoomView.setCoords(d.x,d.y)},updateZoomToImagePosn:function(b,a){l(b,a);wpd.zoomView.setCoords(b,a)},getDisplaySize:function(){return{width:z,height:N}},getImageSize:function(){return{width:C,height:B}},copyImageDataLayerToScreen:function(){V.drawImage(G,0,0,z,N)},setRepainter:function(b){if(null==A||void 0==A.painterName||null==b||void 0==b.painterName||A.painterName!=b.painterName){if(null!=A&&void 0!=A.onRemove)A.onRemove();
A=b;if(null!=A&&void 0!=A.onAttach)A.onAttach()}},removeRepainter:f,forceHandlerRepaint:function(){if(null!=A&&void 0!=A.onForcedRedraw)A.onForcedRedraw()},getRepainter:function(){return A},saveImage:function(){var b=document.createElement("canvas"),a=b.getContext("2d"),d,c,e;b.width=C;b.height=B;a.drawImage(I,0,0,C,B);d=a.getImageData(0,0,C,B);e=O.getImageData(0,0,C,B);for(c=0;c<d.data.length;c+=4)if(0!=e.data[c]||0!=e.data[c+1]||0!=e.data[c+2])d.data[c]=e.data[c],d.data[c+1]=e.data[c+1],d.data[c+
2]=e.data[c+2];a.putImageData(d,0,0);window.open(b.toDataURL(),"_blank")}}}();wpd=wpd||{};
wpd.layoutManager=function(){function a(){var b=parseInt(document.body.offsetWidth,10),a=parseInt(document.body.offsetHeight,10);f.style.height=a+"px";e.style.height=a-280+"px";g.style.width=b-f.offsetWidth-5+"px";g.style.height=a+"px";c.style.height=a-44+"px";wpd.sidebar.resize()}function b(b){clearTimeout(d);d=setTimeout(a,80)}var d,c,f,e,g;return{initialLayout:function(){c=document.getElementById("graphicsContainer");f=document.getElementById("sidebarContainer");e=document.getElementById("sidebarControlsContainer");
g=document.getElementById("mainContainer");a();window.addEventListener("resize",b,!1)},getGraphicsViewportSize:function(){return{width:c.offsetWidth,height:c.offsetHeight}}}}();wpd=wpd||{};
wpd.popup=function(){return{show:function(a){document.getElementById("shadow").style.visibility="visible";a=document.getElementById(a);var b=parseInt(window.innerWidth),d=parseInt(window.innerHeight),c=parseInt(a.offsetWidth),f=parseInt(a.offsetHeight),d=(d-f)/2;a.style.left=(b-c)/2+"px";a.style.top=(60<d?60:d)+"px";a.style.visibility="visible"},close:function(a){document.getElementById("shadow").style.visibility="hidden";document.getElementById(a).style.visibility="hidden"}}}();
wpd.busyNote=function(){var a,b=!1;return{show:function(){b||(null==a&&(a=document.createElement("div"),a.id="wait",a.innerHTML='<p align="center">Processing...</p>'),document.body.appendChild(a),b=!0)},close:function(){null!=a&&!0===b&&(document.body.removeChild(a),b=!1)}}}();
wpd.messagePopup=function(){var a;return{show:function(b,d,c){wpd.popup.show("messagePopup");document.getElementById("message-popup-heading").innerHTML=b;document.getElementById("message-popup-text").innerHTML=d;a=c},close:function(){wpd.popup.close("messagePopup");null!=a&&a()}}}();
wpd.okCancelPopup=function(){return{show:function(a,b,d,c){wpd.popup.show("okCancelPopup");document.getElementById("ok-cancel-popup-heading").innerHTML=a;document.getElementById("ok-cancel-popup-text").innerHTML=b},ok:function(){wpd.popup.close("okCancelPopup");(void 0)()},cancel:function(){wpd.popup.close("okCancelPopup");(void 0)()}}}();wpd.unsupported=function(){wpd.messagePopup.show("Unsupported Feature!","This feature has not been implemented in the current version. This may be available in a future release.")};
wpd=wpd||{};
wpd.sidebar=function(){function a(){var b=document.getElementsByClassName("sidebar"),a;for(a=0;a<b.length;a++)b[a].style.display="none"}return{show:function(b){a();b=document.getElementById(b);b.style.display="inline-block";b.style.height=parseInt(document.body.offsetHeight,10)-280+"px"},clear:a,resize:function(){var b=document.getElementsByClassName("sidebar"),a;for(a=0;a<b.length;a++)"inline-block"===b[a].style.display&&(b[a].style.height=parseInt(document.body.offsetHeight,10)-280+"px")}}}();
wpd=wpd||{};wpd.toolbar=function(){function a(){var b=document.getElementsByClassName("toolbar"),a;for(a=0;a<b.length;a++)b[a].style.visibility="hidden"}return{show:function(b){a();document.getElementById(b).style.visibility="visible"},clear:a}}();wpd=wpd||{};
wpd.webcamCapture=function(){function a(){void 0!=b&&b.stop();wpd.popup.close("webcamCapture")}var b;return{start:function(){if(null==(navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia))wpd.messagePopup.show("Webcam Capture","Your browser does not support webcam capture using HTML5 APIs. A recent version of Google Chrome is recommended.");else{wpd.popup.show("webcamCapture");var a=document.getElementById("webcamVideo");navigator.getUserMedia=
navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia;navigator.getUserMedia({video:!0},function(c){b=c;a.src=window.URL.createObjectURL(c)},function(){})}},cancel:function(){a()},capture:function(){var b=document.createElement("canvas"),c=document.getElementById("webcamVideo"),f=b.getContext("2d"),e;b.width=c.videoWidth;b.height=c.videoHeight;f.drawImage(c,0,0);e=f.getImageData(0,0,b.width,b.height);a();wpd.graphicsWidget.runImageOp(function(){return{imageData:e,
width:b.width,height:b.height}})}}}();wpd=wpd||{};
wpd.zoomView=function(){function a(){var b=document.getElementById("zoomCrossHair"),a=b.getContext("2d");b.width=b.width;a.strokeStyle="black"===n?"rgba(0,0,0,1)":"red"===n?"rgba(255,0,0,1)":"yellow"===n?"rgba(255,255,0,1)":"rgba(0,0,0,1)";a.beginPath();a.moveTo(e/2,0);a.lineTo(e/2,g);a.moveTo(0,g/2);a.lineTo(e,g/2);a.stroke()}var b,d,c,f,e=250,g=250,h,l,n="black";return{initZoom:function(){b=document.getElementById("zoomCanvas");d=b.getContext("2d");c=document.createElement("canvas");f=c.getContext("2d");
h=document.getElementById("mousePosition");l=5;a()},setZoomImage:function(a,e,g,h,n){c.width=h/l;c.height=n/l;f.putImageData(a,0,0);b.width=b.width;d.drawImage(c,e,g,h,n)},setCoords:function(b,a){if(wpd.appData.isAligned()){var c=wpd.appData.getPlotData();h.innerHTML=c.axes.pixelToLiveString(b,a)}else h.innerHTML=b.toFixed(2)+", "+a.toFixed(2)},setZoomRatio:function(b){l=b},getZoomRatio:function(){return l},getSize:function(){return{width:e,height:g}},showSettingsWindow:function(){document.getElementById("zoom-magnification-value").value=
l;document.getElementById("zoom-crosshair-color-value").value=n;wpd.popup.show("zoom-settings-popup")},applySettings:function(){l=document.getElementById("zoom-magnification-value").value;n=document.getElementById("zoom-crosshair-color-value").value;a();wpd.popup.close("zoom-settings-popup")}}}();wpd=wpd||{};
wpd.xyCalibration=function(){function a(){wpd.popup.show("xyAlignment")}return{start:function(){wpd.popup.show("xyAxesInfo")},pickCorners:function(){wpd.popup.close("xyAxesInfo");var b=new wpd.AxesCornersTool(4,2,["X1","X2","Y1","Y2"]);wpd.graphicsWidget.setTool(b)},getCornerValues:a,align:function(){var b=document.getElementById("xmin").value,d=document.getElementById("xmax").value,c=document.getElementById("ymin").value,f=document.getElementById("ymax").value,e=document.getElementById("xlog").checked,
g=document.getElementById("ylog").checked,h=new wpd.XYAxes,l=wpd.alignAxes.getActiveCalib();l.setDataAt(0,b,c);l.setDataAt(1,d,c);l.setDataAt(2,b,c);l.setDataAt(3,d,f);if(!h.calibrate(l,e,g))return wpd.popup.close("xyAlignment"),wpd.messagePopup.show("Invalid Inputs","Please enter valid values for calibration.",a),!1;wpd.appData.getPlotData().axes=h;wpd.popup.close("xyAlignment");return!0}}}();
wpd.polarCalibration=function(){return{start:function(){wpd.popup.show("polarAxesInfo")},pickCorners:function(){wpd.popup.close("polarAxesInfo");var a=new wpd.AxesCornersTool(3,2,["Origin","P1","P2"]);wpd.graphicsWidget.setTool(a)},getCornerValues:function(){wpd.popup.show("polarAlignment")},align:function(){var a=parseFloat(document.getElementById("rpoint1").value),b=parseFloat(document.getElementById("thetapoint1").value),d=parseFloat(document.getElementById("rpoint2").value),c=parseFloat(document.getElementById("thetapoint2").value),
f=document.getElementById("degrees").checked;document.getElementById("radians");var e=document.getElementById("clockwise").checked,g=new wpd.PolarAxes,h=wpd.alignAxes.getActiveCalib();h.setDataAt(1,a,b);h.setDataAt(2,d,c);g.calibrate(h,f,e);wpd.appData.getPlotData().axes=g;wpd.popup.close("polarAlignment");return!0}}}();
wpd.ternaryCalibration=function(){return{start:function(){wpd.popup.show("ternaryAxesInfo")},pickCorners:function(){wpd.popup.close("ternaryAxesInfo");var a=new wpd.AxesCornersTool(3,3,["A","B","C"]);wpd.graphicsWidget.setTool(a)},getCornerValues:function(){wpd.popup.show("ternaryAlignment")},align:function(){document.getElementById("range0to1");var a=document.getElementById("range0to100").checked,b=document.getElementById("ternarynormal").checked,d=new wpd.TernaryAxes,c=wpd.alignAxes.getActiveCalib();
d.calibrate(c,a,b);wpd.appData.getPlotData().axes=d;wpd.popup.close("ternaryAlignment");return!0}}}();
wpd.mapCalibration=function(){function a(){wpd.popup.show("mapAlignment")}return{start:function(){wpd.popup.show("mapAxesInfo")},pickCorners:function(){wpd.popup.close("mapAxesInfo");var b=new wpd.AxesCornersTool(2,2,["P1","P2"]);wpd.graphicsWidget.setTool(b);b.onComplete=a},getCornerValues:a,align:function(){var b=parseFloat(document.getElementById("scaleLength").value),a=document.getElementById("scaleUnits").value,c=new wpd.MapAxes,f=wpd.alignAxes.getActiveCalib();c.calibrate(f,b,a);wpd.appData.getPlotData().axes=
c;wpd.popup.close("mapAlignment");return!0}}}();
wpd.AxesCornersTool=function(){return function(a,b,d){var c=0;b=new wpd.Calibration(b);var f=!0;b.labels=d;wpd.alignAxes.setActiveCalib(b);wpd.graphicsWidget.resetData();this.onMouseClick=function(b,d,h){f?(c+=1,d=wpd.alignAxes.getActiveCalib(),d.addPoint(h.x,h.y,0,0),d.unselectAll(),d.selectPoint(c-1),wpd.graphicsWidget.forceHandlerRepaint(),c===a&&(f=!1,wpd.alignAxes.calibrationCompleted())):(d=wpd.alignAxes.getActiveCalib(),d.unselectAll(),d.selectNearestPoint(h.x,h.y),wpd.graphicsWidget.forceHandlerRepaint());
wpd.graphicsWidget.updateZoomOnEvent(b)};this.onKeyDown=function(b){var a=wpd.alignAxes.getActiveCalib();if(0!==a.getSelectedPoints().length){var d=a.getPoint(a.getSelectedPoints()[0]),c=d.px,d=d.py,f=!0===b.shiftKey?5/wpd.graphicsWidget.getZoomRatio():0.5/wpd.graphicsWidget.getZoomRatio();if(wpd.keyCodes.isUp(b.keyCode))d-=f;else if(wpd.keyCodes.isDown(b.keyCode))d+=f;else if(wpd.keyCodes.isLeft(b.keyCode))c-=f;else if(wpd.keyCodes.isRight(b.keyCode))c+=f;else return;a.changePointPx(a.getSelectedPoints()[0],
c,d);wpd.graphicsWidget.forceHandlerRepaint();wpd.graphicsWidget.updateZoomToImagePosn(c,d);b.preventDefault();b.stopPropagation()}}}}();
wpd.AlignmentCornersRepainter=function(){return function(){var a=wpd.graphicsWidget.getAllContexts();this.painterName="AlignmentCornersReptainer";this.onForcedRedraw=function(){wpd.graphicsWidget.resetData();this.onRedraw()};this.onRedraw=function(){var b=wpd.alignAxes.getActiveCalib();if(null!=b){var d,c,f;for(d=0;d<b.getCount();d++)f=b.getPoint(d),c=wpd.graphicsWidget.screenPx(f.px,f.py),a.dataCtx.fillStyle="rgba(255,255,255,0.7)",a.dataCtx.fillRect(c.x-10,c.y-10,20,40),a.dataCtx.beginPath(),b.isPointSelected(d)?
a.dataCtx.fillStyle="rgba(0,200,0,1)":a.dataCtx.fillStyle="rgba(200,0,0,1)",a.dataCtx.arc(c.x,c.y,3,0,2*Math.PI,!0),a.dataCtx.fill(),a.dataCtx.font="14px sans-serif",a.dataCtx.fillText(b.labels[d],c.x-10,c.y+18),a.oriDataCtx.beginPath(),b.isPointSelected(d)?a.oriDataCtx.fillStyle="rgb(0,200,0)":a.oriDataCtx.fillStyle="rgb(200,0,0)",a.oriDataCtx.arc(f.px,f.py,3,0,2*Math.PI,!0),a.oriDataCtx.fill(),a.oriDataCtx.font="14px sans-serif",a.oriDataCtx.fillText(b.labels[d],parseInt(f.px-10,10),parseInt(f.py+
18,10))}}}}();
wpd.alignAxes=function(){var a,b;return{start:function(){xyEl=document.getElementById("r_xy");polarEl=document.getElementById("r_polar");ternaryEl=document.getElementById("r_ternary");mapEl=document.getElementById("r_map");imageEl=document.getElementById("r_image");wpd.popup.close("axesList");if(!0===xyEl.checked)b=wpd.xyCalibration;else if(!0===polarEl.checked)b=wpd.polarCalibration;else if(!0===ternaryEl.checked)b=wpd.ternaryCalibration;else if(!0===mapEl.checked)b=wpd.mapCalibration;else if(!0===
imageEl.checked){b=null;var a=new wpd.ImageAxes;a.calibrate();wpd.appData.getPlotData().axes=a;wpd.appData.isAligned(!0);wpd.acquireData.load()}null!=b&&(b.start(),wpd.graphicsWidget.setRepainter(new wpd.AlignmentCornersRepainter))},calibrationCompleted:function(){wpd.sidebar.show("axes-calibration-sidebar")},getCornerValues:function(){b.getCornerValues()},align:function(){wpd.graphicsWidget.removeTool();wpd.graphicsWidget.removeRepainter();wpd.graphicsWidget.resetData();b.align()&&(wpd.appData.isAligned(!0),
wpd.acquireData.load())},getActiveCalib:function(){return a},setActiveCalib:function(b){a=b}}}();wpd=wpd||{};
wpd.autoExtraction=function(){function a(){var b=wpd.appData.getPlotData().getAutoDetector(),a=document.getElementById("auto-extract-algo-name").value;if("averagingWindow"===a)b.algorithm=new wpd.AveragingWindowAlgo;else if("XStep"===a||"XStepWithInterpolation"===a){var c=wpd.appData.getPlotData().axes;c instanceof wpd.XYAxes&&!1===c.isLogX()&&!1===c.isLogY()?"XStep"===a?b.algorithm=new wpd.AveragingWindowWithStepSizeAlgo:"XStepWithInterpolation"===a&&(b.algorithm=new wpd.XStepWithInterpolationAlgo):
(wpd.messagePopup.show("Not supported!","This algorithm is only supported for non log scale XY plots."),document.getElementById("auto-extract-algo-name").value="averagingWindow",b.algorithm=new wpd.AveragingWindowAlgo)}else"blobDetector"===a&&(b.algorithm=new wpd.BlobDetectorAlgo);for(var a=b.algorithm,b=document.getElementById("algo-parameter-container"),a=a.getParamList(),f="<table>",c=0;c<a.length;c++)f+="<tr><td>"+a[c][0]+'</td><td><input type="text" size=3 id="algo-param-'+c+'" class="algo-params" value="'+
a[c][2]+'"/></td><td>'+a[c][1]+"</td></tr>";b.innerHTML=f+"</table>"}return{start:function(){wpd.sidebar.show("auto-extraction-sidebar");wpd.colorPicker.init();a()},changeAlgorithm:a,runAlgo:function(){wpd.busyNote.show();setTimeout(function(){var b=wpd.appData.getPlotData().getAutoDetector(),a=b.algorithm,c=new wpd.DataPointsRepainter,f=document.getElementsByClassName("algo-params"),e,g,h=wpd.graphicsWidget.getAllContexts(),l=wpd.graphicsWidget.getImageSize();for(e=0;e<f.length;e++)g=f[e].id,g=parseInt(g.replace("algo-param-",
""),10),a.setParam(g,parseFloat(f[e].value));wpd.graphicsWidget.removeTool();b.imageData=h.oriImageCtx.getImageData(0,0,l.width,l.height);b.generateBinaryData();wpd.graphicsWidget.setRepainter(c);a.run(wpd.appData.getPlotData());wpd.graphicsWidget.forceHandlerRepaint();wpd.dataPointCounter.setCount();wpd.busyNote.close();return!0},10)}}}();wpd=wpd||{};
wpd.colorSelectionWidget=function(){function a(){document.getElementById("color-selection-selected-color-box").style.backgroundColor="rgb("+b[0]+","+b[1]+","+b[2]+")";document.getElementById("color-selection-red").value=b[0];document.getElementById("color-selection-green").value=b[1];document.getElementById("color-selection-blue").value=b[2];var a=document.getElementById("color-selection-options"),c=wpd.appData.getPlotData().topColors,d=10<c.length?10:c.length,f,n="",p,m;for(f=0;f<d;f++)m="rgb("+
c[f].r+","+c[f].g+","+c[f].b+");",p=c[f].percentage.toFixed(3)+"%",n+='<div class="colorOptionBox" style="background-color: '+m+'" title="'+p+'" onclick="wpd.colorSelectionWidget.selectTopColor('+f+');"></div>';a.innerHTML=n;wpd.popup.show("color-selection-widget")}var b,d,c,f;return{setParams:function(a){b=a.color;d=a.triggerElementId;c=a.title;f=a.setColorDelegate;document.getElementById("color-selection-title").innerHTML=c},startPicker:a,pickColor:function(){wpd.popup.close("color-selection-widget");
var c=new wpd.ColorPickerTool;c.onComplete=function(c){b=c;f(c);wpd.graphicsWidget.removeTool();a()};wpd.graphicsWidget.setTool(c)},setColor:function(){var a=[];a[0]=parseInt(document.getElementById("color-selection-red").value,10);a[1]=parseInt(document.getElementById("color-selection-green").value,10);a[2]=parseInt(document.getElementById("color-selection-blue").value,10);b=a;f(a);wpd.popup.close("color-selection-widget");document.getElementById(d).style.backgroundColor="rgb("+b[0]+","+b[1]+","+
b[2]+")"},selectTopColor:function(c){var d=[],h=wpd.appData.getPlotData().topColors;d[0]=h[c].r;d[1]=h[c].g;d[2]=h[c].b;b=d;f(d);a()},testColor:function(){}}}();
wpd.colorPicker=function(){function a(){return{color:wpd.appData.getPlotData().getAutoDetector().fgColor,triggerElementId:"color-button",title:"Specify Plot (Foreground) Color",setColorDelegate:function(b){wpd.appData.getPlotData().getAutoDetector().fgColor=b}}}function b(){return{color:wpd.appData.getPlotData().getAutoDetector().bgColor,triggerElementId:"color-button",title:"Specify Background Color",setColorDelegate:function(b){wpd.appData.getPlotData().getAutoDetector().bgColor=b}}}function d(){var b=
document.getElementById("color-button"),a=document.getElementById("color-distance-value"),c=wpd.appData.getPlotData().getAutoDetector(),d=document.getElementById("color-detection-mode-select"),l;l="fg"===c.colorDetectionMode?c.fgColor:c.bgColor;color_distance=c.colorDistance;b.style.backgroundColor="rgb("+l[0]+","+l[1]+","+l[2]+")";a.value=color_distance;d.value=c.colorDetectionMode}function c(){var b=wpd.graphicsWidget.getAllContexts(),a=wpd.appData.getPlotData().getAutoDetector(),c=wpd.graphicsWidget.getImageSize(),
d,l,n;n=b.oriDataCtx.getImageData(0,0,c.width,c.height);a.imageData=b.oriImageCtx.getImageData(0,0,c.width,c.height);a.generateBinaryData();if(null!=a.mask&&0!==a.mask.length){for(d=0;d<a.mask.length;d++)l=a.mask[d],!0===a.binaryData[l]?(parseInt(l/c.width,10),n.data[4*l]=255,n.data[4*l+1]=255,n.data[4*l+2]=0,n.data[4*l+3]=255):(n.data[4*l]=0,n.data[4*l+1]=0,n.data[4*l+2]=0,n.data[4*l+3]=150);b.oriDataCtx.putImageData(n,0,0);wpd.graphicsWidget.copyImageDataLayerToScreen()}}return{startPicker:function(){wpd.graphicsWidget.removeTool();
wpd.graphicsWidget.removeRepainter();wpd.graphicsWidget.resetData();"fg"===wpd.appData.getPlotData().getAutoDetector().colorDetectionMode?wpd.colorSelectionWidget.setParams(a()):wpd.colorSelectionWidget.setParams(b());wpd.colorSelectionWidget.startPicker()},changeDetectionMode:function(){var b=document.getElementById("color-detection-mode-select");wpd.appData.getPlotData().getAutoDetector().colorDetectionMode=b.value;d()},changeColorDistance:function(){var b=parseFloat(document.getElementById("color-distance-value").value);
wpd.appData.getPlotData().getAutoDetector().colorDistance=b},init:d,testColorDetection:function(){wpd.graphicsWidget.removeTool();wpd.graphicsWidget.resetData();wpd.graphicsWidget.setRepainter(new wpd.ColorFilterRepainter);c()},paintFilteredColor:c}}();wpd.ColorPickerTool=function(){return function(){var a=wpd.graphicsWidget.getAllContexts();this.onMouseClick=function(b,d,c){b=a.oriImageCtx.getImageData(c.x,c.y,1,1);this.onComplete([b.data[0],b.data[1],b.data[2]])};this.onComplete=function(b){}}}();
wpd.ColorFilterRepainter=function(){return function(){this.painterName="colorFilterRepainter";this.onRedraw=function(){wpd.colorPicker.paintFilteredColor()}}}();wpd=wpd||{};
wpd.gridDetection=function(){return{start:function(){wpd.graphicsWidget.removeTool();wpd.graphicsWidget.removeRepainter();wpd.graphicsWidget.resetData();wpd.sidebar.show("grid-detection-sidebar")},markBox:function(){var a=new wpd.GridBoxTool;wpd.graphicsWidget.setTool(a)},clearMask:function(){wpd.graphicsWidget.removeTool();wpd.graphicsWidget.removeRepainter();wpd.appData.getPlotData().getAutoDetector().gridMask=null;wpd.graphicsWidget.resetData()},viewMask:function(){var a=new wpd.GridViewMaskTool;
wpd.graphicsWidget.setTool(a)},grabMask:function(){var a=wpd.graphicsWidget.getAllContexts(),b=wpd.graphicsWidget.getImageSize(),a=a.oriDataCtx.getImageData(0,0,b.width,b.height),d=[],c,f=0,e=wpd.appData.getPlotData().getAutoDetector(),g,h;for(c=0;c<a.data.length;c+=4)255===a.data[c]&&255===a.data[c+1]&&0===a.data[c+2]&&(d[f]=c/4,f++,g=parseInt(c/4%b.width,10),h=parseInt(c/4/b.width,10),1===f?(e.gridMask.xmin=g,e.gridMask.xmax=g,e.gridMask.ymin=h,e.gridMask.ymax=h):(g<e.gridMask.xmin&&(e.gridMask.xmin=
g),g>e.gridMask.xmax&&(e.gridMask.xmax=g),h<e.gridMask.ymin&&(e.gridMask.ymin=h),h>e.gridMask.ymax&&(e.gridMask.ymax=h)));e.gridMask.pixels=d},startColorPicker:function(){wpd.colorSelectionWidget.setParams({color:wpd.appData.getPlotData().getAutoDetector().gridLineColor,triggerElementId:"grid-color-picker-button",title:"Specify Grid Line Color",setColorDelegate:function(a){wpd.appData.getPlotData().getAutoDetector().gridLineColor=a}});wpd.colorSelectionWidget.startPicker()},testColor:function(){},
run:function(){wpd.graphicsWidget.removeTool();wpd.graphicsWidget.removeRepainter();var a=wpd.appData.getPlotData().getAutoDetector(),b=wpd.graphicsWidget.getAllContexts(),d=wpd.graphicsWidget.getImageSize();a.imageData=b.oriImageCtx.getImageData(0,0,d.width,d.height);a.generateGridBinaryData();wpd.gridDetectionCore.setHorizontalParameters(!0,5,5);wpd.gridDetectionCore.setVerticalParameters(!0,5,5);wpd.gridDetectionCore.run()},clear:function(){wpd.graphicsWidget.removeTool();wpd.appData.getPlotData().gridData=
null;wpd.graphicsWidget.removeRepainter();wpd.graphicsWidget.resetData()}}}();
wpd.GridBoxTool=function(){return function(){var a=!1,b,d,c=wpd.graphicsWidget.getAllContexts(),f,e,g=function(){wpd.graphicsWidget.resetHover();c.hoverCtx.strokeStyle="rgb(0,0,0)";c.hoverCtx.strokeRect(d.x,d.y,e.x-d.x,e.y-d.y)},h=function(e,g,h){!1!==a&&(clearTimeout(f),a=!1,wpd.graphicsWidget.resetHover(),c.dataCtx.fillStyle="rgba(255,255,0,0.8)",c.dataCtx.fillRect(d.x,d.y,g.x-d.x,g.y-d.y),c.oriDataCtx.fillStyle="rgba(255,255,0,0.8)",c.oriDataCtx.fillRect(b.x,b.y,h.x-b.x,h.y-b.y))},l=null,n=null;
this.onAttach=function(){wpd.graphicsWidget.setRepainter(new wpd.GridMaskPainter);document.getElementById("grid-mask-box").classList.add("pressed-button");document.getElementById("grid-mask-view").classList.add("pressed-button")};this.onMouseDown=function(c,e,f){!0!==a&&(a=!0,b=f,d=e)};this.onMouseMove=function(b,c,d){!1!==a&&(e=c,clearTimeout(f),f=setTimeout(g,2))};this.onMouseOut=function(b,c,d){!0===a&&(clearTimeout(f),l=c,n=d)};this.onDocumentMouseUp=function(b,a,c){null!=l&&null!=n?h(b,l,n):
h(b,a,c);n=l=null};this.onMouseUp=function(b,a,c){h(b,a,c)};this.onRemove=function(){document.getElementById("grid-mask-box").classList.remove("pressed-button");document.getElementById("grid-mask-view").classList.remove("pressed-button");wpd.gridDetection.grabMask()}}}();
wpd.GridViewMaskTool=function(){return function(){this.onAttach=function(){wpd.graphicsWidget.setRepainter(new wpd.GridMaskPainter);document.getElementById("grid-mask-view").classList.add("pressed-button")};this.onRemove=function(){document.getElementById("grid-mask-view").classList.remove("pressed-button");wpd.gridDetection.grabMask()}}}();
wpd.GridMaskPainter=function(){return function(){var a=wpd.graphicsWidget.getAllContexts(),b=wpd.appData.getPlotData().getAutoDetector(),d=function(){if(null!=b.gridMask.pixels&&0!==b.gridMask.pixels.length){var c,d;c=wpd.graphicsWidget.getImageSize();imgData=a.oriDataCtx.getImageData(0,0,c.width,c.height);for(c=0;c<b.gridMask.pixels.length;c++)d=b.gridMask.pixels[c],imgData.data[4*d]=255,imgData.data[4*d+1]=255,imgData.data[4*d+2]=0,imgData.data[4*d+3]=200;a.oriDataCtx.putImageData(imgData,0,0);
wpd.graphicsWidget.copyImageDataLayerToScreen()}};this.painterName="gridMaskPainter";this.onRedraw=function(){wpd.gridDetection.grabMask();d()};this.onAttach=function(){wpd.graphicsWidget.resetData();d()}}}();wpd=wpd||{};
wpd.imageOps=function(){function a(b,a,f){var e,g,h,l,n,p;for(e=0;e<f;e++)for(g=0;g<a/2;g++)for(h=4*(e*a+g),l=4*((e+1)*a-(g+1)),p=0;4>p;p++)n=b.data[h+p],b.data[h+p]=b.data[l+p],b.data[l+p]=n;return{imageData:b,width:a,height:f}}function b(b,a,f){var e,g,h,l,n,p;for(e=0;e<f/2;e++)for(g=0;g<a;g++)for(h=4*(e*a+g),l=4*((f-(e+2))*a+g),p=0;4>p;p++)n=b.data[h+p],b.data[h+p]=b.data[l+p],b.data[l+p]=n;return{imageData:b,width:a,height:f}}return{hflip:function(){wpd.graphicsWidget.runImageOp(a)},vflip:function(){wpd.graphicsWidget.runImageOp(b)}}}();
wpd=wpd||{};wpd.keyCodes=function(){return{isUp:function(a){return 38===a},isDown:function(a){return 40===a},isLeft:function(a){return 37===a},isRight:function(a){return 39===a},isAlphabet:function(a,b){return 90<a||65>a?!1:String.fromCharCode(a).toLowerCase()===b}}}();wpd=wpd||{};
wpd.acquireData=function(){function a(){var b=new wpd.ManualSelectionTool;wpd.graphicsWidget.setTool(b)}function b(){var b=new wpd.DeleteDataPointTool;wpd.graphicsWidget.setTool(b)}function d(){wpd.graphicsWidget.setTool(new wpd.AdjustDataPointTool)}return{load:function(){wpd.appData.isAligned()?(wpd.sidebar.show("acquireDataSidebar"),wpd.dataPointCounter.setCount(),wpd.graphicsWidget.removeTool(),wpd.graphicsWidget.setRepainter(new wpd.DataPointsRepainter),a()):wpd.messagePopup.show("Acquire Data",
"Please calibrate the axes before acquiring data.")},manualSelection:a,adjustPoints:d,deletePoint:b,clearAll:function(){wpd.appData.getPlotData().getActiveDataSeries().clearAll();wpd.graphicsWidget.removeTool();wpd.graphicsWidget.resetData();wpd.dataPointCounter.setCount();wpd.graphicsWidget.removeRepainter()},undo:function(){wpd.appData.getPlotData().getActiveDataSeries().removeLastPixel();wpd.graphicsWidget.resetData();wpd.graphicsWidget.forceHandlerRepaint();wpd.dataPointCounter.setCount()},showSidebar:function(){wpd.sidebar.show("acquireDataSidebar")},
switchToolOnKeyPress:function(c){switch(c){case "d":b();break;case "a":a();break;case "s":d()}}}}();
wpd.ManualSelectionTool=function(){return function(){var a=wpd.graphicsWidget.getAllContexts(),b=wpd.appData.getPlotData();this.onAttach=function(){document.getElementById("manual-select-button").classList.add("pressed-button");wpd.graphicsWidget.setRepainter(new wpd.DataPointsRepainter)};this.onMouseClick=function(d,c,f){b.getActiveDataSeries().addPixel(f.x,f.y);a.dataCtx.beginPath();a.dataCtx.fillStyle="rgb(200,0,0)";a.dataCtx.arc(c.x,c.y,3,0,2*Math.PI,!0);a.dataCtx.fill();a.oriDataCtx.beginPath();
a.oriDataCtx.fillStyle="rgb(200,0,0)";a.oriDataCtx.arc(f.x,f.y,3,0,2*Math.PI,!0);a.oriDataCtx.fill();wpd.graphicsWidget.updateZoomOnEvent(d);wpd.dataPointCounter.setCount()};this.onRemove=function(){document.getElementById("manual-select-button").classList.remove("pressed-button")};this.onKeyDown=function(a){var c=b.getActiveDataSeries(),f=c.getCount()-1,e=c.getPixel(f),g=0.5/wpd.graphicsWidget.getZoomRatio();if(wpd.keyCodes.isUp(a.keyCode))e.y-=g;else if(wpd.keyCodes.isDown(a.keyCode))e.y+=g;else if(wpd.keyCodes.isLeft(a.keyCode))e.x-=
g;else if(wpd.keyCodes.isRight(a.keyCode))e.x+=g;else{(wpd.keyCodes.isAlphabet(a.keyCode,"a")||wpd.keyCodes.isAlphabet(a.keyCode,"s")||wpd.keyCodes.isAlphabet(a.keyCode,"d"))&&wpd.acquireData.switchToolOnKeyPress(String.fromCharCode(a.keyCode).toLowerCase());return}c.setPixelAt(f,e.x,e.y);wpd.graphicsWidget.resetData();wpd.graphicsWidget.forceHandlerRepaint();wpd.graphicsWidget.updateZoomToImagePosn(e.x,e.y);a.preventDefault()}}}();
wpd.DeleteDataPointTool=function(){return function(){wpd.graphicsWidget.getAllContexts();var a=wpd.appData.getPlotData();this.onAttach=function(){document.getElementById("delete-point-button").classList.add("pressed-button");wpd.graphicsWidget.setRepainter(new wpd.DataPointsRepainter)};this.onMouseClick=function(b,d,c){a.getActiveDataSeries().removeNearestPixel(c.x,c.y);wpd.graphicsWidget.resetData();wpd.graphicsWidget.forceHandlerRepaint();wpd.graphicsWidget.updateZoomOnEvent(b);wpd.dataPointCounter.setCount()};
this.onKeyDown=function(b){(wpd.keyCodes.isAlphabet(b.keyCode,"a")||wpd.keyCodes.isAlphabet(b.keyCode,"s")||wpd.keyCodes.isAlphabet(b.keyCode,"d"))&&wpd.acquireData.switchToolOnKeyPress(String.fromCharCode(b.keyCode).toLowerCase())};this.onRemove=function(){document.getElementById("delete-point-button").classList.remove("pressed-button")}}}();
wpd.DataPointsRepainter=function(){return function(){var a=function(){var b=wpd.graphicsWidget.getAllContexts(),a=wpd.appData.getPlotData().getActiveDataSeries(),c,f,e,g;for(c=0;c<a.getCount();c++)f=a.getPixel(c),g=0<=a.getSelectedPixels().indexOf(c),e=wpd.graphicsWidget.screenPx(f.x,f.y),b.dataCtx.beginPath(),b.dataCtx.fillStyle=g?"rgb(0,200,0)":"rgb(200,0,0)",b.dataCtx.arc(e.x,e.y,3,0,2*Math.PI,!0),b.dataCtx.fill(),b.oriDataCtx.beginPath(),b.oriDataCtx.fillStyle=g?"rgb(0,200,0)":"rgb(200,0,0)",
b.oriDataCtx.arc(f.x,f.y,3,0,2*Math.PI,!0),b.oriDataCtx.fill()};this.painterName="dataPointsRepainter";this.onAttach=function(){wpd.graphicsWidget.resetData();a()};this.onRedraw=function(){a()};this.onForcedRedraw=function(){wpd.graphicsWidget.resetData();a()}}}();
wpd.AdjustDataPointTool=function(){return function(){this.onAttach=function(){document.getElementById("manual-adjust-button").classList.add("pressed-button");wpd.graphicsWidget.setRepainter(new wpd.DataPointsRepainter)};this.onRemove=function(){wpd.appData.getPlotData().getActiveDataSeries().unselectAll();wpd.graphicsWidget.forceHandlerRepaint();document.getElementById("manual-adjust-button").classList.remove("pressed-button")};this.onMouseClick=function(a,b,d){b=wpd.appData.getPlotData().getActiveDataSeries();
b.unselectAll();b.selectNearestPixel(d.x,d.y);wpd.graphicsWidget.forceHandlerRepaint();wpd.graphicsWidget.updateZoomOnEvent(a)};this.onKeyDown=function(a){if(wpd.keyCodes.isAlphabet(a.keyCode,"a")||wpd.keyCodes.isAlphabet(a.keyCode,"s")||wpd.keyCodes.isAlphabet(a.keyCode,"d"))wpd.acquireData.switchToolOnKeyPress(String.fromCharCode(a.keyCode).toLowerCase());else{var b=wpd.appData.getPlotData().getActiveDataSeries(),d=b.getSelectedPixels()[0];if(null!=d){var c=b.getPixel(d),f=c.x,c=c.y,e=!0===a.shiftKey?
5/wpd.graphicsWidget.getZoomRatio():0.5/wpd.graphicsWidget.getZoomRatio();if(wpd.keyCodes.isUp(a.keyCode))c-=e;else if(wpd.keyCodes.isDown(a.keyCode))c+=e;else if(wpd.keyCodes.isLeft(a.keyCode))f-=e;else if(wpd.keyCodes.isRight(a.keyCode))f+=e;else return;b.setPixelAt(d,f,c);wpd.graphicsWidget.forceHandlerRepaint();wpd.graphicsWidget.updateZoomToImagePosn(f,c);a.preventDefault();a.stopPropagation()}}}}}();
wpd.dataPointCounter=function(){return{setCount:function(){var a=document.getElementsByClassName("data-point-counter"),b;for(b=0;b<a.length;b++)a[b].innerHTML=wpd.appData.getPlotData().getActiveDataSeries().getCount()}}}();wpd=wpd||{};
wpd.dataMask=function(){return{grabMask:function(){var a=wpd.graphicsWidget.getAllContexts(),b=wpd.graphicsWidget.getImageSize(),a=a.oriDataCtx.getImageData(0,0,b.width,b.height),b=[],d,c=0,f=wpd.appData.getPlotData().getAutoDetector();for(d=0;d<a.data.length;d+=4)255===a.data[d]&&255===a.data[d+1]&&0===a.data[d+2]&&(b[c]=d/4,c++);f.mask=b},markBox:function(){var a=new wpd.BoxMaskTool;wpd.graphicsWidget.setTool(a)},markPen:function(){var a=new wpd.PenMaskTool;wpd.graphicsWidget.setTool(a)},eraseMarks:function(){var a=
new wpd.EraseMaskTool;wpd.graphicsWidget.setTool(a)},viewMask:function(){var a=new wpd.ViewMaskTool;wpd.graphicsWidget.setTool(a)}}}();
wpd.BoxMaskTool=function(){return function(){var a=!1,b,d,c=wpd.graphicsWidget.getAllContexts(),f,e,g=function(){wpd.graphicsWidget.resetHover();c.hoverCtx.strokeStyle="rgb(0,0,0)";c.hoverCtx.strokeRect(d.x,d.y,e.x-d.x,e.y-d.y)},h=function(e,g,h){!1!==a&&(clearTimeout(f),a=!1,wpd.graphicsWidget.resetHover(),c.dataCtx.fillStyle="rgba(255,255,0,0.8)",c.dataCtx.fillRect(d.x,d.y,g.x-d.x,g.y-d.y),c.oriDataCtx.fillStyle="rgba(255,255,0,0.8)",c.oriDataCtx.fillRect(b.x,b.y,h.x-b.x,h.y-b.y))},l=null,n=null;
this.onAttach=function(){wpd.graphicsWidget.setRepainter(new wpd.MaskPainter);document.getElementById("box-mask").classList.add("pressed-button");document.getElementById("view-mask").classList.add("pressed-button")};this.onMouseDown=function(c,e,f){!0!==a&&(a=!0,b=f,d=e)};this.onMouseMove=function(b,c,d){!1!==a&&(e=c,clearTimeout(f),f=setTimeout(g,2))};this.onMouseOut=function(b,c,d){!0===a&&(clearTimeout(f),l=c,n=d)};this.onDocumentMouseUp=function(b,a,c){null!=l&&null!=n?h(b,l,n):h(b,a,c);n=l=null};
this.onMouseUp=function(b,a,c){h(b,a,c)};this.onRemove=function(){document.getElementById("box-mask").classList.remove("pressed-button");document.getElementById("view-mask").classList.remove("pressed-button");wpd.dataMask.grabMask()}}}();
wpd.PenMaskTool=function(){return function(){var a=wpd.graphicsWidget.getAllContexts(),b=!1,d,c,f,e=function(){a.dataCtx.strokeStyle="rgba(255,255,0,0.8)";a.dataCtx.lineTo(c.x,c.y);a.dataCtx.stroke();a.oriDataCtx.strokeStyle="rgba(255,255,0,0.8)";a.oriDataCtx.lineTo(f.x,f.y);a.oriDataCtx.stroke()};this.onAttach=function(){wpd.graphicsWidget.setRepainter(new wpd.MaskPainter);document.getElementById("pen-mask").classList.add("pressed-button");document.getElementById("view-mask").classList.add("pressed-button");
wpd.toolbar.show("paintToolbar")};this.onMouseDown=function(c,d,e){!0!==b&&(c=parseInt(document.getElementById("paintThickness").value,10),b=!0,a.dataCtx.strokeStyle="rgba(255,255,0,0.8)",a.dataCtx.lineWidth=c*wpd.graphicsWidget.getZoomRatio(),a.dataCtx.beginPath(),a.dataCtx.moveTo(d.x,d.y),a.oriDataCtx.strokeStyle="rgba(255,255,0,0.8)",a.oriDataCtx.lineWidth=c,a.oriDataCtx.beginPath(),a.oriDataCtx.moveTo(e.x,e.y))};this.onMouseMove=function(a,h,l){!1!==b&&(c=h,f=l,clearTimeout(d),d=setTimeout(e,
2))};this.onMouseUp=function(c,e,f){clearTimeout(d);a.dataCtx.closePath();a.dataCtx.lineWidth=1;a.oriDataCtx.closePath();a.oriDataCtx.lineWidth=1;b=!1};this.onMouseOut=function(b,a,c){this.onMouseUp(b,a,c)};this.onRemove=function(){document.getElementById("pen-mask").classList.remove("pressed-button");document.getElementById("view-mask").classList.remove("pressed-button");wpd.dataMask.grabMask();wpd.toolbar.clear()}}}();
wpd.EraseMaskTool=function(){return function(){var a=wpd.graphicsWidget.getAllContexts(),b=!1,d,c,f,e=function(){a.dataCtx.globalCompositeOperation="destination-out";a.oriDataCtx.globalCompositeOperation="destination-out";a.dataCtx.strokeStyle="rgba(255,255,0,1)";a.dataCtx.lineTo(c.x,c.y);a.dataCtx.stroke();a.oriDataCtx.strokeStyle="rgba(255,255,0,1)";a.oriDataCtx.lineTo(f.x,f.y);a.oriDataCtx.stroke()};this.onAttach=function(){wpd.graphicsWidget.setRepainter(new wpd.MaskPainter);document.getElementById("erase-mask").classList.add("pressed-button");
document.getElementById("view-mask").classList.add("pressed-button");wpd.toolbar.show("paintToolbar")};this.onMouseDown=function(c,d,e){!0!==b&&(c=parseInt(document.getElementById("paintThickness").value,10),b=!0,a.dataCtx.globalCompositeOperation="destination-out",a.oriDataCtx.globalCompositeOperation="destination-out",a.dataCtx.strokeStyle="rgba(0,0,0,1)",a.dataCtx.lineWidth=c*wpd.graphicsWidget.getZoomRatio(),a.dataCtx.beginPath(),a.dataCtx.moveTo(d.x,d.y),a.oriDataCtx.strokeStyle="rgba(0,0,0,1)",
a.oriDataCtx.lineWidth=c,a.oriDataCtx.beginPath(),a.oriDataCtx.moveTo(e.x,e.y))};this.onMouseMove=function(a,h,l){!1!==b&&(c=h,f=l,clearTimeout(d),d=setTimeout(e,2))};this.onMouseOut=function(b,a,c){this.onMouseUp(b,a,c)};this.onMouseUp=function(c,e,f){clearTimeout(d);a.dataCtx.closePath();a.dataCtx.lineWidth=1;a.oriDataCtx.closePath();a.oriDataCtx.lineWidth=1;a.dataCtx.globalCompositeOperation="source-over";a.oriDataCtx.globalCompositeOperation="source-over";b=!1};this.onRemove=function(){document.getElementById("erase-mask").classList.remove("pressed-button");
document.getElementById("view-mask").classList.remove("pressed-button");wpd.dataMask.grabMask();wpd.toolbar.clear()}}}();wpd.ViewMaskTool=function(){return function(){this.onAttach=function(){wpd.graphicsWidget.setRepainter(new wpd.MaskPainter);document.getElementById("view-mask").classList.add("pressed-button")};this.onRemove=function(){document.getElementById("view-mask").classList.remove("pressed-button");wpd.dataMask.grabMask()}}}();
wpd.MaskPainter=function(){return function(){var a=wpd.graphicsWidget.getAllContexts(),b=wpd.appData.getPlotData().getAutoDetector(),d=function(){if(null!=b.mask&&0!==b.mask.length){var c,d;c=wpd.graphicsWidget.getImageSize();imgData=a.oriDataCtx.getImageData(0,0,c.width,c.height);for(c=0;c<b.mask.length;c++)d=b.mask[c],imgData.data[4*d]=255,imgData.data[4*d+1]=255,imgData.data[4*d+2]=0,imgData.data[4*d+3]=200;a.oriDataCtx.putImageData(imgData,0,0);wpd.graphicsWidget.copyImageDataLayerToScreen()}};
this.painterName="dataMaskPainter";this.onRedraw=function(){wpd.dataMask.grabMask();d()};this.onAttach=function(){wpd.graphicsWidget.resetData();d()}}}();wpd=wpd||{};
wpd.distanceMeasurement=function(){return{start:function(){wpd.graphicsWidget.removeTool();wpd.graphicsWidget.resetData();var a=wpd.appData.getPlotData();null==a.distanceMeasurementData&&(a.distanceMeasurementData=new wpd.ConnectedPoints(2));wpd.sidebar.show("measure-distances-sidebar");wpd.graphicsWidget.setTool(new wpd.AddMeasurementTool("distance"));wpd.graphicsWidget.forceHandlerRepaint()},addPair:function(){wpd.graphicsWidget.setTool(new wpd.AddMeasurementTool("distance"))},deletePair:function(){wpd.graphicsWidget.setTool(new wpd.DeleteMeasurementTool("distance"))},
clearAll:function(){wpd.graphicsWidget.removeTool();wpd.graphicsWidget.resetData();wpd.appData.getPlotData().distanceMeasurementData=new wpd.ConnectedPoints(2)}}}();
wpd.angleMeasurement=function(){return{start:function(){wpd.graphicsWidget.removeTool();wpd.graphicsWidget.resetData();var a=wpd.appData.getPlotData();null==a.angleMeasurementData&&(a.angleMeasurementData=new wpd.ConnectedPoints(3));wpd.sidebar.show("measure-angles-sidebar");wpd.graphicsWidget.setTool(new wpd.AddMeasurementTool("angle"));wpd.graphicsWidget.forceHandlerRepaint()},addAngle:function(){wpd.graphicsWidget.setTool(new wpd.AddMeasurementTool("angle"))},deleteAngle:function(){wpd.graphicsWidget.setTool(new wpd.DeleteMeasurementTool("angle"))},
clearAll:function(){wpd.graphicsWidget.removeTool();wpd.graphicsWidget.resetData();wpd.appData.getPlotData().angleMeasurementData=new wpd.ConnectedPoints(3)}}}();
wpd.measurementData=function(){var a;return{showAngleData:function(){wpd.popup.show("measurement-data-window");var b=wpd.appData.getPlotData().angleMeasurementData,d=b.connectionCount(),c,f=document.getElementById("measurement-data-table");a="";for(c=0;c<d;c++)a+=c.toString()+", "+b.getAngle(c)+"\n";f.value=a},showDistanceData:function(){wpd.popup.show("measurement-data-window");var b=wpd.appData.getPlotData().distanceMeasurementData,d=b.connectionCount(),c,f=document.getElementById("measurement-data-table"),
e=wpd.appData.getPlotData().axes;a="";for(c=0;c<d;c++)a=!0===wpd.appData.isAligned()&&e instanceof wpd.MapAxes?a+(c.toString()+", "+e.pixelToDataDistance(b.getDistance(c))+"\n"):a+(c.toString()+", "+b.getDistance(c)+"\n");f.value=a},selectAll:function(){var b=document.getElementById("measurement-data-table");b.focus();b.select()},generateCSV:function(){var b,d,c,f=JSON.stringify(a);b=document.createElement("div");d=document.createElement("form");c=document.createElement("input");d.setAttribute("method",
"post");d.setAttribute("action","php/csvexport.php");c.setAttribute("type","text");c.setAttribute("name","data");d.appendChild(c);b.appendChild(d);document.body.appendChild(b);b.style.display="none";c.setAttribute("value",f);d.submit();document.body.removeChild(b)},close:function(){a="";wpd.popup.close("measurement-data-window")}}}();
wpd.AddMeasurementTool=function(){return function(a){var b="distance"===a,d=wpd.graphicsWidget.getAllContexts(),c=wpd.appData.getPlotData(),f=0,e=!0,g=[],h=b?2:3;this.onAttach=function(){document.getElementById(!0===b?"add-pair-button":"add-angle-button").classList.add("pressed-button");wpd.graphicsWidget.setRepainter(new wpd.MeasurementRepainter(a))};this.onRemove=function(){document.getElementById(!0===b?"add-pair-button":"add-angle-button").classList.remove("pressed-button")};this.onMouseClick=
function(l,n,p){if(e){wpd.graphicsWidget.resetHover();g[2*f]=p.x;g[2*f+1]=p.y;f+=1;f===h&&(e=!1,b?c.distanceMeasurementData.addConnection(g):c.angleMeasurementData.addConnection(g),wpd.graphicsWidget.forceHandlerRepaint(),wpd.graphicsWidget.setTool(new wpd.AdjustMeasurementTool(a)));if(1<f){var m=wpd.graphicsWidget.screenPx(g[2*(f-2)],g[2*(f-2)+1]);d.dataCtx.beginPath();d.dataCtx.strokeStyle="rgb(0,0,10)";d.dataCtx.moveTo(m.x,m.y);d.dataCtx.lineTo(n.x,n.y);d.dataCtx.stroke();d.oriDataCtx.beginPath();
d.oriDataCtx.strokeStyle="rgb(0,0,10)";d.oriDataCtx.moveTo(g[2*(f-2)],g[2*(f-2)+1]);d.oriDataCtx.lineTo(p.x,p.y);d.oriDataCtx.stroke()}d.dataCtx.beginPath();d.dataCtx.fillStyle="rgb(200, 0, 0)";d.dataCtx.arc(n.x,n.y,3,0,2*Math.PI,!0);d.dataCtx.fill();d.oriDataCtx.beginPath();d.oriDataCtx.fillStyle="rgb(200,0,0)";d.oriDataCtx.arc(p.x,p.y,3,0,2*Math.PI,!0);d.oriDataCtx.fill()}wpd.graphicsWidget.updateZoomOnEvent(l)};this.onMouseMove=function(b,a,c){e&&1<=f&&(wpd.graphicsWidget.resetHover(),b=wpd.graphicsWidget.screenPx(g[2*
(f-1)],g[2*(f-1)+1]),d.hoverCtx.beginPath(),d.hoverCtx.strokeStyle="rgb(0,0,0)",d.hoverCtx.moveTo(b.x,b.y),d.hoverCtx.lineTo(a.x,a.y),d.hoverCtx.stroke())};this.onKeyDown=function(b){}}}();
wpd.DeleteMeasurementTool=function(){return function(a){var b="distance"===a;wpd.graphicsWidget.getAllContexts();var d=wpd.appData.getPlotData();this.onAttach=function(){document.getElementById(!0===b?"delete-pair-button":"delete-angle-button").classList.add("pressed-button");wpd.graphicsWidget.setRepainter(new wpd.MeasurementRepainter(a))};this.onRemove=function(){document.getElementById(!0===b?"delete-pair-button":"delete-angle-button").classList.remove("pressed-button")};this.onMouseClick=function(c,
f,e){b?d.distanceMeasurementData.deleteNearestConnection(e.x,e.y):d.angleMeasurementData.deleteNearestConnection(e.x,e.y);wpd.graphicsWidget.setTool(new wpd.AdjustMeasurementTool(a));wpd.graphicsWidget.resetData();wpd.graphicsWidget.forceHandlerRepaint();wpd.graphicsWidget.updateZoomOnEvent(c)}}}();
wpd.AdjustMeasurementTool=function(){return function(a){this.onAttach=function(){wpd.graphicsWidget.setRepainter(new wpd.MeasurementRepainter(a))};this.onMouseClick=function(b,d,c){d=wpd.appData.getPlotData();"distance"===a?d.distanceMeasurementData.selectNearestPoint(c.x,c.y):"angle"===a&&d.angleMeasurementData.selectNearestPoint(c.x,c.y);wpd.graphicsWidget.forceHandlerRepaint();wpd.graphicsWidget.updateZoomOnEvent(b)};this.onKeyDown=function(b){if(wpd.keyCodes.isAlphabet(b.keyCode,"a"))wpd.graphicsWidget.setTool(new wpd.AddMeasurementTool(a));
else if(wpd.keyCodes.isAlphabet(b.keyCode,"d"))wpd.graphicsWidget.setTool(new wpd.DeleteMeasurementTool(a));else{var d=wpd.appData.getPlotData(),d="distance"===a?d.distanceMeasurementData:d.angleMeasurementData,c=d.getSelectedConnectionAndPoint();if(0<=c.connectionIndex&&0<=c.pointIndex){var f=!0===b.shiftKey?5/wpd.graphicsWidget.getZoomRatio():0.5/wpd.graphicsWidget.getZoomRatio(),e=d.getPointAt(c.connectionIndex,c.pointIndex);if(wpd.keyCodes.isUp(b.keyCode))e.y-=f;else if(wpd.keyCodes.isDown(b.keyCode))e.y+=
f;else if(wpd.keyCodes.isLeft(b.keyCode))e.x-=f;else if(wpd.keyCodes.isRight(b.keyCode))e.x+=f;else return;d.setPointAt(c.connectionIndex,c.pointIndex,e.x,e.y);wpd.graphicsWidget.forceHandlerRepaint();wpd.graphicsWidget.updateZoomToImagePosn(e.x,e.y);b.preventDefault();b.stopPropagation()}}}}}();
wpd.MeasurementRepainter=function(){return function(a){var b="distance"===a,d="angle"===a,c=wpd.graphicsWidget.getAllContexts(),f=function(b,a,d,e,f,g,q,r){c.dataCtx.beginPath();c.dataCtx.strokeStyle="rgb(0,0,10)";c.dataCtx.moveTo(b,a);c.dataCtx.lineTo(d,e);c.dataCtx.stroke();c.oriDataCtx.beginPath();c.oriDataCtx.strokeStyle="rgb(0,0,10)";c.oriDataCtx.moveTo(f,g);c.oriDataCtx.lineTo(q,r);c.oriDataCtx.stroke()},e=function(b,a,d,e,f){c.dataCtx.beginPath();c.dataCtx.fillStyle=f?"rgb(0, 200, 0)":"rgb(200, 0, 0)";
c.dataCtx.arc(b,a,3,0,2*Math.PI,!0);c.dataCtx.fill();c.oriDataCtx.beginPath();c.oriDataCtx.fillStyle=f?"rgb(0,200,0)":"rgb(200,0,0)";c.oriDataCtx.arc(d,e,3,0,2*Math.PI,!0);c.oriDataCtx.fill()},g=function(b,a,d,e,f){c.dataCtx.font="14px sans-serif";c.dataCtx.fillText(f,parseInt(b,10),parseInt(a,10));c.oriDataCtx.font="14px sans-serif";c.oriDataCtx.fillText(f,parseInt(d,10),parseInt(e,10))};this.painterName="measurementRepainter-"+a;this.onAttach=function(){wpd.graphicsWidget.resetData()};this.onRedraw=
function(){if(b){var a=wpd.appData.getPlotData().distanceMeasurementData,l=a.connectionCount(),n,p,m,k,q,r,s,t,u,v,w=wpd.appData.getPlotData().axes;for(n=0;n<l;n++)p=a.getConnectionAt(n),m=p[0],k=p[1],q=p[2],p=p[3],u=a.isPointSelected(n,0),v=a.isPointSelected(n,1),t=!0===wpd.appData.isAligned()&&w instanceof wpd.MapAxes?"["+n.toString()+"]: "+w.pixelToDataDistance(a.getDistance(n)).toFixed(2)+" "+w.getUnits():"["+n.toString()+"]: "+a.getDistance(n).toFixed(2)+" px",r=wpd.graphicsWidget.screenPx(m,
k),s=wpd.graphicsWidget.screenPx(q,p),f(r.x,r.y,s.x,s.y,m,k,q,p),e(r.x,r.y,m,k,u),e(s.x,s.y,q,p,v),g(0.5*(r.x+s.x),0.5*(r.y+s.y),0.5*(m+q),0.5*(k+p),t)}if(d){var a=wpd.appData.getPlotData().angleMeasurementData,l=a.connectionCount(),y,F,H,J,D;for(n=0;n<l;n++)q=a.getConnectionAt(n),s=q[0],t=q[1],m=q[2],k=q[3],u=q[4],v=q[5],H=a.isPointSelected(n,0),J=a.isPointSelected(n,1),D=a.isPointSelected(n,2),w="["+n.toString()+"]: "+a.getAngle(n).toFixed(2)+"\u00b0",r=Math.atan2(t-k,s-m),p=Math.atan2(v-k,u-m),
y=wpd.graphicsWidget.screenPx(s,t),q=wpd.graphicsWidget.screenPx(m,k),F=wpd.graphicsWidget.screenPx(u,v),f(y.x,y.y,q.x,q.y,s,t,m,k),f(q.x,q.y,F.x,F.y,m,k,u,v),e(y.x,y.y,s,t,H),e(q.x,q.y,m,k,J),e(F.x,F.y,u,v,D),s=q.x,t=q.y,u=m,v=k,c.dataCtx.beginPath(),c.dataCtx.strokeStyle="rgb(0,0,10)",c.dataCtx.arc(s,t,15,r,p,!0),c.dataCtx.stroke(),c.oriDataCtx.beginPath(),c.oriDataCtx.strokeStyle="rgb(0,0,10)",c.oriDataCtx.arc(u,v,15,r,p,!0),c.oriDataCtx.stroke(),g(q.x+10,q.y+15,m+10,k+15,w)}};this.onForcedRedraw=
function(){wpd.graphicsWidget.resetData();this.onRedraw()}}}();wpd=wpd||{};wpd.saveResume=function(){return{save:function(){var a=wpd.appData.getPlotData().getAutoDetector().imageData,b=new XMLHttpRequest,d=new FormData;b.open("POST","php/test.php",!0);b.onload=function(a){console.log("done")};a=new Blob(BSON.serialize(a),{type:"application/bson"});d.append("file.bson",a,"file.bson");b.send(d)}}}();wpd=wpd||{};
wpd.scriptInjector=function(){return{start:function(){wpd.popup.show("runScriptPopup")},cancel:function(){wpd.popup.close("runScriptPopup")},load:function(){var a=document.getElementById("runScriptFileInput");wpd.popup.close("runScriptPopup");if(1==a.files.length){var b=new FileReader;b.onload=function(){eval(b.result);wpdscript.run();window.wpdscript=wpdscript};b.readAsText(a.files[0])}}}}();wpd=wpd||{};wpd.browserInfo=function(){return{checkBrowser:function(){window.FileReader||alert("\tWARNING!\nYour web browser is not supported. This program might not behave as intended. Please use a recent version of Google Chrome, Firefox or Safari browser.")}}}();
